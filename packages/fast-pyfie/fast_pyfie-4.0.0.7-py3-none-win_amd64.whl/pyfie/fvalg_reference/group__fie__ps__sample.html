<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=Shift_JIS">
<title>FIEライブラリ: サンプルコード</title>
<link href="fvalg-prod.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- 作成： Doxygen 1.5.6-FASTSP-p2 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="contents">
<h1>サンプルコード<br>
<small>
[<a class="el" href="group__fie__ps.html">照度差ステレオ</a>]</small>
</h1><h2><a class="anchor" name="fie_ps_code_basic">
基本的な使用例</a></h2>
<h3><a class="anchor" name="fie_ps_woodham_example_code">
コード</a></h3>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include "fie.h"</span>
<span class="preprocessor">#include "oal_aloc.h"</span>

<span class="comment">// --- リング照明使用の照度差ステレオ法サンプル ---</span>
<span class="keyword">static</span> INT do_ring_woodham()
{   
    INT status = <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cdec888cfe6642ce77c95e72fd369c9304" title="不明なエラー">F_ERR_UNKNOWN</a>;
    INT img_num;<span class="comment">//撮像枚数</span>

    <span class="comment">// 画像のパス</span>
    
    <span class="keyword">const</span> CHAR* img_fnames[] = {
        
        <span class="stringliteral">"input_img_files/00.png"</span>,
        <span class="stringliteral">"input_img_files/01.png"</span>,
        <span class="stringliteral">"input_img_files/02.png"</span>,
        <span class="stringliteral">"input_img_files/03.png"</span>,
        <span class="stringliteral">"input_img_files/04.png"</span>,
        <span class="stringliteral">"input_img_files/05.png"</span>,
        <span class="stringliteral">"input_img_files/06.png"</span>,
        <span class="stringliteral">"input_img_files/07.png"</span>
    };


    <span class="comment">// 読み込む用画像</span>
    FHANDLE himg_temp = NULL;

    <span class="comment">// himg_tempをまとめる画像</span>
    FHANDLE himg_all = NULL;
    FHANDLE himg_all_child = NULL;

    FHANDLE himg_normal_double_after = NULL;

    <span class="comment">//法線画像用</span>
    FHANDLE himg_normal_double = NULL;
    FHANDLE himg_normal_uc8 = NULL;

    <span class="comment">//曲率画像用</span>
    FHANDLE hdst_curvature_mean_double = NULL;
    FHANDLE hdst_curvature_mean_uc8 = NULL;

    <span class="comment">//高さ画像（frankot_chellappa）用</span>
    FHANDLE hdst_depth_frankot_chellappa_double = NULL;
    FHANDLE hdst_depth_frankot_chellappa_uc8 = NULL;

    <span class="comment">//高さ画像（horn_brooks）用</span>
    FHANDLE hdst_depth_horn_brooks_double = NULL;
    FHANDLE hdst_depth_horn_brooks_uc8 = NULL;

    INT i;

    INT ch_temp,type_temp, width_temp, height_temp;
    INT img_all_ch, type, width, height;
    DOUBLE light_height, light_radius;

    DOUBLE* slant=NULL;
    DOUBLE* tilt=NULL;
    INT light_order = 0;<span class="comment">//時計回り</span>
    DOUBLE initial_angle;

    DOUBLE normal_thresh = 0.10;
    INT curvature_type = <a class="code" href="group__fie__ps.html#gg731ede198c6e2e3d0c8f04e3374605463ec99590693bf854a8ab4ed6598ef89d" title="平均曲率">F_CURVATURE_MEAN</a>;

    INT iter;

    DOUBLE low_thresh = 5;

    <span class="comment">//ファイル数から撮像枚数を計算することにしています。</span>

    img_num = <span class="keyword">sizeof</span>(img_fnames) / <span class="keyword">sizeof</span>(CHAR*);
    
    <span class="comment">//最初の一枚目の画像読み込み（これを基準にする）</span>
    {
        status = <a class="code" href="group__fie__file__image.html#ga735b6accb014c4d15eec6e422b6a7bb" title=" &amp;lt;img class= inline-img src=&amp;quot;oss.png&amp;quot; alt=&amp;quot;[[OSS]]&amp;quot;&amp;gt;  画像ファイル...">fnFIE_load_img_file</a>(img_fnames[0], &amp;himg_temp, <a class="code" href="group__fie__file__image.html#gge1ca4e0484c0d907a215a44931bbcc9adb9994a1f48569964f60a6dd2eb91234" title="F_IMG_UC8, 3chで読込">F_COLOR_IMG_TYPE_UC8</a>);
        <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }

        status = <a class="code" href="group__fie__image.html#gbd877b77fb0ae99b4eabd32fa33044ae" title="画像情報取得">fnFIE_img_get_params</a>(himg_temp,&amp;ch_temp,&amp;type_temp,NULL,&amp;width_temp,&amp;height_temp);
        <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }
        
    }

    <span class="comment">//まとめる用の画像オブジェクトを確保</span>

    img_all_ch = img_num;
    width = width_temp;
    height = height_temp;
    type = type_temp;

    himg_all = <a class="code" href="group__fie__image.html#ge1fb319dbc93c5bbaba49d39904ca491" title="ルート画像の確保">fnFIE_img_root_alloc</a>(<a class="code" href="group__fie__image.html#ggd5e633c5daa48d827c052eb173c0effb290a3f243e6f7dfdd220061fe9077e98" title="8bit濃淡画像">F_IMG_UC8</a>, img_all_ch, width, height);
    <span class="keywordflow">if</span> (himg_all == NULL) { status = <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd66019e37614dd7208ad00ac047df2e6c" title="メモリ確保エラー">F_ERR_NOMEMORY</a>; <span class="keywordflow">goto</span> exit; }

    <span class="comment">//１枚目の処理</span>

    himg_all_child = <a class="code" href="group__fie__image.html#g84df62546f80d2637fd822677456f757" title="チャイルド画像の確保(単一チャネル割り当て版)">fnFIE_img_child_alloc_single_ch</a>(himg_all, 0, 0, 0, width, height);
    <span class="keywordflow">if</span> (himg_all_child == NULL) { status = <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd66019e37614dd7208ad00ac047df2e6c" title="メモリ確保エラー">F_ERR_NOMEMORY</a>; <span class="keywordflow">goto</span> exit; }

    status = <a class="code" href="group__fie__std__operation.html#gcb85dadcde458186d7720c2a92205b7d" title="画像コピー">fnFIE_img_copy</a>(himg_temp, himg_all_child);
    <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }

    <a class="code" href="group__fie__object.html#g5255bfc98226503d087b8614fcbb240c" title="オブジェクトを解放">fnFIE_free_object</a>(himg_all_child); himg_all_child = NULL;
    <a class="code" href="group__fie__object.html#g5255bfc98226503d087b8614fcbb240c" title="オブジェクトを解放">fnFIE_free_object</a>(himg_temp); himg_temp = NULL;

    <span class="comment">//2枚目以降の処理</span>

    <span class="keywordflow">for</span> (i = 1; i&lt;img_num; i++) {
    
        status = <a class="code" href="group__fie__file__image.html#ga735b6accb014c4d15eec6e422b6a7bb" title=" &amp;lt;img class= inline-img src=&amp;quot;oss.png&amp;quot; alt=&amp;quot;[[OSS]]&amp;quot;&amp;gt;  画像ファイル...">fnFIE_load_img_file</a>(img_fnames[i], &amp;himg_temp, <a class="code" href="group__fie__file__image.html#gge1ca4e0484c0d907a215a44931bbcc9adb9994a1f48569964f60a6dd2eb91234" title="F_IMG_UC8, 3chで読込">F_COLOR_IMG_TYPE_UC8</a>);
        <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }

        status = <a class="code" href="group__fie__image.html#gbd877b77fb0ae99b4eabd32fa33044ae" title="画像情報取得">fnFIE_img_get_params</a>(himg_temp, &amp;ch_temp, NULL,NULL, &amp;width_temp, &amp;height_temp);
        <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }

        <span class="keywordflow">if</span> (ch_temp != 1 || width_temp != width || height_temp != height) {
            status = <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd7899e670e978240beaa8b3c2365d8b02" title="不正な画像エラー">F_ERR_INVALID_IMAGE</a>;
            <span class="keywordflow">goto</span> exit;
        }

        himg_all_child = <a class="code" href="group__fie__image.html#g84df62546f80d2637fd822677456f757" title="チャイルド画像の確保(単一チャネル割り当て版)">fnFIE_img_child_alloc_single_ch</a>(himg_all, i, 0, 0, width, height);
        <span class="keywordflow">if</span> (himg_all_child == NULL) { status = <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd66019e37614dd7208ad00ac047df2e6c" title="メモリ確保エラー">F_ERR_NOMEMORY</a>; <span class="keywordflow">goto</span> exit; }

        status = <a class="code" href="group__fie__std__operation.html#gcb85dadcde458186d7720c2a92205b7d" title="画像コピー">fnFIE_img_copy</a>(himg_temp,himg_all_child);
        <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }

        <a class="code" href="group__fie__object.html#g5255bfc98226503d087b8614fcbb240c" title="オブジェクトを解放">fnFIE_free_object</a>(himg_all_child); 
        himg_all_child = NULL;
        <a class="code" href="group__fie__object.html#g5255bfc98226503d087b8614fcbb240c" title="オブジェクトを解放">fnFIE_free_object</a>(himg_temp);
        himg_temp = NULL;
    }

    <span class="comment">//前処理</span>
    <span class="comment">//黒背景の微妙な画素値の違いによる法線推定の誤りを和らげます</span>

    status=<a class="code" href="group__fie__filter__arithm.html#g6a2c30317c1b80b6b76d88c814a34663" title="画像と定数の最大値">fnFIE_img_max_const</a>(himg_all, low_thresh, himg_all);
    <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }

    <span class="comment">//リング照明用で光源情報を計算する</span>
    slant = (DOUBLE*)<a class="code" href="group__memory__alloc.html#g80e0d9105acd3ea67cd8c5194a19f3d6" title="メモリブロックの割当">fnOAL_malloc</a>(img_num * <span class="keyword">sizeof</span>(DOUBLE));
    <span class="keywordflow">if</span> (slant == NULL) { status = <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd66019e37614dd7208ad00ac047df2e6c" title="メモリ確保エラー">F_ERR_NOMEMORY</a>; <span class="keywordflow">goto</span> exit; }

    tilt = (DOUBLE*)<a class="code" href="group__memory__alloc.html#g80e0d9105acd3ea67cd8c5194a19f3d6" title="メモリブロックの割当">fnOAL_malloc</a>(img_num * <span class="keyword">sizeof</span>(DOUBLE));
    <span class="keywordflow">if</span> (tilt == NULL) { status = <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd66019e37614dd7208ad00ac047df2e6c" title="メモリ確保エラー">F_ERR_NOMEMORY</a>; <span class="keywordflow">goto</span> exit; }

    light_radius = 1;
    light_height = 2;
    initial_angle = 170;

    status= <a class="code" href="group__fie__ps__tool.html#g238f3f409973ec266af30803eba91adc" title="照度差ステレオ光源ベクトルの情報補助関数（リング照明）...">fnFIE_ps_woodham_calc_light_ring</a>(light_height, light_radius, initial_angle, light_order,slant,tilt, img_num);
    <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }

    <span class="comment">//----------------------------------------------</span>
    <span class="comment">//-----woodhamによる法線推定実行----------------</span>
    <span class="comment">//----------------------------------------------</span>

    himg_normal_double = <a class="code" href="group__fie__image.html#ge1fb319dbc93c5bbaba49d39904ca491" title="ルート画像の確保">fnFIE_img_root_alloc</a>(<a class="code" href="group__fie__image.html#ggd5e633c5daa48d827c052eb173c0effb0a7d3a28a440ff75d1c59831807f9426" title="倍精度浮動小数点画像">F_IMG_DOUBLE</a>, 3, width, height);
    <span class="keywordflow">if</span> (himg_normal_double == NULL) { status = <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd66019e37614dd7208ad00ac047df2e6c" title="メモリ確保エラー">F_ERR_NOMEMORY</a>; <span class="keywordflow">goto</span> exit; }

    status=<a class="code" href="group__fie__ps__do.html#g6489cb8d698cae140a74885c0a0a66b8" title=" &amp;lt;img class= inline-img src=&amp;quot;oss.png&amp;quot; alt=&amp;quot;[[OSS]]&amp;quot;&amp;gt;  Woodhamによる法...">fnFIE_ps_woodham</a>(himg_all, slant, tilt, himg_normal_double,NULL);
    <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }
    
    <span class="comment">//結果画像保存（可視化用）</span>
    {
        himg_normal_uc8 = <a class="code" href="group__fie__image.html#ge1fb319dbc93c5bbaba49d39904ca491" title="ルート画像の確保">fnFIE_img_root_alloc</a>(<a class="code" href="group__fie__image.html#ggd5e633c5daa48d827c052eb173c0effb290a3f243e6f7dfdd220061fe9077e98" title="8bit濃淡画像">F_IMG_UC8</a>, 3, width, height);
        <span class="keywordflow">if</span> (himg_normal_uc8 == NULL) { status = <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd66019e37614dd7208ad00ac047df2e6c" title="メモリ確保エラー">F_ERR_NOMEMORY</a>; <span class="keywordflow">goto</span> exit; }

        status = <a class="code" href="group__fie__std__operation.html#g3d515b8e1843ffa3dc986f67f0185d5c" title="濃度変換付き画像コピー">fnFIE_img_copy_ex</a>(himg_normal_double,himg_normal_uc8, 0, -1, 255.0/(1-(-1)));
        <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }

        status = <a class="code" href="group__fie__file__image.html#g5642cf383268870443617c385e28c18e" title=" &amp;lt;img class= inline-img src=&amp;quot;oss.png&amp;quot; alt=&amp;quot;[[OSS]]&amp;quot;&amp;gt;  PNGファイルの...">fnFIE_save_png</a>(<span class="stringliteral">"himg_normal_uc8.png"</span>, himg_normal_uc8 ,-1);
        <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }

    }

    <span class="comment">//----------------------------------------------</span>
    <span class="comment">//-----曲率画像計算-----------------------------</span>
    <span class="comment">//----------------------------------------------</span>

    hdst_curvature_mean_double = <a class="code" href="group__fie__image.html#ge1fb319dbc93c5bbaba49d39904ca491" title="ルート画像の確保">fnFIE_img_root_alloc</a>(<a class="code" href="group__fie__image.html#ggd5e633c5daa48d827c052eb173c0effb0a7d3a28a440ff75d1c59831807f9426" title="倍精度浮動小数点画像">F_IMG_DOUBLE</a>, 1, width, height);
    <span class="keywordflow">if</span> (himg_normal_double == NULL) { status = <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd66019e37614dd7208ad00ac047df2e6c" title="メモリ確保エラー">F_ERR_NOMEMORY</a>; <span class="keywordflow">goto</span> exit; }

    status=<a class="code" href="group__fie__ps__do.html#gc87a29d344bb0c7db6793f55dd40454c" title="曲率画像生成">fnFIE_ps_curvature</a>(himg_normal_double, hdst_curvature_mean_double, normal_thresh, curvature_type);
    <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }
    
    <span class="comment">//結果画像保存（可視化用）</span>
    {
        hdst_curvature_mean_uc8 = <a class="code" href="group__fie__image.html#ge1fb319dbc93c5bbaba49d39904ca491" title="ルート画像の確保">fnFIE_img_root_alloc</a>(<a class="code" href="group__fie__image.html#ggd5e633c5daa48d827c052eb173c0effb290a3f243e6f7dfdd220061fe9077e98" title="8bit濃淡画像">F_IMG_UC8</a>, 1, width, height);
        <span class="keywordflow">if</span> (himg_normal_uc8 == NULL) { status = <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd66019e37614dd7208ad00ac047df2e6c" title="メモリ確保エラー">F_ERR_NOMEMORY</a>; <span class="keywordflow">goto</span> exit; }

        status = <a class="code" href="group__fie__std__operation.html#g3d515b8e1843ffa3dc986f67f0185d5c" title="濃度変換付き画像コピー">fnFIE_img_copy_ex</a>(hdst_curvature_mean_double, hdst_curvature_mean_uc8, 1, 0, 0);
        <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }

        status = <a class="code" href="group__fie__file__image.html#g5642cf383268870443617c385e28c18e" title=" &amp;lt;img class= inline-img src=&amp;quot;oss.png&amp;quot; alt=&amp;quot;[[OSS]]&amp;quot;&amp;gt;  PNGファイルの...">fnFIE_save_png</a>(<span class="stringliteral">"hdst_curvature_mean_uc8.png"</span>, hdst_curvature_mean_uc8, -1);
        <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }

    }

    <span class="comment">//----------------------------------------------</span>
    <span class="comment">//-----高さ画像計算(frankot_chellappa)----------</span>
    <span class="comment">//----------------------------------------------</span>

    hdst_depth_frankot_chellappa_double = <a class="code" href="group__fie__image.html#ge1fb319dbc93c5bbaba49d39904ca491" title="ルート画像の確保">fnFIE_img_root_alloc</a>(<a class="code" href="group__fie__image.html#ggd5e633c5daa48d827c052eb173c0effb0a7d3a28a440ff75d1c59831807f9426" title="倍精度浮動小数点画像">F_IMG_DOUBLE</a>, 1, width, height);
    <span class="keywordflow">if</span> (hdst_depth_frankot_chellappa_double == NULL) { status = <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd66019e37614dd7208ad00ac047df2e6c" title="メモリ確保エラー">F_ERR_NOMEMORY</a>; <span class="keywordflow">goto</span> exit; }

    status = <a class="code" href="group__fie__ps__do.html#gfb4c8e4ddeddb60818d98698e746f8c4" title="Frankot-Chellappa法による高さ画像生成">fnFIE_ps_frankot_chellappa</a>(himg_normal_double, hdst_depth_frankot_chellappa_double, normal_thresh);
    <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }

    <span class="comment">//結果画像保存（可視化用）</span>
    {
        hdst_depth_frankot_chellappa_uc8 = <a class="code" href="group__fie__image.html#ge1fb319dbc93c5bbaba49d39904ca491" title="ルート画像の確保">fnFIE_img_root_alloc</a>(<a class="code" href="group__fie__image.html#ggd5e633c5daa48d827c052eb173c0effb290a3f243e6f7dfdd220061fe9077e98" title="8bit濃淡画像">F_IMG_UC8</a>, 1, width, height);
        <span class="keywordflow">if</span> (hdst_depth_frankot_chellappa_uc8 == NULL) { status = <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd66019e37614dd7208ad00ac047df2e6c" title="メモリ確保エラー">F_ERR_NOMEMORY</a>; <span class="keywordflow">goto</span> exit; }

        status = <a class="code" href="group__fie__std__operation.html#g3d515b8e1843ffa3dc986f67f0185d5c" title="濃度変換付き画像コピー">fnFIE_img_copy_ex</a>(hdst_depth_frankot_chellappa_double, hdst_depth_frankot_chellappa_uc8, 1, 0, 0);
        <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }

        status = <a class="code" href="group__fie__file__image.html#g5642cf383268870443617c385e28c18e" title=" &amp;lt;img class= inline-img src=&amp;quot;oss.png&amp;quot; alt=&amp;quot;[[OSS]]&amp;quot;&amp;gt;  PNGファイルの...">fnFIE_save_png</a>(<span class="stringliteral">"hdst_depth_frankot_chellappa_uc8.png"</span>, hdst_depth_frankot_chellappa_uc8, -1);
        <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }

    }

    <span class="comment">//----------------------------------------------</span>
    <span class="comment">//-----高さ画像計算(horn_brooks)----------------</span>
    <span class="comment">//----------------------------------------------</span>

    iter = 100;

    hdst_depth_horn_brooks_double = <a class="code" href="group__fie__image.html#ge1fb319dbc93c5bbaba49d39904ca491" title="ルート画像の確保">fnFIE_img_root_alloc</a>(<a class="code" href="group__fie__image.html#ggd5e633c5daa48d827c052eb173c0effb0a7d3a28a440ff75d1c59831807f9426" title="倍精度浮動小数点画像">F_IMG_DOUBLE</a>, 1, width, height);
    <span class="keywordflow">if</span> (hdst_depth_horn_brooks_double == NULL) { status = <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd66019e37614dd7208ad00ac047df2e6c" title="メモリ確保エラー">F_ERR_NOMEMORY</a>; <span class="keywordflow">goto</span> exit; }

    status = <a class="code" href="group__fie__ps__do.html#g12788a4a0352b677c510ba36fc76ece6" title="Horn-Brooks法による高さ画像生成">fnFIE_ps_horn_brooks</a>(himg_normal_double, hdst_depth_horn_brooks_double, normal_thresh,iter);
    <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }

    <span class="comment">//結果画像保存（可視化用）</span>
    {
        hdst_depth_horn_brooks_uc8 = <a class="code" href="group__fie__image.html#ge1fb319dbc93c5bbaba49d39904ca491" title="ルート画像の確保">fnFIE_img_root_alloc</a>(<a class="code" href="group__fie__image.html#ggd5e633c5daa48d827c052eb173c0effb290a3f243e6f7dfdd220061fe9077e98" title="8bit濃淡画像">F_IMG_UC8</a>, 1, width, height);
        <span class="keywordflow">if</span> (hdst_depth_horn_brooks_uc8 == NULL) { status = <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd66019e37614dd7208ad00ac047df2e6c" title="メモリ確保エラー">F_ERR_NOMEMORY</a>; <span class="keywordflow">goto</span> exit; }

        status = <a class="code" href="group__fie__std__operation.html#g3d515b8e1843ffa3dc986f67f0185d5c" title="濃度変換付き画像コピー">fnFIE_img_copy_ex</a>(hdst_depth_horn_brooks_double, hdst_depth_horn_brooks_uc8, 1, 0, 0);
        <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }

        status = <a class="code" href="group__fie__file__image.html#g5642cf383268870443617c385e28c18e" title=" &amp;lt;img class= inline-img src=&amp;quot;oss.png&amp;quot; alt=&amp;quot;[[OSS]]&amp;quot;&amp;gt;  PNGファイルの...">fnFIE_save_png</a>(<span class="stringliteral">"hdst_depth_horn_brooks_uc8.png"</span>, hdst_depth_horn_brooks_uc8, -1);
        <span class="keywordflow">if</span> (status != <a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cd457bddfc94b88d8440be1a5e773adefa" title="エラー無し">F_ERR_NONE</a>) { <span class="keywordflow">goto</span> exit; }

    }

exit:
    <span class="comment">// 各種解放</span>
    <a class="code" href="group__fie__object.html#g5255bfc98226503d087b8614fcbb240c" title="オブジェクトを解放">fnFIE_free_object</a>(himg_all);
    <a class="code" href="group__fie__object.html#g5255bfc98226503d087b8614fcbb240c" title="オブジェクトを解放">fnFIE_free_object</a>(himg_all_child);
    <a class="code" href="group__fie__object.html#g5255bfc98226503d087b8614fcbb240c" title="オブジェクトを解放">fnFIE_free_object</a>(himg_temp);

    <a class="code" href="group__fie__object.html#g5255bfc98226503d087b8614fcbb240c" title="オブジェクトを解放">fnFIE_free_object</a>(himg_normal_double);
    <a class="code" href="group__fie__object.html#g5255bfc98226503d087b8614fcbb240c" title="オブジェクトを解放">fnFIE_free_object</a>(himg_normal_double_after);
    <a class="code" href="group__fie__object.html#g5255bfc98226503d087b8614fcbb240c" title="オブジェクトを解放">fnFIE_free_object</a>(himg_normal_uc8);

    <a class="code" href="group__fie__object.html#g5255bfc98226503d087b8614fcbb240c" title="オブジェクトを解放">fnFIE_free_object</a>(hdst_curvature_mean_double);
    <a class="code" href="group__fie__object.html#g5255bfc98226503d087b8614fcbb240c" title="オブジェクトを解放">fnFIE_free_object</a>(hdst_curvature_mean_uc8);

    <a class="code" href="group__fie__object.html#g5255bfc98226503d087b8614fcbb240c" title="オブジェクトを解放">fnFIE_free_object</a>(hdst_depth_frankot_chellappa_double);
    <a class="code" href="group__fie__object.html#g5255bfc98226503d087b8614fcbb240c" title="オブジェクトを解放">fnFIE_free_object</a>(hdst_depth_frankot_chellappa_uc8);

    <a class="code" href="group__fie__object.html#g5255bfc98226503d087b8614fcbb240c" title="オブジェクトを解放">fnFIE_free_object</a>(hdst_depth_horn_brooks_double);
    <a class="code" href="group__fie__object.html#g5255bfc98226503d087b8614fcbb240c" title="オブジェクトを解放">fnFIE_free_object</a>(hdst_depth_horn_brooks_uc8);

    <a class="code" href="group__memory__alloc.html#g78ba9c03b7577b9c091ba42ca9cb7c95" title="メモリブロックの解放">fnOAL_free</a>(slant);
    <a class="code" href="group__memory__alloc.html#g78ba9c03b7577b9c091ba42ca9cb7c95" title="メモリブロックの解放">fnOAL_free</a>(tilt);
    
    <span class="keywordflow">return</span> status;
}

INT main()
{
    INT status=<a class="code" href="group__fie__document.html#ggbffaca45497ab68d341a940f16c668cdec888cfe6642ce77c95e72fd369c9304" title="不明なエラー">F_ERR_UNKNOWN</a>;

    <span class="comment">// FIEライブラリのセットアップ</span>
    <a class="code" href="group__fie__libinit.html#g12250eabf0163ce206c4caa007b33a80" title="FIEライブラリの初期化">fnFIE_setup</a>();

    <span class="comment">// リング照明でwoodhamの手法による法線推定</span>
    status = do_ring_woodham();

    <span class="comment">// ライブラリの終了処理</span>
    <a class="code" href="group__fie__libinit.html#gcf71693a1b50ed7ce9947ac8179cbfc3" title="FIEライブラリの終了処理">fnFIE_teardown</a>();

    <span class="keywordflow">return</span> status;
}
</pre></div><h3><a class="anchor" name="fie_ps_input_img">
入力画像</a></h3>
<table class="layoutTable">
<tr>
<td><div align="center">
<img src="fie_ps_sample_code_input_00.png" alt="fie_ps_sample_code_input_00.png">
<p><strong>入力画像0チャネル</strong></p></div>
  </td><td><div align="center">
<img src="fie_ps_sample_code_input_01.png" alt="fie_ps_sample_code_input_01.png">
<p><strong>入力画像1チャネル</strong></p></div>
  </td><td><div align="center">
<img src="fie_ps_sample_code_input_02.png" alt="fie_ps_sample_code_input_02.png">
<p><strong>入力画像2チャネル</strong></p></div>
  </td><td><div align="center">
<img src="fie_ps_sample_code_input_03.png" alt="fie_ps_sample_code_input_03.png">
<p><strong>入力画像3チャネル</strong></p></div>
   </td></tr>
<tr>
<td><div align="center">
<img src="fie_ps_sample_code_input_04.png" alt="fie_ps_sample_code_input_04.png">
<p><strong>入力画像4チャネル</strong></p></div>
  </td><td><div align="center">
<img src="fie_ps_sample_code_input_05.png" alt="fie_ps_sample_code_input_05.png">
<p><strong>入力画像5チャネル</strong></p></div>
  </td><td><div align="center">
<img src="fie_ps_sample_code_input_06.png" alt="fie_ps_sample_code_input_06.png">
<p><strong>入力画像6チャネル</strong></p></div>
  </td><td><div align="center">
<img src="fie_ps_sample_code_input_07.png" alt="fie_ps_sample_code_input_07.png">
<p><strong>入力画像7チャネル</strong></p></div>
  <p>
</td></tr>
<tr>
<td><div align="center">
<img src="fie_ps_sample_code_normal.png" alt="fie_ps_sample_code_normal.png">
<p><strong>出力法線画像</strong></p></div>
  </td><td><div align="center">
<img src="fie_ps_sample_code_curvature_mean.png" alt="fie_ps_sample_code_curvature_mean.png">
<p><strong>出力曲率画像(平均曲率)</strong></p></div>
  </td><td><div align="center">
<img src="fie_ps_sample_code_frankot_chellappa.png" alt="fie_ps_sample_code_frankot_chellappa.png">
<p><strong>出力高さ画像(Frankot-Chellappa法)</strong></p></div>
  </td><td><div align="center">
<img src="fie_ps_sample_code_horn_brooks.png" alt="fie_ps_sample_code_horn_brooks.png">
<p><strong>出力高さ画像(Horn-Brooks法)</strong></p></div>
  <p>
</td></tr>
</table>

<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
</table>
</div>
<hr size="1">
<address style="align: right; color: #cccccc;">
	<small>
	Documentation copyright &copy; 2009-2025 TOKYO ELECTRON DEVICE LIMITED. <br>
	Generated on Tue Sep 16 09:08:52 2025 for FIEライブラリ by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.5.6-FASTSP-p2
	</small>
</address>
</body>
</html>
