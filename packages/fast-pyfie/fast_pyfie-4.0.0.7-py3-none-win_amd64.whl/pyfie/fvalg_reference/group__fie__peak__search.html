<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=Shift_JIS">
<title>FIEライブラリ: ピーク探索</title>
<link href="fvalg-prod.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- 作成： Doxygen 1.5.6-FASTSP-p2 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="contents">
<h1>ピーク探索<br>
<small>
[<a class="el" href="group__fie__vtool.html">ビジョンツール</a>]</small>
</h1>
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>関数</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">INT FVALGAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fie__peak__search.html#g4c834f9dce11ffd9048017c4d46f405f">fnFIE_find_peaks</a> (DOUBLE *src_val, INT src_num, INT neighbor, INT nms_length, INT rel_length, DOUBLE val_thresh, DOUBLE rel_thresh, DOUBLE max_abs_diff, INT sort_mode, DOUBLE *peaks_val, DOUBLE *peaks_pos, INT *peaks_num)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"> <img class= inline-img src="oss.png" alt="[[OSS]]">  ピーク探索  <a href="#g4c834f9dce11ffd9048017c4d46f405f"></a><br></td></tr>
</table>
<hr><h2>関数</h2>
<a class="anchor" name="g4c834f9dce11ffd9048017c4d46f405f"></a><!-- doxytag: member="oss_fie_find_peaks.c::fnFIE_find_peaks" ref="g4c834f9dce11ffd9048017c4d46f405f" args="(DOUBLE *src_val, INT src_num, INT neighbor, INT nms_length, INT rel_length, DOUBLE val_thresh, DOUBLE rel_thresh, DOUBLE max_abs_diff, INT sort_mode, DOUBLE *peaks_val, DOUBLE *peaks_pos, INT *peaks_num)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT FVALGAPI fnFIE_find_peaks           </td>
          <td>(</td>
          <td class="paramtype">DOUBLE *&nbsp;</td>
          <td class="paramname"> <em>src_val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT&nbsp;</td>
          <td class="paramname"> <em>src_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT&nbsp;</td>
          <td class="paramname"> <em>neighbor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT&nbsp;</td>
          <td class="paramname"> <em>nms_length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT&nbsp;</td>
          <td class="paramname"> <em>rel_length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE&nbsp;</td>
          <td class="paramname"> <em>val_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE&nbsp;</td>
          <td class="paramname"> <em>rel_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE&nbsp;</td>
          <td class="paramname"> <em>max_abs_diff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT&nbsp;</td>
          <td class="paramname"> <em>sort_mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE *&nbsp;</td>
          <td class="paramname"> <em>peaks_val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE *&nbsp;</td>
          <td class="paramname"> <em>peaks_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT *&nbsp;</td>
          <td class="paramname"> <em>peaks_num</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
 <img class= inline-img src="oss.png" alt="[[OSS]]">  ピーク探索 
<p>
入力された配列を走査し、ピーク点 (データの極大点) を探索します。<br>
 例えば、濃度プロファイルから配列を作成し、局所的に濃度値が高くなっている位置を検出するといったことが可能です。<br>
<p>
この関数は、データ点とデータ点の間隔を 1 とし、データ点とデータ点の間を補間して浮動小数点精度でピーク値とその位置を出力します。<br>
 各種パラメータによって出力するピークを抑制することができます。<br>
<p>
<dl class="user" compact><dt><b>参照が配列外となるときの挙動</b></dt><dd>ピーク値とその位置の補間、出力するピークの抑制の処理では、ピークそのものだけでなく、その付近も参照します。<br>
 その参照が配列外となるときは、配列外となった側の参照範囲を配列の端まで縮小させます。</dd></dl>
<dl class="user" compact><dt><b>相対的ピーク高</b></dt><dd>相対的ピーク高とは、データ点によって作成される曲線を山や谷と見立てたとき、注目するピークを囲む極小値の等高線の中で、そのピークより高い地点を包括して囲わない最も低い等高線からピークまでの高さを示します。<br>
 図1-1 の入力の例では、極小値 a の等高線は、ピーク A のみのグループと ピーク B, C, D のグループに分割するようにピークを囲みます。 極小値 b の等高線は、すべてのピークを包括するようにピークを囲みます。このような関係を 図1-2 に示します。<br>
 例えば、すべての極小値の等高線は ピーク B を囲います。そして、ピーク B よりも高いピークは存在しないので、ピーク B の相対的ピーク高は、最小値 b の位置から測定されます。 一方、極小値 c 以下の等高線は ピーク C とそれよりも高いピークである ピーク B を囲みます。このとき、ピーク C の相対的ピーク高は、極小値 c 以下の等高線のうちピーク B と ピーク C を分割するように囲む、極小値 c の位置から測定されます。<br>
 このようにして計算すると、図1-1 における相対的ピーク高は、a から A までの高さ、b から B までの高さ、… となります。<br>
 相対的ピーク高が小さなピークを無視することで、細かい振動によるピークの出現を抑制できます。<br>
 同値のピークが計算範囲内に出現したときには、先に出現したピークのほうが高いときと同様な挙動をします ( 図2 )。<br>
 <table class="layoutTable">
<tr>
<td><div align="center">
<img src="rel_peaks.png" alt="rel_peaks.png">
<p><strong>図1-1</strong></p></div>
  </td><td><div align="center">
<img src="rel_peaks_group.png" alt="rel_peaks_group.png">
<p><strong>図1-2</strong></p></div>
   </td></tr>
<tr>
<td><div align="center">
<img src="rel_peaks_eq.png" alt="rel_peaks_eq.png">
<p><strong>図2</strong></p></div>
   </td></tr>
</table>
</dd></dl>
<br>
<p>
<dl compact><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>src_val</em>&nbsp;</td><td>入力配列 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>src_num</em>&nbsp;</td><td>入力配列の要素数 ( 1 ≦ src_num ) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>neighbor</em>&nbsp;</td><td>近傍範囲 ( 0 ≦ neighbor ) <br>
 極大のデータ点から 前後それぞれ <em>neighbor</em> 個までの範囲を近傍とし、補間に利用します。<br>
 0が指定された場合、補間なしとなります。<br>
 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>nms_length</em>&nbsp;</td><td>非極大抑制のフィルタ片幅 ( 0 ≦ nms_length ) <br>
 極大のデータ点の前後 nms_length の範囲に複数のピークが出現したとき、 そのうちの最もピーク値の大きいものを採用し、他は無視します。<br>
 同値の場合は、先に出現したピークが優先されます。<br>
 <em>nms_length</em> = 0 のときには、制限なしとなります。<br>
 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rel_length</em>&nbsp;</td><td>相対的ピーク高の計算片幅 ( 0 ≦ rel_length ) <br>
 極大のデータ点の前後 <em>rel_length</em> の範囲内で相対的ピーク高を計算します。<br>
 <em>rel_length</em> = 0 のときには、入力配列全体が計算範囲となります。<br>
 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>val_thresh</em>&nbsp;</td><td>ピーク値の閾値 <br>
 入力値が <em>val_thresh</em> 未満のピークは出力されません。<br>
 <em>val_thresh</em> ≦ ( 入力値の最低値 ) の場合、制限なしとなります。<br>
 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rel_thresh</em>&nbsp;</td><td>相対的ピーク高の閾値 ( 0 ≦ rel_thresh ) <br>
 相対的ピーク高が <em>rel_thresh</em> 未満のピークは出力されません。<br>
 <em>rel_thresh</em> = 0 の場合、制限なしとなります。<br>
 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>max_abs_diff</em>&nbsp;</td><td>差分絶対値の上限 ( 0 ≦ max_abs_diff ) <br>
 極大のデータ点と前後の隣接しているデータ点との差がどちらも <em>max_abs_diff</em> より大きいときには、ごましおノイズ等によって出現したピークとみなして無視します。<br>
 <em>max_abs_diff</em> の値が小さいほど、ノイズを抑制しやすくピークが出現しにくい傾向があり、 <em>max_abs_diff</em> の値が大きいほど、ノイズを抑制しにくくピークが出現しやすい傾向があります。<br>
 入力値の最大値と最小値の差の1/4程度を推奨します。<br>
 特に制限しない場合は、0 を指定してください。<br>
 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>sort_mode</em>&nbsp;</td><td><em>peaks_val</em> と <em>peaks_pos</em> のソートモード<br>
 <ul>
<li>
0 : 位置基準昇順 </li>
<li>
1 : 位置基準降順 </li>
<li>
2 : ピーク値基準昇順 </li>
<li>
3 : ピーク値基準降順 </li>
</ul>
</td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>peaks_val</em>&nbsp;</td><td>取得ピーク値保存用のバッファ<br>
 <em>sort_mode</em> で指定された順にピーク値を格納します。<br>
 <em>peaks_num</em> 個以上の配列を確保したうえで、その配列を渡してください。<br>
 </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>peaks_pos</em>&nbsp;</td><td>取得ピーク位置保存用のバッファ<br>
 <em>sort_mode</em> で指定された順にピーク位置を格納します。<br>
 つまり、peaks_val[idx] と peaks_pos[idx] は対応しています。<br>
 <em>peaks_num</em> 個以上の配列を確保したうえで、その配列を渡してください。<br>
 </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>peaks_num</em>&nbsp;</td><td>ピークの個数 <br>
 入力のときには、ピークを最大で何個出力するか ( 1以上 ) を指定します。<br>
 出力のときには、以下の数値となります。 <ul>
<li>
検出されたピークの個数が <em>peaks_num</em> 以内の場合 : 検出されたピークの個数 </li>
<li>
検出されたピークの個数が <em>peaks_num</em> を超えた場合 : 入力時の <em>peaks_num</em> <ul>
<li>
このとき、ソートモードに従い、順に <em>peaks_num</em> 個のピークを出力します。 </li>
</ul>
</li>
</ul>
</td></tr>
  </table>
</dl>
<dl compact><dt><b>戻り値:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NONE</em>&nbsp;</td><td>正常終了 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_PARAM</em>&nbsp;</td><td>パラメータ異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NOMEMORY</em>&nbsp;</td><td>メモリ不足エラー </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NO_LICENCE</em>&nbsp;</td><td>ライセンスエラー または未初期化エラー </td></tr>
  </table>
</dl>

</div>
</div><p>
</div>
<hr size="1">
<address style="align: right; color: #cccccc;">
	<small>
	Documentation copyright &copy; 2009-2025 TOKYO ELECTRON DEVICE LIMITED. <br>
	Generated on Tue Sep 16 09:08:52 2025 for FIEライブラリ by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.5.6-FASTSP-p2
	</small>
</address>
</body>
</html>
