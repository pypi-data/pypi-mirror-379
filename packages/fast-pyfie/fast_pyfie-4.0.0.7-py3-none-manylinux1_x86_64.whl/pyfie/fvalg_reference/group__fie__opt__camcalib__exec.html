<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=Shift_JIS">
<title>FIEライブラリ: 実行</title>
<link href="fvalg-prod.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- 作成： Doxygen 1.5.6-FASTSP-p2 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="contents">
<h1>実行<br>
<small>
[<a class="el" href="group__fie__opt__camcalib.html">カメラキャリブレーション</a>]</small>
</h1>
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>関数</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">INT FVALGAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fie__opt__camcalib__exec.html#g8028fe1ae3343e24a1c17b8e9c5e98c8">fnFIE_calib_calc_intrinsic_parameters</a> (FHANDLE hcalib, <a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a> *pcamera)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"> <img class= inline-img src="oss.png" alt="[[OSS]]">  カメラ内部パラメータの算出  <a href="#g8028fe1ae3343e24a1c17b8e9c5e98c8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">INT FVALGAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fie__opt__camcalib__exec.html#gf3e633c716b0a13d84572707e4ad3f53">fnFIE_calib_calc_1shot</a> (FHANDLE hcalib, INT view_num, <a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a> *pcamera, <a class="el" href="structFMATRIX.html">FMATRIX</a> *homography)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"> <img class= inline-img src="oss.png" alt="[[OSS]]">  １視野による特殊カメラキャリブレーションの実行  <a href="#gf3e633c716b0a13d84572707e4ad3f53"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">INT FVALGAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fie__opt__camcalib__exec.html#g1a4f0ab9bfce79d32a5e01a83f9fa59a">fnFIE_calib_calc_extrinsic_parameters</a> (<a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a> camera, <a class="el" href="structDPNT__T.html">DPNT_T</a> *model_points, <a class="el" href="structDPNT__T.html">DPNT_T</a> *marker_points, INT num_points, <a class="el" href="structFMATRIX.html">FMATRIX</a> *rotation, <a class="el" href="structFVECTOR.html">FVECTOR</a> *translation, <a class="el" href="structFMATRIX.html">FMATRIX</a> *homography)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"> <img class= inline-img src="oss.png" alt="[[OSS]]">  カメラ外部パラメータとカメラ混合パラメータの算出  <a href="#g1a4f0ab9bfce79d32a5e01a83f9fa59a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">INT FVALGAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fie__opt__camcalib__exec.html#g5a5043e9d631aa479dd553357c1b3707">fnFIE_calib_calc_homography_matrix</a> (<a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a> camera, <a class="el" href="structFMATRIX.html">FMATRIX</a> *rotation, <a class="el" href="structFVECTOR.html">FVECTOR</a> *translation, <a class="el" href="structFMATRIX.html">FMATRIX</a> *homography)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"> <img class= inline-img src="oss.png" alt="[[OSS]]">  カメラ混合パラメータの算出  <a href="#g5a5043e9d631aa479dd553357c1b3707"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">INT FVALGAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fie__opt__camcalib__exec.html#g6fb54001db79f6cf44e0c5885954b7ce">fnFIE_calib_calc_error</a> (FHANDLE hcalib, <a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a> camera, DOUBLE *min_error, DOUBLE *max_error, DOUBLE *average_error)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"> <img class= inline-img src="oss.png" alt="[[OSS]]">  カメラ内部パラメータの精度の検証  <a href="#g6fb54001db79f6cf44e0c5885954b7ce"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">INT FVALGAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fie__opt__camcalib__exec.html#geab0664514c4b803d1444956260926d7">fnFIE_calib_calc_error2</a> (FHANDLE hcalib, <a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a> camera, INT view_num, <a class="el" href="structDPNT__T.html">DPNT_T</a> *diff, INT num_points)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"> <img class= inline-img src="oss.png" alt="[[OSS]]">  カメラ内部パラメータの精度の検証2  <a href="#geab0664514c4b803d1444956260926d7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">INT FVALGAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fie__opt__camcalib__exec.html#ge930c8a92c90656286390d949228aa92">fnFIE_calib_calc_error3</a> (FHANDLE hcalib, <a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a> camera, <a class="el" href="structDPNT__T.html">DPNT_T</a> *points, <a class="el" href="structDPNT__T.html">DPNT_T</a> *diff, INT num_points)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"> <img class= inline-img src="oss.png" alt="[[OSS]]">  カメラ内部パラメータの精度の検証3  <a href="#ge930c8a92c90656286390d949228aa92"></a><br></td></tr>
</table>
<hr><h2>関数</h2>
<a class="anchor" name="g8028fe1ae3343e24a1c17b8e9c5e98c8"></a><!-- doxytag: member="fie_calib.c::fnFIE_calib_calc_intrinsic_parameters" ref="g8028fe1ae3343e24a1c17b8e9c5e98c8" args="(FHANDLE hcalib, F_CAMERA_PARAM *pcamera)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT FVALGAPI fnFIE_calib_calc_intrinsic_parameters           </td>
          <td>(</td>
          <td class="paramtype">FHANDLE&nbsp;</td>
          <td class="paramname"> <em>hcalib</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a> *&nbsp;</td>
          <td class="paramname"> <em>pcamera</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
 <img class= inline-img src="oss.png" alt="[[OSS]]">  カメラ内部パラメータの算出 
<p>
1カメラのカメラキャリブレーションを実施し、カメラ内部パラメータを算出します。 <a class="el" href="group__fie__opt__camcalib__init.html#g629e0c3ad0076eadbcd0febcf9886f68" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  モデル撮像結...">fnFIE_calib_add_data()</a> を使って異なる視野のデータを3回以上追加している必要があります。<p>
よいカメラ内部パラメータを計算するためには、下記の点に注意して入力データを作成してください。<ul>
<li><a class="el" href="group__fie__opt__camcalib__init.html#g629e0c3ad0076eadbcd0febcf9886f68" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  モデル撮像結...">fnFIE_calib_add_data()</a> で追加したデータがなるべく視野全域にわたっていること</li><li>モデルがすべての画像で同一方向を向いていることがないように注意すること</li><li>さまざまな角度からモデルを撮影するように心がけること</li><li>なるべく10枚以上の異なった画像を撮影すること</li></ul>
<p>
<dl compact><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>hcalib</em>&nbsp;</td><td>キャリブレーションデータオブジェクト </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>pcamera</em>&nbsp;</td><td>カメラ内部パラメータ構造体</td></tr>
  </table>
</dl>
<dl compact><dt><b>戻り値:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NONE</em>&nbsp;</td><td>正常終了 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_OBJECT</em>&nbsp;</td><td>オブジェクト異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_PARAM</em>&nbsp;</td><td>パラメータ異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NOMEMORY</em>&nbsp;</td><td>メモリ不足 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_CALC_IMPOSSIBLE</em>&nbsp;</td><td>計算不能<ul>
<li>データ追加回数が不足</li><li>逆行列計算の失敗などで求解が不能になった </li></ul>
</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NO_LICENCE</em>&nbsp;</td><td>ライセンスエラー、または未初期化エラー</td></tr>
  </table>
</dl>
<dl class="user" compact><dt><b>example code</b></dt><dd><div class="fragment"><pre class="fragment"><span class="comment">//エラー処理は省略しているので注意してください。</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include "fie.h"</span>

<span class="comment">//カメラ内部パラメータと歪み係数を求めます。</span>
INT main(VOID)
{
    <span class="comment">//キャリブレーションテンプレート座標系における、モデルの座標データを用意します。</span>
    <a class="code" href="structDPNT__T.html" title="２次元座標指定用構造体(DOUBLE)">DPNT_T</a> model[36] = {
        { 0, 0},{ 4, 0},{ 8, 0}, 
        {12, 0},{16, 0},{20, 0},
        { 0, 4},{ 4, 4},{ 8, 4}, 
        {12, 4},{16, 4},{20, 4},
        { 0, 8},{ 4, 8},{ 8, 8},
        {12, 8},{16, 8},{20, 8},
        { 0,12},{ 4,12},{ 8,12},
        {12,12},{16,12},{20,12},
        { 0,16},{ 4,16},{ 8,16},
        {12,16},{16,16},{20,16},
        { 0,20},{ 4,20},{ 8,20},
        {12,20},{16,20},{20,20}
    };
    <span class="comment">//カメラ画像座標系における、特徴点の検出データを用意します。</span>
    <span class="comment">//各座標値はmodelと同じ順番に並んでいます。</span>
    <span class="comment">//ここでは5組用意しています。</span>
    <a class="code" href="structDPNT__T.html" title="２次元座標指定用構造体(DOUBLE)">DPNT_T</a> points_0[36] = {
        { 350.2, 338.7 },{ 483.1, 338.8 },{  616.2, 339.0 },
        { 749.9, 339.3 },{ 883.1, 340.0 },{ 1016.0, 340.8 },
        { 339.2, 408.9 },{ 476.0, 409.2 },{  612.9, 409.8 },
        { 750.0, 410.1 },{ 887.2, 410.9 },{ 1024.1, 411.1 },
        { 327.9, 484.2 },{ 468.1, 484.8 },{  609.1, 485.2 },
        { 750.8, 485.8 },{ 891.8, 486.1 },{ 1032.8, 486.8 },
        { 315.3, 563.9 },{ 460.2, 564.2 },{  605.2, 564.9 },
        { 751.0, 565.2 },{ 896.2, 565.9 },{ 1041.8, 566.1 },
        { 302.8, 648.9 },{ 451.9, 649.2 },{  601.2, 650.1 },
        { 751.8, 650.9 },{ 901.2, 651.1 },{ 1051.1, 651.7 },
        { 288.9, 738.2 },{ 442.9, 739.1 },{  597.0, 740.0 },
        { 752.0, 740.7 },{ 906.8, 741.0 },{ 1061.0, 741.2 }
    };
    <a class="code" href="structDPNT__T.html" title="２次元座標指定用構造体(DOUBLE)">DPNT_T</a> points_1[36] = {
        { 311.8, 345.8 },{ 461.0, 344.1 },{  611.1, 342.8 }, 
        { 762.1, 341.2 },{ 912.9, 340.2 },{ 1063.9, 339.1 }, 
        { 326.1, 443.8 },{ 471.8, 442.2 },{  617.8, 441.0 }, 
        { 764.2, 440.0 },{ 910.9, 438.9 },{ 1057.8, 437.9 }, 
        { 340.0, 537.2 },{ 481.7, 536.2 },{  623.8, 535.2 }, 
        { 766.2, 534.7 },{ 909.0, 533.1 },{ 1051.9, 532.0 }, 
        { 353.2, 625.0 },{ 491.0, 624.1 },{  629.7, 623.2 }, 
        { 768.2, 622.2 },{ 907.1, 621.8 },{ 1046.0, 620.8 }, 
        { 366.0, 708.9 },{ 500.0, 708.1 },{  634.9, 707.7 }, 
        { 770.1, 706.9 },{ 905.1, 705.9 },{ 1040.9, 705.0 }, 
        { 378.0, 787.7 },{ 508.9, 787.1 },{  640.1, 786.8 }, 
        { 771.9, 786.0 },{ 903.7, 785.1 },{ 1035.2, 784.1 }
    };
    <a class="code" href="structDPNT__T.html" title="２次元座標指定用構造体(DOUBLE)">DPNT_T</a> points_2[36] = {
        { 263.1, 175.2 },{ 374.9, 156.8 },{ 491.2, 138.5 },
        { 612.0, 119.1 },{ 737.4,  99.2 },{ 867.7,  78.9 },
        { 275.4, 312.2 },{ 387.7, 296.7 },{ 504.4, 280.6 },
        { 625.7, 264.1 },{ 751.6, 246.9 },{ 882.3, 229.3 },
        { 288.2, 449.6 },{ 400.8, 436.8 },{ 517.8, 423.3 },
        { 639.4, 409.3 },{ 765.7, 395.1 },{ 896.8, 380.1 },
        { 301.1, 587.3 },{ 413.9, 577.0 },{ 531.1, 566.2 },
        { 653.1, 555.2 },{ 779.8, 543.8 },{ 911.1, 531.3 },
        { 314.2, 725.1 },{ 427.2, 717.2 },{ 544.9, 709.2 },
        { 667.0, 701.0 },{ 793.9, 692.1 },{ 925.3, 682.9 },
        { 327.8, 862.3 },{ 440.9, 857.2 },{ 558.2, 852.0 },
        { 680.9, 846.2 },{ 807.8, 840.1 },{ 939.2, 833.8 }
    };
    <a class="code" href="structDPNT__T.html" title="２次元座標指定用構造体(DOUBLE)">DPNT_T</a> points_3[36] = {
        { 288.1,  66.6 },{ 444.8,  78.8 },{  596.1,  90.8 },
        { 743.0, 103.0 },{ 884.9, 114.9 },{ 1021.9, 126.7 },
        { 286.9, 232.9 },{ 444.2, 242.2 },{  596.9, 252.0 },
        { 744.2, 261.3 },{ 887.0, 270.8 },{ 1024.3, 279.9 },
        { 286.0, 400.8 },{ 444.1, 407.9 },{  597.1, 414.8 },
        { 745.8, 421.7 },{ 888.8, 428.1 },{ 1026.9, 434.3 },
        { 285.2, 570.8 },{ 444.0, 574.8 },{  597.9, 579.0 },
        { 746.9, 583.0 },{ 890.1, 587.0 },{ 1028.9, 590.8 },
        { 285.1, 741.2 },{ 444.1, 743.0 },{  598.2, 744.2 },
        { 747.9, 745.8 },{ 891.9, 746.9 },{ 1030.8, 747.7 },
        { 285.1, 912.9 },{ 444.8, 911.9 },{  599.1, 910.2 },
        { 748.9, 908.9 },{ 892.9, 907.1 },{ 1032.1, 905.1 }
    };
    <a class="code" href="structDPNT__T.html" title="２次元座標指定用構造体(DOUBLE)">DPNT_T</a> points_4[36] = {
        { 328.0, 193.2 },{ 469.8, 192.8 },{  611.9, 192.3 },
        { 754.7, 192.2 },{ 897.0, 192.3 },{ 1039.2, 192.8 },
        { 326.9, 335.2 },{ 469.0, 335.0 },{  611.8, 334.9 },
        { 754.8, 334.9 },{ 897.2, 334.9 },{ 1040.0, 335.0 },
        { 326.1, 477.9 },{ 468.3, 477.9 },{  611.1, 477.9 },
        { 754.7, 477.9 },{ 897.7, 478.0 },{ 1040.2, 477.9 },
        { 325.8, 621.0 },{ 468.0, 621.0 },{  611.0, 621.1 },
        { 754.2, 621.2 },{ 897.7, 621.2 },{ 1040.7, 621.2 },
        { 325.2, 764.0 },{ 467.9, 764.3 },{  610.9, 764.9 },
        { 754.1, 765.0 },{ 897.2, 765.0 },{ 1040.7, 764.9 },
        { 325.1, 907.0 },{ 467.8, 907.8 },{  610.8, 908.1 },
        { 754.0, 908.2 },{ 897.0, 908.2 },{ 1040.1, 908.1 }
    };

    FHANDLE hcalib = NULL;
    <a class="code" href="structF__CAMERA__PARAM.html" title="カメラ内部パラメータ構造体 (intrinsic parameters)">F_CAMERA_PARAM</a> camera;

    <span class="comment">// FIEライブラリの使用前に必ずコールする必要があります。</span>
    <a class="code" href="group__fie__libinit.html#g12250eabf0163ce206c4caa007b33a80" title="FIEライブラリの初期化">fnFIE_setup</a>();

    <span class="comment">//カメラキャリブレーションデータオブジェクトを生成します。</span>
    hcalib = <a class="code" href="group__fie__opt__camcalib__init.html#g9802bec525e1fe4c7cb5e04135953284" title=" &amp;lt;img class= inline-img src=&amp;quot;oss.png&amp;quot; alt=&amp;quot;[[OSS]]&amp;quot;&amp;gt;  カメラキャリ...">fnFIE_calib_open</a>( model, 36, NULL );

    <span class="comment">//データを追加します。</span>
    <a class="code" href="group__fie__opt__camcalib__init.html#g629e0c3ad0076eadbcd0febcf9886f68" title=" &amp;lt;img class= inline-img src=&amp;quot;oss.png&amp;quot; alt=&amp;quot;[[OSS]]&amp;quot;&amp;gt;  モデル撮像結...">fnFIE_calib_add_data</a>( hcalib, points_0, 36 );
    <a class="code" href="group__fie__opt__camcalib__init.html#g629e0c3ad0076eadbcd0febcf9886f68" title=" &amp;lt;img class= inline-img src=&amp;quot;oss.png&amp;quot; alt=&amp;quot;[[OSS]]&amp;quot;&amp;gt;  モデル撮像結...">fnFIE_calib_add_data</a>( hcalib, points_1, 36 );
    <a class="code" href="group__fie__opt__camcalib__init.html#g629e0c3ad0076eadbcd0febcf9886f68" title=" &amp;lt;img class= inline-img src=&amp;quot;oss.png&amp;quot; alt=&amp;quot;[[OSS]]&amp;quot;&amp;gt;  モデル撮像結...">fnFIE_calib_add_data</a>( hcalib, points_2, 36 );
    <a class="code" href="group__fie__opt__camcalib__init.html#g629e0c3ad0076eadbcd0febcf9886f68" title=" &amp;lt;img class= inline-img src=&amp;quot;oss.png&amp;quot; alt=&amp;quot;[[OSS]]&amp;quot;&amp;gt;  モデル撮像結...">fnFIE_calib_add_data</a>( hcalib, points_3, 36 );
    <a class="code" href="group__fie__opt__camcalib__init.html#g629e0c3ad0076eadbcd0febcf9886f68" title=" &amp;lt;img class= inline-img src=&amp;quot;oss.png&amp;quot; alt=&amp;quot;[[OSS]]&amp;quot;&amp;gt;  モデル撮像結...">fnFIE_calib_add_data</a>( hcalib, points_4, 36 );

    <span class="comment">//カメラ内部パラメータと歪み係数を計算します。</span>
    <a class="code" href="group__fie__opt__camcalib__exec.html#g8028fe1ae3343e24a1c17b8e9c5e98c8" title=" &amp;lt;img class= inline-img src=&amp;quot;oss.png&amp;quot; alt=&amp;quot;[[OSS]]&amp;quot;&amp;gt;  カメラ内部パ...">fnFIE_calib_calc_intrinsic_parameters</a>( hcalib, &amp;camera );

    printf(
        <span class="stringliteral">"alpha\t:%f\nbeta\t:%f\ngamma\t:%f\nu0\t:%f\nv0\t:%f\nk1\t:%f\nk2\t:%f\n"</span>,
        camera.<a class="code" href="structF__CAMERA__PARAM.html#a72956e2fe8c0f52efca60c38e43e02b" title="カメラ内部パラメータ alpha (スケール係数 水平方向)">a</a>, camera.<a class="code" href="structF__CAMERA__PARAM.html#980a18dde870c197a75f46b5fbf27d89" title="カメラ内部パラメータ beta (スケール係数 垂直方向)">b</a>, camera.<a class="code" href="structF__CAMERA__PARAM.html#2d6cc3a4fc155796938c8dbed36ec0cf" title="カメラ内部パラメータ gamma (スキュー)">g</a>, camera.<a class="code" href="structF__CAMERA__PARAM.html#6ed4671a98808c8f1ce51f33663b2c1c" title="カメラ内部パラメータ u0 (光軸中心 水平方向)">u</a>, camera.<a class="code" href="structF__CAMERA__PARAM.html#4b6df7b1552bfbdb6a7eb11da25e9f74" title="カメラ内部パラメータ v0 (光軸中心 垂直方向)">v</a>, camera.<a class="code" href="structF__CAMERA__PARAM.html#9939594cdc92964a2fd8bca8cc2d8a88" title="放射歪み係数 k1 (光軸中心からのL2ノルムの2乗に掛ける係数)...">k1</a>, camera.<a class="code" href="structF__CAMERA__PARAM.html#73373630394106a41eb44996161163dc" title="放射歪み係数 k2 (光軸中心からのL2ノルムの4乗に掛ける係数)...">k2</a>
        );

    <a class="code" href="group__fie__object.html#g5255bfc98226503d087b8614fcbb240c" title="オブジェクトを解放">fnFIE_free_object</a>( hcalib );

    <span class="comment">// 終了処理</span>
    <a class="code" href="group__fie__libinit.html#gcf71693a1b50ed7ce9947ac8179cbfc3" title="FIEライブラリの終了処理">fnFIE_teardown</a>();

    <span class="keywordflow">return</span> 0;
}
</pre></div> </dd></dl>

</div>
</div><p>
<a class="anchor" name="gf3e633c716b0a13d84572707e4ad3f53"></a><!-- doxytag: member="fie_calib.c::fnFIE_calib_calc_1shot" ref="gf3e633c716b0a13d84572707e4ad3f53" args="(FHANDLE hcalib, INT view_num, F_CAMERA_PARAM *pcamera, FMATRIX *homography)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT FVALGAPI fnFIE_calib_calc_1shot           </td>
          <td>(</td>
          <td class="paramtype">FHANDLE&nbsp;</td>
          <td class="paramname"> <em>hcalib</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT&nbsp;</td>
          <td class="paramname"> <em>view_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a> *&nbsp;</td>
          <td class="paramname"> <em>pcamera</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFMATRIX.html">FMATRIX</a> *&nbsp;</td>
          <td class="paramname"> <em>homography</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
 <img class= inline-img src="oss.png" alt="[[OSS]]">  １視野による特殊カメラキャリブレーションの実行 
<p>
１視野のみのデータによる特殊なカメラキャリブレーションを実施し、 カメラ内部パラメータ <em>pcamera</em> 及び カメラ混合パラメータ <em>homography</em> を算出します。<p>
本関数の実行前に <a class="el" href="group__fie__opt__camcalib__init.html#g629e0c3ad0076eadbcd0febcf9886f68" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  モデル撮像結...">fnFIE_calib_add_data()</a> により １回以上データを追加していなければなりません。<p>
本関数では一回分の撮像結果だけでキャリブレーションを行うため、 全てのカメラ内部パラメータを求めることができません（情報が足りない）。 そのため、カメラ内部パラメータのうち、歪み中心 u0, v0 と、 歪み係数 k1, k2 のみを推定します。alpha, beta, gamma は内部で仮定した定数(1,1,0)が使用されます。 つまり、スケールは１、スキュー無しという過程の元で計算が 行われるということです。<p>
より良いパラメータを推定するためには、 下記の事項に注意してデータを作成してください。<ul>
<li>カメラの視野全体にわたって撮像モデル座標が広がるようにする</li><li>特徴点の数を多くする</li></ul>
<p>
<dl compact><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>hcalib</em>&nbsp;</td><td>キャリブレーションデータオブジェクト </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>view_num</em>&nbsp;</td><td><em>hcalib</em> に何番目に追加したデータを使うか <br>
 (0 &lt;= <em>view_num</em> &lt; <a class="el" href="group__fie__opt__camcalib__init.html#g629e0c3ad0076eadbcd0febcf9886f68" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  モデル撮像結...">fnFIE_calib_add_data()</a> を呼んだ回数) </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>pcamera</em>&nbsp;</td><td>カメラ内部パラメータ構造体 </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>homography</em>&nbsp;</td><td>指定した視野データに対応するカメラ混合パラメータ<br>
サイズ3*3の行列</td></tr>
  </table>
</dl>
<dl compact><dt><b>戻り値:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NONE</em>&nbsp;</td><td>正常終了 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_OBJECT</em>&nbsp;</td><td>オブジェクト異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_PARAM</em>&nbsp;</td><td>パラメータ異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NOMEMORY</em>&nbsp;</td><td>メモリ不足 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_CALC_IMPOSSIBLE</em>&nbsp;</td><td>計算不能 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NO_LICENCE</em>&nbsp;</td><td>ライセンスエラー、または未初期化エラー </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="g1a4f0ab9bfce79d32a5e01a83f9fa59a"></a><!-- doxytag: member="fie_calib.c::fnFIE_calib_calc_extrinsic_parameters" ref="g1a4f0ab9bfce79d32a5e01a83f9fa59a" args="(F_CAMERA_PARAM camera, DPNT_T *model_points, DPNT_T *marker_points, INT num_points, FMATRIX *rotation, FVECTOR *translation, FMATRIX *homography)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT FVALGAPI fnFIE_calib_calc_extrinsic_parameters           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a>&nbsp;</td>
          <td class="paramname"> <em>camera</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDPNT__T.html">DPNT_T</a> *&nbsp;</td>
          <td class="paramname"> <em>model_points</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDPNT__T.html">DPNT_T</a> *&nbsp;</td>
          <td class="paramname"> <em>marker_points</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT&nbsp;</td>
          <td class="paramname"> <em>num_points</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFMATRIX.html">FMATRIX</a> *&nbsp;</td>
          <td class="paramname"> <em>rotation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFVECTOR.html">FVECTOR</a> *&nbsp;</td>
          <td class="paramname"> <em>translation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFMATRIX.html">FMATRIX</a> *&nbsp;</td>
          <td class="paramname"> <em>homography</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
 <img class= inline-img src="oss.png" alt="[[OSS]]">  カメラ外部パラメータとカメラ混合パラメータの算出 
<p>
基準モデル座標データと、 そのモデルを撮像した撮像画像から抽出した座標データを <a class="el" href="group__fie__opt__camcalib__use.html#gb3618da3839ddf73c84a10f9721b3264" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  点列を歪み補...">fnFIE_calib_undistort_points()</a> で歪み補正した座標データの対から、 カメラ外部パラメータ（回転行列<img class="formulaInl" alt="$\bf{R}$" src="form_1068.png"> <em>rotation</em> , 並進ベクトル <img class="formulaInl" alt="$\bf{T}$" src="form_1069.png"> <em>translation）と</em> カメラ混合パラメータ <img class="formulaInl" alt="$\bf{H}$" src="form_1065.png"> <em>homography</em> を算出します。<p>
<em>model_points</em> と <em>marker_points</em> は対応する点を同じ順番で格納して与える必要があります。 また、どちらも同じ点数 <em>num_points</em> である必要があります。 キャリブレーションテンプレートはカメラ内部パラメータの算出に用いたものと 数値の単位が同一であればテンプレート自体が同一でなくてもかまいません。 与えるモデルデータ座標値は <a class="el" href="group__fie__opt__camcalib__use.html#g7253e93a49a7a1a58809dc012ec84e63" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  画像を正対変...">fnFIE_calib_rectify_matrix()</a> や <a class="el" href="group__fie__opt__camcalib__use.html#gf3512622ed7c0741f828feaa32821801" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  画像の正対変...">fnFIE_calib_rectify_ud_image_map()</a> に与える <em>ppm</em> の単位に影響します。<p>
<a class="el" href="group__fie__opt__camcalib__exec.html#gf3e633c716b0a13d84572707e4ad3f53" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  １視野による...">fnFIE_calib_calc_1shot()</a> で求めたカメラ内部パラメータを用いて当関数でカメラ混合パラメータやカメラ外部パラメータを算出することはできません。 <a class="el" href="group__fie__opt__camcalib__exec.html#gf3e633c716b0a13d84572707e4ad3f53" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  １視野による...">fnFIE_calib_calc_1shot()</a> でカメラ内部パラメータと同時に算出したホモグラフィ行列を利用してください。<p>
<dl compact><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>camera</em>&nbsp;</td><td>カメラ内部パラメータ構造体 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>model_points</em>&nbsp;</td><td>モデルデータの配列 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>marker_points</em>&nbsp;</td><td>画像から検出して歪み補正を適用済みの特徴点座標の配列 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>num_points</em>&nbsp;</td><td>配列の要素数 </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>rotation</em>&nbsp;</td><td>カメラ外部パラメータ（回転行列）<br>
 3*3の行列 </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>translation</em>&nbsp;</td><td>カメラ外部パラメータ（並進ベクトル）<br>
 要素3のベクトル </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>homography</em>&nbsp;</td><td>カメラ混合パラメータ <br>
 3*3の行列</td></tr>
  </table>
</dl>
<dl compact><dt><b>戻り値:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NONE</em>&nbsp;</td><td>正常終了 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NOMEMORY</em>&nbsp;</td><td>メモリ不足 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_CALC_IMPOSSIBLE</em>&nbsp;</td><td>計算不能 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_PARAM</em>&nbsp;</td><td>パラメータ異常<ul>
<li><em>num_points</em> &lt;= 3</li><li>NULLポインタが渡された</li><li>ホモグラフィ行列を右下の値で正規化できなかった</li><li>不正なサイズの行列または、ベクトルが渡された </li></ul>
</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NO_LICENCE</em>&nbsp;</td><td>ライセンスエラー、または未初期化エラー</td></tr>
  </table>
</dl>
<dl class="user" compact><dt><b>example code</b></dt><dd><div class="fragment"><pre class="fragment"><span class="comment">//エラー処理は省略しているので注意してください。</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include "fie.h"</span>

<span class="comment">//カメラ外部パラメータを求めます。</span>
INT main(VOID)
{
    <span class="comment">//キャリブレーションテンプレート座標系における、モデルの座標データを用意します。</span>
    <a class="code" href="structDPNT__T.html" title="２次元座標指定用構造体(DOUBLE)">DPNT_T</a> model[36] = {
        { 0, 0},{ 4, 0},{ 8, 0}, 
        {12, 0},{16, 0},{20, 0},
        { 0, 4},{ 4, 4},{ 8, 4}, 
        {12, 4},{16, 4},{20, 4},
        { 0, 8},{ 4, 8},{ 8, 8},
        {12, 8},{16, 8},{20, 8},
        { 0,12},{ 4,12},{ 8,12},
        {12,12},{16,12},{20,12},
        { 0,16},{ 4,16},{ 8,16},
        {12,16},{16,16},{20,16},
        { 0,20},{ 4,20},{ 8,20},
        {12,20},{16,20},{20,20}
    };
    <span class="comment">//カメラ画像座標系における、特徴点の検出データを1つだけ用意します。</span>
    <span class="comment">//各座標値はmodelと同じ順番に並んでいます。</span>
    <a class="code" href="structDPNT__T.html" title="２次元座標指定用構造体(DOUBLE)">DPNT_T</a> points[36] = {
        { 263.1, 175.2 },{ 374.9, 156.8 },{ 491.2, 138.5 },
        { 612.0, 119.1 },{ 737.4,  99.2 },{ 867.7,  78.9 },
        { 275.4, 312.2 },{ 387.7, 296.7 },{ 504.4, 280.6 },
        { 625.7, 264.1 },{ 751.6, 246.9 },{ 882.3, 229.3 },
        { 288.2, 449.6 },{ 400.8, 436.8 },{ 517.8, 423.3 },
        { 639.4, 409.3 },{ 765.7, 395.1 },{ 896.8, 380.1 },
        { 301.1, 587.3 },{ 413.9, 577.0 },{ 531.1, 566.2 },
        { 653.1, 555.2 },{ 779.8, 543.8 },{ 911.1, 531.3 },
        { 314.2, 725.1 },{ 427.2, 717.2 },{ 544.9, 709.2 },
        { 667.0, 701.0 },{ 793.9, 692.1 },{ 925.3, 682.9 },
        { 327.8, 862.3 },{ 440.9, 857.2 },{ 558.2, 852.0 },
        { 680.9, 846.2 },{ 807.8, 840.1 },{ 939.2, 833.8 }
    };

    <a class="code" href="structF__CAMERA__PARAM.html" title="カメラ内部パラメータ構造体 (intrinsic parameters)">F_CAMERA_PARAM</a> camera;
    <a class="code" href="structFMATRIX.html" title="行列">FMATRIX</a> *rotation = NULL, *homography = NULL;
    <a class="code" href="structFVECTOR.html" title="ベクトル">FVECTOR</a> *translation = NULL;

    <span class="comment">// FIEライブラリの使用前に必ずコールする必要があります。</span>
    <a class="code" href="group__fie__libinit.html#g12250eabf0163ce206c4caa007b33a80" title="FIEライブラリの初期化">fnFIE_setup</a>();

    <span class="comment">//カメラ内部パラメータを用意します。</span>
    camera.<a class="code" href="structF__CAMERA__PARAM.html#a72956e2fe8c0f52efca60c38e43e02b" title="カメラ内部パラメータ alpha (スケール係数 水平方向)">a</a> = 4004.927964;
    camera.<a class="code" href="structF__CAMERA__PARAM.html#980a18dde870c197a75f46b5fbf27d89" title="カメラ内部パラメータ beta (スケール係数 垂直方向)">b</a> = 4013.092279;
    camera.<a class="code" href="structF__CAMERA__PARAM.html#2d6cc3a4fc155796938c8dbed36ec0cf" title="カメラ内部パラメータ gamma (スキュー)">g</a> =   -3.073555;
    camera.<a class="code" href="structF__CAMERA__PARAM.html#6ed4671a98808c8f1ce51f33663b2c1c" title="カメラ内部パラメータ u0 (光軸中心 水平方向)">u</a> =  681.768416;
    camera.<a class="code" href="structF__CAMERA__PARAM.html#4b6df7b1552bfbdb6a7eb11da25e9f74" title="カメラ内部パラメータ v0 (光軸中心 垂直方向)">v</a> =  515.571246;
    camera.<a class="code" href="structF__CAMERA__PARAM.html#9939594cdc92964a2fd8bca8cc2d8a88" title="放射歪み係数 k1 (光軸中心からのL2ノルムの2乗に掛ける係数)...">k1</a> =  -0.286936;
    camera.<a class="code" href="structF__CAMERA__PARAM.html#73373630394106a41eb44996161163dc" title="放射歪み係数 k2 (光軸中心からのL2ノルムの4乗に掛ける係数)...">k2</a> =   1.420280;
    <span class="comment">//出力先を用意します。</span>
    rotation = <a class="code" href="group__fie__math__matrix__basic.html#g35d17c7e740900c4f718ad4f61226283" title="行列の生成">fnFIE_mat_aalloc</a>( 3, 3 );
    homography = <a class="code" href="group__fie__math__matrix__basic.html#g35d17c7e740900c4f718ad4f61226283" title="行列の生成">fnFIE_mat_aalloc</a>( 3, 3 );
    translation = <a class="code" href="group__fie__math__matrix__basic.html#g7180fe7a013b081282ed95bbd2e673b2" title="ベクトルの生成">fnFIE_mat_valloc</a>( 3 );

    <span class="comment">//カメラ外部パラメータを計算します。</span>
    <a class="code" href="group__fie__opt__camcalib__exec.html#g1a4f0ab9bfce79d32a5e01a83f9fa59a" title=" &amp;lt;img class= inline-img src=&amp;quot;oss.png&amp;quot; alt=&amp;quot;[[OSS]]&amp;quot;&amp;gt;  カメラ外部パ...">fnFIE_calib_calc_extrinsic_parameters</a>( camera, model, points, 36, rotation, translation, homography );

    printf( 
        <span class="stringliteral">"%f\t%f\t%f\n%f\t%f\t%f\n%f\t%f\t%f\n"</span>,
        homography-&gt;m[0][0],homography-&gt;m[0][1],homography-&gt;m[0][2],
        homography-&gt;m[1][0],homography-&gt;m[1][1],homography-&gt;m[1][2],
        homography-&gt;m[2][0],homography-&gt;m[2][1],homography-&gt;m[2][2]
    );

    <a class="code" href="group__fie__math__matrix__basic.html#g8329aaae1791dcd9737ffff194dde79c" title="行列の解放">fnFIE_mat_afree</a>( rotation );
    <a class="code" href="group__fie__math__matrix__basic.html#g8329aaae1791dcd9737ffff194dde79c" title="行列の解放">fnFIE_mat_afree</a>( homography );
    <a class="code" href="group__fie__math__matrix__basic.html#g4239c8a77dc435166360aee41a0903dd" title="ベクトル領域の解放">fnFIE_mat_vfree</a>( translation );

    <span class="comment">// 終了処理</span>
    <a class="code" href="group__fie__libinit.html#gcf71693a1b50ed7ce9947ac8179cbfc3" title="FIEライブラリの終了処理">fnFIE_teardown</a>();

    <span class="keywordflow">return</span> 0;
}
</pre></div> </dd></dl>

</div>
</div><p>
<a class="anchor" name="g5a5043e9d631aa479dd553357c1b3707"></a><!-- doxytag: member="fie_calib.c::fnFIE_calib_calc_homography_matrix" ref="g5a5043e9d631aa479dd553357c1b3707" args="(F_CAMERA_PARAM camera, FMATRIX *rotation, FVECTOR *translation, FMATRIX *homography)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT FVALGAPI fnFIE_calib_calc_homography_matrix           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a>&nbsp;</td>
          <td class="paramname"> <em>camera</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFMATRIX.html">FMATRIX</a> *&nbsp;</td>
          <td class="paramname"> <em>rotation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFVECTOR.html">FVECTOR</a> *&nbsp;</td>
          <td class="paramname"> <em>translation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFMATRIX.html">FMATRIX</a> *&nbsp;</td>
          <td class="paramname"> <em>homography</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
 <img class= inline-img src="oss.png" alt="[[OSS]]">  カメラ混合パラメータの算出 
<p>
カメラ内部パラメータ <em>camera</em> の線形成分 <img class="formulaInl" alt="$A$" src="form_1096.png">と カメラ外部パラメータの回転成分 <em>rotation</em> 及び 並進成分 <em>translation</em> より、カメラ混合パラメータ <em>homography</em> を算出します。<p>
なお、本関数によって得られる変換行列 <em>homography</em> は カメラ外部パラメータの回転成分 <em>rotation</em> 及び 並進成分 <em>translation</em> に加工をしない限り <a class="el" href="group__fie__opt__camcalib__exec.html#g1a4f0ab9bfce79d32a5e01a83f9fa59a" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  カメラ外部パ...">fnFIE_calib_calc_extrinsic_parameters()</a> で得られる <em>homography</em> と同一になります。 本関数は <em>rotation</em> や <em>translation</em> の値を自分で変更した後に カメラ混合パラメータを作成したい場合に使用してください。<p>
<dl class="user" compact><dt><b>演算式</b></dt><dd><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \bf{R} = \left[ \begin{array}{ccc} r_{11} &amp; r_{12} &amp; r_{13}\\ r_{21} &amp; r_{22} &amp; r_{23}\\ r_{31} &amp; r_{32} &amp; r_{33} \end{array} \right], \bf{T} = \left[ \begin{array}{c} t_1 \\ t_2 \\ t_3 \end{array} \right] \]" src="form_1097.png">
<p>
 としたとき <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \bf{H'} = A\left[ \begin{array}{ccc} r_{11} &amp; r_{12} &amp; t_1\\ r_{21} &amp; r_{22} &amp; t_2\\ r_{31} &amp; r_{32} &amp; t_3 \end{array}\right] \]" src="form_1098.png">
<p>
 を計算し、 <img class="formulaInl" alt="$\bf{H'}_{33}$" src="form_1099.png"> を1に正規化した <img class="formulaInl" alt="$\bf{H}$" src="form_1065.png"> を出力します。</dd></dl>
<dl compact><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>camera</em>&nbsp;</td><td>カメラ内部パラメータ構造体 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rotation</em>&nbsp;</td><td>カメラ外部パラメータ（回転行列）<br>
 サイズ3x3の行列 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>translation</em>&nbsp;</td><td>カメラ外部パラメータ（並進ベクトル）<br>
 サイズ3のベクトル </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>homography</em>&nbsp;</td><td>カメラ混合パラメータ <br>
 サイズ3x3の行列</td></tr>
  </table>
</dl>
<dl compact><dt><b>戻り値:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NONE</em>&nbsp;</td><td>正常終了 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NOMEMORY</em>&nbsp;</td><td>メモリ不足 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_PARAM</em>&nbsp;</td><td>パラメータ異常<ul>
<li>NULLポインタが渡された</li><li>ホモグラフィ行列を右下の値で正規化できなかった</li><li>不正なサイズの行列または、ベクトルが渡された </li></ul>
</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NO_LICENCE</em>&nbsp;</td><td>ライセンスエラー、または未初期化エラー </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="g6fb54001db79f6cf44e0c5885954b7ce"></a><!-- doxytag: member="fie_calib.c::fnFIE_calib_calc_error" ref="g6fb54001db79f6cf44e0c5885954b7ce" args="(FHANDLE hcalib, F_CAMERA_PARAM camera, DOUBLE *min_error, DOUBLE *max_error, DOUBLE *average_error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT FVALGAPI fnFIE_calib_calc_error           </td>
          <td>(</td>
          <td class="paramtype">FHANDLE&nbsp;</td>
          <td class="paramname"> <em>hcalib</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a>&nbsp;</td>
          <td class="paramname"> <em>camera</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE *&nbsp;</td>
          <td class="paramname"> <em>min_error</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE *&nbsp;</td>
          <td class="paramname"> <em>max_error</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE *&nbsp;</td>
          <td class="paramname"> <em>average_error</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
 <img class= inline-img src="oss.png" alt="[[OSS]]">  カメラ内部パラメータの精度の検証 
<p>
算出済みのカメラ内部パラメータを利用して <em>hcalib</em> 内の基準モデル座標列をカメラ画像座標系に投影し、 <em>hcalib</em> 内のカメラ画像座標系でのデータと比較して逆投影誤差を計算します。<p>
<dl compact><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>hcalib</em>&nbsp;</td><td>キャリブレーションデータオブジェクト </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>camera</em>&nbsp;</td><td>カメラ内部パラメータ </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>min_error</em>&nbsp;</td><td>最も近かった対応点間の距離 </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>max_error</em>&nbsp;</td><td>最も遠かった対応点間の距離 </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>average_error</em>&nbsp;</td><td>全ての対応点間の距離の平均</td></tr>
  </table>
</dl>
<dl compact><dt><b>戻り値:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NONE</em>&nbsp;</td><td>正常終了 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_PARAM</em>&nbsp;</td><td>パラメータ異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_OBJECT</em>&nbsp;</td><td>オブジェクト異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NOMEMORY</em>&nbsp;</td><td>メモリ不足 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NO_LICENCE</em>&nbsp;</td><td>ライセンスエラー、または未初期化エラー </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="geab0664514c4b803d1444956260926d7"></a><!-- doxytag: member="fie_calib.c::fnFIE_calib_calc_error2" ref="geab0664514c4b803d1444956260926d7" args="(FHANDLE hcalib, F_CAMERA_PARAM camera, INT view_num, DPNT_T *diff, INT num_points)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT FVALGAPI fnFIE_calib_calc_error2           </td>
          <td>(</td>
          <td class="paramtype">FHANDLE&nbsp;</td>
          <td class="paramname"> <em>hcalib</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a>&nbsp;</td>
          <td class="paramname"> <em>camera</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT&nbsp;</td>
          <td class="paramname"> <em>view_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDPNT__T.html">DPNT_T</a> *&nbsp;</td>
          <td class="paramname"> <em>diff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT&nbsp;</td>
          <td class="paramname"> <em>num_points</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
 <img class= inline-img src="oss.png" alt="[[OSS]]">  カメラ内部パラメータの精度の検証2 
<p>
算出済みのカメラ内部パラメータを利用して <em>hcalib</em> 内の基準モデル座標列をカメラ画像座標系に投影し、 <em>hcalib</em> 内に格納済みのモデル撮像結果座標列のうち <em>view_num</em> で指定したカメラ画像座標系でのデータと比較して逆投影誤差を計算します。 計算結果は、モデルをカメラ画像座標系へ投影した座標値からカメラ画像座標系でのデータを減算した値を基準モデル座標列に対応した順番で返します。 <em>diff</em> の単位はカメラ画像座標系におけるピクセルです。<p>
<a class="el" href="group__fie__opt__camcalib__exec.html#ge930c8a92c90656286390d949228aa92" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  カメラ内部パ...">fnFIE_calib_calc_error3()</a> とは、当関数の場合キャリブレーションデータオブジェクトの内部に追加済みのモデル撮像結果座標列を用いる点が異なります。 内部に追加済みの座標列のうち、どの座標列のどの点が算出済みのカメラ内部パラメータとあまり適合しないのか調べるなどの目的で用います。<p>
<dl compact><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>hcalib</em>&nbsp;</td><td>キャリブレーションデータオブジェクト </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>camera</em>&nbsp;</td><td>カメラ内部パラメータ </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>view_num</em>&nbsp;</td><td>カメラ画像座標系番号 <br>
 ( 0 &lt;= <em>view_num</em> &lt; <a class="el" href="group__fie__opt__camcalib__init.html#g629e0c3ad0076eadbcd0febcf9886f68" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  モデル撮像結...">fnFIE_calib_add_data()</a> 又は <a class="el" href="group__fie__opt__camcalib__init.html#g9dc19e6717b62eac0d5e39401c84e0d8" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  特徴点の検出...">fnFIE_calib_add_data2()</a> を呼んだ回数 ) </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>diff</em>&nbsp;</td><td>逆投影誤差配列 </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>num_points</em>&nbsp;</td><td><em>diff</em> 配列が含む座標の個数。基準モデル座標列の個数と同じである必要があります。</td></tr>
  </table>
</dl>
<dl compact><dt><b>戻り値:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NONE</em>&nbsp;</td><td>正常終了 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_PARAM</em>&nbsp;</td><td>パラメータ異常<ul>
<li><em>num_points</em> が基準モデル座標列の個数と異なる</li><li><em>diff</em> がNULL</li><li><em>view_num</em> が範囲外 </li></ul>
</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_OBJECT</em>&nbsp;</td><td>オブジェクト異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NOMEMORY</em>&nbsp;</td><td>メモリ不足 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_CALC_IMPOSSIBLE</em>&nbsp;</td><td>計算不能 ( 指定したモデル撮像結果座標列に対するカメラ外部パラメータ算出に失敗した ) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NO_LICENCE</em>&nbsp;</td><td>ライセンスエラー、または未初期化エラー </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="ge930c8a92c90656286390d949228aa92"></a><!-- doxytag: member="fie_calib.c::fnFIE_calib_calc_error3" ref="ge930c8a92c90656286390d949228aa92" args="(FHANDLE hcalib, F_CAMERA_PARAM camera, DPNT_T *points, DPNT_T *diff, INT num_points)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT FVALGAPI fnFIE_calib_calc_error3           </td>
          <td>(</td>
          <td class="paramtype">FHANDLE&nbsp;</td>
          <td class="paramname"> <em>hcalib</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a>&nbsp;</td>
          <td class="paramname"> <em>camera</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDPNT__T.html">DPNT_T</a> *&nbsp;</td>
          <td class="paramname"> <em>points</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDPNT__T.html">DPNT_T</a> *&nbsp;</td>
          <td class="paramname"> <em>diff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT&nbsp;</td>
          <td class="paramname"> <em>num_points</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
 <img class= inline-img src="oss.png" alt="[[OSS]]">  カメラ内部パラメータの精度の検証3 
<p>
算出済みのカメラ内部パラメータを利用して <em>hcalib</em> 内の基準モデル座標列をカメラ画像座標系に投影し、 <em>points</em> と比較して逆投影誤差を計算します。 <em>points</em> にて与える座標列は <a class="el" href="group__fie__opt__camcalib__init.html#g9802bec525e1fe4c7cb5e04135953284" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  カメラキャリ...">fnFIE_calib_open()</a> で設定した基準モデル座標列と同じ数でなければなりません。 またその順序は、基準モデル座標列の指定時と同じ順序でなければなりません。 なお、<em>points</em> の座標はカメラ画像の座標系 (画像左上を原点として単位はピクセル)で与えてください。 計算結果は、基準モデル座標列をカメラ画像座標系へ投影した座標値からカメラ画像座標系でのデータである <em>points</em> を減算した値を、基準モデル座標列に対応した順番で返します。 <em>diff</em> の単位も <em>points</em> 同様にカメラ画像座標系におけるピクセルです。<p>
<a class="el" href="group__fie__opt__camcalib__exec.html#geab0664514c4b803d1444956260926d7" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  カメラ内部パ...">fnFIE_calib_calc_error2()</a> とは、 <a class="el" href="group__fie__opt__camcalib__init.html#g629e0c3ad0076eadbcd0febcf9886f68" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  モデル撮像結...">fnFIE_calib_add_data()</a> や <a class="el" href="group__fie__opt__camcalib__init.html#g9dc19e6717b62eac0d5e39401c84e0d8" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  特徴点の検出...">fnFIE_calib_add_data2()</a> でキャリブレーションデータオブジェクトの内部に追加済みのモデル撮像結果座標列を用いるのではなく、 当関数に直接モデル撮像結果座標列を与える点で異なります。 当関数はカメラパラメータの算出に用いなかった座標列で誤差検証を行いたい場合などに利用します。<p>
<dl compact><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>hcalib</em>&nbsp;</td><td>キャリブレーションデータオブジェクト </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>camera</em>&nbsp;</td><td>カメラ内部パラメータ </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>points</em>&nbsp;</td><td>画像から検出したモデル座標の配列。 <em>hcalib</em> の基準モデル座標列と対応した順番である必要があります。 </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>diff</em>&nbsp;</td><td>逆投影誤差配列 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>num_points</em>&nbsp;</td><td><em>points</em> と <em>diff</em> 配列のサイズ。<br>
 基準モデル座標配列と同じ個数である必要があります。</td></tr>
  </table>
</dl>
<dl compact><dt><b>戻り値:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NONE</em>&nbsp;</td><td>正常終了 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_PARAM</em>&nbsp;</td><td>パラメータ異常<ul>
<li><em>points</em> 又は <em>diff</em> がNULL</li><li><em>num_points</em> と基準モデル座標列の個数が異なる </li></ul>
</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_OBJECT</em>&nbsp;</td><td>オブジェクト異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NOMEMORY</em>&nbsp;</td><td>メモリ不足 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_CALC_IMPOSSIBLE</em>&nbsp;</td><td>計算不能 ( <em>points</em> に対するカメラ外部パラメータ算出に失敗した ) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NO_LICENCE</em>&nbsp;</td><td>ライセンスエラー、または未初期化エラー </td></tr>
  </table>
</dl>

</div>
</div><p>
</div>
<hr size="1">
<address style="align: right; color: #cccccc;">
	<small>
	Documentation copyright &copy; 2009-2025 TOKYO ELECTRON DEVICE LIMITED. <br>
	Generated on Tue Sep 16 09:08:55 2025 for FIEライブラリ by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.5.6-FASTSP-p2
	</small>
</address>
</body>
</html>
