<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=Shift_JIS">
<title>FIEライブラリ: 結果利用</title>
<link href="fvalg-prod.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- 作成： Doxygen 1.5.6-FASTSP-p2 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="contents">
<h1>結果利用<br>
<small>
[<a class="el" href="group__fie__opt__camcalib.html">カメラキャリブレーション</a>]</small>
</h1>
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>関数</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">INT FVALGAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fie__opt__camcalib__use.html#gb3618da3839ddf73c84a10f9721b3264">fnFIE_calib_undistort_points</a> (<a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a> camera, <a class="el" href="structDPNT__T.html">DPNT_T</a> *src_points, <a class="el" href="structDPNT__T.html">DPNT_T</a> *dst_points, INT num_points)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"> <img class= inline-img src="oss.png" alt="[[OSS]]">  点列を歪み補正画像座標へ変換  <a href="#gb3618da3839ddf73c84a10f9721b3264"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">INT FVALGAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fie__opt__camcalib__use.html#geed54e0168d712841402bf53f4c70a8a">fnFIE_calib_undistort_image_map</a> (<a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a> camera, FHANDLE map)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"> <img class= inline-img src="oss.png" alt="[[OSS]]">  画像の歪み補正マップ生成  <a href="#geed54e0168d712841402bf53f4c70a8a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">INT FVALGAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fie__opt__camcalib__use.html#ge8d82c04fd81c148d2fe4dfd031bd721">fnFIE_calib_undistort_image_map_scale</a> (<a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a> camera, <a class="el" href="structDPNT__T.html">DPNT_T</a> offset, DOUBLE scale, FHANDLE map)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"> <img class= inline-img src="oss.png" alt="[[OSS]]">  画像の歪み補正マップ生成(スケール・オフセット付き)  <a href="#ge8d82c04fd81c148d2fe4dfd031bd721"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">INT FVALGAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fie__opt__camcalib__use.html#gca9245ce1b7f6bf6c90896afad4aa8e1">fnFIE_calib_undistort_fit_scale</a> (<a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a> camera, INT src_width, INT src_height, INT mode, DOUBLE *fit_scale, <a class="el" href="structDPNT__T.html">DPNT_T</a> *fit_offset, INT *fit_width, INT *fit_height)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"> <img class= inline-img src="oss.png" alt="[[OSS]]">  歪み補正画像の内接矩形画像や外接矩形画像作成のための係数の算出  <a href="#gca9245ce1b7f6bf6c90896afad4aa8e1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">INT FVALGAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fie__opt__camcalib__use.html#ga71615c4d685f73ebabf2b3ba6ca72a0">fnFIE_calib_undistort_fit_rect</a> (<a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a> camera, INT src_width, INT src_height, INT mode, DOUBLE scale, <a class="el" href="structDPNT__T.html">DPNT_T</a> *fit_offset, INT *fit_width, INT *fit_height)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"> <img class= inline-img src="oss.png" alt="[[OSS]]">  歪み補正画像の内接矩形画像や外接矩形画像作成のための係数の算出2  <a href="#ga71615c4d685f73ebabf2b3ba6ca72a0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">INT FVALGAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fie__opt__camcalib__use.html#g5cedfff9c020872194864b42f544e8b3">fnFIE_calib_distort_points</a> (<a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a> camera, <a class="el" href="structDPNT__T.html">DPNT_T</a> *src_points, <a class="el" href="structDPNT__T.html">DPNT_T</a> *dst_points, INT num_points)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"> <img class= inline-img src="oss.png" alt="[[OSS]]">  点列を歪んだ座標へ変換  <a href="#g5cedfff9c020872194864b42f544e8b3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">INT FVALGAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fie__opt__camcalib__use.html#g22241f0e16d2d55fbbdcae80f6504b1d">fnFIE_calib_distort_image_map</a> (<a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a> camera, FHANDLE map)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"> <img class= inline-img src="oss.png" alt="[[OSS]]">  画像の歪みシミュレーションマップ生成  <a href="#g22241f0e16d2d55fbbdcae80f6504b1d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">INT FVALGAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fie__opt__camcalib__use.html#g7253e93a49a7a1a58809dc012ec84e63">fnFIE_calib_rectify_matrix</a> (<a class="el" href="structFMATRIX.html">FMATRIX</a> *homography, DOUBLE origin_x, DOUBLE origin_y, DOUBLE ppm, <a class="el" href="structFMATRIX.html">FMATRIX</a> *rectify)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"> <img class= inline-img src="oss.png" alt="[[OSS]]">  画像を正対変換するための射影行列の生成  <a href="#g7253e93a49a7a1a58809dc012ec84e63"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">INT FVALGAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fie__opt__camcalib__use.html#gc66c887e0ec4e50d4c6689da38f2cb8e">fnFIE_calib_rectify_matrix_inv</a> (<a class="el" href="structFMATRIX.html">FMATRIX</a> *homography, DOUBLE origin_x, DOUBLE origin_y, DOUBLE ppm, <a class="el" href="structFMATRIX.html">FMATRIX</a> *rect_inv)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"> <img class= inline-img src="oss.png" alt="[[OSS]]">  画像を逆正対変換するための射影行列の生成  <a href="#gc66c887e0ec4e50d4c6689da38f2cb8e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">INT FVALGAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fie__opt__camcalib__use.html#gf3512622ed7c0741f828feaa32821801">fnFIE_calib_rectify_ud_image_map</a> (<a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a> camera, <a class="el" href="structFMATRIX.html">FMATRIX</a> *homography, DOUBLE origin_x, DOUBLE origin_y, DOUBLE ppm, FHANDLE map)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"> <img class= inline-img src="oss.png" alt="[[OSS]]">  画像の正対変換と歪み補正を同時に行う座標変換マップの生成  <a href="#gf3512622ed7c0741f828feaa32821801"></a><br></td></tr>
</table>
<hr><h2>関数</h2>
<a class="anchor" name="gb3618da3839ddf73c84a10f9721b3264"></a><!-- doxytag: member="fie_calib.c::fnFIE_calib_undistort_points" ref="gb3618da3839ddf73c84a10f9721b3264" args="(F_CAMERA_PARAM camera, DPNT_T *src_points, DPNT_T *dst_points, INT num_points)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT FVALGAPI fnFIE_calib_undistort_points           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a>&nbsp;</td>
          <td class="paramname"> <em>camera</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDPNT__T.html">DPNT_T</a> *&nbsp;</td>
          <td class="paramname"> <em>src_points</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDPNT__T.html">DPNT_T</a> *&nbsp;</td>
          <td class="paramname"> <em>dst_points</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT&nbsp;</td>
          <td class="paramname"> <em>num_points</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
 <img class= inline-img src="oss.png" alt="[[OSS]]">  点列を歪み補正画像座標へ変換 
<p>
カメラ内部パラメータによる座標変換を行います。 カメラ画像座標系から理想画像座標系への変換になります。<p>
<dl class="user" compact><dt><b>演算式</b></dt><dd>カメラ画像座標系での座標 <em>src_points</em> を <img class="formulaInl" alt="$\breve{u}, \breve{v}$" src="form_1100.png"> 、 理想画像座標系での座標 <em>dst_points</em> を <img class="formulaInl" alt="$u, v$" src="form_1101.png"> とすると、その対応は次式により定義されています。 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{array}{l} \breve{u} = u+(u-u_0)[k_1(x^2+y^2)+k_2(x^2+y^2)^2] \\ \breve{v} = v+(v-v_0)[k_1(x^2+y^2)+k_2(x^2+y^2)^2] \end{array} \]" src="form_1095.png">
<p>
 ただし、<br>
 <img class="formulaInl" alt="$u_0, v_0$" src="form_1080.png"> ：カメラ内部パラメータ（光軸移動係数） <br>
 <img class="formulaInl" alt="$k_1, k_2$" src="form_1102.png"> ：カメラ内部パラメータ（放射歪係数）<br>
 <img class="formulaInl" alt="$x, y$" src="form_1103.png"> ：正規化画像座標系での座標 <br>
 また、<img class="formulaInl" alt="$x, y$" src="form_1103.png"> はカメラ内部パラメータ行列 <img class="formulaInl" alt="$A^{-1}$" src="form_1104.png"> により <img class="formulaInl" alt="$\breve{u}, \breve{v}$" src="form_1100.png"> を射影変換した座標です。</dd></dl>
<dl class="user" compact><dt><b></b></dt><dd>本関数ではこの関係式より、 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{array}{l} u+(u-u_0)[k_1(x^2+y^2)+k_2(x^2+y^2)^2] - \breve{u}\\ v+(v-v_0)[k_1(x^2+y^2)+k_2(x^2+y^2)^2] - \breve{v} \end{array} \]" src="form_1105.png">
<p>
 が最小になるような <img class="formulaInl" alt="$u,v$" src="form_1106.png"> を非線形最適化を用いて推定し、出力します。</dd></dl>
<dl compact><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>camera</em>&nbsp;</td><td>カメラ内部パラメータ構造体 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>src_points</em>&nbsp;</td><td>カメラ画像座標系における点の配列 </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>dst_points</em>&nbsp;</td><td>歪み補正画像座標系における点の配列 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>num_points</em>&nbsp;</td><td><em>src_points</em>, <em>dst_points</em> の点数</td></tr>
  </table>
</dl>
<dl compact><dt><b>戻り値:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NONE</em>&nbsp;</td><td>正常終了 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NOMEMORY</em>&nbsp;</td><td>メモリ不足 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_CALC_IMPOSSIBLE</em>&nbsp;</td><td>計算不能 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_PARAM</em>&nbsp;</td><td>パラメータ異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NO_LICENCE</em>&nbsp;</td><td>ライセンスエラー、または未初期化エラー</td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>参照:</b></dt><dd><a class="el" href="group__fie__opt__camcalib__use.html#g5cedfff9c020872194864b42f544e8b3" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  点列を歪ん...">fnFIE_calib_distort_points()</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="geed54e0168d712841402bf53f4c70a8a"></a><!-- doxytag: member="fie_calib.c::fnFIE_calib_undistort_image_map" ref="geed54e0168d712841402bf53f4c70a8a" args="(F_CAMERA_PARAM camera, FHANDLE map)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT FVALGAPI fnFIE_calib_undistort_image_map           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a>&nbsp;</td>
          <td class="paramname"> <em>camera</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FHANDLE&nbsp;</td>
          <td class="paramname"> <em>map</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
 <img class= inline-img src="oss.png" alt="[[OSS]]">  画像の歪み補正マップ生成 
<p>
カメラ内部パラメータによる座標変換マップを生成します。 本関数によって生成される座標変換マップは、 カメラ画像座標系から理想画像座標系への変換を行います。<p>
<div align="center">
<img src="calib_undis0.png" alt="calib_undis0.png">
<p><strong>歪み補正の実施例</strong></p></div>
 <em>map</em> は <a class="el" href="group__fie__geometric__transform.html#g599d687f04058cc75345e19f1f9c96ab" title="座標変換マップに従って座標を変換する">fnFIE_geotrans_warpping()</a> と同じ形式の座標変換マップ画像で、 画像型 F_IMG_DOUBLE または F_IMG_FLOAT、チャネル数２の画像を入力します。 <em>map</em> の画像サイズは後で <a class="el" href="group__fie__geometric__transform.html#g599d687f04058cc75345e19f1f9c96ab" title="座標変換マップに従って座標を変換する">fnFIE_geotrans_warpping()</a> に渡して 変換する際の処理結果画像と画像サイズが同じである必要があります。 また、カメラ内部パラメータ算出時の画像サイズと同じであることを 想定していますが、異なっていても実行は可能です。<p>
カメラ画像座標と理想画像座標で光軸中心付近の スケール係数が1対1になるように変換マップは生成されます。 そのため、画像の外周では変換後に補正前には視野の外だったピクセルが 画像中に出たり、補正前に視野にあったピクセルが画像外に出たりすることがあります。<p>
<dl class="attention" compact><dt><b>注意:</b></dt><dd>カメラ内部パラメータ内の光軸中心の値は <a class="el" href="group__fie__opt__camcalib__init.html#g629e0c3ad0076eadbcd0febcf9886f68" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  モデル撮像結...">fnFIE_calib_add_data()</a> で与えた特徴点の座標系での値となります。 通常はカメラ画像座標系と同じ座標系であり、カメラ画像の中心付近に現れます。 当関数にカメラ画像と異なったサイズの座標変換マップを渡すと、 光軸中心は動かないために画像中心と大きく異なった場所を基準に 歪み補正が行われてしまいますので、注意する必要があります。</dd></dl>
<dl class="user" compact><dt><b>演算式</b></dt><dd>カメラ画像座標系での座標を <img class="formulaInl" alt="$\breve{u}, \breve{v}$" src="form_1100.png"> 、 理想画像座標系での座標を <img class="formulaInl" alt="$u, v$" src="form_1101.png"> とすると、本関数は次式により表される変換マップを生成します。 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{array}{l} \breve{u} = u+(u-u_0)[k_1(x^2+y^2)+k_2(x^2+y^2)^2] \\ \breve{v} = v+(v-v_0)[k_1(x^2+y^2)+k_2(x^2+y^2)^2] \end{array} \]" src="form_1095.png">
<p>
 ただし、<br>
 <img class="formulaInl" alt="$u_0, v_0$" src="form_1080.png"> ：カメラ内部パラメータ（光軸移動係数） <br>
 <img class="formulaInl" alt="$k_1, k_2$" src="form_1102.png"> ：カメラ内部パラメータ（放射歪係数）<br>
 <img class="formulaInl" alt="$x, y$" src="form_1103.png"> ：正規化画像座標系での座標 <br>
 また、<img class="formulaInl" alt="$x, y$" src="form_1103.png"> はカメラ内部パラメータ行列 <img class="formulaInl" alt="$A^{-1}$" src="form_1104.png"> により <img class="formulaInl" alt="$\breve{u}, \breve{v}$" src="form_1100.png"> を射影変換した座標です。</dd></dl>
<dl compact><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>camera</em>&nbsp;</td><td>カメラ内部パラメータ構造体 </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>map</em>&nbsp;</td><td>歪み補正画像作成用map ( type:double, float / ch:2 )</td></tr>
  </table>
</dl>
<dl compact><dt><b>戻り値:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NONE</em>&nbsp;</td><td>正常終了 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NOMEMORY</em>&nbsp;</td><td>メモリ不足 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_IMAGE</em>&nbsp;</td><td>画像異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_PARAM</em>&nbsp;</td><td>パラメータ異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_CALC_IMPOSSIBLE</em>&nbsp;</td><td>カメラ内部パラメータの逆行列が計算不能 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NO_LICENCE</em>&nbsp;</td><td>ライセンスエラー、または未初期化エラー</td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>参照:</b></dt><dd><a class="el" href="group__fie__geometric__transform.html#g599d687f04058cc75345e19f1f9c96ab" title="座標変換マップに従って座標を変換する">fnFIE_geotrans_warpping()</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="ge8d82c04fd81c148d2fe4dfd031bd721"></a><!-- doxytag: member="fie_calib.c::fnFIE_calib_undistort_image_map_scale" ref="ge8d82c04fd81c148d2fe4dfd031bd721" args="(F_CAMERA_PARAM camera, DPNT_T offset, DOUBLE scale, FHANDLE map)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT FVALGAPI fnFIE_calib_undistort_image_map_scale           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a>&nbsp;</td>
          <td class="paramname"> <em>camera</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDPNT__T.html">DPNT_T</a>&nbsp;</td>
          <td class="paramname"> <em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE&nbsp;</td>
          <td class="paramname"> <em>scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FHANDLE&nbsp;</td>
          <td class="paramname"> <em>map</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
 <img class= inline-img src="oss.png" alt="[[OSS]]">  画像の歪み補正マップ生成(スケール・オフセット付き) 
<p>
カメラ内部パラメータによる座標変換マップを生成します。 本関数によって生成される座標変換マップは、カメラ画像座標系から、 理想画像座標系にスケールとオフセットを加えた座標系への変換を行います。<p>
本関数と <a class="el" href="group__fie__opt__camcalib__use.html#geed54e0168d712841402bf53f4c70a8a" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  画像の歪み補...">fnFIE_calib_undistort_image_map()</a> との違いは、 <a class="el" href="group__fie__opt__camcalib__use.html#geed54e0168d712841402bf53f4c70a8a" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  画像の歪み補...">fnFIE_calib_undistort_image_map()</a> がカメラ内部パラメータによる変換結果をそのまま 使用するのに対して、本関数ではそれにスケールとオフセットを付加できる点です。 その他の部分は <a class="el" href="group__fie__opt__camcalib__use.html#geed54e0168d712841402bf53f4c70a8a" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  画像の歪み補...">fnFIE_calib_undistort_image_map()</a> と同一仕様ですので、 そちらのリファレンスをあわせて参照してください。<p>
スケール <em>scale</em> およびオフセット <em>offset</em> は理想画像座標を <img class="formulaInl" alt="$x, y$" src="form_1103.png"> 、 理想画像座標にスケールとオフセットを加えた座標を <img class="formulaInl" alt="$x', y'$" src="form_1107.png"> としたときに、 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{array}{l} x' = x / scale - offset.x \\ y' = y / scale - offset.y \end{array} \]" src="form_1108.png">
<p>
 となるように適用されます。 つまり <a class="el" href="group__fie__opt__camcalib__use.html#geed54e0168d712841402bf53f4c70a8a" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  画像の歪み補...">fnFIE_calib_undistort_image_map()</a> の出力する座標変換マップと 本関数によって生成された座標変換マップを比較したときに、 <a class="el" href="group__fie__geometric__transform.html#g599d687f04058cc75345e19f1f9c96ab" title="座標変換マップに従って座標を変換する">fnFIE_geotrans_warpping()</a> で使用した結果の画像が (0,0) を基準に <em>scale</em> 倍された後で <em>offset</em> だけ平行移動 するような違いが生まれます。<p>
<em>map</em> は <a class="el" href="group__fie__geometric__transform.html#g599d687f04058cc75345e19f1f9c96ab" title="座標変換マップに従って座標を変換する">fnFIE_geotrans_warpping()</a> と同じ形式の座標変換マップ画像で、 画像型 F_IMG_DOUBLE または F_IMG_FLOAT、チャネル数２の画像を入力します。 <em>map</em> の画像サイズは後で <a class="el" href="group__fie__geometric__transform.html#g599d687f04058cc75345e19f1f9c96ab" title="座標変換マップに従って座標を変換する">fnFIE_geotrans_warpping()</a> に渡して 変換する際の処理結果画像と画像サイズが同じである必要があります。<p>
<dl compact><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>camera</em>&nbsp;</td><td>カメラ内部パラメータ構造体 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>offset</em>&nbsp;</td><td>原点のオフセット </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>scale</em>&nbsp;</td><td>拡大倍率 ( <em>scale</em> &gt; 0 ) </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>map</em>&nbsp;</td><td>歪み補正画像作成用map ( type:double, float / ch:2 )</td></tr>
  </table>
</dl>
<dl compact><dt><b>戻り値:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NONE</em>&nbsp;</td><td>正常終了 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NOMEMORY</em>&nbsp;</td><td>メモリ不足 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_IMAGE</em>&nbsp;</td><td>画像異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_PARAM</em>&nbsp;</td><td>パラメータ異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_CALC_IMPOSSIBLE</em>&nbsp;</td><td>カメラ内部パラメータの逆行列が計算不能 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NO_LICENCE</em>&nbsp;</td><td>ライセンスエラー、または未初期化エラー</td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>参照:</b></dt><dd><a class="el" href="group__fie__geometric__transform.html#g599d687f04058cc75345e19f1f9c96ab" title="座標変換マップに従って座標を変換する">fnFIE_geotrans_warpping()</a> , <a class="el" href="group__fie__opt__camcalib__use.html#geed54e0168d712841402bf53f4c70a8a" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  画像の歪み補...">fnFIE_calib_undistort_image_map()</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="gca9245ce1b7f6bf6c90896afad4aa8e1"></a><!-- doxytag: member="fie_calib.c::fnFIE_calib_undistort_fit_scale" ref="gca9245ce1b7f6bf6c90896afad4aa8e1" args="(F_CAMERA_PARAM camera, INT src_width, INT src_height, INT mode, DOUBLE *fit_scale, DPNT_T *fit_offset, INT *fit_width, INT *fit_height)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT FVALGAPI fnFIE_calib_undistort_fit_scale           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a>&nbsp;</td>
          <td class="paramname"> <em>camera</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT&nbsp;</td>
          <td class="paramname"> <em>src_width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT&nbsp;</td>
          <td class="paramname"> <em>src_height</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT&nbsp;</td>
          <td class="paramname"> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE *&nbsp;</td>
          <td class="paramname"> <em>fit_scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDPNT__T.html">DPNT_T</a> *&nbsp;</td>
          <td class="paramname"> <em>fit_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT *&nbsp;</td>
          <td class="paramname"> <em>fit_width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT *&nbsp;</td>
          <td class="paramname"> <em>fit_height</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
 <img class= inline-img src="oss.png" alt="[[OSS]]">  歪み補正画像の内接矩形画像や外接矩形画像作成のための係数の算出 
<p>
幅が <em>src_width</em>, 高さが <em>src_height</em> のカメラ撮像画像を カメラ内部パラメータ <em>camera</em> にて変換する際に、 その変換結果に対してフィットするような 座標変換マップのサイズとオフセットを計算します。 計算されたパラメータ <em>fit_offset</em>, <em>fit_width</em>, <em>fit_width</em> は スケール・オフセット付き画像ひずみ補正関数 <a class="el" href="group__fie__opt__camcalib__use.html#ge8d82c04fd81c148d2fe4dfd031bd721" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  画像の歪み補...">fnFIE_calib_undistort_image_map_scale()</a> にて使用できます。<p>
本関数では変換マップの幅または高さのうち、 スケール変化の小さくなる方をカメラ撮像画像のそれと 同一になるように固定したときの各パラメータを算出します。<p>
<em>mode</em> パラメータの指定値により動作が異なり、 次のように処理が行われます。<p>
<dl class="user" compact><dt><b>mode 0</b></dt><dd><em>mode</em> == 0 の場合、歪み補正を行った理想画像の補正結果内部に 無効領域が現れないように画像が作成されるパラメータを算出します。 <div align="center">
<img src="calib_fit0.png" alt="calib_fit0.png">
</div>
</dd></dl>
<dl class="user" compact><dt><b>mode 1</b></dt><dd><em>mode</em> == 1 の場合、理想画像の出力時に無効領域を作ってでも 元々のカメラ画像の全てのピクセルが変換先に現れるように 画像が作成されるパラメータを算出します。 <div align="center">
<img src="calib_fit1.png" alt="calib_fit1.png">
</div>
</dd></dl>
計算の結果、出力すべき画像の縦横比が変わってしまうことがあります。 外接するモードで縦横比が変わった場合には、<em>fit_width</em> または <em>fit_height</em> の どちらかに <em>src_width</em> や <em>src_height</em> より小さい値が入ります。 内接するモードで縦横比が変わった場合には、<em>fit_width</em> または <em>fit_height</em> の どちらかに <em>src_width</em> や <em>src_height</em> より大きい値が入ります。<p>
本関数と <a class="el" href="group__fie__opt__camcalib__use.html#ga71615c4d685f73ebabf2b3ba6ca72a0" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  歪み補正画像...">fnFIE_calib_undistort_fit_rect()</a> との違いは、 本関数がカメラ撮像画像の幅または高さを基準として パラメータを算出するのに対し <a class="el" href="group__fie__opt__camcalib__use.html#ga71615c4d685f73ebabf2b3ba6ca72a0" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  歪み補正画像...">fnFIE_calib_undistort_fit_rect()</a> では 画像のスケール変化率を基準としてパラメータを算出する点です。<p>
<dl compact><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>camera</em>&nbsp;</td><td>カメラ内部パラメータ構造体 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>src_width</em>&nbsp;</td><td>カメラ画像とワープ変換先画像の横幅 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>src_height</em>&nbsp;</td><td>カメラ画像とワープ変換先画像の縦幅 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mode</em>&nbsp;</td><td>計算モード指定<ul>
<li>0 内接する：ワープ変換後の画像は無効領域を持たない</li><li>1 外接する：ワープ変換前の画素は全てワープ変換後の画像に出現する </li></ul>
</td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>fit_scale</em>&nbsp;</td><td>スケール係数 </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>fit_offset</em>&nbsp;</td><td>オフセット </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>fit_width</em>&nbsp;</td><td>内接または外接する領域を最大限にとったときの横幅 </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>fit_height</em>&nbsp;</td><td>内接または外接する領域を最大限にとったときの縦幅</td></tr>
  </table>
</dl>
<dl compact><dt><b>戻り値:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NONE</em>&nbsp;</td><td>正常終了 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_PARAM</em>&nbsp;</td><td>パラメータ異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NOMEMORY</em>&nbsp;</td><td>メモリ不足 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_CALC_IMPOSSIBLE</em>&nbsp;</td><td>計算不能 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NO_LICENCE</em>&nbsp;</td><td>ライセンスエラー、または未初期化エラー</td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>参照:</b></dt><dd><a class="el" href="group__fie__opt__camcalib__use.html#ge8d82c04fd81c148d2fe4dfd031bd721" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  画像の歪み補...">fnFIE_calib_undistort_image_map_scale()</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="ga71615c4d685f73ebabf2b3ba6ca72a0"></a><!-- doxytag: member="fie_calib.c::fnFIE_calib_undistort_fit_rect" ref="ga71615c4d685f73ebabf2b3ba6ca72a0" args="(F_CAMERA_PARAM camera, INT src_width, INT src_height, INT mode, DOUBLE scale, DPNT_T *fit_offset, INT *fit_width, INT *fit_height)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT FVALGAPI fnFIE_calib_undistort_fit_rect           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a>&nbsp;</td>
          <td class="paramname"> <em>camera</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT&nbsp;</td>
          <td class="paramname"> <em>src_width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT&nbsp;</td>
          <td class="paramname"> <em>src_height</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT&nbsp;</td>
          <td class="paramname"> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE&nbsp;</td>
          <td class="paramname"> <em>scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDPNT__T.html">DPNT_T</a> *&nbsp;</td>
          <td class="paramname"> <em>fit_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT *&nbsp;</td>
          <td class="paramname"> <em>fit_width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT *&nbsp;</td>
          <td class="paramname"> <em>fit_height</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
 <img class= inline-img src="oss.png" alt="[[OSS]]">  歪み補正画像の内接矩形画像や外接矩形画像作成のための係数の算出2 
<p>
幅が <em>src_width</em>, 高さが <em>src_height</em> のカメラ撮像画像を カメラ内部パラメータ <em>camera</em> にて画像を変換する際に、 <em>scale</em> パラメータで入力したスケール係数の画像に対してフィットするような 座標変換マップのサイズとオフセットを計算します。<p>
計算されたパラメータ <em>fit_offset</em>, <em>fit_width</em>, <em>fit_width</em> は スケール・オフセット付き画像ひずみ補正関数 <a class="el" href="group__fie__opt__camcalib__use.html#ge8d82c04fd81c148d2fe4dfd031bd721" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  画像の歪み補...">fnFIE_calib_undistort_image_map_scale()</a> にて使用できます。<p>
<em>mode</em> パラメータの指定値により動作が異なり、 次のように処理が行われます。<p>
<dl class="user" compact><dt><b>mode 0</b></dt><dd><em>mode</em> == 0 の場合、歪み補正を行った理想画像の補正結果内部に 無効領域が現れないように画像が作成されるパラメータを算出します。 <div align="center">
<img src="calib_fit0.png" alt="calib_fit0.png">
</div>
</dd></dl>
<dl class="user" compact><dt><b>mode 1</b></dt><dd><em>mode</em> == 1 の場合、理想画像の出力時に無効領域を作ってでも 元々のカメラ画像の全てのピクセルが変換先に現れるように 画像が作成されるパラメータを算出します。 <div align="center">
<img src="calib_fit1.png" alt="calib_fit1.png">
</div>
</dd></dl>
本関数と <a class="el" href="group__fie__opt__camcalib__use.html#gca9245ce1b7f6bf6c90896afad4aa8e1" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  歪み補正画像...">fnFIE_calib_undistort_fit_scale()</a> との違いは、 本関数が画像のスケール変化率を基準としてパラメータを算出する のに対し <a class="el" href="group__fie__opt__camcalib__use.html#gca9245ce1b7f6bf6c90896afad4aa8e1" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  歪み補正画像...">fnFIE_calib_undistort_fit_scale()</a> では カメラ撮像画像の幅または高さを基準としてパラメータを算出する点です。<p>
<dl compact><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>camera</em>&nbsp;</td><td>カメラ内部パラメータ構造体 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>src_width</em>&nbsp;</td><td>カメラ画像とワープ変換先画像の横幅 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>src_height</em>&nbsp;</td><td>カメラ画像とワープ変換先画像の縦幅 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mode</em>&nbsp;</td><td>計算モード指定<ul>
<li>0 内接する：ワープ変換後の画像は無効領域を持たない</li><li>1 外接する：ワープ変換前の画素は全てワープ変換後の画像に出現する </li></ul>
</td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>scale</em>&nbsp;</td><td>スケール係数 ( <em>scale</em> &gt; 0 ) </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>fit_offset</em>&nbsp;</td><td>オフセット </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>fit_width</em>&nbsp;</td><td>内接または外接する領域を最大限にとったときの横幅 </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>fit_height</em>&nbsp;</td><td>内接または外接する領域を最大限にとったときの縦幅</td></tr>
  </table>
</dl>
<dl compact><dt><b>戻り値:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NONE</em>&nbsp;</td><td>正常終了 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_PARAM</em>&nbsp;</td><td>パラメータ異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NOMEMORY</em>&nbsp;</td><td>メモリ不足 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_CALC_IMPOSSIBLE</em>&nbsp;</td><td>計算不能 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NO_LICENCE</em>&nbsp;</td><td>ライセンスエラー、または未初期化エラー</td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>参照:</b></dt><dd><a class="el" href="group__fie__opt__camcalib__use.html#ge8d82c04fd81c148d2fe4dfd031bd721" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  画像の歪み補...">fnFIE_calib_undistort_image_map_scale()</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="g5cedfff9c020872194864b42f544e8b3"></a><!-- doxytag: member="fie_calib.c::fnFIE_calib_distort_points" ref="g5cedfff9c020872194864b42f544e8b3" args="(F_CAMERA_PARAM camera, DPNT_T *src_points, DPNT_T *dst_points, INT num_points)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT FVALGAPI fnFIE_calib_distort_points           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a>&nbsp;</td>
          <td class="paramname"> <em>camera</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDPNT__T.html">DPNT_T</a> *&nbsp;</td>
          <td class="paramname"> <em>src_points</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDPNT__T.html">DPNT_T</a> *&nbsp;</td>
          <td class="paramname"> <em>dst_points</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT&nbsp;</td>
          <td class="paramname"> <em>num_points</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
 <img class= inline-img src="oss.png" alt="[[OSS]]">  点列を歪んだ座標へ変換 
<p>
カメラ内部パラメータと放射歪み係数を用いて点列の歪みシミュレーションを行います。 理想画像座標系からカメラ画像座標系への変換です。<p>
<em>src_points</em> で与えられる理想画像座標系での座標を <img class="formulaInl" alt="$u, v$" src="form_1101.png"> と表すと、本関数は下式により <em>dst_points</em> で出力される カメラ画像座標系での座標 <img class="formulaInl" alt="$\breve{u},\breve{v}$" src="form_1109.png"> を計算します。<p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{array}{l} \breve{u} = u+(u-u_0)[k_1(x^2+y^2)+k_2(x^2+y^2)^2] \\ \breve{v} = v+(v-v_0)[k_1(x^2+y^2)+k_2(x^2+y^2)^2] \end{array} \]" src="form_1095.png">
<p>
 ただし、 <img class="formulaInl" alt="$x, y$" src="form_1103.png"> ：正規化画像座標系での座標 <br>
 <img class="formulaInl" alt="$u_0, v_0$" src="form_1080.png"> ：カメラ内部パラメータ <br>
 <img class="formulaInl" alt="$k_1, k_2$" src="form_1102.png"> ：放射歪系数 <br>
<p>
<dl compact><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>camera</em>&nbsp;</td><td>カメラ内部パラメータ構造体 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>src_points</em>&nbsp;</td><td>理想画像座標系における点の配列( <img class="formulaInl" alt="$u, v$" src="form_1101.png"> ) </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>dst_points</em>&nbsp;</td><td>カメラ画像座標系における点の配列( <img class="formulaInl" alt="$\breve{u}, \breve{v}$" src="form_1100.png"> ) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>num_points</em>&nbsp;</td><td><em>src_points</em>, <em>dst_points</em> の点数</td></tr>
  </table>
</dl>
<dl compact><dt><b>戻り値:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NONE</em>&nbsp;</td><td>正常終了 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NOMEMORY</em>&nbsp;</td><td>メモリ不足 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_PARAM</em>&nbsp;</td><td>パラメータ異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_CALC_IMPOSSIBLE</em>&nbsp;</td><td>カメラ内部パラメータの逆行列が計算不能 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NO_LICENCE</em>&nbsp;</td><td>ライセンスエラー、または未初期化エラー</td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>参照:</b></dt><dd><a class="el" href="group__fie__opt__camcalib__use.html#gb3618da3839ddf73c84a10f9721b3264" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  点列を歪み補...">fnFIE_calib_undistort_points()</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="g22241f0e16d2d55fbbdcae80f6504b1d"></a><!-- doxytag: member="fie_calib.c::fnFIE_calib_distort_image_map" ref="g22241f0e16d2d55fbbdcae80f6504b1d" args="(F_CAMERA_PARAM camera, FHANDLE map)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT FVALGAPI fnFIE_calib_distort_image_map           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a>&nbsp;</td>
          <td class="paramname"> <em>camera</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FHANDLE&nbsp;</td>
          <td class="paramname"> <em>map</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
 <img class= inline-img src="oss.png" alt="[[OSS]]">  画像の歪みシミュレーションマップ生成 
<p>
画像の歪みシミュレーションをするための座標変換マップを生成します。 カメラ内部パラメータ構造体の歪み補正係数を用いて、 画像の歪み補正前にどのような画像だったかシミュレーションするための 座標変換マップを生成します。 理想画像座標系からカメラ画像座標系への変換になります。<p>
<em>map</em> は <a class="el" href="group__fie__geometric__transform.html#g599d687f04058cc75345e19f1f9c96ab" title="座標変換マップに従って座標を変換する">fnFIE_geotrans_warpping()</a> と同じ形式の座標変換マップ画像で、 画像型 F_IMG_DOUBLE または F_IMG_FLOAT、チャネル数２の画像を入力します。 <em>map</em> の画像サイズは後で <a class="el" href="group__fie__geometric__transform.html#g599d687f04058cc75345e19f1f9c96ab" title="座標変換マップに従って座標を変換する">fnFIE_geotrans_warpping()</a> に渡して変換する際の 処理結果画像と画像サイズが同じである必要があります。 また <em>map</em> の画像サイズは、カメラ内部パラメータ算出時の画像サイズと 同じであることを想定していますが、異なっていても実行は可能です。<p>
<dl compact><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>camera</em>&nbsp;</td><td>カメラ内部パラメータ構造体 </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>map</em>&nbsp;</td><td>歪み画像作成用座標変換マップ ( type:double, float / ch:2 )</td></tr>
  </table>
</dl>
<dl compact><dt><b>戻り値:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NONE</em>&nbsp;</td><td>正常終了 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NOMEMORY</em>&nbsp;</td><td>メモリ不足 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_IMAGE</em>&nbsp;</td><td>画像異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_PARAM</em>&nbsp;</td><td>パラメータ異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NO_LICENCE</em>&nbsp;</td><td>ライセンスエラー、または未初期化エラー</td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>参照:</b></dt><dd><a class="el" href="group__fie__geometric__transform.html#g599d687f04058cc75345e19f1f9c96ab" title="座標変換マップに従って座標を変換する">fnFIE_geotrans_warpping()</a>, <a class="el" href="group__fie__opt__camcalib__use.html#geed54e0168d712841402bf53f4c70a8a" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  画像の歪み補...">fnFIE_calib_undistort_image_map()</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="g7253e93a49a7a1a58809dc012ec84e63"></a><!-- doxytag: member="fie_calib.c::fnFIE_calib_rectify_matrix" ref="g7253e93a49a7a1a58809dc012ec84e63" args="(FMATRIX *homography, DOUBLE origin_x, DOUBLE origin_y, DOUBLE ppm, FMATRIX *rectify)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT FVALGAPI fnFIE_calib_rectify_matrix           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFMATRIX.html">FMATRIX</a> *&nbsp;</td>
          <td class="paramname"> <em>homography</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE&nbsp;</td>
          <td class="paramname"> <em>origin_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE&nbsp;</td>
          <td class="paramname"> <em>origin_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE&nbsp;</td>
          <td class="paramname"> <em>ppm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFMATRIX.html">FMATRIX</a> *&nbsp;</td>
          <td class="paramname"> <em>rectify</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
 <img class= inline-img src="oss.png" alt="[[OSS]]">  画像を正対変換するための射影行列の生成 
<p>
カメラ混合パラメータに対して平行移動とスケール成分を付加した射影行列を計算します。 生成された行列は <a class="el" href="group__fie__geometric__transform.html#g2643f645190d545e409d5311357e1705" title="画像の射影変換">fnFIE_geotrans_perspective()</a> や <a class="el" href="group__fie__cg__geometric__transform.html#g60b8d5244f8a96f6a707720ac8c4cf3e" title="点の射影変換">fnFIE_geotrans_perspective_point()</a> 等に 渡すことで、理想画像からワールド平面画像への変換に使用することが出来ます。 本処理は <a class="el" href="group__fie__opt__camcalib__use.html#gc66c887e0ec4e50d4c6689da38f2cb8e" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  画像を逆正対...">fnFIE_calib_rectify_matrix_inv()</a> と逆方向の変換行列生成を行います。<p>
<div align="center">
<img src="calib_rectify0.png" alt="calib_rectify0.png">
<p><strong>正対変換の実施例</strong></p></div>
 <dl class="user" compact><dt><b>計算式</b></dt><dd>本関数による <em>rectify</em> の算出は下式によって行われます。 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ rectify = \left[ homography \cdot \left[ \begin{array}{ccc} 1&amp;0&amp;origin\_x\\ 0&amp;1&amp;origin\_y\\ 0&amp;0&amp;1 \end{array}\right] \left[\begin{array}{ccc} 1/ppm &amp; 0 &amp; 0\\ 0 &amp; 1/ppm &amp; 0\\ 0 &amp; 0 &amp; 1\end{array} \right] \right]^{-1} \]" src="form_1110.png">
<p>
</dd></dl>
<dl compact><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>homography</em>&nbsp;</td><td>カメラ混合パラメータ(3x3行列) <br>
 通常は <a class="el" href="group__fie__opt__camcalib__exec.html#g1a4f0ab9bfce79d32a5e01a83f9fa59a" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  カメラ外部パ...">fnFIE_calib_calc_extrinsic_parameters()</a> で生成された行列を使用します。 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>origin_x</em>&nbsp;</td><td>ワールド平面座標原点と <em>map</em> 原点のＸ方向オフセット。<br>
 ワールド平面座標系の単位で指定します。 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>origin_y</em>&nbsp;</td><td>ワールド平面座標原点と <em>map</em> 原点のＹ方向オフセット。<br>
 ワールド平面座標系の単位で指定します。 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ppm</em>&nbsp;</td><td><em>map</em> での出力画素数とワールド平面座標系の単位長さとの比( <em>ppm</em> &gt; 1e-9 ) <br>
 ( pixel/mm, pixel/inchなど ) </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>rectify</em>&nbsp;</td><td>正対変換のための射影行列</td></tr>
  </table>
</dl>
<dl compact><dt><b>戻り値:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NONE</em>&nbsp;</td><td>正常終了 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NOMEMORY</em>&nbsp;</td><td>メモリ不足 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_PARAM</em>&nbsp;</td><td>パラメータ異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_CALC_IMPOSSIBLE</em>&nbsp;</td><td>計算不能 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NO_LICENCE</em>&nbsp;</td><td>ライセンスエラー、または未初期化エラー</td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>参照:</b></dt><dd><a class="el" href="group__fie__opt__camcalib__use.html#gc66c887e0ec4e50d4c6689da38f2cb8e" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  画像を逆正対...">fnFIE_calib_rectify_matrix_inv()</a>, <a class="el" href="group__fie__geometric__transform.html#g2643f645190d545e409d5311357e1705" title="画像の射影変換">fnFIE_geotrans_perspective()</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="gc66c887e0ec4e50d4c6689da38f2cb8e"></a><!-- doxytag: member="fie_calib.c::fnFIE_calib_rectify_matrix_inv" ref="gc66c887e0ec4e50d4c6689da38f2cb8e" args="(FMATRIX *homography, DOUBLE origin_x, DOUBLE origin_y, DOUBLE ppm, FMATRIX *rect_inv)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT FVALGAPI fnFIE_calib_rectify_matrix_inv           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFMATRIX.html">FMATRIX</a> *&nbsp;</td>
          <td class="paramname"> <em>homography</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE&nbsp;</td>
          <td class="paramname"> <em>origin_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE&nbsp;</td>
          <td class="paramname"> <em>origin_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE&nbsp;</td>
          <td class="paramname"> <em>ppm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFMATRIX.html">FMATRIX</a> *&nbsp;</td>
          <td class="paramname"> <em>rect_inv</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
 <img class= inline-img src="oss.png" alt="[[OSS]]">  画像を逆正対変換するための射影行列の生成 
<p>
カメラ混合パラメータに対して平行移動とスケール成分を付加した射影行列を計算します。 生成された行列は <a class="el" href="group__fie__geometric__transform.html#g2643f645190d545e409d5311357e1705" title="画像の射影変換">fnFIE_geotrans_perspective()</a> や <a class="el" href="group__fie__cg__geometric__transform.html#g60b8d5244f8a96f6a707720ac8c4cf3e" title="点の射影変換">fnFIE_geotrans_perspective_point()</a> 等に 渡すことで、ワールド平面画像から理想画像への変換に使用することが出来ます。 本処理は <a class="el" href="group__fie__opt__camcalib__use.html#g7253e93a49a7a1a58809dc012ec84e63" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  画像を正対変...">fnFIE_calib_rectify_matrix()</a> と逆方向の変換行列生成を行います。<p>
<dl class="user" compact><dt><b>計算式</b></dt><dd>本関数による <img class="formulaInl" alt="$rectify^{-1}$" src="form_1111.png"> ( <em>rect_inv</em> ) の算出は下式によって行われます。 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ rectity^{-1} = homography \cdot \left[ \begin{array}{ccc} 1 &amp; 0 &amp; origin\_x\\ 0 &amp; 1 &amp; origin\_y\\ 0 &amp; 0 &amp; 1 \end{array} \right] \left[ \begin{array}{ccc} 1/ppm &amp; 0 &amp; 0\\ 0 &amp; 1/ppm &amp; 0\\ 0 &amp; 0 &amp; 1 \end{array} \right] \]" src="form_1112.png">
<p>
</dd></dl>
<dl compact><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>homography</em>&nbsp;</td><td>カメラ混合パラメータ（3x3行列) <br>
 通常は <a class="el" href="group__fie__opt__camcalib__exec.html#g1a4f0ab9bfce79d32a5e01a83f9fa59a" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  カメラ外部パ...">fnFIE_calib_calc_extrinsic_parameters()</a> で生成された行列を使用します。 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>origin_x</em>&nbsp;</td><td>ワールド平面座標原点と <em>map</em> 原点のＸ方向オフセット。<br>
 ワールド平面座標系の単位で指定します。 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>origin_y</em>&nbsp;</td><td>ワールド平面座標原点と <em>map</em> 原点のＹ方向オフセット。<br>
 ワールド平面座標系の単位で指定します。 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ppm</em>&nbsp;</td><td><em>map</em> での出力画素数とワールド平面座標系の単位長さとの比( <em>ppm</em> &gt; 1e-9 ) <br>
 ( pixel/mm, pixel/inchなど ) </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>rect_inv</em>&nbsp;</td><td>逆正対変換のための射影行列</td></tr>
  </table>
</dl>
<dl compact><dt><b>戻り値:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NONE</em>&nbsp;</td><td>正常終了 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NOMEMORY</em>&nbsp;</td><td>メモリ不足 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_PARAM</em>&nbsp;</td><td>パラメータ異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_CALC_IMPOSSIBLE</em>&nbsp;</td><td>計算不能 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NO_LICENCE</em>&nbsp;</td><td>ライセンスエラー、または未初期化エラー</td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>参照:</b></dt><dd><a class="el" href="group__fie__opt__camcalib__use.html#g7253e93a49a7a1a58809dc012ec84e63" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  画像を正対変...">fnFIE_calib_rectify_matrix()</a>, <a class="el" href="group__fie__geometric__transform.html#g2643f645190d545e409d5311357e1705" title="画像の射影変換">fnFIE_geotrans_perspective()</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="gf3512622ed7c0741f828feaa32821801"></a><!-- doxytag: member="fie_calib.c::fnFIE_calib_rectify_ud_image_map" ref="gf3512622ed7c0741f828feaa32821801" args="(F_CAMERA_PARAM camera, FMATRIX *homography, DOUBLE origin_x, DOUBLE origin_y, DOUBLE ppm, FHANDLE map)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT FVALGAPI fnFIE_calib_rectify_ud_image_map           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structF__CAMERA__PARAM.html">F_CAMERA_PARAM</a>&nbsp;</td>
          <td class="paramname"> <em>camera</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFMATRIX.html">FMATRIX</a> *&nbsp;</td>
          <td class="paramname"> <em>homography</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE&nbsp;</td>
          <td class="paramname"> <em>origin_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE&nbsp;</td>
          <td class="paramname"> <em>origin_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DOUBLE&nbsp;</td>
          <td class="paramname"> <em>ppm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FHANDLE&nbsp;</td>
          <td class="paramname"> <em>map</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
 <img class= inline-img src="oss.png" alt="[[OSS]]">  画像の正対変換と歪み補正を同時に行う座標変換マップの生成 
<p>
カメラの内部パラメータによる変換と、外部パラメータによる変換を 同時に行う座標変換マップを生成します。 生成された座標マップは <a class="el" href="group__fie__geometric__transform.html#g599d687f04058cc75345e19f1f9c96ab" title="座標変換マップに従って座標を変換する">fnFIE_geotrans_warpping()</a> にて使用します。 この座標変換マップにて変換を行うと、 カメラ画像座標系からワールド平面座標系への正対変換が行えます。<p>
<div align="center">
<img src="calib_rectify0.png" alt="calib_rectify0.png">
<p><strong>正対変換の実施例</strong></p></div>
 <dl class="attention" compact><dt><b>注意:</b></dt><dd>カメラ混合パラメータ<img class="formulaInl" alt="$\bf{H}$" src="form_1065.png"> <em>homography</em> を求める時に 算出されたカメラ内部パラメータ<img class="formulaInl" alt="$\bf{A}$" src="form_1049.png">と、 本関数に指定されるカメラ内部パラメータ <img class="formulaInl" alt="$\bf{A}$" src="form_1049.png"> <em>camera</em> は 同一の物でなければなりません。</dd></dl>
<dl class="user" compact><dt><b>演算式</b></dt><dd>座標変換前の座標を <img class="formulaInl" alt="$\breve{u} , \breve{v}$" src="form_1113.png"> 、 座標変換後の座標を <img class="formulaInl" alt="$X, Y$" src="form_1114.png"> とおくと、 本関数は下式の関係に対応する座標変換マップを生成します。 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \left[ \begin{array}{ccc} W u &amp; W v &amp; W \end{array} \right]^t = \bf{H} \left[ \begin{array}{ccc} X &amp; Y &amp; 1 \end{array} \right]^t \]" src="form_1115.png">
<p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \left[ \begin{array}{ccc} W' x &amp; W' y &amp; W' \end{array} \right]^t = \bf{Rt} \left[ \begin{array}{ccc} X &amp; Y &amp; 1 \end{array} \right]^t \]" src="form_1116.png">
<p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{array}{l} \breve{u} = u+(u-u_0)[k_1(x^2+y^2)+k_2(x^2+y^2)^2] \\ \breve{v} = v+(v-v_0)[k_1(x^2+y^2)+k_2(x^2+y^2)^2] \end{array} \]" src="form_1095.png">
<p>
 ただし、 <img class="formulaInl" alt="$ k_1, k_2 $" src="form_1090.png"> ：放射歪み係数 <br>
 <img class="formulaInl" alt="$(u_0, v_0)$" src="form_1117.png"> ：理想画像座標上での光軸中心座標 <br>
 <img class="formulaInl" alt="$\bf{A}$" src="form_1049.png"> ：カメラ内部パラメータ行列 <br>
 <img class="formulaInl" alt="$\bf{H}$" src="form_1065.png"> ：カメラ混合パラメータ行列 <br>
 <img class="formulaInl" alt="$(u, v)$" src="form_1091.png"> ：理想画像座標上での点座標 <br>
 <img class="formulaInl" alt="$(\breve{u}, \breve{v})$" src="form_1092.png"> ：カメラ画像座標上での点座標 <br>
 <img class="formulaInl" alt="$(x, y)$" src="form_511.png"> ：<img class="formulaInl" alt="$(u, v)$" src="form_1091.png"> を正規化画像座標系へ変換した座標 <br>
</dd></dl>
<dl class="user" compact><dt><b></b></dt><dd>また、本関数ではカメラ混合パラメータ<img class="formulaInl" alt="$H$" src="form_182.png">を求める際の カメラ内部パラメータ行列は <em>camera</em> にて指定された カメラ内部パラメータ行列<img class="formulaInl" alt="$A$" src="form_1096.png"> は同一で有ると仮定しているので、 カメラ外部行列は次式により算出しています。 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{array}{ll} Rt &amp;= A^{-1} \bf{H} \\ ( &amp;= A^{-1} \bf{A} \bf{Rt}) \end{array} \]" src="form_1118.png">
<p>
</dd></dl>
<dl compact><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>camera</em>&nbsp;</td><td>カメラ内部パラメータ </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>homography</em>&nbsp;</td><td>カメラ混合パラメータ（3x3行列） </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>origin_x</em>&nbsp;</td><td>ワールド平面座標系と <em>map</em> 原点のＸ方向オフセット。<br>
 ワールド平面座標系の単位で指定します。 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>origin_y</em>&nbsp;</td><td>ワールド平面座標系と <em>map</em> 原点のＹ方向オフセット。<br>
 ワールド平面座標系の単位で指定します。 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ppm</em>&nbsp;</td><td><em>map</em> での出力画素数とワールド平面座標系の単位長さとの比( <em>ppm</em> &gt; 1e-9 ) <br>
 ( pixel/mm, pixel/inchなど ) </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>map</em>&nbsp;</td><td>座標変換マップ ( type:double, float / ch:2 ) <br>
 <a class="el" href="group__fie__geometric__transform.html#g599d687f04058cc75345e19f1f9c96ab" title="座標変換マップに従って座標を変換する">fnFIE_geotrans_warpping()</a> の座標変換マップと同じものです。</td></tr>
  </table>
</dl>
<dl compact><dt><b>戻り値:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NONE</em>&nbsp;</td><td>正常終了 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_PARAM</em>&nbsp;</td><td>パラメータ異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_INVALID_IMAGE</em>&nbsp;</td><td>画像オブジェクト異常 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NOMEMORY</em>&nbsp;</td><td>メモリ不足 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_CALC_IMPOSSIBLE</em>&nbsp;</td><td>計算不能 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>F_ERR_NO_LICENCE</em>&nbsp;</td><td>ライセンスエラー、または未初期化エラー</td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>参照:</b></dt><dd><a class="el" href="group__fie__geometric__transform.html#g599d687f04058cc75345e19f1f9c96ab" title="座標変換マップに従って座標を変換する">fnFIE_geotrans_warpping()</a>, <a class="el" href="group__fie__opt__camcalib__use.html#geed54e0168d712841402bf53f4c70a8a" title=" &lt;img class= inline-img src=&quot;oss.png&quot; alt=&quot;[[OSS]]&quot;&gt;  画像の歪み補...">fnFIE_calib_undistort_image_map()</a> </dd></dl>

</div>
</div><p>
</div>
<hr size="1">
<address style="align: right; color: #cccccc;">
	<small>
	Documentation copyright &copy; 2009-2025 TOKYO ELECTRON DEVICE LIMITED. <br>
	Generated on Tue Sep 16 09:08:55 2025 for FIEライブラリ by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.5.6-FASTSP-p2
	</small>
</address>
</body>
</html>
