{
  "issue_title": "资源管理：资源未释放：流",
  "issue_level": "Medium",
  "issue_count": "5",
  "issue_desc": "程序创建或分配流资源后，不进行合理释放，将会降低系统性能。攻击者可能会通过耗尽资源池的方式发起拒绝服务攻击。\n\n**例如**：在下面Java方法中，创建I/O流对象后未进行合理释放，程序依靠Java虚拟机的垃圾回收机制释放I/O流资源，事实上，程序不能确定何时调用虚拟机的`finalize()`方法。在繁忙的程序环境下，可能导致Java虚拟机不能有效的使用I/O对象。\n```java\n...\npublic void processFile(String filePath){\n    try {\n        FileInputStream fis = new FileInputStream(filePath);\n        InputStreamReader isr = new InputStreamReader(fis);\n        BufferedReader br = new BufferedReader(isr);\n        String line=\"\";\n        while((line=br.readLine())!=null){\n            processLine(line);\n        }\n    } catch (FileNotFoundException e) {\n        log(e);\n    } catch (IOException e){\n        log(e);\n    }\n}\n...\n```",
  "fix_advice": "程序不应依赖于Java虚拟机的`finalize()`方法来自动回收流资源，而需要手动在finally代码块中进行流资源的释放。\n\n**例如**：下面代码片段中，在finally代码块中对流资源进行了合理的释放。\n```java\npublic void processFile(String filePath){\n    FileInputStream fis = null;\n    InputStreamReader isr = null;\n    BufferedReader br = null;\n    try {\n        fis = new FileInputStream(filePath);\n        isr = new InputStreamReader(fis);\n        br = new BufferedReader(isr);\n        String line=\"\";\n        while((line=br.readLine())!=null){\n            //processLine(line);\n        }\n    } catch (FileNotFoundException e) {\n        //log(e);\n    } catch (IOException e){\n        //log(e);\n    }finally{\n        if(br!=null){\n            try {\n                br.close();\n            } catch (IOException e) {\n                //log(e);\n            }\n        }\n        if(isr!=null){\n            try {\n                isr.close();\n            } catch (IOException e) {\n                //log(e);\n            }\n        }\n        if(fis!=null){\n            try {\n                fis.close();\n            } catch (IOException e) {\n                //log(e);\n            }\n        }\n    }\n}\n```",
  "code_sample": "",
  "code_list": [
    {
      "code_location": "src/main/java/org/owasp/webgoat/lessons/challenges/challenge1/ImageServlet.java",
      "code_line_num": "30",
      "code_details": "跟踪路径:跟踪路径1:\n\n1 src/main/java/org/owasp/webgoat/lessons/challenges/challenge1/ImageServlet.java;30行getInputStream()\n\n2 src/main/java/org/owasp/webgoat/lessons/challenges/challenge1/ImageServlet.java;41行作用域结束 : 资源泄漏"
    },
    {
      "code_location": "src/main/java/org/owasp/webgoat/lessons/pathtraversal/ProfileUploadBase.java",
      "code_line_num": "126",
      "code_details": "跟踪路径:跟踪路径1:\n\n1 src/main/java/org/owasp/webgoat/lessons/pathtraversal/ProfileUploadBase.java;126行inputStream = getResourceAsStream(...)\n\n2 src/main/java/org/owasp/webgoat/lessons/pathtraversal/ProfileUploadBase.java;126行inputStream 引用一个分配的资源\n\n3 src/main/java/org/owasp/webgoat/lessons/pathtraversal/ProfileUploadBase.java;127行inputStream 不再引用一个分配的资源\n\n4 src/main/java/org/owasp/webgoat/lessons/pathtraversal/ProfileUploadBase.java;127行inputStream 作用域结束 : 资源泄漏 : 抛出  java.lang.Throwable 异常"
    },
    {
      "code_location": "src/main/java/org/owasp/webgoat/lessons/clientsidefiltering/Salaries.java",
      "code_line_num": "49",
      "code_details": "跟踪路径:跟踪路径1:\n\n1 src/main/java/org/owasp/webgoat/lessons/clientsidefiltering/Salaries.java;49行new FileOutputStream(...)\n\n2 src/main/java/org/owasp/webgoat/lessons/clientsidefiltering/Salaries.java;49行作用域结束 : 资源泄漏 : 抛出  java.io.IOException 异常"
    },
    {
      "code_location": "src/main/java/org/owasp/webgoat/lessons/clientsidefiltering/Salaries.java",
      "code_line_num": "48",
      "code_details": "跟踪路径:跟踪路径1:\n\n1 src/main/java/org/owasp/webgoat/lessons/clientsidefiltering/Salaries.java;48行getInputStream()\n\n2 src/main/java/org/owasp/webgoat/lessons/clientsidefiltering/Salaries.java;49行作用域结束 : 资源泄漏 : 抛出  java.io.IOException 异常"
    },
    {
      "code_location": "src/main/java/org/owasp/webgoat/lessons/pathtraversal/ProfileUploadRetrieval.java",
      "code_line_num": "64",
      "code_details": "跟踪路径:跟踪路径1:\n\n1 src/main/java/org/owasp/webgoat/lessons/pathtraversal/ProfileUploadRetrieval.java;64行new FileOutputStream(...)\n\n2 src/main/java/org/owasp/webgoat/lessons/pathtraversal/ProfileUploadRetrieval.java;64行作用域结束 : 资源泄漏 : 抛出  java.lang.Throwable 异常"
    }
  ],
  "next_block_start": 26
}