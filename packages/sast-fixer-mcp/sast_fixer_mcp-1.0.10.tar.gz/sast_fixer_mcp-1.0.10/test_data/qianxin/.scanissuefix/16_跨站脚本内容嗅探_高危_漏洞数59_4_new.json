{
  "issue_title": "跨站脚本：内容嗅探",
  "issue_level": "High",
  "issue_count": "59",
  "issue_desc": "内容嗅探是指应用程序将获取到的不可信赖的数据，并在未检验数据是否存在恶意代码的情况下，将其发送给用户。\n\n**例如**：下面代码找中返回用户控制的数据，格式为`application/json`。\n```java\n@Path(\"/user\")\n@Produces(\"application/json\")\npublic class User {\n    @GET\n    public String setName(@QueryParam(\"param\") String name) {\n        return \"{'name': '\" + param + \"'}\";\n    }\n}\n```\n如果攻击者所发送请求的`name`参数设置为 `&lt;html&gt;&lt;body&gt;&lt;script&gt;alert(1)&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;`，则服务器将生成以下响应：\n```java\nHTTP/1.1 200 OK\nContent-Length: 88\nContent-Type: application/json\nConnection: Closed\n{'name': '&lt;html&gt;&lt;body&gt;&lt;script&gt;alert(1)&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;'}\n```\n尽管响应将其视为JSON文档，但旧浏览器仍可能尝试将其呈现为 HTML文档，使其容易受到跨站脚本攻击。",
  "fix_advice": "为了避免内容嗅探攻击，建议采用以下方式进行防御：\n1.对用户的输入进行合理验证（如年龄只能是数字），对特殊字符（如`&lt;、&gt;、'、\"`以及`&lt;script&gt;、javascript`等进行过滤。\n2.根据数据将要置于HTML上下文中的不同位置（HTML标签、HTML属性、JavaScript脚本、CSS、URL），对所有不可信数据进行恰当的输出编码。\n **例如**：采用OWASP ESAPI对数据输出HTML上下文中不同位置，编码方法如下。\n```java\n//HTML encode\nESAPI.encoder().encodeForHTML(inputData);\n//HTML attribute encode\nESAPI.encoder().encodeForHTMLAttribute(inputData);\n//JavaScript encode\nESAPI.encoder().encodeForJavaScript(inputData);\n//CSS encode\nESAPI.encoder().encodeForCSS(inputData);\n//URL encode\nESAPI.encoder().encodeForURL(inputData);\n```\n3.设置HttpOnly属性，避免攻击者利用跨站脚本漏洞进行Cookie劫持攻击。在Java EE中，给Cookie添加HttpOnly的代码如下：\n```java\n...\nresponse.setHeader(\"Set-Cookie\",\"cookiename=cookievalue; path=/; Domain=domainvaule; Max-age=seconds; HttpOnly\");\n...\n```",
  "code_sample": "",
  "code_list": [
    {
      "code_location": "src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5a.java",
      "code_line_num": "41",
      "code_details": "跟踪路径:跟踪路径1:\n\n1 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5a.java;40行来自于http请求的数据从completed()方法第1个参数进入\n\n2 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5a.java;41行不可信的数据从injectableQuery()方法第1个参数进入,然后从返回值返回\n\n3 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5a.java;47行赋值不可信的数据给变量query\n\n4 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5a.java;69行不可信的数据从output()方法第1个参数进入,然后从返回值返回\n\n5 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;33行赋值不可信的数据给变量this.output\n\n6 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;34行返回不可信的数据this\n\n7 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5a.java;69行不可信的数据从build()方法this参数进入,然后从返回值返回\n\n8 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;52行不可信的数据从AttackResult()方法第4个参数进入,然后从this参数返回\n\n9 src/main/java/org/owasp/webgoat/container/assignments/AttackResult.java;47行赋值不可信的数据给变量this.output\n\n10 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;48行返回不可信的数据\n\n11 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5a.java;69行返回不可信的数据\n\n12 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5a.java;41行返回不可信的数据"
    },
    {
      "code_location": "src/main/java/org/owasp/webgoat/lessons/sqlinjection/mitigation/SqlOnlyInputValidation.java",
      "code_line_num": "36",
      "code_details": "跟踪路径:跟踪路径1:\n\n1 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;72行来自于数据库的数据从executeQuery()方法返回值返回\n\n2 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;72行赋值不可信的数据给变量results\n\n3 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;85行不可信的数据从writeTable()方法第1个参数进入,然后从返回值返回\n\n4 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5a.java;107行不可信的数据从getString()方法this参数进入,然后从返回值返回\n\n5 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5a.java;107行不可信的数据从append()方法第1个参数进入,然后从this参数返回\n\n6 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5a.java;119行不可信的数据从toString()方法this参数进入,然后从返回值返回\n\n7 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5a.java;119行返回不可信的数据\n\n8 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;85行不可信的数据从append()方法第1个参数进入,然后从this参数返回\n\n9 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;88行不可信的数据从verifySqlInjection()方法第1个参数进入,然后从返回值返回\n\n10 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;105行不可信的数据从toString()方法this参数进入,然后从返回值返回\n\n11 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;105行不可信的数据从output()方法第1个参数进入,然后从返回值返回\n\n12 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;33行赋值不可信的数据给变量this.output\n\n13 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;34行返回不可信的数据this\n\n14 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;105行不可信的数据从build()方法this参数进入,然后从返回值返回\n\n15 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;52行不可信的数据从AttackResult()方法第4个参数进入,然后从this参数返回\n\n16 src/main/java/org/owasp/webgoat/container/assignments/AttackResult.java;47行赋值不可信的数据给变量this.output\n\n17 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;48行返回不可信的数据\n\n18 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;105行返回不可信的数据\n\n19 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;88行返回不可信的数据\n\n20 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;56行不可信的数据从executeSqlInjection()方法返回值返回\n\n21 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;56行返回不可信的数据\n\n22 src/main/java/org/owasp/webgoat/lessons/sqlinjection/mitigation/SqlOnlyInputValidation.java;35行不可信的数据从injectableQuery()方法返回值返回\n\n23 src/main/java/org/owasp/webgoat/lessons/sqlinjection/mitigation/SqlOnlyInputValidation.java;35行赋值不可信的数据给变量attackResult\n\n24 src/main/java/org/owasp/webgoat/lessons/sqlinjection/mitigation/SqlOnlyInputValidation.java;40行不可信的数据从getOutput()方法this参数进入,然后从返回值返回\n\n25 src/main/java/org/owasp/webgoat/container/assignments/AttackResult.java;18行返回不可信的数据this.output\n\n26 src/main/java/org/owasp/webgoat/lessons/sqlinjection/mitigation/SqlOnlyInputValidation.java;40行不可信的数据从AttackResult()方法第4个参数进入,然后从this参数返回\n\n27 src/main/java/org/owasp/webgoat/container/assignments/AttackResult.java;47行赋值不可信的数据给变量this.output\n\n28 src/main/java/org/owasp/webgoat/lessons/sqlinjection/mitigation/SqlOnlyInputValidation.java;36行返回不可信的数据\n\n跟踪路径2:\n\n1 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;72行来自于数据库的数据从executeQuery()方法返回值返回\n\n2 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;72行赋值不可信的数据给变量results\n\n3 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;85行不可信的数据从writeTable()方法第1个参数进入,然后从返回值返回\n\n4 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5a.java;107行不可信的数据从getString()方法this参数进入,然后从返回值返回\n\n5 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5a.java;107行不可信的数据从append()方法第1个参数进入,然后从this参数返回\n\n6 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5a.java;119行不可信的数据从toString()方法this参数进入,然后从返回值返回\n\n7 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5a.java;119行返回不可信的数据\n\n8 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;85行不可信的数据从append()方法第1个参数进入,然后从this参数返回\n\n9 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;88行不可信的数据从verifySqlInjection()方法第1个参数进入,然后从返回值返回\n\n10 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;111行不可信的数据从toString()方法this参数进入,然后从返回值返回\n\n11 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;111行不可信的数据从feedbackArgs()方法第1个参数进入,然后从返回值返回\n\n12 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;23行赋值不可信的数据给变量this.feedbackArgs\n\n13 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;24行返回不可信的数据this\n\n14 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;109行不可信的数据从output()方法this参数进入,然后从返回值返回\n\n15 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;34行返回不可信的数据this\n\n16 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;109行不可信的数据从build()方法this参数进入,然后从返回值返回\n\n17 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;51行不可信的数据从AttackResult()方法第3个参数进入,然后从this参数返回\n\n18 src/main/java/org/owasp/webgoat/container/assignments/AttackResult.java;46行赋值不可信的数据给变量this.feedbackArgs\n\n19 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;48行返回不可信的数据\n\n20 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;109行返回不可信的数据\n\n21 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;88行返回不可信的数据\n\n22 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;56行不可信的数据从executeSqlInjection()方法返回值返回\n\n23 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;56行返回不可信的数据\n\n24 src/main/java/org/owasp/webgoat/lessons/sqlinjection/mitigation/SqlOnlyInputValidation.java;35行不可信的数据从injectableQuery()方法返回值返回\n\n25 src/main/java/org/owasp/webgoat/lessons/sqlinjection/mitigation/SqlOnlyInputValidation.java;35行赋值不可信的数据给变量attackResult\n\n26 src/main/java/org/owasp/webgoat/lessons/sqlinjection/mitigation/SqlOnlyInputValidation.java;39行不可信的数据从getFeedbackArgs()方法this参数进入,然后从返回值返回\n\n27 src/main/java/org/owasp/webgoat/container/assignments/AttackResult.java;17行返回不可信的数据this.feedbackArgs\n\n28 src/main/java/org/owasp/webgoat/lessons/sqlinjection/mitigation/SqlOnlyInputValidation.java;39行不可信的数据从AttackResult()方法第3个参数进入,然后从this参数返回\n\n29 src/main/java/org/owasp/webgoat/container/assignments/AttackResult.java;46行赋值不可信的数据给变量this.feedbackArgs\n\n30 src/main/java/org/owasp/webgoat/lessons/sqlinjection/mitigation/SqlOnlyInputValidation.java;36行返回不可信的数据"
    },
    {
      "code_location": "src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5b.java",
      "code_line_num": "41",
      "code_details": "跟踪路径:跟踪路径1:\n\n1 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5b.java;39行来自于http请求的数据从completed()方法第2个参数进入\n\n2 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5b.java;41行不可信的数据从injectableQuery()方法第1个参数进入,然后从返回值返回\n\n3 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5b.java;57行不可信的数据从output()方法第1个参数进入,然后从返回值返回\n\n4 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;33行赋值不可信的数据给变量this.output\n\n5 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;34行返回不可信的数据this\n\n6 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5b.java;55行不可信的数据从build()方法this参数进入,然后从返回值返回\n\n7 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;52行不可信的数据从AttackResult()方法第4个参数进入,然后从this参数返回\n\n8 src/main/java/org/owasp/webgoat/container/assignments/AttackResult.java;47行赋值不可信的数据给变量this.output\n\n9 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;48行返回不可信的数据\n\n10 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5b.java;55行返回不可信的数据\n\n11 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5b.java;41行返回不可信的数据\n\n跟踪路径2:\n\n1 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5b.java;39行来自于http请求的数据从completed()方法第2个参数进入\n\n2 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5b.java;41行不可信的数据从injectableQuery()方法第1个参数进入,然后从返回值返回\n\n3 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5b.java;61行不可信的数据从replace()方法第2个参数进入,然后从返回值返回\n\n4 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5b.java;57行不可信的数据从output()方法第1个参数进入,然后从返回值返回\n\n5 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;33行赋值不可信的数据给变量this.output\n\n6 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;34行返回不可信的数据this\n\n7 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5b.java;55行不可信的数据从build()方法this参数进入,然后从返回值返回\n\n8 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;52行不可信的数据从AttackResult()方法第4个参数进入,然后从this参数返回\n\n9 src/main/java/org/owasp/webgoat/container/assignments/AttackResult.java;47行赋值不可信的数据给变量this.output\n\n10 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;48行返回不可信的数据\n\n11 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5b.java;55行返回不可信的数据\n\n12 src/main/java/org/owasp/webgoat/lessons/sqlinjection/introduction/SqlInjectionLesson5b.java;41行返回不可信的数据"
    },
    {
      "code_location": "src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java",
      "code_line_num": "45",
      "code_details": "跟踪路径:跟踪路径1:\n\n1 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;44行来自于http请求的数据从completed()方法第1个参数进入\n\n2 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;45行不可信的数据从injectableQuery()方法第1个参数进入,然后从返回值返回\n\n3 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;54行赋值不可信的数据给变量query\n\n4 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;56行不可信的数据从executeSqlInjection()方法第2个参数进入,然后从返回值返回\n\n5 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;77行不可信的数据从output()方法第1个参数进入,然后从返回值返回\n\n6 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;33行赋值不可信的数据给变量this.output\n\n7 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;34行返回不可信的数据this\n\n8 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;75行不可信的数据从build()方法this参数进入,然后从返回值返回\n\n9 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;52行不可信的数据从AttackResult()方法第4个参数进入,然后从this参数返回\n\n10 src/main/java/org/owasp/webgoat/container/assignments/AttackResult.java;47行赋值不可信的数据给变量this.output\n\n11 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;48行返回不可信的数据\n\n12 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;75行返回不可信的数据\n\n13 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;56行返回不可信的数据\n\n14 src/main/java/org/owasp/webgoat/lessons/sqlinjection/advanced/SqlInjectionLesson6a.java;45行返回不可信的数据"
    },
    {
      "code_location": "src/main/java/org/owasp/webgoat/lessons/spoofcookie/SpoofCookieAssignment.java",
      "code_line_num": "58",
      "code_details": "跟踪路径:跟踪路径1:\n\n1 src/main/java/org/owasp/webgoat/lessons/spoofcookie/SpoofCookieAssignment.java;52行来自于http请求的数据从login()方法第3个参数进入\n\n2 src/main/java/org/owasp/webgoat/lessons/spoofcookie/SpoofCookieAssignment.java;58行不可信的数据从cookieLoginFlow()方法第1个参数进入,然后从返回值返回\n\n3 src/main/java/org/owasp/webgoat/lessons/spoofcookie/SpoofCookieAssignment.java;107行不可信的数据从format()方法第3个参数进入,然后从返回值返回\n\n4 src/main/java/org/owasp/webgoat/lessons/spoofcookie/SpoofCookieAssignment.java;107行不可信的数据从output()方法第1个参数进入,然后从返回值返回\n\n5 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;33行赋值不可信的数据给变量this.output\n\n6 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;34行返回不可信的数据this\n\n7 src/main/java/org/owasp/webgoat/lessons/spoofcookie/SpoofCookieAssignment.java;105行不可信的数据从build()方法this参数进入,然后从返回值返回\n\n8 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;52行不可信的数据从AttackResult()方法第4个参数进入,然后从this参数返回\n\n9 src/main/java/org/owasp/webgoat/container/assignments/AttackResult.java;47行赋值不可信的数据给变量this.output\n\n10 src/main/java/org/owasp/webgoat/container/assignments/AttackResultBuilder.java;48行返回不可信的数据\n\n11 src/main/java/org/owasp/webgoat/lessons/spoofcookie/SpoofCookieAssignment.java;105行返回不可信的数据\n\n12 src/main/java/org/owasp/webgoat/lessons/spoofcookie/SpoofCookieAssignment.java;58行返回不可信的数据"
    }
  ],
  "next_block_start": 242
}