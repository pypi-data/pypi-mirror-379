import{x as j,y as N,ap as X,ad as F,C as $,a as V,F as G,aA as oe,I as J,av as re,ac as T,ar as K,i as W,N as D,au as Q,c_ as ue,cs as ce,at as E,ao as ie,cz as ve,c4 as fe,z as de,a1 as me,aq as he,b as ge,a4 as A,D as pe,E as ye,H as Se,j as we,c$ as Ve}from"./index-CuEbufVv.js";const Te=N({renderless:Boolean,...J()},"VVirtualScrollItem"),Ie=j()({name:"VVirtualScrollItem",inheritAttrs:!1,props:Te(),emits:{"update:height":l=>!0},setup(l,a){let{attrs:v,emit:s,slots:n}=a;const{resizeRef:o,contentRect:c}=X(void 0,"border");F(()=>c.value?.height,g=>{g!=null&&s("update:height",g)}),$(()=>l.renderless?V(G,null,[n.default?.({itemRef:o})]):V("div",oe({ref:o,class:["v-virtual-scroll__item",l.class],style:l.style},v),[n.default?.()]))}}),Re=-1,be=1,H=100,xe=N({itemHeight:{type:[Number,String],default:null},itemKey:{type:[String,Array,Function],default:null},height:[Number,String]},"virtual");function Pe(l,a){const v=re(),s=T(0);K(()=>{s.value=parseFloat(l.itemHeight||0)});const n=T(0),o=T(Math.ceil((parseInt(l.height)||v.height.value)/(s.value||16))||1),c=T(0),g=T(0),u=W(),m=W();let I=0;const{resizeRef:O,contentRect:x}=X();K(()=>{O.value=u.value});const y=D(()=>u.value===document.documentElement?v.height.value:x.value?.height||parseInt(l.height)||0),z=D(()=>!!(u.value&&m.value&&y.value&&s.value));let h=Array.from({length:a.value.length}),i=Array.from({length:a.value.length});const f=T(0);let P=-1;function Y(e){return h[e]||s.value}const _=ue(()=>{const e=performance.now();i[0]=0;const t=a.value.length;for(let r=1;r<=t-1;r++)i[r]=(i[r-1]||0)+Y(r-1);f.value=Math.max(f.value,performance.now()-e)},f),Z=F(z,e=>{e&&(Z(),I=m.value.offsetTop,_.immediate(),S(),~P&&ie(()=>{ve&&window.requestAnimationFrame(()=>{L(P),P=-1})}))});Q(()=>{_.clear()});function ee(e,t){const r=h[e],d=s.value;s.value=d?Math.min(s.value,t):t,(r!==t||d!==s.value)&&(h[e]=t,_())}function p(e){e=E(e,0,a.value.length-1);const t=Math.floor(e),r=e%1,d=t+1,b=i[t]||0,w=i[d]||b;return b+(w-b)*r}function C(e){return _e(i,e)}let k=0,R=0,M=0;F(y,(e,t)=>{t&&(S(),e<t&&requestAnimationFrame(()=>{R=0,S()}))});let B=-1;function te(){if(!u.value||!m.value)return;const e=u.value.scrollTop,t=performance.now();t-M>500?(R=Math.sign(e-k),I=m.value.offsetTop):R=e-k,k=e,M=t,window.clearTimeout(B),B=window.setTimeout(q,500),S()}function q(){!u.value||!m.value||(R=0,M=0,window.clearTimeout(B),S())}let U=-1;function S(){cancelAnimationFrame(U),U=requestAnimationFrame(le)}function le(){if(!u.value||!y.value||!s.value)return;const e=k-I,t=Math.sign(R),r=Math.max(0,e-H),d=E(C(r),0,a.value.length),b=e+y.value+H,w=E(C(b)+1,d+1,a.value.length);if((t!==Re||d<n.value)&&(t!==be||w>o.value)){const ne=p(n.value)-p(d),se=p(w)-p(o.value);Math.max(ne,se)>H?(n.value=d,o.value=w):(d<=0&&(n.value=d),w>=a.value.length&&(o.value=w))}c.value=p(n.value),g.value=p(a.value.length)-p(o.value)}function L(e){const t=p(e);!u.value||e&&!t?P=e:u.value.scrollTop=t}const ae=D(()=>a.value.slice(n.value,o.value).map((e,t)=>{const r=t+n.value;return{raw:e,index:r,key:ce(e,l.itemKey,r)}}));return F(a,()=>{h=Array.from({length:a.value.length}),i=Array.from({length:a.value.length}),_.immediate(),S()},{deep:1}),{calculateVisibleItems:S,containerRef:u,markerRef:m,computedItems:ae,paddingTop:c,paddingBottom:g,scrollToIndex:L,handleScroll:te,handleScrollend:q,handleItemResize:ee}}function _e(l,a){let v=l.length-1,s=0,n=0,o=null,c=-1;if(l[v]<a)return v;for(;s<=v;)if(n=s+v>>1,o=l[n],o>a)v=n-1;else if(o<a)c=n,s=n+1;else return o===a?n:s;return c}const ke=N({items:{type:Array,default:()=>[]},renderless:Boolean,...xe(),...J(),...Se()},"VVirtualScroll"),Oe=j()({name:"VVirtualScroll",props:ke(),setup(l,a){let{slots:v}=a;const s=fe("VVirtualScroll"),{dimensionStyles:n}=de(l),{calculateVisibleItems:o,containerRef:c,markerRef:g,handleScroll:u,handleScrollend:m,handleItemResize:I,scrollToIndex:O,paddingTop:x,paddingBottom:y,computedItems:z}=Pe(l,me(()=>l.items));return he(()=>l.renderless,()=>{function h(){const f=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)?"addEventListener":"removeEventListener";c.value===document.documentElement?(document[f]("scroll",u,{passive:!0}),document[f]("scrollend",m)):(c.value?.[f]("scroll",u,{passive:!0}),c.value?.[f]("scrollend",m))}we(()=>{c.value=Ve(s.vnode.el,!0),h(!0)}),Q(h)}),$(()=>{const h=z.value.map(i=>ge(Ie,{key:i.key,renderless:l.renderless,"onUpdate:height":f=>I(i.index,f)},{default:f=>v.default?.({item:i.raw,index:i.index,...f})}));return l.renderless?V(G,null,[V("div",{ref:g,class:"v-virtual-scroll__spacer",style:{paddingTop:A(x.value)}},null),h,V("div",{class:"v-virtual-scroll__spacer",style:{paddingBottom:A(y.value)}},null)]):V("div",{ref:c,class:ye(["v-virtual-scroll",l.class]),onScrollPassive:u,onScrollend:m,style:pe([n.value,l.style])},[V("div",{ref:g,class:"v-virtual-scroll__container",style:{paddingTop:A(x.value),paddingBottom:A(y.value)}},[h])])}),{calculateVisibleItems:o,scrollToIndex:O}}});export{Oe as V};
