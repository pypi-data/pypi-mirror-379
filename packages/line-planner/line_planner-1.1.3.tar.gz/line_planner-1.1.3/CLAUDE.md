# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## é¡¹ç›®æ¦‚è¿°

**SIFèˆªçº¿è§„åˆ’å™¨ - ç®€åŒ–ç‰ˆ**

è¿™æ˜¯ä¸€ä¸ªä¸“ä¸ºSIFï¼ˆSolar-Induced Fluorescenceï¼‰å•ç‚¹å…‰è°±è®¾å¤‡ä¼˜åŒ–çš„ç®€åŒ–èˆªçº¿è§„åˆ’å™¨ã€‚é¡¹ç›®é‡‡ç”¨ç‹¬ç«‹å®ç°æ¶æ„ï¼Œä»KMLè¾¹ç•Œæ–‡ä»¶ç”Ÿæˆè›‡å½¢èˆªçº¿æ‹ç‚¹ï¼Œä¸“ä¸ºæ— äººæœºé£è¡Œæ§åˆ¶è®¾è®¡ã€‚

## é¡¹ç›®ç‰¹ç‚¹

- **ç®€åŒ–æ¶æ„**: åˆ é™¤äº†å¤æ‚çš„APIå±‚ï¼Œåªä¿ç•™æ ¸å¿ƒåŠŸèƒ½
- **ç‹¬ç«‹å®ç°**: ä½¿ç”¨standaloneæ¨¡å¼ï¼Œæ— å¤–éƒ¨ä¾èµ–å¤æ‚æ€§
- **æ ‡å‡†è¾“å…¥**: é€šè¿‡JSONé…ç½®è¿›è¡Œèˆªçº¿è§„åˆ’
- **å†…ç½®å¯è§†åŒ–**: é›†æˆmatplotlibç”Ÿæˆèˆªçº¿å›¾åƒ
- **ä¸€é”®è¿è¡Œ**: é€šè¿‡`interface.py`ç»Ÿä¸€å…¥å£

## å¼€å‘ç¯å¢ƒä¸å·¥å…·

### åŒ…ç®¡ç†å™¨
- ä½¿ç”¨ `uv` ç®¡ç†Pythonç¯å¢ƒå’Œä¾èµ–
- è¿è¡ŒPythonä»£ç ï¼š`uv run python <script.py>`
- å®‰è£…å¼€å‘ä¾èµ–ï¼š`uv sync --dev`

### æ ¸å¿ƒå‘½ä»¤

#### æ„å»ºä¸å®‰è£…
```bash
# å¼€å‘æ¨¡å¼å®‰è£…
uv pip install -e .
# å®‰è£…å¼€å‘ä¾èµ–
uv pip install -e ".[dev]"
```

#### ä»£ç è´¨é‡æ£€æŸ¥
```bash
# ä»£ç æ ¼å¼åŒ–
uv run black src/
uv run isort src/

# ç±»å‹æ£€æŸ¥
uv run mypy src/

# ä»£ç æ£€æŸ¥
uv run flake8 src/
```

#### æµ‹è¯•
```bash
# ä¸»è¦åŠŸèƒ½æµ‹è¯•
echo '{"kml_file":"test.kml","line_spacing":25,"rotation_angle":0,"save_dir":"./output"}' | uv run python interface.py

# é€šè¿‡é…ç½®æ–‡ä»¶æµ‹è¯•
echo "test.json" | uv run python interface.py
```

## é¡¹ç›®æ¶æ„

### ç®€åŒ–æ¶æ„æ¨¡å¼
é¡¹ç›®é‡‡ç”¨ç®€åŒ–çš„å•ä¸€æµç¨‹æ¶æ„ï¼š

```
interface.py â†’ line_planner.main â†’ stdin_processor â†’ standalone â†’ è¾“å‡ºç»“æœ
```

**æ ¸å¿ƒæ¨¡å—ï¼ˆç®€åŒ–åï¼‰:**

1. **å…¥å£å±‚**
   - `interface.py` - ä¸»è¦ç¨‹åºå…¥å£ï¼Œå¤„ç†æ ‡å‡†è¾“å…¥

2. **æ§åˆ¶å±‚ (`src/line_planner/`)**
   - `main.py` - ä¸»ç¨‹åºé€»è¾‘ï¼Œè·¯ç”±åˆ°ç‹¬ç«‹å®ç°
   - `api/stdin_processor.py` - æ ‡å‡†è¾“å…¥å¤„ç†å’Œç»“æœè¾“å‡º

3. **æ ¸å¿ƒå±‚ (`src/line_planner/core/`)**
   - `standalone.py` - ç‹¬ç«‹å®ç°ï¼ŒåŒ…å«æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
     - `StandaloneBoundaryParser` - KMLè§£æ
     - `StandalonePlanner` - èˆªçº¿è§„åˆ’ç®—æ³•
     - å†…ç½®å¯è§†åŒ–åŠŸèƒ½

### æ•°æ®æµæ¶æ„
```
JSONé…ç½® â†’ ç‹¬ç«‹è§£æå™¨ â†’ ç‹¬ç«‹è§„åˆ’å™¨ â†’ èˆªçº¿æ‹ç‚¹ â†’ å¤šæ ¼å¼è¾“å‡º+å¯è§†åŒ–
```

### ç®€åŒ–è®¾è®¡åŸåˆ™
- **ç‹¬ç«‹å®ç°**: æ‰€æœ‰åŠŸèƒ½é›†æˆåœ¨standaloneæ¨¡å—ä¸­
- **æ ‡å‡†è¾“å…¥**: é€šè¿‡JSONé…ç½®é©±åŠ¨
- **å†…ç½®å¯è§†åŒ–**: é›†æˆmatplotlibç”Ÿæˆå›¾åƒ
- **ä¸€ä½“åŒ–è¾“å‡º**: åŒæ—¶ç”ŸæˆJSONã€å›¾åƒã€æ—¥å¿—

## ä¸»è¦å…¥å£ç‚¹

### æ ‡å‡†ä½¿ç”¨æ–¹å¼
```bash
# ç›´æ¥JSONé…ç½®
echo '{"kml_file":"test.kml","line_spacing":25,"rotation_angle":0,"save_dir":"./output"}' | uv run python interface.py

# é€šè¿‡é…ç½®æ–‡ä»¶
echo "test.json" | uv run python interface.py

# Windowsä¸‹çš„ç­‰æ•ˆå‘½ä»¤
type test.json | python interface.py
```

### é…ç½®æ–‡ä»¶æ ¼å¼
```json
{
  "kml_file": "test.kml",
  "line_spacing": 25,
  "rotation_angle": 0,
  "save_dir": "./output"
}
```

## é…ç½®æ–‡ä»¶

### å…³é”®é…ç½®æ–‡ä»¶
- `pyproject.toml` - é¡¹ç›®é…ç½®ã€ä¾èµ–ç®¡ç†ã€å¼€å‘å·¥å…·é…ç½®
- `uv.lock` - ä¾èµ–é”å®šæ–‡ä»¶
- `test.json` - æµ‹è¯•é…ç½®æ–‡ä»¶ç¤ºä¾‹

### å¼€å‘å·¥å…·é…ç½®
é¡¹ç›®åœ¨pyproject.tomlä¸­é…ç½®äº†ï¼š
- Blackä»£ç æ ¼å¼åŒ–ï¼ˆè¡Œé•¿åº¦100ï¼‰
- isortå¯¼å…¥æ’åº
- mypyç±»å‹æ£€æŸ¥ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰
- matplotlib, numpyç­‰ç§‘å­¦è®¡ç®—ä¾èµ–

## æ ¸å¿ƒæ•°æ®ç»“æ„

### è§„åˆ’ç»“æœæ ¼å¼
```json
{
  "success": true,
  "turn_points": [
    {"lat": 39.904200, "lon": 116.407400, "type": "start", "index": 0}
  ],
  "statistics": {
    "total_points": 12,
    "total_distance_km": 2.450,
    "estimated_flight_time_10ms_min": 4.1
  },
  "parameters": {
    "line_spacing": 20.0,
    "rotation_angle": 0.0
  }
}
```

## ç®—æ³•æ ¸å¿ƒ

### èˆªçº¿ç”Ÿæˆç®—æ³•
1. **è¾¹ç•Œæ‰«æ**: æŒ‰æŒ‡å®šé—´è·ç”Ÿæˆæ°´å¹³æ‰«æçº¿
2. **äº¤ç‚¹è®¡ç®—**: è®¡ç®—æ‰«æçº¿ä¸å¤šè¾¹å½¢è¾¹ç•Œçš„äº¤ç‚¹
3. **æ‹ç‚¹æå–**: æ¯æ¡èˆªçº¿åªä¿ç•™èµ·ç‚¹å’Œç»ˆç‚¹
4. **è›‡å½¢ä¼˜åŒ–**: å¥‡å¶è¡Œäº¤æ›¿æ–¹å‘

### åæ ‡è½¬æ¢
- è¾“å…¥WGS84ç»çº¬åº¦ â†’ å±€éƒ¨ç±³åˆ¶åæ ‡ç³» â†’ èˆªçº¿æ—‹è½¬ â†’ ç”Ÿæˆæ‹ç‚¹ â†’ è½¬æ¢å›WGS84

## è¾“å‡ºæ ¼å¼

è‡ªåŠ¨ç”Ÿæˆå¤šç§è¾“å‡ºæ–‡ä»¶ï¼š
- **coordinates.json**: èˆªçº¿åæ ‡æ•°æ®
- **result.json**: å®Œæ•´çš„è§„åˆ’ç»“æœå’Œç»Ÿè®¡ä¿¡æ¯
- **flight_plan.png**: å¯è§†åŒ–èˆªçº¿å›¾åƒï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
- **processing.log**: å¤„ç†è¿‡ç¨‹æ—¥å¿—

### è¾“å‡ºç›®å½•ç»“æ„
```
output/
â””â”€â”€ sif_planning_20250922_105239/
    â”œâ”€â”€ coordinates.json    # åæ ‡æ•°æ®
    â”œâ”€â”€ result.json        # å®Œæ•´ç»“æœ
    â”œâ”€â”€ flight_plan.png    # å¯è§†åŒ–å›¾åƒ
    â””â”€â”€ processing.log     # å¤„ç†æ—¥å¿—
```

## æµ‹è¯•ç­–ç•¥

### ç®€åŒ–æµ‹è¯•æ–¹æ³•
```bash
# åŸºæœ¬åŠŸèƒ½æµ‹è¯•
echo '{"kml_file":"test.kml","line_spacing":25,"rotation_angle":0}' | uv run python interface.py

# å‚æ•°å˜åŒ–æµ‹è¯•
echo '{"kml_file":"test.kml","line_spacing":50,"rotation_angle":45}' | uv run python interface.py

# æ–‡ä»¶è·¯å¾„æµ‹è¯•
echo "test.json" | uv run python interface.py
```

### éªŒè¯æ ‡å‡†
- è¾“å‡ºJSONæ ¼å¼æ­£ç¡®
- ç”Ÿæˆå¯è§†åŒ–å›¾åƒ
- èˆªçº¿æ‹ç‚¹æ•°é‡åˆç†
- è›‡å½¢è·¯å¾„ä¼˜åŒ–æ­£ç¡®

## ä¸“ä¸šé¢†åŸŸçŸ¥è¯†

### SIFè®¾å¤‡ç‰¹ç‚¹
- å•ç‚¹å…‰è°±æµ‹é‡ï¼Œéœ€è¦ç²¾ç¡®çš„æ‹ç‚¹æ§åˆ¶
- é€‚ç”¨äºå†œä¸šé¥æ„Ÿã€ç¯å¢ƒç›‘æµ‹ç­‰åœºæ™¯
- è¦æ±‚é«˜ç²¾åº¦çš„èˆªçº¿è§„åˆ’å’Œç¨³å®šçš„é£è¡Œè·¯å¾„

### èˆªçº¿ä¼˜åŒ–åŸåˆ™
- æœ€å°åŒ–è½¬å¼¯æ¬¡æ•°ï¼Œæé«˜é£è¡Œæ•ˆç‡
- ä¿æŒèˆªçº¿é—´è·ä¸€è‡´æ€§ï¼Œç¡®ä¿æ•°æ®è´¨é‡
- æ”¯æŒèˆªçº¿æ—‹è½¬ï¼Œé€‚åº”ä¸åŒåœ°å½¢å’Œé£å‘æ¡ä»¶

## é¡¹ç›®ç®€åŒ–å†å²

### ç®€åŒ–åŸå› 
- åŸé¡¹ç›®åŒ…å«å¤æ‚çš„APIå±‚å’Œå¤šä¸ªå†—ä½™æ¨¡å—
- å®é™…ä½¿ç”¨ä¸­åªéœ€è¦æ ‡å‡†è¾“å…¥çš„ç®€å•æ¨¡å¼
- ç‹¬ç«‹å®ç°å·²ç»åŒ…å«æ‰€æœ‰å¿…è¦åŠŸèƒ½

### åˆ é™¤çš„æ¨¡å—
- `src/line_planner/api/simple_api.py` - å¤æ‚APIæ¥å£
- `src/line_planner/core/planner.py` - æ ‡å‡†è§„åˆ’å™¨
- `src/line_planner/core/boundary_parser.py` - æ ‡å‡†è§£æå™¨
- `src/line_planner/utils/visualization.py` - å¤–éƒ¨å¯è§†åŒ–å·¥å…·

### ç®€åŒ–æ•ˆæœ
- **ä»£ç å‡å°‘**: åˆ é™¤çº¦1000+è¡Œä»£ç 
- **ç»´æŠ¤æ€§æé«˜**: åªéœ€ç»´æŠ¤ç‹¬ç«‹å®ç°
- **æ€§èƒ½ä¼˜åŒ–**: æ— å¤æ‚æ¨¡å—ä¾èµ–
- **ä½¿ç”¨ç®€åŒ–**: ä¸€è¡Œå‘½ä»¤å®Œæˆèˆªçº¿è§„åˆ’

## é‡è¦æé†’

âš ï¸ **æ¶æ„å·²ç®€åŒ–** - é¡¹ç›®å·²åˆ é™¤æ ‡å‡†APIæ¨¡å¼ï¼Œåªä¿ç•™ç‹¬ç«‹å®ç°ã€‚
âœ… **æ¨èä½¿ç”¨æ–¹å¼** - é€šè¿‡ `echo 'config' | python interface.py` ä½¿ç”¨ã€‚
ğŸ”§ **æ ¸å¿ƒæ¨¡å—** - æ‰€æœ‰åŠŸèƒ½é›†ä¸­åœ¨ `standalone.py` ä¸­ã€‚