<?xml version="1.0" encoding="utf-8" ?>
<!-- Copyright 2018-2019 Tecnativa - Ernesto Tejeda
     License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl). -->
<odoo>
    <template
        id="sale_order_portal_content_hide_detail"
        inherit_id="sale.sale_order_portal_content"
    >
        <xpath expr="//t[@name='product_line_row']" position="attributes">
            <attribute
                name="t-if"
                add="(not current_section or current_section.show_details)"
                separator=" and "
            />
        </xpath>
        <xpath
            expr="//tbody[hasclass('sale_tbody')]//t[contains(@t-if, 'line.display_type') and contains(@t-if, 'line_section') and contains(@t-if, 'or line.product_type')]//td"
            position="attributes"
        >
            <attribute name="t-if" add="line.show_details" separator=" and " />
        </xpath>
        <xpath
            expr="//tbody[hasclass('sale_tbody')]//t[contains(@t-if, 'line.display_type') and contains(@t-if, 'line_note')]//td"
            position="attributes"
        >
            <attribute
                name="t-if"
                add="(not current_section or current_section.show_details)"
                separator=" and "
            />
        </xpath>
        <xpath
            expr="//tbody[hasclass('sale_tbody')]//tr[hasclass('is-subtotal', 'text-end')]//td"
            position="attributes"
        >
            <attribute
                name="t-if"
                add="current_section.show_details and current_section.show_subtotal"
                separator=" and "
            />
        </xpath>
        <xpath
            expr="//tbody[hasclass('sale_tbody')]//tr[hasclass('is-subtotal', 'text-end')]/td/strong"
            position="attributes"
        >
            <attribute name="class" add="d-none" separator=" " />
        </xpath>
        <xpath
            expr="//tbody[hasclass('sale_tbody')]//tr[hasclass('is-subtotal', 'text-end')]/td/strong"
            position="after"
        >
            <strong class="mr16">Subtotal <span
                t-field="current_section.name"
            /></strong>
        </xpath>
        <xpath
            expr="//tbody[hasclass('sale_tbody')]//tr[hasclass('is-subtotal', 'text-end')]/t"
            position="before"
        >
            <t t-if="current_section and not current_section.show_details">
                <tr class="o_line_section">
                    <td colspan="99">
                        <span t-field="current_section.name" class="fw-bold" />
                        <span class="float-end">
                            <span
                                t-if="current_section.show_section_subtotal"
                                class="text-end"
                                t-out="current_subtotal"
                                t-options='{"widget": "monetary", "display_currency": sale_order.currency_id}'
                            />
                        </span>
                    </td>
                </tr>
            </t>
            <!-- Move current_section reset to after subtotal section -->
            <xpath
                expr="//t[@t-set='current_section' and @t-value='None']"
                position="move"
            />
        </xpath>

        <!-- Prices -->
        <xpath expr="//div[@t-field='line.price_unit']" position="attributes">
            <attribute
                name="t-if"
                add="(not current_section or current_section.show_line_amount)"
                separator=" and "
            />
        </xpath>
        <xpath expr="//t[contains(@t-out, 'line.price_unit')]" position="attributes">
            <attribute
                name="t-if"
                add="(not current_section or current_section.show_line_amount)"
                separator=" and "
            />
        </xpath>
        <xpath expr="//span[@t-field='line.price_subtotal']" position="attributes">
            <attribute
                name="t-if"
                add="(not current_section or current_section.show_line_amount)"
                separator=" and "
            />
        </xpath>
        <xpath
            expr="//t[@t-foreach='lines_to_report']//span[contains(@t-out, 'line.tax_id')]"
            position="attributes"
        >
            <attribute
                name="t-if"
                add="(not current_section or current_section.show_line_amount)"
                separator=" and "
            />
        </xpath>
    </template>
</odoo>
