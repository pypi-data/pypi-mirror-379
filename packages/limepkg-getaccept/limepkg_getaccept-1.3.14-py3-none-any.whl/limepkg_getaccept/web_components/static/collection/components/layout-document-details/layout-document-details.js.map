{"version":3,"file":"layout-document-details.js","sourceRoot":"","sources":["../../../src/components/layout-document-details/layout-document-details.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, h, Prop, State, Event } from '@stencil/core';\nimport { IDocument } from '../../types/Document';\nimport { fetchDocumentDetails, removeDocument } from '../../services';\nimport { LimeWebComponentPlatform } from '@limetech/lime-web-components';\nimport { ISession } from '../../types/Session';\nimport { IDocumentPage } from '../../types/DocumentPage';\nimport moment from 'moment/moment';\nimport { EventEmitter } from 'events';\nimport { EnumViews } from '../../models/EnumViews';\nimport { EnumDocumentStatuses } from '../../models/EnumDocumentStatuses';\n\n@Component({\n    tag: 'layout-document-details',\n    shadow: true,\n    styleUrl: 'layout-document-details.scss',\n})\nexport class LayoutDocumentDetails {\n    @Prop() public documentId: string;\n    @Prop() platform: LimeWebComponentPlatform;\n    @Prop() public session: ISession;\n\n    @Event() changeView: EventEmitter;\n\n    @State() documentData: IDocument = {};\n    @State() isLoading: boolean = false;\n\n    private totalPageViewTime: number;\n\n    public componentWillLoad() {\n        this.loadDocumentDetails();\n    }\n\n    constructor() {\n        this.removeDocumentHandler = this.removeDocumentHandler.bind(this);\n        this.openDocumentIntGetAcceptHandler =\n            this.openDocumentIntGetAcceptHandler.bind(this);\n    }\n\n    public render() {\n        return [\n            <div>\n                <h3>Document Details</h3>\n                {(() => {\n                    if (this.isLoading) {\n                        return <ga-loader />;\n                    } else {\n                        return (\n                            <div class=\"document-details-container\">\n                                <div class=\"document-details-info\">\n                                    <ul class=\"document-details-info-list\">\n                                        <li>\n                                            <span class=\"document-detail-title\">\n                                                Document name:\n                                            </span>{' '}\n                                            {this.documentData.name}\n                                        </li>\n                                        <li>\n                                            <span class=\"document-detail-title\">\n                                                Status:\n                                            </span>{' '}\n                                            {this.documentData.status}\n                                        </li>\n                                        <li>\n                                            <span class=\"document-detail-title\">\n                                                Deal value:\n                                            </span>{' '}\n                                            {this.documentData.value}\n                                        </li>\n                                        <li>\n                                            <span class=\"document-detail-title\">\n                                                Expiration date:\n                                            </span>{' '}\n                                            {this.documentData.expiration_date}\n                                        </li>\n                                        <li>\n                                            <span class=\"document-detail-title\">\n                                                Send date:\n                                            </span>{' '}\n                                            {this.documentData.send_date}\n                                        </li>\n                                    </ul>\n                                    <div class=\"document-details-action-buttons\">\n                                        <limel-button\n                                            primary={true}\n                                            label=\"Open in GetAccept\"\n                                            onClick={\n                                                this\n                                                    .openDocumentIntGetAcceptHandler\n                                            }\n                                        />\n                                        <limel-button\n                                            class=\"document-details-action-button-remove\"\n                                            primary={false}\n                                            label=\"Remove document\"\n                                            onClick={this.removeDocumentHandler}\n                                        />\n                                    </div>\n                                </div>\n                                <div class=\"document-details-pages\">\n                                    <ul>\n                                        {this.documentData.pages.map(page => {\n                                            return (\n                                                <document-page-info\n                                                    documentId={\n                                                        this.documentData.id\n                                                    }\n                                                    session={this.session}\n                                                    page={page}\n                                                    totalTime={\n                                                        this.totalPageViewTime\n                                                    }\n                                                />\n                                            );\n                                        })}\n                                    </ul>\n                                </div>\n                            </div>\n                        );\n                    }\n                })()}\n            </div>,\n        ];\n    }\n\n    private async loadDocumentDetails() {\n        // should load document details. Replace hard coded id with id from this.document.\n        this.isLoading = true;\n        const rawDocument = await fetchDocumentDetails(\n            this.platform,\n            this.session,\n            this.documentId\n        );\n\n        this.documentData = {\n            id: rawDocument.id,\n            name: rawDocument.name,\n            page_count: rawDocument.page_count,\n            status: rawDocument.status,\n            value: rawDocument.value,\n            expiration_date: moment(rawDocument.expiration_date).format(\n                'YYYY-MM-DD'\n            ),\n            send_date: this.getSendDate(rawDocument),\n            pages: this.getDocumentPages(rawDocument),\n        };\n        this.totalPageViewTime = this.getTotalPageViewTime(rawDocument);\n        this.isLoading = false;\n    }\n\n    private getSendDate(rawDocument): string {\n        return (\n            (rawDocument.send_date &&\n                moment(rawDocument.send_date).format('YYYY-MM-DD')) ||\n            ''\n        );\n    }\n\n    private getDocumentPages(rawDocument): IDocumentPage[] {\n        return (\n            (rawDocument.pages &&\n                rawDocument.pages.map((page: IDocumentPage) => {\n                    return {\n                        page_id: page.page_id,\n                        thumb_url: page.thumb_url,\n                        page_time: page.page_time,\n                        order_num: page.order_num,\n                        page_num: page.page_num,\n                    };\n                })) ||\n            []\n        );\n    }\n\n    private getTotalPageViewTime(rawDocument): number {\n        return (\n            (rawDocument.pages &&\n                rawDocument.pages.reduce(\n                    (acc, page) => acc + page.page_time,\n                    0\n                )) ||\n            0\n        );\n    }\n\n    private async removeDocumentHandler() {\n        this.isLoading = true;\n        const result = await removeDocument(\n            this.platform,\n            this.session,\n            this.documentId\n        );\n        this.isLoading = false;\n        if (result) {\n            this.changeView.emit(EnumViews.home);\n        }\n    }\n\n    private openDocumentIntGetAcceptHandler() {\n        const page: string =\n            this.documentData.status === EnumDocumentStatuses.draft\n                ? 'edit'\n                : 'view';\n        window.open(\n            `https://app.getaccept.com/document/${page}/${this.documentData.id}`,\n            '_blank'\n        );\n    }\n}\n"]}