services:
  app:
    build: .
    image: {{ name.lower() }}:latest
    container_name: {{ name.lower().replace(' ', '-') }}
    environment:
      PORT: ${PORT:-8080}
      RELOAD: ${RELOAD:-1}
    ports:
      - "0:8080"
    volumes:
      - .:/app
    command: >-
      sh -c "
      if [ \"$${RELOAD}\" = \"1\" ]; then
        python - <<'PY'
import os, subprocess
port = os.environ.get('PORT', '8080')
subprocess.run([
  'watchfiles',
  '--ignore-dotfiles',
  '--debounce', '300',
  '--', 'python', '-m', '{{ package_name }}.app', '--host', '0.0.0.0', '--port', port
])
PY
      else
        python -m {{ package_name }}.app --host 0.0.0.0 --port $${PORT}
      fi"

