(this.webpackJsonpstreamlit_custom_slider=this.webpackJsonpstreamlit_custom_slider||[]).push([[0],{100:function(e,t,a){},133:function(e,t,a){},134:function(e,t,a){"use strict";a.r(t);var r=a(1),l=a.n(r),n=a(13),o=a.n(n),i=a(23),s=(a(32),a(33),a(49)),c=a(8),d=a.n(c),m=(a(88),a(89),a(90),a(31)),u=a.n(m),p=(a(100),a(136)),f=a(18),g=a(16),b=a.n(g);const y=["YYYY-MM-DDTHH:mm","MM/DD/YYYYTHH:mm","MM/DD/YYYY HH:mm","YYYY-MM-DD HH:mm"],x=["buying_power","borrow_power"],h=["Day","Week","Month","Quarter","Quarters","Year"],v=h.map(e=>e+" Margin");u.a.setAppElement("#root");let E=!1;var _=e=>{let{isOpen:t,closeModal:a,modalData:n,promptText:o,setPromptText:i,toastr:s}=e;const[c,d]=l.a.useState(!1),{prompt_field:m,prompt_order_rules:g,selectedRow:_,selectedField:w,add_symbol_row_info:k,display_grid_column:S}=n,[C,O]=l.a.useState(!1),[N,R]=l.a.useState(!1),[F,D]=l.a.useState(!1),[A,j]=l.a.useState(!0),[T,z]=l.a.useState(!0),[W,M]=l.a.useState({}),[H,P]=l.a.useState({}),B=n.editableCols||[],Y=_&&S&&Array.isArray(_[S])?_[S]:[],I=Y.length>0?Object.keys(Y[0]):[],L=B.map(e=>e.col_header),G=Array.from(new Set([...L,...I])),J=Object(r.useRef)(null);Object(r.useRef)(null);Object(r.useEffect)(()=>{t&&setTimeout(()=>{var e;return null===(e=J.current)||void 0===e?void 0:e.focus()},100)},[t]),Object(r.useEffect)(()=>{M({})},[t,_]),Object(r.useEffect)(()=>{if(!B||!_||!S||!Array.isArray(_[S]))return;const e=_[S],t={};B.forEach(a=>{let{col_header:r}=a;t[r]={},e.forEach((e,a)=>{var l;t[r][a]=null!==(l=e[r])&&void 0!==l?l:""})}),P(t)},[t,_,S,B]);const q=e=>y.some(t=>b()(e,t,!0).isValid()),U=e=>{const t=b()(e,y,!0).toDate(),a=Intl.DateTimeFormat().resolvedOptions().timeZone,r=Object(f.b)(t,a);return Object(f.a)(r,"yyyy-MM-dd'T'HH:mm")},K=[],$=[],V=[],X=[];Array.isArray(g)&&o&&g.filter(e=>e&&e in o);if(g)for(const r of g){const e=o[r];Array.isArray(e)?X.push(r):"boolean"===typeof e?$.push(r):q(e)?V.push(r):K.push(r)}return l.a.createElement(u.a,{isOpen:t,onRequestClose:a,ariaHideApp:!1},l.a.createElement("div",{className:"my-modal-content"},l.a.createElement("div",{className:"modal-header px-3 d-flex justify-content-center align-items-center",style:{position:"relative"}},l.a.createElement("h4",{className:"text-center m-0"},n.prompt_message),l.a.createElement("span",{className:"close",onClick:a,style:{position:"absolute",right:"20px"}},"\xd7")),l.a.createElement("div",{className:"modal-body p-3"},l.a.createElement("div",{className:"d-flex flex-column"},$.length>0&&l.a.createElement("div",{className:"d-flex flex-row justify-content-between mb-2",style:{border:"1px solid #e0e0e0",borderRadius:"8px",padding:"8px",background:"#fafcff"}},$.map((e,t)=>l.a.createElement("div",{className:"d-flex flex-column align-items-center",key:t,style:{marginRight:"8px"}},l.a.createElement("label",{className:"mb-0",style:{minWidth:"100px",textAlign:"center",fontSize:"0.9rem"}},e,":"),l.a.createElement("input",{type:"checkbox",checked:o[e],onChange:t=>i({...o,[e]:t.target.checked}),style:{width:"16px",height:"16px",marginTop:"4px"}})))),k&&Array.isArray(k)&&l.a.createElement("div",{className:"d-flex flex-wrap",style:{flex:1,border:"1px solid #e0e0e0",borderRadius:"8px",padding:"8px",background:"#fafcff",marginBottom:"8px"}},k.map((e,t)=>_&&void 0!==_[e]&&l.a.createElement("div",{key:e,style:{flex:"1 1 30%",minWidth:"120px",marginBottom:"8px",paddingRight:"12px"}},l.a.createElement("b",null,e,": "),"number"===typeof _[e]?Number(_[e]).toLocaleString(void 0,{maximumFractionDigits:2}):String(_[e])))),l.a.createElement("div",{className:"d-flex flex-wrap",style:{gap:"16px",marginBottom:"16px"}},K.length>0&&K.map((e,t)=>{if(h.includes(e)||v.includes(e))return null;const a=x.includes(e);return l.a.createElement("div",{key:t,className:"d-flex flex-column",style:{flex:"1 1 calc(50% - 16px)",minWidth:"150px"}},l.a.createElement("label",{className:"mb-1",style:{fontSize:"0.85rem",fontWeight:"bold",textTransform:"capitalize"}},e.replace(/_/g," "),":","sell_amount"===e&&l.a.createElement("span",{style:{marginLeft:"4px",cursor:"pointer"},title:"This amount will override sell_qty"},"\u2753")),a?l.a.createElement(l.a.Fragment,null,l.a.createElement("input",{type:"range",min:"0",max:"1",step:".01",value:o[e]||0,onChange:t=>i({...o,[e]:Number(t.target.value)}),style:{width:"100%"}}),l.a.createElement("span",{style:{fontSize:"0.85rem",fontWeight:"bold",marginTop:"4px"}},o[e]||0)):l.a.createElement("input",{type:"text",value:o[e],onChange:t=>i({...o,[e]:t.target.value}),style:{width:"100%",padding:"6px",fontSize:"0.85rem",border:"1px solid #ccc",borderRadius:"4px"}}))}),X.length>0&&X.map((e,t)=>l.a.createElement("div",{key:t,className:"d-flex flex-column",style:{flex:"1 1 calc(50% - 16px)",minWidth:"150px"}},l.a.createElement("label",{className:"mb-1",style:{fontSize:"0.85rem",fontWeight:"bold",textTransform:"capitalize"}},e.replace(/_/g," "),":"),l.a.createElement("select",{value:o[e][0],onChange:t=>i({...o,[e]:[t.target.value]}),style:{width:"100%",padding:"6px",fontSize:"0.85rem",border:"1px solid #ccc",borderRadius:"4px"}},o[e].map((e,t)=>l.a.createElement("option",{key:t,value:e},e))))),V.length>0&&V.map((e,t)=>l.a.createElement("div",{key:t,className:"d-flex flex-column",style:{flex:"1 1 calc(50% - 16px)",minWidth:"150px"}},l.a.createElement("label",{className:"mb-1",style:{fontSize:"0.85rem",fontWeight:"bold",textTransform:"capitalize"}},e.replace(/_/g," "),":"),l.a.createElement("input",{type:"datetime-local",value:o[e]&&U(o[e]),onChange:t=>i({...o,[e]:t.target.value}),style:{width:"100%",padding:"6px",fontSize:"0.85rem",border:"1px solid #ccc",borderRadius:"4px"}}))),h.some(e=>null===g||void 0===g?void 0:g.includes(e))&&l.a.createElement("div",{style:{flex:"1 1 100%",marginTop:"16px"}},l.a.createElement("div",{style:{cursor:"pointer",fontWeight:"bold",marginBottom:"4px"},onClick:()=>O(e=>!e)},C?"\u25bc":"\u25ba"," Advanced Allocation Options"),C&&l.a.createElement("div",{className:"d-flex flex-wrap",style:{gap:"16px"}},h.map((e,t)=>(null===g||void 0===g?void 0:g.includes(e))&&void 0!==o[e]&&l.a.createElement("div",{key:t,className:"d-flex flex-column",style:{flex:"1 1 calc(50% - 16px)",minWidth:"150px"}},l.a.createElement("label",{className:"mb-1",style:{fontSize:"0.85rem",fontWeight:"bold",textTransform:"capitalize"}},e.replace(/_/g," "),":"),l.a.createElement("input",{type:"range",min:"0",max:"1",step:".01",value:o[e]||0,onChange:t=>i({...o,[e]:Number(t.target.value)}),style:{width:"100%"}}),l.a.createElement("span",{style:{fontSize:"0.85rem",fontWeight:"bold",marginTop:"4px"}},o[e]||0))))),v.some(e=>null===g||void 0===g?void 0:g.includes(e))&&l.a.createElement("div",{style:{flex:"1 1 100%",marginTop:"16px"}},l.a.createElement("div",{style:{cursor:"pointer",fontWeight:"bold",marginBottom:"4px"},onClick:()=>R(e=>!e)},N?"\u25bc":"\u25ba"," Advanced Margin Allocation Options"),N&&l.a.createElement("div",{className:"d-flex flex-wrap",style:{gap:"16px"}},v.map((e,t)=>(null===g||void 0===g?void 0:g.includes(e))&&void 0!==o[e]&&l.a.createElement("div",{key:t,className:"d-flex flex-column",style:{flex:"1 1 calc(50% - 16px)",minWidth:"150px"}},l.a.createElement("label",{className:"mb-1",style:{fontSize:"0.85rem",fontWeight:"bold",textTransform:"capitalize"}},e.replace(/_/g," "),":"),l.a.createElement("input",{type:"range",min:"0",max:"1",step:".01",value:o[e]||0,onChange:t=>i({...o,[e]:Number(t.target.value)}),style:{width:"100%"}}),l.a.createElement("span",{style:{fontSize:"0.85rem",fontWeight:"bold",marginTop:"4px"}},o[e]||0)))))),S&&_&&Array.isArray(_[S])&&_[S].length>0&&l.a.createElement("div",{style:{margin:"16px 0"}},l.a.createElement("div",{style:{cursor:"pointer",fontWeight:"bold",marginBottom:"4px"},onClick:()=>z(e=>!e)},l.a.createElement("span",{style:{marginRight:"8px"}},T?"\u25bc":"\u25ba"),l.a.createElement("button",{type:"button",className:"btn btn-link p-0",style:{fontWeight:"bold",textDecoration:"underline",color:"#007bff",background:"none",border:"none",cursor:"pointer"},onClick:()=>z(e=>!e)},S)),T&&(()=>{const e=_[S];return l.a.createElement("div",{style:{overflowX:"auto"}},l.a.createElement("table",{className:"table table-bordered table-sm",style:{fontSize:"0.6rem"}},l.a.createElement("thead",null,l.a.createElement("tr",null,G.map(e=>{const t=B.find(t=>t.col_header===e);return l.a.createElement("th",{key:e,style:{whiteSpace:"normal",wordWrap:"break-word",backgroundColor:"#fafcff",color:"black",textAlign:"center"}},l.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},(null===t||void 0===t?void 0:t.display_name)||e.replace(/_/g," "),(null===t||void 0===t?void 0:t.info)&&l.a.createElement("span",{style:{marginLeft:"4px",cursor:"pointer",color:"#007bff",fontSize:"0.8rem"},title:t.info},"\u2753")))}))),l.a.createElement("tbody",null,e.map((t,a)=>l.a.createElement("tr",{key:a},G.map(r=>{const n=B.find(e=>e.col_header===r);var s;if("sell_qty"===r)return l.a.createElement("td",{key:r},l.a.createElement("input",{type:"number",min:0,max:t.qty_available,value:(null===(s=H[r])||void 0===s?void 0:s[a])||"",onChange:l=>{let n=l.target.value;if(""===n)return void P(e=>({...e,[r]:{...e[r],[a]:""}}));let s=Number(n);s<0&&(s=0),void 0!==t.qty_available&&s>t.qty_available&&(s=t.qty_available),P(e=>({...e,[r]:{...e[r],[a]:s}}));const c=e.map((e,t)=>{var l;return{...e,sell_qty:t===a?String(s):(null===(l=H[r])||void 0===l?void 0:l[t])||""}});i({...o,active_orders_with_qty:c})},style:{width:"80px",fontSize:"0.8rem"}}));if(n){if("list"===n.dtype){var c;const e=n.values||[];return l.a.createElement("td",{key:r},l.a.createElement("select",{value:(null===(c=H[r])||void 0===c?void 0:c[a])||"",onChange:e=>{const t=e.target.value;P(e=>({...e,[r]:{...e[r],[a]:t}}))},style:{width:"100%",fontSize:"0.8rem",padding:"4px",minWidth:"80px"}},l.a.createElement("option",{value:"",disabled:!0},"Select..."),e.map((e,t)=>l.a.createElement("option",{key:t,value:e},e))))}var d,m,u,p;return"checkbox"===n.dtype?l.a.createElement("td",{key:r},l.a.createElement("input",{type:"checkbox",checked:!!(null===(d=H[r])||void 0===d?void 0:d[a]),onChange:e=>{const t=e.target.checked;P(e=>({...e,[r]:{...e[r],[a]:t}}))}})):"number"===n.dtype?l.a.createElement("td",{key:r},l.a.createElement("input",{type:"number",value:(null===(m=H[r])||void 0===m?void 0:m[a])||"",onChange:e=>{const t=e.target.value;P(e=>({...e,[r]:{...e[r],[a]:t}}))},style:{width:"80px",fontSize:"0.8rem"}})):"datetime"===n.dtype?l.a.createElement("td",{key:r},l.a.createElement("input",{type:"datetime-local",value:(null===(u=H[r])||void 0===u?void 0:u[a])||"",onChange:e=>{const t=e.target.value;P(e=>({...e,[r]:{...e[r],[a]:t}}))},style:{width:"140px",fontSize:"0.8rem"}})):l.a.createElement("td",{key:r},l.a.createElement("input",{type:"text",value:(null===(p=H[r])||void 0===p?void 0:p[a])||"",onChange:e=>{const t=e.target.value;P(e=>({...e,[r]:{...e[r],[a]:t}}))},style:{width:"80px",fontSize:"0.8rem"}}))}return l.a.createElement("td",{key:r},t&&void 0!==t[r]?"number"===typeof t[r]?Number(t[r]).toLocaleString(void 0,{maximumFractionDigits:2}):String(t[r]):"")})))),l.a.createElement("tfoot",null,l.a.createElement("tr",null,G.map(t=>{try{const a=e.reduce((e,a)=>{const r=a[t];return"number"!==typeof r||isNaN(r)?e:e+r},0),r=e.some(e=>"number"===typeof e[t]&&!isNaN(e[t]));return l.a.createElement("td",{key:t,style:{fontWeight:"bold",background:"#f7f7f7"}},r?a.toLocaleString(void 0,{maximumFractionDigits:2}):"")}catch(a){return l.a.createElement("td",{key:t})}})))))})()))),l.a.createElement("div",{className:"modal-footer d-flex justify-content-center",style:{position:"sticky",bottom:0}},l.a.createElement("button",{type:"button",className:"btn btn-primary mx-2",onClick:async()=>{if(!E&&!c){d(!0),E=!0;try{const e=S&&_&&Array.isArray(_[S])?_[S]:[];if(!e||!Array.isArray(e))return void s.error("No editable orders found for this action.");const t=e.map((e,t)=>{let a={};return B.forEach(r=>{var l,n,o;a[r.col_header]=null!==(l=null!==(n=null===(o=H[r.col_header])||void 0===o?void 0:o[t])&&void 0!==n?n:e[r.col_header])&&void 0!==l?l:""}),{...e,...a}}),r={username:n.username,prod:n.prod,selected_row:n.selectedRow,default_value:o,editable_orders:t,...n.kwargs},{data:l}=await p.a.post(n.button_api,r),{status:i,data:c,description:d}=l;"success"===i?c&&"fade"===c.message_type?s.success(d,"Success"):alert("Success!\nDescription: "+d):c&&"fade"===c.message_type?s.error(d,"Error"):alert("Error!\nDescription: "+d),!1!==(null===c||void 0===c?void 0:c.close_modal)&&a()}catch(e){console.log("error :>> ",e),s.error(e.message)}d(!1),E=!1}},ref:J},c?l.a.createElement("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}):"Ok"),l.a.createElement("button",{type:"button",className:"btn btn-secondary mx-2",onClick:a},"Cancel"))))},w=(a(132),a(138));a(137),a(133);function k(e,t,a){return Object.keys(e).reduce((r,l)=>a.includes(l)?(r[l]=e[l],r):(r[l]=t(e[l]),r),{})}function S(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const r=e=>null!==e&&"object"===typeof e?S(e,t):t(e);return Array.isArray(e)?e.map(r):"object"===typeof e?k(e,r,a):e}let C=[],O=null;function N(e,t){try{let a=new Date(e);return Object(f.a)(a,t)}catch{return e}}function R(e,t){let a=Number.parseFloat(e);return Number.isNaN(a)?e:t+a.toFixed(2)}function F(e,t){let a=Number.parseFloat(e);return Number.isNaN(a)?e:a.toFixed(t)}const D=e=>{const t=e.column.colDef.linkField,a=e.column.colDef.baseURL,r=e.data&&t?e.data[t]:null;return r&&a?l.a.createElement("a",{href:`${a}/${r}`,target:"_blank",rel:"noopener noreferrer"},e.value):l.a.createElement("span",null,e.value)};d.a.options={positionClass:"toast-top-full-width",hideDuration:300,timeOut:3e3};var A=e=>{const t=e=>{if(!e||!e.node)return null;if("bottom"===e.node.rowPinned)return l.a.createElement("span",null,e.value);const t=e.data&&e.col_header&&e.data[e.col_header+"_cellStyle"]?e.data[e.col_header+"_cellStyle"]:e.cellStyle;return l.a.createElement("button",{onClick:()=>{e.clicked(e.node.id)},style:{background:"transparent",border:(null===t||void 0===t?void 0:t.border)||"none",width:e.width?e.width:"100%",color:(null===t||void 0===t?void 0:t.color)||"inherit",...t}},e.col_header?e.value:e.buttonName)};function a(e,t){const r={...e,masterDetail:!0};return r.getDetailRowData=e=>{let t=[];Array.isArray(e.data.nestedRows)?t=e.data.nestedRows:e.data.nestedRows&&(t=[e.data.nestedRows]),e.successCallback(t.length?t:[])},r.detailCellRendererParams&&r.detailCellRendererParams.detailGridOptions&&(r.detailCellRendererParams.detailGridOptions=a(r.detailCellRendererParams.detailGridOptions,t+1)),r}const n=Object(r.useRef)(null),{username:o,api:c,api_update:m,api_ws:u,refresh_sec:f,refresh_cutoff_sec:b=0,prod:y=!0,index:x,enable_JsCode:h,kwargs:v}=e;let{grid_options:E={}}=e;h&&(E=S(E,ke,["rowData"]));const[k,A]=Object(r.useState)([]);let{buttons:j,toggle_views:T,api_key:z,api_lastmod_key:W=null,columnOrder:M=[],refresh_success:H=null,total_col:P=!1,subtotal_cols:B=[],filter_button:Y=""}=v;const[I,L]=Object(r.useState)([]),[G,J]=Object(r.useState)(!1),[q,U]=Object(r.useState)({}),[K,$]=Object(r.useState)(""),[V,X]=Object(r.useState)(0),[Q,Z]=Object(r.useState)(null),[ee,te]=Object(r.useState)(89),[ae,re]=Object(r.useState)(null),[le,ne]=Object(r.useState)([]),[oe,ie]=Object(r.useState)(null),[se,ce]=Object(r.useState)(null);Object(r.useEffect)(()=>{if(!v.api_ws)return void console.warn("api_ws is undefined, WebSocket not started.");const e=new WebSocket(v.api_ws);return e.onopen=()=>{e.send(JSON.stringify({username:o,grid:I,api_key:z}))},e.onmessage=e=>{var t;const{row_id:a,updates:r}=JSON.parse(e.data),l=null===(t=n.current)||void 0===t?void 0:t.api.getRowNode(a);if(l&&l.data){var o;const e={...l.data,...r};e[x]=a,null===(o=n.current)||void 0===o||o.api.applyTransaction({update:[e]})}else console.log("Row not found for update:",a)},()=>e.close()},[v.api_ws,x,I]);Object(r.useEffect)(()=>{var e;i.a.setFrameHeight(),j.length&&(j=S(j,ke,["rowData"]),j.forEach(e=>{const{prompt_field:a,prompt_message:r,button_api:l,prompt_order_rules:n,col_header:i,col_headername:s,col_width:c,pinned:m,button_name:u,border_color:f,border:g,add_symbol_row_info:b,display_grid_column:h,editableCols:_,...w}=e;let k=e.filterParams||{};v.filter_apply&&(k={...k,buttons:["apply","reset"]}),E.columnDefs.push({...w,field:i||x,headerName:s,width:c,pinned:m,cellRenderer:t,filterParams:k,cellRendererParams:{col_header:i,buttonName:u,borderColor:f,border:g,filterParams:k,cellStyle:e.cellStyle,...e.cellRendererParams||{},clicked:async function(e){try{const t=C.find(t=>t[x]===e);if(n){const e=t[a],i="string"===typeof e?JSON.parse(t[a].replace(/'/g,'"').replace(/\n/g,"").replace(/\s/g,"").replace(/False/g,"false").replace(/True/g,"true")):e;J(!0),U({prompt_message:r,button_api:l,username:o,prod:y,selectedRow:t,kwargs:v,prompt_field:a,prompt_order_rules:n,selectedField:i,add_symbol_row_info:b,display_grid_column:h,editableCols:_});const s={};n.forEach(e=>{s[e]=i[e]}),$(s)}else a&&r?(J(!0),U({prompt_message:r,button_api:l,username:o,prod:y,selectedRow:t,kwargs:v}),$(t[a])):(window.confirm(r)&&await p.a.post(l,{username:o,prod:y,selected_row:t,...v}),d.a.success("Success!"))}catch(t){alert(""+t)}}}})})),M.length>0&&E.columnDefs&&E.columnDefs.sort((e,t)=>-1!==M.indexOf(e.field)&&-1!==M.indexOf(t.field)?M.indexOf(e.field)-M.indexOf(t.field):-1===M.indexOf(e.field)?1:-1===M.indexOf(t.field)?-1:0),(null===(e=n.current)||void 0===e?void 0:e.api)&&n.current.api.refreshHeader()},[j,E.columnDefs]);const de=async()=>{const e=await me();return!1!==e&&(L(e),C=e,!0)};Object(r.useEffect)(()=>{_e()},[V]);const me=async()=>{try{let e=T?T[V]:"none";if(!await(async(e,t)=>e!==t&&(te(e),!0))(V,ee)&&f&&f>0){if(!await(async()=>{try{if(null===W)return console.log("api key is null, returning false"),!0;if(null!==W&&void 0!==W){var e;const t=c.split("/").slice(0,-1).join("/"),a=await p.a.get(t+"/lastmod_key",{params:{api_key:z,client_user:o,prod:y,api_lastmod_key:W}});return(null===(e=a.data)||void 0===e?void 0:e.lastModified)!==Q&&(Z(a.data.lastModified),!0)}return!1}catch(t){return d.a.error("Failed to check last modified: "+t.message),!1}})())return!1}console.log("fetching data...",c);const t=await p.a.post(c,{username:o,prod:y,...v,toggle_view_selection:e});return JSON.parse(t.data)}catch(e){return d.a.error("Fetch Error: "+e.message),!1}},ue=Object(r.useCallback)(()=>{if(!n.current)return;if(!B||0===B.length)return void A([]);const e=n.current.api;let t=[];if(e.forEachNodeAfterFilterAndSort(e=>{e.data&&t.push(e.data)}),0===t.length)return void A([]);let a={},r=[];E&&E.columnDefs?r=E.columnDefs.map(e=>e.field).filter(Boolean):t.length>0&&(r=Object.keys(t[0])),"string"===typeof P&&r.includes(P)?a[P]="subTotals":r.length>0&&(a[r[0]]="subTotals"),Array.isArray(j)&&j.forEach(e=>{e.col_header&&e.cellStyle&&(a[e.col_header+"_cellStyle"]=e.cellStyle)}),r.forEach(e=>{if(B.includes(e)){const r=t.reduce((t,a)=>{let r=a[e];if("string"===typeof r&&r.includes("$")){const e=r.match(/\$([\d,.\-]+)/);e&&e[1]&&(r=e[1].replace(/,/g,""))}const l=Number(r);return t+(isNaN(l)?0:l)},0);a[e]=isNaN(r)?"":r}else"subTotals"===a[P]&&e===P||(a[e]="")}),A([a])},[B,P]),pe=Object(r.useCallback)(()=>{ue()},[ue]);Object(r.useEffect)(()=>{if(f&&f>0){const t=setInterval(de,1e3*f);let a;return b>0&&(console.log(b),a=setTimeout(()=>{clearInterval(t),console.log("Fetching data ended, refresh rate:",f)},1e3*b)),console.error("rendered==========",e),()=>{clearInterval(t),a&&clearTimeout(a)}}},[e,V]);const fe=Object(r.useCallback)(e=>{var t;const a=[],r=n.current.columnApi,l=(null===(t=E)||void 0===t?void 0:t.columnDefs)||[];r.getColumns().forEach(e=>{const t=l.find(t=>t.field===e.getColDef().field);t&&void 0!==t.initialWidth||a.push(e.getId())}),r.autoSizeColumns(a,e)},[]),ge=(Object(r.useCallback)(()=>{n.current.api.sizeColumnsToFit({defaultMinWidth:100})},[]),Object(r.useCallback)(async e=>{setTimeout(async()=>{try{console.log("ws api is",u,v.api_ws);const t=await me();if(!1===t)return;L(t),C=t,B&&B.length>0?ue():A([]),fe(!0),e.columnApi&&ie(e.columnApi.getColumnState())}catch(t){d.a.error("Error: "+t.message)}},100)},[])),be=Object(r.useMemo)(()=>({minWidth:200}),[]),ye=Object(r.useMemo)(()=>e=>e.data[x],[x]),xe=Object(r.useMemo)(()=>({toolPanels:[{id:"columns",labelDefault:"Columns",labelKey:"columns",iconKey:"columns",toolPanel:"agColumnsToolPanel"},{id:"filters",labelDefault:"Filters",labelKey:"filters",iconKey:"filter",toolPanel:"agFiltersToolPanel"}],defaultToolPanel:"customStats"}),[]),he=Object(r.useCallback)(e=>{null===O&&(O={}),O[e.data[x]]=e.data,console.log("Data after change is",O)},[]),[ve,Ee]=Object(r.useState)(!1),_e=(Object(r.useRef)(null),async()=>{Ee(!0);try{const e=await de();H&&e&&d.a.success("Refresh success!")}catch(e){d.a.error("Refresh Failed! "+e.message)}finally{Ee(!1)}}),we=Object(r.useMemo)(()=>({dateColumnFilter:{filter:"agDateColumnFilter",filterParams:{comparator:(e,t)=>Object(w.a)(new Date(t),e)}},numberColumnFilter:{filter:"agNumberColumnFilter"},shortDateTimeFormat:{valueFormatter:e=>N(e.value,"dd/MM/yyyy HH:mm")},customDateTimeFormat:{valueFormatter:e=>N(e.value,e.column.colDef.custom_format_string)},customNumericFormat:{valueFormatter:e=>{var t;return F(e.value,null!==(t=e.column.colDef.precision)&&void 0!==t?t:2)}},customCurrencyFormat:{valueFormatter:e=>R(e.value,e.column.colDef.custom_currency_symbol)},timedeltaFormat:{valueFormatter:e=>Object(g.duration)(e.value).humanize(!0)},customNumberFormat:{valueFormatter:e=>Number(e.value).toLocaleString("en-US",{minimumFractionDigits:0})},customHyperlinkRenderer:{cellRenderer:D,cellRendererParams:{baseURL:"URLSearchParams.co"}}}),[]);function ke(e){let t=new RegExp("::JSCODE::\\s*((function|class)\\s*.*)\\s*::JSCODE::").exec(e);if(t){const e=t[1];return new Function("return "+e)()}return e}const Se=(Ce=T.length)<3?{padding:"15px 18px",fontSize:"18px"}:Ce<8?{padding:"15px 18px",fontSize:"15px"}:Ce<15?{padding:"12px 13px",fontSize:"13px"}:Ce<35?{padding:"10px 12px",fontSize:"11px"}:{padding:"3px 5px",fontSize:"10px"};var Ce;const Oe=Object(r.useMemo)(()=>((e,t)=>Array.from(new Set(t.map(t=>t[e]))).filter(e=>void 0!==e&&null!==e))(Y,I),[I,Y]);return l.a.createElement(l.a.Fragment,null,v.show_cell_content&&se&&l.a.createElement("div",{style:{position:"absolute",top:"10px",right:"10px",background:"white",border:"1px solid #ddd",borderRadius:"8px",padding:"10px",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.1)",zIndex:1e3,maxWidth:"300px",maxHeight:"200px",overflow:"auto",width:"fit-content"}},l.a.createElement("p",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"}},se),l.a.createElement("button",{onClick:()=>ce(null),style:{background:"#3498db",color:"white",border:"none",borderRadius:"2px",padding:"3px 5px",cursor:"pointer"}},l.a.createElement("h5",{style:{fontSize:"8px",margin:"0 0 6px 0"}},"x"))),T&&T.length>0&&l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{style:{fontWeight:"bold",color:"#055A6E",marginBottom:"4px",fontSize:"15px"}},v.toggle_header?v.toggle_header:""),T.length<20?l.a.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px",padding:"10px",marginBottom:"10px"}},T.map((e,t)=>l.a.createElement("button",{key:t,className:"btn "+(V===t?"btn-danger":"btn-secondary"),style:{...Se,borderRadius:"8px",color:"#055A6E",backgroundColor:"#F3FAFD",fontWeight:"bold"},onClick:()=>{X(t),te(V)},disabled:ve},e,ve&&V===t?l.a.createElement("div",{style:{width:"14px",height:"14px",border:"2px solid black",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginLeft:"8px"}}):null))):l.a.createElement("div",{className:"toggle-view-container",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(100px, 1fr))",gap:"10px",overflowY:"auto",maxHeight:"200px",padding:"10px",border:"1px solid #ddd",borderRadius:"8px",backgroundColor:"#eef9f8",width:"100%",marginBottom:"10px"}},T.map((e,t)=>l.a.createElement("button",{key:t,className:"btn "+(V===t?"btn-danger":"btn-secondary"),style:{...Se,borderRadius:"8px",color:"#055A6E",backgroundColor:"#F3FAFD",fontWeight:"bold"},onClick:()=>{X(t),te(V)},disabled:ve},e,ve&&V===t?l.a.createElement("div",{style:{width:"14px",height:"14px",border:"2px solid black",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginLeft:"8px"}}):null)))),l.a.createElement(_,{isOpen:G,closeModal:()=>J(!1),modalData:q,promptText:K,setPromptText:$,toastr:d.a}),l.a.createElement("div",{style:{flexDirection:"row",height:"100%",width:"100%"},id:"myGrid"},l.a.createElement("div",{className:"d-flex justify-content-between align-items-center"},(void 0==f||0==f)&&l.a.createElement("div",{style:{display:"flex"}},l.a.createElement("div",{style:{margin:"5px 5px 5px 2px"}},l.a.createElement("button",{className:"btn",style:{backgroundColor:"#3498db",color:"white",padding:"2px 5px",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"50px"},onClick:_e,title:"Refresh",disabled:ve},ve?l.a.createElement("div",{style:{width:"12px",height:"12px",border:"2px solid white",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 0.8s linear infinite"}}):l.a.createElement("span",{style:{fontSize:"25px",lineHeight:"1"}},"\u27f3")),l.a.createElement("style",null,"\n                    @keyframes spin {\n                      to {\n                        transform: rotate(360deg);\n                      }\n                    }\n                  ")),l.a.createElement("div",{style:{margin:"5px 5px 5px 2px"}},l.a.createElement("button",{className:"btn",style:{backgroundColor:"green",color:"white",padding:"5px 8px",fontSize:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"6px"},onClick:async()=>{if(null!==O)try{const e=await p.a.post(m,{username:o,prod:y,new_data:O,...v});O=null,e.status?d.a.success("Successfully Updated! "):d.a.error("Failed! "+e.message)}catch(e){d.a.error("Failed! "+e)}else d.a.warning("No changes to update")},title:"Update"},l.a.createElement("span",{style:{fontSize:"18px",lineHeight:"1"}},"\u2191"))))),l.a.createElement("div",{className:E.theme||"ag-theme-alpine-dark",style:{width:"100%",height:v.grid_height?v.grid_height:"100%"}},v.column_sets&&l.a.createElement("div",{style:{marginBottom:12,display:"flex",gap:"8px",alignItems:"center",flexWrap:"wrap"}},l.a.createElement("button",{onClick:()=>{ne([]),setTimeout(()=>{var e;const t=null===(e=n.current)||void 0===e?void 0:e.columnApi;t&&oe&&t.applyColumnState({state:oe,applyOrder:!0})},0)},style:{background:"rgb(194, 194, 194)",color:"white",border:"1.5px solid rgb(213, 213, 213)",borderRadius:"6px",fontWeight:"bold",fontSize:"12px",padding:"5px 10px",margin:"0 4px 4px 0",boxShadow:"0 2px 6px rgb(216, 216, 216)",transition:"all 0.15s",cursor:"pointer"}},"Reset Columns"),Object.keys(v.column_sets).map(e=>l.a.createElement("button",{key:e,onClick:()=>{ne(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e]),setTimeout(()=>{var t;const a=le.includes(e)?le.filter(t=>t!==e):[...le,e],r=Array.from(new Set(a.flatMap(e=>v.column_sets[e]))),l=null===(t=n.current)||void 0===t?void 0:t.columnApi;l&&Array.isArray(E.columnDefs)&&(E.columnDefs.forEach(e=>{l.setColumnVisible(e.field,r.includes(e.field))}),r.forEach((e,t)=>{l.moveColumn(e,t)}))},0)},style:{background:le.includes(e)?"#3498db":"#F3FAFD",color:le.includes(e)?"white":"#055A6E",border:le.includes(e)?"2px solid #1abc9c":"1px solid #ddd",borderRadius:"6px",fontWeight:"bold",fontSize:"12px",padding:"5px 10px",margin:"0 4px 4px 0",boxShadow:le.includes(e)?"0 2px 6px rgba(52,152,219,0.10)":"none",transition:"all 0.15s",cursor:"pointer"}},e))),v.streaming_list_text&&Array.isArray(v.streaming_list_text)&&l.a.createElement("div",{style:{width:"100%",background:"#F3FAFD",color:"#055A6E",padding:"4px 10px",fontSize:"13px",borderBottom:"1px solid #ddd",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",marginBottom:"4px",fontWeight:"bold"}},l.a.createElement("div",{style:{display:"block",width:"100%",whiteSpace:"nowrap",overflow:"hidden",position:"relative"}},l.a.createElement("div",{style:{display:"inline-block",paddingLeft:"100%",animation:"scroll-left 40s linear infinite"}},v.streaming_list_text.join("   |   ")),l.a.createElement("style",null,"\n                @keyframes scroll-left {\n                  0% {\n                  transform: translateX(0%);\n                  }\n                  100% {\n                  transform: translateX(-100%);\n                  }\n                }\n                "))),v.filter_button&&""!==v.filter_button&&l.a.createElement("div",{style:{marginBottom:8}},v.show_clear_all_filters&&l.a.createElement("button",{onClick:()=>{n.current&&n.current.api&&n.current.api.setFilterModel({})},style:{background:"rgb(194, 194, 194)",color:"white",border:"1.5px solid rgb(213, 213, 213)",borderRadius:"6px",fontWeight:"bold",fontSize:"12px",padding:"5px 10px",margin:"0 4px 4px 0",boxShadow:"0 2px 6px rgb(216, 216, 216)",transition:"all 0.15s",cursor:"pointer"}},"Clear Filters"),Oe.map(e=>l.a.createElement("button",{key:e,onClick:()=>(e=>{if(re(e),n.current&&n.current.api){const t=n.current.api;if(e)t.setFilterModel({...t.getFilterModel(),[Y]:{filterType:"set",values:[e]}});else{const e=t.getFilterModel();delete e[Y],t.setFilterModel(e)}}})(e),style:{background:ae===e?"#3498db":"#F3FAFD",color:ae===e?"white":"#055A6E",border:ae===e?"2px solid #1abc9c":"1px solid #ddd",borderRadius:"6px",fontWeight:"bold",fontSize:"12px",padding:"5px 10px",margin:"0 4px 4px 0",boxShadow:ae===e?"0 2px 6px rgba(52,152,219,0.10)":"none",transition:"all 0.15s",cursor:"pointer"}},e))),l.a.createElement(s.AgGridReact,{ref:n,rowData:I,pinnedBottomRowData:k,onFilterChanged:pe,getRowStyle:e=>{if(e.data&&"subTotals"===e.data[P])return{fontWeight:"bold",background:"#f8f8f8"};try{var t,a;const r=null!==(t=e.data.color_row)&&void 0!==t?t:void 0;return{background:r,color:null!==(a=e.data.color_row_text)&&void 0!==a?a:void 0}}catch(r){return void console.error("Error accessing row style:",r)}},headerHeight:30,rowHeight:30,onGridReady:ge,autoGroupColumnDef:be,animateRows:!0,suppressAggFuncInHeader:!0,getRowId:ye,gridOptions:(()=>{let e={...E};return v.nestedGridEnabled&&v.detailGridOptions?(e.masterDetail=!0,e.detailCellRendererParams={detailGridOptions:a(v.detailGridOptions,1),getDetailRowData:e=>{let t=[];Array.isArray(e.data.nestedRows)?t=e.data.nestedRows:e.data.nestedRows&&(t=[e.data.nestedRows]),e.successCallback(t.length?t:[])}}):(e.masterDetail=!1,e.detailCellRendererParams=void 0),e})(),onCellValueChanged:he,columnTypes:we,sideBar:!1!==E.sideBar&&xe,onCellClicked:e=>{e.value&&ce(e.value)}}))))};var j=Object(i.b)(e=>{const{username:t,api:a,api_update:r,refresh_sec:n,refresh_cutoff_sec:o,gridoption_build:i,enable_JsCode:s,prod:c}=e.args,{grid_options:d,kwargs:m={}}=e.args,{index:u,theme:p}=d;return l.a.createElement("div",null,l.a.createElement(A,{username:t,api:a,api_update:r,refresh_sec:n,refresh_cutoff_sec:o,gridoption_build:i,prod:c,grid_options:d,index:u,kwargs:m,enable_JsCode:s}))});o.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(j,null)),document.getElementById("root"))},56:function(e,t,a){e.exports=a(134)}},[[56,1,2]]]);
//# sourceMappingURL=main.0e621925.chunk.js.map