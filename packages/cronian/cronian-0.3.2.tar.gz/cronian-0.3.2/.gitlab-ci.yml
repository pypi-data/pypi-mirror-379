
# Change pip's cache directory to be inside the project directory since we can
# only cache local items.
variables:
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"


test:
  tags:
    - python3.11
  # Specifically use the 3.11 image we've setup in our runner
  image: python:3.11
  # https://pip.pypa.io/en/stable/topics/caching/
  cache:
    paths:
      - .cache/pip
  before_script:
    - python -m venv venv
    - source venv/bin/activate
  script:
    - python -m pip install --editable ".[dev]"
    - pytest --cov
  coverage: /TOTAL.*? (100(?:\.0+)?\%|[1-9]?\d(?:\.\d+)?\%)$/


ruff:
  tags:
    - python3.11
  image: python:3.11
  cache:
    paths:
      - .cache/pip
  before_script:
    - python -m venv venv
    - source venv/bin/activate
    - python -m pip install ruff
  script:
    - ruff check .

