# 更新日志

## [0.2.2] - 2025-09-23

### 🎯 数据解析重大改进
- **数据源匹配优化**: 实现智能分层查询机制，优先从tools_table获取真实工具信息
- **评分数据类型修复**: 修复整数和浮点数类型混乱问题，实现严格的类型检查
- **测试统计准确性**: 从假数据改为真实统计计算，提供准确的测试成功率和次数
- **时间戳准确性**: 全面改进datetime解析和验证，解决时区和逻辑错误
- **数据关联机制**: 建立tools_table和test_results表的智能关联查询

### 🔧 数据验证和错误处理
- **全面数据验证**: 添加`_validate_tool_info()`、`_validate_test_result()`等验证方法
- **输入验证**: 实现`_validate_search_filters()`搜索参数验证
- **安全查询**: 添加`_safe_execute_query()`重试机制和指数退避
- **边界检查**: 评分范围(0-100)、URL格式、必填字段验证
- **自动修复**: 自动修正常见数据问题如无效URL、超出范围评分等

### ⚡ 性能和稳定性提升
- **查询优化**: 改进数据库查询语句，减少不必要的数据获取
- **错误恢复**: 实现查询失败自动重试机制
- **内存优化**: 优化数据结构，减少内存占用
- **日志完善**: 增加详细的错误日志和调试信息

### 📊 测试覆盖率提升
- **综合测试**: 创建完整的测试套件，覆盖所有核心功能
- **性能测试**: 添加QPS、响应时间等性能指标测试
- **边界测试**: 测试各种边界条件和异常情况
- **数据准确性测试**: 验证时间戳、评分、统计数据的准确性

### 🛠️ 代码质量改进
- **类型安全**: 完善类型注解，减少运行时错误
- **错误处理**: 统一异常处理机制，提高代码健壮性
- **代码结构**: 优化方法组织，提高可读性和维护性
- **文档完善**: 添加详细的方法文档和使用说明

### 📈 效果验证结果
- **总体成功率**: 81.8%
- **功能完整性**: 100% (4/4项测试通过)
- **数据准确性**: 100% (无逻辑错误，评分范围正确)
- **系统稳定性**: 100% (数据库连接稳定，错误处理完善)
- **工具数量**: 378个工具可用

## [0.2.1] - 2025-09-23

### 功能完善 🛠️
- **搜索功能增强**: 
  - 添加完整的参数验证和边界检查
  - 改进错误处理机制，提供更详细的错误信息
  - 优化搜索摘要生成，包含过滤条件说明
  - 添加过滤器信息返回，便于调试和日志记录
- **性能优化**:
  - 限制搜索结果数量在1-100之间，防止过度请求
  - 改进分数范围验证逻辑
  - 优化数据库查询排序机制
- **错误处理改进**:
  - 完整的参数验证和边界检查
  - 搜索失败时返回友好的错误信息
  - 添加详细的过滤条件返回，便于调试

### 修复 🔧
- **stdio通信**: 完全修复stdout重定向问题，确保MCP协议兼容性
- **版本一致性**: 更新所有文件中的版本号为0.2.1
- **代码质量**: 移除调试输出，提升生产环境稳定性

### 测试验证 ✅
- **uvx兼容性**: 完整的uvx环境测试通过
- **MCP协议**: 标准JSON-RPC 2.0协议验证
- **功能测试**: 所有核心功能测试通过

---

## [0.2.0] - 2025-09-23

### 重构 🚀
- **工具简化**: 按照context7设计理念，将MCP工具从5个精简为2个核心工具
- **功能整合**: 将排序功能整合到`search_mcp_tools`中，支持多种排序方式
- **代码优化**: 大幅简化代码结构，提高维护性和稳定性

### 移除的功能 🗑️
- **get_tool_evaluation**: 功能被搜索工具覆盖
- **get_top_tools**: 功能已整合到搜索工具的排序功能中
- **get_tool_categories**: 使用频率较低的非核心功能

### 保留的核心功能 ✅
- **search_mcp_tools**: 增强的搜索功能，支持多种排序和筛选
- **health_check**: 重要的系统健康监控功能

### 改进 📈
- **性能提升**: 减少50%的工具数量，降低系统复杂度
- **用户体验**: 更清晰的工具定位，避免功能重复
- **维护性**: 简化代码结构，更易于维护和扩展

### 测试验证 ✅
- 简化后的功能测试全部通过
- 搜索和排序功能正常运行
- 健康检查功能稳定

---

## [0.1.6] - 2025-09-23

### 修复 🔧
- **版本统一**: 修复版本号不一致问题，统一所有文件中的版本为0.1.6
- **构建系统**: 简化构建配置，使用单一的hatchling构建后端，移除setuptools依赖
- **Pydantic兼容性**: 修复Pydantic V2相关的弃用警告
  - 将`class Config`改为`model_config`
  - 移除Field中的env参数，使用pydantic-settings的标准方式

### 改进 🚀
- **包构建**: 优化构建流程，确保版本一致性
- **uvx兼容性**: 改善uvx运行体验，支持无缓存运行
- **依赖管理**: 精简构建依赖，提高构建效率

### 测试验证 ✅
- uvx运行测试通过
- 包构建和安装验证成功
- Cherry Studio兼容性确认

---

## [0.1.5] - 2025-09-22

### 修复 🔧
- **构建系统**: 添加setup.py作为备用构建系统，提高兼容性
- **导入路径**: 修复docker-compose.yml中的模块导入路径问题
- **安全模块**: 改进安全配置管理器的导入容错机制

### 改进 🚀
- **包构建**: 完善pyproject.toml配置，优化包包含和排除规则
- **依赖管理**: 更新构建系统依赖，添加setuptools和wheel支持
- **Docker**: 优化Docker健康检查脚本的模块路径

### 测试验证 ✅
- 包构建和安装测试通过
- Docker容器健康检查正常工作
- 安全模块导入兼容性测试通过

---

## [0.1.4] - 2025-09-22

### 修复 🔧
- **关键修复**: 完全解决stdio模式连接问题
  - 修复MCP客户端调用`uvx mcp-evaluation-server server`时的连接失败
  - 在stdio模式下完全禁用所有日志和警告输出
  - 正确处理MCP协议初始化流程
- **日志系统**: 修复日志文件路径问题，支持动态创建日志目录
- **安全模块**: 移除不必要的警告输出，提升stdio模式兼容性

### 改进 🚀
- **HTTP模式**: 增加Streamable HTTP支持
  - 支持`server`和`http`命令启动HTTP服务器
  - 默认监听`127.0.0.1:8000`，路径`/mcp`
  - 可通过`--host`、`--port`、`--path`参数自定义
- **命令行**: 增强命令行参数解析和模式检测
- **兼容性**: 改善与各种MCP客户端的兼容性

### 测试验证 ✅
- stdio模式MCP协议初始化成功
- HTTP服务器模式正常启动
- 包安装和运行稳定

---

## [0.1.3] - 2025-09-22

### 修复
- **关键修复**: 修正所有导入路径问题 (src → mcp_evaluation_server)
- **配置修复**: 更新 pyproject.toml 配置错误
  - 修正 coverage 源路径
  - 添加 dependency-groups 配置
  - 移除不存在的文件引用
- **文档更新**: 更正 README 中的启动命令和项目结构
- **类型注解**: 添加缺失的类型注解，提升代码质量
  - 修复 utils.py 的 Optional 类型错误
  - 为 practical_security.py 添加返回类型注解
  - 为 memory_protection.py 添加完整类型注解

### 改进
- 测试现在可以正常运行
- 包启动稳定性提升
- 代码质量和可维护性改善

---

## [0.1.2] - 2025-09-22

### 优化
- 优化包结构，移除11MB冗余数据
- 简化依赖配置，从8个减少到4个核心包
- 清理重复代码和临时文件
- 优化包大小，提升部署效率

### 修复
- 修复包导入和模块结构问题
- 改进数据库连接稳定性
- 优化MCP服务器启动性能

### 测试
- 完成本地功能测试验证
- 确认MCP协议兼容性
- 验证与AI客户端集成能力

---

## 未发布

---

## [0.1.1] - 2025-09-22

### 新增
- 优化GitHub Actions工作流，只在release时触发更新日志
- 全面支持uvx运行方式，无需预先安装
- 更新MCP客户端配置指南，支持Cursor和Cherry Studio
- 改进用户文档和故障排除指南

### 优化
- 简化MCP服务器配置流程
- 提升用户体验，支持开箱即用
- 修复Pydantic v2兼容性警告

---

## [0.1.0] - 2025-09-19

### 新增
- 初始版本发布
- 基础搜索功能
- 工具评估系统
- 分类统计功能
