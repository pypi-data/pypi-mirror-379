# Multi-Strategy Configuration Example
# This configuration demonstrates running multiple strategies simultaneously

version: "1.1.28"
environment: "staging"

# Application Settings
app:
  name: "TradingBot-MultiStrategy"
  log_level: "INFO"
  timezone: "UTC"
  data_retention_days: 30
  max_concurrent_strategies: 6

# Database Configuration
database:
  url: "${DATABASE_URL}"
  pool_size: 15
  max_overflow: 30
  echo: false

# Exchange Configuration
exchanges:
  binance:
    enabled: true
    api_key: "${BINANCE_API_KEY}"
    api_secret: "${BINANCE_API_SECRET}"
    sandbox: true  # Use testnet for multi-strategy testing
    rate_limit: 1200
    timeout: 30
    
  coinbase:
    enabled: true
    api_key: "${COINBASE_API_KEY}"
    api_secret: "${COINBASE_API_SECRET}"
    passphrase: "${COINBASE_PASSPHRASE}"
    sandbox: true
    rate_limit: 600
    timeout: 30

# Multi-Strategy Configuration
strategies:
  # Trend Following Strategies
  ma_crossover_btc:
    enabled: true
    class: "MovingAverageStrategy"
    parameters:
      short_period: 10
      long_period: 21
      confidence_threshold: 0.75
    symbols:
      - "BTC/USDT"
    timeframes:
      - "1h"
      - "4h"
    weight: 0.25  # 25% of available capital
    
  ma_crossover_eth:
    enabled: true
    class: "MovingAverageStrategy"
    parameters:
      short_period: 12
      long_period: 26
      confidence_threshold: 0.75
    symbols:
      - "ETH/USDT"
    timeframes:
      - "1h"
      - "4h"
    weight: 0.20  # 20% of available capital
  
  # Mean Reversion Strategies
  rsi_btc:
    enabled: true
    class: "RSIStrategy"
    parameters:
      period: 14
      oversold_threshold: 30
      overbought_threshold: 70
      confidence_multiplier: 1.0
    symbols:
      - "BTC/USDT"
    timeframes:
      - "1h"
    weight: 0.15  # 15% of available capital
    
  rsi_altcoins:
    enabled: true
    class: "RSIStrategy"
    parameters:
      period: 14
      oversold_threshold: 25  # More conservative for altcoins
      overbought_threshold: 75
      confidence_multiplier: 1.2
    symbols:
      - "ADA/USDT"
      - "DOT/USDT"
      - "LINK/USDT"
    timeframes:
      - "1h"
      - "4h"
    weight: 0.20  # 20% of available capital
  
  # Multi-Indicator Strategy
  multi_indicator_major:
    enabled: true
    class: "MultiIndicatorStrategy"
    parameters:
      ma_short: 10
      ma_long: 20
      rsi_period: 14
      macd_fast: 12
      macd_slow: 26
      macd_signal: 9
      confidence_threshold: 0.8
    symbols:
      - "BTC/USDT"
      - "ETH/USDT"
    timeframes:
      - "4h"
      - "1d"
    weight: 0.15  # 15% of available capital
  
  # Volatility Strategy
  atr_volatility:
    enabled: true
    class: "ATRVolatilityStrategy"
    parameters:
      atr_period: 14
      volatility_threshold: 0.02
      breakout_multiplier: 2.0
      confidence_threshold: 0.7
    symbols:
      - "BTC/USDT"
      - "ETH/USDT"
      - "BNB/USDT"
    timeframes:
      - "1h"
      - "4h"
    weight: 0.05  # 5% of available capital

# Risk Management (Multi-Strategy Specific)
risk_management:
  global:
    max_portfolio_risk: 0.015  # 1.5% total portfolio risk
    max_daily_loss: 0.04       # 4% daily loss limit
    max_drawdown: 0.12         # 12% maximum drawdown
    position_sizing_method: "fixed_fractional"
    
  # Strategy-specific risk limits
  strategy_limits:
    ma_crossover_btc:
      max_position_size: 0.08  # 8% max position
      max_daily_trades: 3
    ma_crossover_eth:
      max_position_size: 0.06  # 6% max position
      max_daily_trades: 3
    rsi_btc:
      max_position_size: 0.05  # 5% max position
      max_daily_trades: 5
    rsi_altcoins:
      max_position_size: 0.03  # 3% max position per symbol
      max_daily_trades: 8
    multi_indicator_major:
      max_position_size: 0.07  # 7% max position
      max_daily_trades: 2
    atr_volatility:
      max_position_size: 0.02  # 2% max position
      max_daily_trades: 10
    
  stop_loss:
    enabled: true
    default_percentage: 0.05
    trailing_stop: true
    trailing_percentage: 0.03
    
  position_limits:
    max_total_positions: 12     # Maximum total positions across all strategies
    max_positions_per_symbol: 2 # Maximum positions per symbol
    max_correlated_positions: 4 # Maximum correlated positions
    min_trade_amount: 25        # $25 minimum trade
    
  # Correlation management
  correlation_limits:
    enabled: true
    max_correlation: 0.7
    correlation_lookback_days: 30
    symbols_groups:
      major_crypto: ["BTC/USDT", "ETH/USDT"]
      altcoins: ["ADA/USDT", "DOT/USDT", "LINK/USDT", "BNB/USDT"]

# Data Collection (Multi-Symbol)
data:
  collection:
    enabled: true
    symbols:
      - "BTC/USDT"
      - "ETH/USDT"
      - "ADA/USDT"
      - "DOT/USDT"
      - "LINK/USDT"
      - "BNB/USDT"
    timeframes:
      - "1m"
      - "5m"
      - "15m"
      - "1h"
      - "4h"
      - "1d"
    
  storage:
    compress_data: true
    backup_enabled: true
    backup_interval_hours: 12
    
  validation:
    check_data_integrity: true
    remove_outliers: true
    outlier_threshold: 3.0

# Monitoring (Enhanced for Multi-Strategy)
monitoring:
  enabled: true
  metrics_port: 8000
  health_check_port: 8001
  
  prometheus:
    enabled: true
    port: 9090
    scrape_interval: "15s"
    
  alerting:
    enabled: true
    channels:
      - type: "email"
        smtp_server: "${SMTP_SERVER}"
        smtp_port: 587
        username: "${SMTP_USERNAME}"
        password: "${SMTP_PASSWORD}"
        recipients:
          - "trader@example.com"
      
      - type: "slack"
        webhook_url: "${SLACK_WEBHOOK_URL}"
        channel: "#multi-strategy-alerts"
    
    rules:
      # Portfolio-level alerts
      - name: "portfolio_high_loss"
        condition: "daily_pnl < -0.03"
        severity: "critical"
        message: "Portfolio daily loss exceeds 3%"
        
      - name: "portfolio_drawdown"
        condition: "max_drawdown > 0.10"
        severity: "high"
        message: "Portfolio drawdown exceeds 10%"
        
      # Strategy-specific alerts
      - name: "strategy_underperformance"
        condition: "strategy_daily_pnl < -0.01"
        severity: "warning"
        message: "Strategy daily loss exceeds 1%"
        
      - name: "strategy_errors"
        condition: "strategy_errors > 3"
        severity: "warning"
        message: "Strategy generating multiple errors"
        
      # Position management alerts
      - name: "max_positions_reached"
        condition: "total_positions >= max_total_positions"
        severity: "warning"
        message: "Maximum position limit reached"
        
      - name: "high_correlation"
        condition: "correlation_breach > 0"
        severity: "warning"
        message: "High correlation detected between positions"

# Backtesting Configuration
backtesting:
  default_capital: 50000  # $50k for multi-strategy testing
  commission: 0.001
  slippage: 0.0005
  
  # Multi-strategy specific settings
  strategy_allocation:
    ma_crossover_btc: 0.25
    ma_crossover_eth: 0.20
    rsi_btc: 0.15
    rsi_altcoins: 0.20
    multi_indicator_major: 0.15
    atr_volatility: 0.05
  
  performance_metrics:
    - "total_return"
    - "annualized_return"
    - "sharpe_ratio"
    - "sortino_ratio"
    - "max_drawdown"
    - "win_rate"
    - "profit_factor"
    - "calmar_ratio"
    - "strategy_correlation"

# Logging Configuration
logging:
  version: 1
  disable_existing_loggers: false
  
  formatters:
    detailed:
      format: "%(asctime)s [%(levelname)s] %(name)s:%(lineno)d - %(funcName)s() - %(message)s"
  
  handlers:
    console:
      class: "logging.StreamHandler"
      level: "INFO"
      formatter: "detailed"
      stream: "ext://sys.stdout"
    
    file:
      class: "logging.handlers.RotatingFileHandler"
      level: "INFO"
      formatter: "detailed"
      filename: "logs/multi_strategy.log"
      maxBytes: 52428800  # 50MB
      backupCount: 5
    
    # Strategy-specific log files
    strategy_file:
      class: "logging.handlers.RotatingFileHandler"
      level: "INFO"
      formatter: "detailed"
      filename: "logs/strategies.log"
      maxBytes: 52428800
      backupCount: 5
  
  loggers:
    "":
      level: "INFO"
      handlers: ["console", "file"]
      propagate: false
    
    "trading_bot.strategies":
      level: "INFO"
      handlers: ["strategy_file"]
      propagate: false

# Multi-Strategy Specific Settings
multi_strategy:
  # Portfolio rebalancing
  rebalancing:
    enabled: true
    frequency: "daily"  # daily, weekly, monthly
    threshold: 0.05     # Rebalance if allocation drifts by 5%
    
  # Strategy performance monitoring
  performance_monitoring:
    enabled: true
    evaluation_period_days: 7
    underperformance_threshold: -0.02  # -2% weekly performance
    auto_disable_underperforming: false
    
  # Dynamic allocation
  dynamic_allocation:
    enabled: false  # Disable for this example
    allocation_method: "performance_based"
    lookback_period_days: 30
    
  # Strategy coordination
  coordination:
    prevent_opposing_signals: true
    signal_aggregation: "weighted_average"
    minimum_signal_agreement: 0.6