def init_factory(fields):
    def init(self):
        for name, field in fields.items():
            setattr(self, name, field.resolve())

    return init


def register(Cls):
    fields = {k: v for k, v in vars(Cls).items() if not k.startswith("__")}
    _attach_names(fields)
    _attach_init(Cls, fields)


def _attach_names(fields):
    for name, field in fields.items():
        field.name = name


def _attach_init(Cls, fields):
    setattr(Cls, "__init__", init_factory(fields))
