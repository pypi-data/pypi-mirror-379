# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'Lmdb_View_UI.ui'
#
# Created by: PyQt5 UI code generator 5.15.9
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.


from PyQt5 import QtCore, QtGui, QtWidgets
from PyQt5.QtWidgets import (QFileDialog, QInputDialog, QMessageBox, QLineEdit, 
                            QDialog, QVBoxLayout, QComboBox, QLabel, QPushButton,
                            QDialogButtonBox, QGroupBox)


class Ui_Form(object):
    def setupUi(self, Form):
        Form.setObjectName("Form")
        Form.setWindowModality(QtCore.Qt.NonModal)
        Form.resize(1602, 865)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Fixed)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(Form.sizePolicy().hasHeightForWidth())
        Form.setSizePolicy(sizePolicy)
        self.gridLayout = QtWidgets.QGridLayout(Form)
        self.gridLayout.setObjectName("gridLayout")
        self.verticalLayout = QtWidgets.QVBoxLayout()
        self.verticalLayout.setObjectName("verticalLayout")
        self.horizontalLayout_3 = QtWidgets.QHBoxLayout()
        self.horizontalLayout_3.setObjectName("horizontalLayout_3")
        self.openmdbBt = QtWidgets.QPushButton(Form)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Preferred)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.openmdbBt.sizePolicy().hasHeightForWidth())
        self.openmdbBt.setSizePolicy(sizePolicy)
        self.openmdbBt.setObjectName("openmdbBt")
        self.horizontalLayout_3.addWidget(self.openmdbBt)
        self.label = QtWidgets.QLabel(Form)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Minimum)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.label.sizePolicy().hasHeightForWidth())
        self.label.setSizePolicy(sizePolicy)
        self.label.setObjectName("label")
        self.horizontalLayout_3.addWidget(self.label)
        self.path_label = QtWidgets.QLineEdit(Form)
        self.path_label.setObjectName("path_label")
        self.horizontalLayout_3.addWidget(self.path_label)
        spacerItem = QtWidgets.QSpacerItem(120, 50, QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Minimum)
        self.horizontalLayout_3.addItem(spacerItem)
        self.verticalLayout.addLayout(self.horizontalLayout_3)
        self.horizontalLayout = QtWidgets.QHBoxLayout()
        self.horizontalLayout.setObjectName("horizontalLayout")
        self.verticalLayout_2 = QtWidgets.QVBoxLayout()
        self.verticalLayout_2.setSizeConstraint(QtWidgets.QLayout.SetFixedSize)
        self.verticalLayout_2.setSpacing(3)
        self.verticalLayout_2.setObjectName("verticalLayout_2")
        self.treeWidget = QtWidgets.QTreeWidget(Form)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Minimum)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.treeWidget.sizePolicy().hasHeightForWidth())
        self.treeWidget.setSizePolicy(sizePolicy)
        self.treeWidget.setMinimumSize(QtCore.QSize(0, 300))
        self.treeWidget.setAutoFillBackground(False)
        self.treeWidget.setObjectName("treeWidget")
        self.treeWidget.headerItem().setText(0, "1")
        self.verticalLayout_2.addWidget(self.treeWidget)
        self.NameView = QtWidgets.QListView(Form)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Expanding)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.NameView.sizePolicy().hasHeightForWidth())
        self.NameView.setSizePolicy(sizePolicy)
        self.NameView.setFlow(QtWidgets.QListView.TopToBottom)
        self.NameView.setObjectName("NameView")
        self.verticalLayout_2.addWidget(self.NameView)
        self.horizontalLayout_6 = QtWidgets.QHBoxLayout()
        self.horizontalLayout_6.setObjectName("horizontalLayout_6")
        self.Pre_view_Button = QtWidgets.QPushButton(Form)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Preferred)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.Pre_view_Button.sizePolicy().hasHeightForWidth())
        self.Pre_view_Button.setSizePolicy(sizePolicy)
        self.Pre_view_Button.setObjectName("Pre_view_Button")
        self.horizontalLayout_6.addWidget(self.Pre_view_Button)
        self.Next_view_Button = QtWidgets.QPushButton(Form)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Preferred)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.Next_view_Button.sizePolicy().hasHeightForWidth())
        self.Next_view_Button.setSizePolicy(sizePolicy)
        self.Next_view_Button.setObjectName("Next_view_Button")
        self.horizontalLayout_6.addWidget(self.Next_view_Button)
        self.verticalLayout_2.addLayout(self.horizontalLayout_6)
        self.horizontalLayout_4 = QtWidgets.QHBoxLayout()
        self.horizontalLayout_4.setSizeConstraint(QtWidgets.QLayout.SetDefaultConstraint)
        self.horizontalLayout_4.setContentsMargins(0, -1, -1, -1)
        self.horizontalLayout_4.setObjectName("horizontalLayout_4")
        self.search_edit = QtWidgets.QLineEdit(Form)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Fixed)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.search_edit.sizePolicy().hasHeightForWidth())
        self.search_edit.setSizePolicy(sizePolicy)
        self.search_edit.setObjectName("search_edit")
        self.horizontalLayout_4.addWidget(self.search_edit)
        self.SearchButton = QtWidgets.QPushButton(Form)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Preferred)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.SearchButton.sizePolicy().hasHeightForWidth())
        self.SearchButton.setSizePolicy(sizePolicy)
        self.SearchButton.setObjectName("SearchButton")
        self.horizontalLayout_4.addWidget(self.SearchButton)
        self.verticalLayout_2.addLayout(self.horizontalLayout_4)
        self.horizontalLayout.addLayout(self.verticalLayout_2)
        self.verticalLayout.addLayout(self.horizontalLayout)
        self.horizontalLayout_2 = QtWidgets.QHBoxLayout()
        self.horizontalLayout_2.setObjectName("horizontalLayout_2")
        self.label_3 = QtWidgets.QLabel(Form)
        self.label_3.setObjectName("label_3")
        self.horizontalLayout_2.addWidget(self.label_3)
        self.NowNumber = QtWidgets.QLCDNumber(Form)
        self.NowNumber.setObjectName("NowNumber")
        self.horizontalLayout_2.addWidget(self.NowNumber)
        self.label_2 = QtWidgets.QLabel(Form)
        self.label_2.setObjectName("label_2")
        self.horizontalLayout_2.addWidget(self.label_2)
        self.MaxNumber = QtWidgets.QLCDNumber(Form)
        self.MaxNumber.setObjectName("MaxNumber")
        self.horizontalLayout_2.addWidget(self.MaxNumber)
        self.label_4 = QtWidgets.QLabel(Form)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Preferred)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.label_4.sizePolicy().hasHeightForWidth())
        self.label_4.setSizePolicy(sizePolicy)
        self.label_4.setObjectName("label_4")
        self.horizontalLayout_2.addWidget(self.label_4)
        self.fun_progressBar = QtWidgets.QProgressBar(Form)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Fixed)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.fun_progressBar.sizePolicy().hasHeightForWidth())
        self.fun_progressBar.setSizePolicy(sizePolicy)
        self.fun_progressBar.setProperty("value", 0)
        self.fun_progressBar.setObjectName("fun_progressBar")
        self.horizontalLayout_2.addWidget(self.fun_progressBar)
        self.state_label = QtWidgets.QLabel(Form)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Preferred)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.state_label.sizePolicy().hasHeightForWidth())
        self.state_label.setSizePolicy(sizePolicy)
        self.state_label.setObjectName("state_label")
        self.horizontalLayout_2.addWidget(self.state_label)
        self.state_bt = QtWidgets.QPushButton(Form)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Preferred)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.state_bt.sizePolicy().hasHeightForWidth())
        self.state_bt.setSizePolicy(sizePolicy)
        self.state_bt.setObjectName("state_bt")
        self.horizontalLayout_2.addWidget(self.state_bt)
        spacerItem1 = QtWidgets.QSpacerItem(250, 50, QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Minimum)
        self.horizontalLayout_2.addItem(spacerItem1)
        self.functionButton = QtWidgets.QPushButton(Form)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Preferred, QtWidgets.QSizePolicy.Preferred)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.functionButton.sizePolicy().hasHeightForWidth())
        self.functionButton.setSizePolicy(sizePolicy)
        self.functionButton.setObjectName("functionButton")
        self.horizontalLayout_2.addWidget(self.functionButton)
        self.JumpButton = QtWidgets.QPushButton(Form)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Minimum, QtWidgets.QSizePolicy.Preferred)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.JumpButton.sizePolicy().hasHeightForWidth())
        self.JumpButton.setSizePolicy(sizePolicy)
        self.JumpButton.setObjectName("JumpButton")
        self.horizontalLayout_2.addWidget(self.JumpButton)
        self.PreButton = QtWidgets.QPushButton(Form)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Minimum, QtWidgets.QSizePolicy.Preferred)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.PreButton.sizePolicy().hasHeightForWidth())
        self.PreButton.setSizePolicy(sizePolicy)
        self.PreButton.setObjectName("PreButton")
        self.horizontalLayout_2.addWidget(self.PreButton)
        self.NextButton = QtWidgets.QPushButton(Form)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Minimum, QtWidgets.QSizePolicy.Preferred)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.NextButton.sizePolicy().hasHeightForWidth())
        self.NextButton.setSizePolicy(sizePolicy)
        self.NextButton.setObjectName("NextButton")
        self.horizontalLayout_2.addWidget(self.NextButton)
        self.verticalLayout.addLayout(self.horizontalLayout_2)
        self.gridLayout.addLayout(self.verticalLayout, 0, 0, 1, 1)

        self.retranslateUi(Form)
        QtCore.QMetaObject.connectSlotsByName(Form)

    def retranslateUi(self, Form):
        _translate = QtCore.QCoreApplication.translate
        Form.setWindowTitle(_translate("Form", "LMDB查看器"))
        self.openmdbBt.setText(_translate("Form", "打开数据库"))
        self.label.setText(_translate("Form", "LMDB数据库路径："))
        self.Pre_view_Button.setText(_translate("Form", "上一页"))
        self.Next_view_Button.setText(_translate("Form", "下一页"))
        self.SearchButton.setText(_translate("Form", "模糊搜索"))
        self.label_3.setText(_translate("Form", "当前序号:"))
        self.label_2.setText(_translate("Form", "最大序号:"))
        self.label_4.setText(_translate("Form", "加载状态："))
        self.state_label.setText(_translate("Form", "标记状态:"))
        self.state_bt.setText(_translate("Form", "当前标记"))
        self.functionButton.setText(_translate("Form", "功能"))
        self.JumpButton.setText(_translate("Form", "跳转"))
        self.PreButton.setText(_translate("Form", "上一个"))
        self.NextButton.setText(_translate("Form", "下一个"))



# 配置对话框类
class DataConfigDialog(QDialog):
    def __init__(self, keys, config_dict=None, parent=None):
        super().__init__(parent)
        self.setWindowTitle("数据配置")
        self.setWindowModality(QtCore.Qt.ApplicationModal)
        self.layout = QVBoxLayout()
        
        # 数据类型选择
        self.type_group = QGroupBox("数据类型")
        type_layout = QVBoxLayout()
        self.data_type_combo = QComboBox()
        self.data_type_combo.addItems(["点云(Point Cloud)", "网格(Mesh)"])
        type_layout.addWidget(QLabel("选择数据类型:"))
        type_layout.addWidget(self.data_type_combo)
        self.type_group.setLayout(type_layout)
        self.layout.addWidget(self.type_group)
        
        # 顶点配置
        self.vertex_group = QGroupBox("顶点配置")
        vertex_layout = QVBoxLayout()
        vertex_layout.addWidget(QLabel("顶点键名:"))
        self.vertex_key_combo = QComboBox()
        self.vertex_key_combo.addItems(keys)
        vertex_layout.addWidget(self.vertex_key_combo)
        
        vertex_layout.addWidget(QLabel("顶点标签键名 (可选):"))
        self.vertex_label_combo = QComboBox()
        self.vertex_label_combo.addItem("无")
        self.vertex_label_combo.addItems(keys)
        vertex_layout.addWidget(self.vertex_label_combo)
        self.vertex_group.setLayout(vertex_layout)
        self.layout.addWidget(self.vertex_group)
        
        # 面片配置 (仅网格)
        self.face_group = QGroupBox("面片配置 (仅网格)")
        face_layout = QVBoxLayout()
        face_layout.addWidget(QLabel("面片键名:"))
        self.face_key_combo = QComboBox()
        self.face_key_combo.addItems(keys)
        face_layout.addWidget(self.face_key_combo)
        
        face_layout.addWidget(QLabel("面片标签键名 (可选):"))
        self.face_label_combo = QComboBox()
        self.face_label_combo.addItem("无")
        self.face_label_combo.addItems(keys)
        face_layout.addWidget(self.face_label_combo)
        self.face_group.setLayout(face_layout)
        self.face_group.setVisible(False)  # 默认隐藏
        self.layout.addWidget(self.face_group)
        
        # 名称键配置
        self.name_group = QGroupBox("索引配置")
        name_layout = QVBoxLayout()
        name_layout.addWidget(QLabel("索引键名:"))
        self.name_key_combo = QComboBox()
        self.name_key_combo.addItems(keys)
        name_layout.addWidget(self.name_key_combo)
        self.name_group.setLayout(name_layout)
        self.layout.addWidget(self.name_group)
        
        # 按钮
        self.button_box = QDialogButtonBox(QDialogButtonBox.Ok | QDialogButtonBox.Cancel)
        self.button_box.accepted.connect(self.accept)
        self.button_box.rejected.connect(self.reject)
        self.layout.addWidget(self.button_box)
        
        self.setLayout(self.layout)
        
        # 应用传入的配置
        if config_dict:
            self.apply_config(config_dict)
        
        # 连接信号
        self.data_type_combo.currentIndexChanged.connect(self.update_ui)
        # 确保UI状态正确
        self.update_ui()
    
    def apply_config(self, config_dict):
        """应用传入的配置字典到各个控件"""
        # 设置数据类型
        if "data_type" in config_dict:
            index = self.data_type_combo.findText(config_dict["data_type"])
            if index >= 0:
                self.data_type_combo.setCurrentIndex(index)
        
        # 设置顶点键
        if "vertex_key" in config_dict:
            index = self.vertex_key_combo.findText(config_dict["vertex_key"])
            if index >= 0:
                self.vertex_key_combo.setCurrentIndex(index)
        
        # 设置顶点标签键（处理None值）
        vertex_label = config_dict.get("vertex_label_key", "无")
        if vertex_label is None:
            vertex_label = "无"
        index = self.vertex_label_combo.findText(vertex_label)
        if index >= 0:
            self.vertex_label_combo.setCurrentIndex(index)
        
        # 设置面片键（仅网格）
        if "face_key" in config_dict and config_dict["face_key"]:
            index = self.face_key_combo.findText(config_dict["face_key"])
            if index >= 0:
                self.face_key_combo.setCurrentIndex(index)
        
        # 设置面片标签键（处理None值）
        face_label = config_dict.get("face_label_key", "无")
        if face_label is None:
            face_label = "无"
        index = self.face_label_combo.findText(face_label)
        if index >= 0:
            self.face_label_combo.setCurrentIndex(index)
        
        # 设置名称键
        if "name_key" in config_dict:
            index = self.name_key_combo.findText(config_dict["name_key"])
            if index >= 0:
                self.name_key_combo.setCurrentIndex(index)
        
        # 更新UI状态（确保面片组可见性正确）
        self.update_ui()
    
    def update_ui(self):
        """根据数据类型更新UI显示"""
        is_mesh = self.data_type_combo.currentText() == "网格(Mesh)"
        self.face_group.setVisible(is_mesh)
    
    def get_config(self):
        """获取当前配置"""
        config = {
            "data_type": self.data_type_combo.currentText(),
            "vertex_key": self.vertex_key_combo.currentText(),
            "vertex_label_key": self.vertex_label_combo.currentText() if self.vertex_label_combo.currentText() != "无" else None,
            "face_key": self.face_key_combo.currentText() if self.data_type_combo.currentText() == "网格(Mesh)" else None,
            "face_label_key": self.face_label_combo.currentText() if self.face_label_combo.currentText() != "无" and self.data_type_combo.currentText() == "网格(Mesh)" else None,
            "name_key": self.name_key_combo.currentText()
        }
        return config