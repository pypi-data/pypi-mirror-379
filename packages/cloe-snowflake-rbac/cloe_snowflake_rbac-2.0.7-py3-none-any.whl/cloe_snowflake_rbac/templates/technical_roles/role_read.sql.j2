{% set database_name_role = database_name_role_override or database_name %}
{% set role_name = static_role_name_override or 'R_T_' ~ database_name_role ~ '_' ~ schema_name ~ '_READ' -%}
{% if delete_role -%}
DROP ROLE IF EXISTS {{ role_name }};
{% elif create_role -%}
CREATE ROLE IF NOT EXISTS {{ role_name }};
{% elif grant_role -%}
{% if not grants_only -%}
GRANT ROLE {{ role_name }} TO ROLE SYSADMIN;
{% endif -%}
GRANT USAGE ON DATABASE {{ database_name }} TO ROLE {{ role_name }};
GRANT USAGE ON SCHEMA {{ database_name }}.{{ schema_name }} TO ROLE {{ role_name }};
{% for object in [
    'SELECT ON ALL TABLES',
    'SELECT ON FUTURE TABLES',
    'SELECT ON ALL VIEWS',
    'SELECT ON FUTURE VIEWS',
    'SELECT ON ALL MATERIALIZED VIEWS',
    'SELECT ON FUTURE MATERIALIZED VIEWS',
    'SELECT ON ALL EXTERNAL TABLES',
    'SELECT ON FUTURE EXTERNAL TABLES',
    'SELECT ON ALL DYNAMIC TABLES',
    'SELECT ON FUTURE DYNAMIC TABLES'
] -%}
GRANT {{ object }} IN SCHEMA {{ database_name }}.{{ schema_name }} TO ROLE {{ role_name }};
{% endfor %}
GRANT USAGE ON ALL FUNCTIONS IN SCHEMA {{ database_name }}.{{ schema_name }} TO ROLE {{ role_name }};
GRANT USAGE ON FUTURE FUNCTIONS IN SCHEMA {{ database_name }}.{{ schema_name }} TO ROLE {{ role_name }};
{% elif revoke_role -%}
REVOKE USAGE ON DATABASE {{ database_name }} FROM ROLE {{ role_name }};
REVOKE USAGE ON SCHEMA {{ database_name }}.{{ schema_name }} FROM ROLE {{ role_name }};
{% for object in [
    'SELECT ON ALL TABLES',
    'SELECT ON FUTURE TABLES',
    'SELECT ON ALL VIEWS',
    'SELECT ON FUTURE VIEWS',
    'SELECT ON ALL MATERIALIZED VIEWS',
    'SELECT ON FUTURE MATERIALIZED VIEWS',
    'SELECT ON ALL EXTERNAL TABLES',
    'SELECT ON FUTURE EXTERNAL TABLES',
    'SELECT ON ALL DYNAMIC TABLES',
    'SELECT ON FUTURE DYNAMIC TABLES'
] -%}
REVOKE {{ object }} IN SCHEMA {{ database_name }}.{{ schema_name }} FROM ROLE {{ role_name }};
{% endfor %}
REVOKE USAGE ON ALL FUNCTIONS IN SCHEMA {{ database_name }}.{{ schema_name }} FROM ROLE {{ role_name }};
REVOKE USAGE ON FUTURE FUNCTIONS IN SCHEMA {{ database_name }}.{{ schema_name }} FROM ROLE {{ role_name }};
{% endif -%}
