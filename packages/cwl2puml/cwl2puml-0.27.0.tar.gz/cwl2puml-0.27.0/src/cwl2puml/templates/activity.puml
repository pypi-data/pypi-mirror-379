/'
 ' Diagram generated by cwl2puml v{{ version }}
 ' timestamp: {{ timestamp }}
 '/
@startuml
start

{% macro serialize_workflow(workflow) -%}
{% for step in workflow.steps %}
{% if step.when %}if ({{ step.when }}){% endif %}
{% if step.scatter %}repeat{% endif %}
        {% set process = index.get(step.run.split('#')[-1]) %}
        {% if 'Workflow' == process.class_ %}
group {{ process.id }}
            {{ serialize_workflow(process) }}
end group        
        {% else %}
:step: {{ step.id }}
{{ process.class_ }}: {{ process.id }};
        {% endif %}
{% if step.scatter %}repeat while ({{ step.scatterMethod }} {{ step.scatter }}){% endif %}
{% if step.when %}endif{% endif %}
{% endfor %}
{%- endmacro %}

{% set process = index.get(workflow_id) %}
{% if 'Workflow' == process.class_ %}

split
    {% for input in process.inputs %}
    :{{ input.id }}; <<input>>
{% if loop.last %}end {% endif %}split{% if not loop.last %} again{% endif %}
    {% endfor %}

    {{ serialize_workflow(process) }}

split
    {% for output in process.outputs %}
    :{{ output.id }}; <<output>>
{% if loop.last %}end {% endif %}split{% if not loop.last %} again{% endif %}
    {% endfor %}

{% endif %}

stop
@enduml
