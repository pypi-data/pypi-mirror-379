# aionvk

<p align="center">
  <strong>–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π, –±—ã—Å—Ç—Ä—ã–π –∏ —É–¥–æ–±–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–æ–≤ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ –Ω–∞ Python.</strong>
</p>

<p align="center">
  <em>–°–æ–∑–¥–∞–Ω —Å –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ–º –æ—Ç <a href="https://github.com/aiogram/aiogram">aiogram</a>.</em>
</p>

[![PyPI - Version](https://img.shields.io/pypi/v/aionvk)](https://pypi.org/project/aionvk/)
[![Python Versions](https://img.shields.io/pypi/pyversions/aionvk.svg)](https://pypi.org/project/aionvk/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

---

**aionvk** ‚Äî —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –±–æ—Ç–æ–≤ –¥–ª—è VK –ø—Ä–æ—Å—Ç–æ–π –∏ –ø—Ä–∏—è—Ç–Ω–æ–π. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å—Ç—Ä–æ–≥—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ `pydantic`, —á—Ç–æ–±—ã –≤–∞—à –∫–æ–¥ –±—ã–ª –Ω–∞–¥–µ–∂–Ω—ã–º, —á–∏—Ç–∞–µ–º—ã–º –∏ –ª–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–º.

## üöÄ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

*   **–ü–æ–ª–Ω–æ—Å—Ç—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π**: –ü–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `asyncio` –∏ `httpx` –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
*   **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Router` –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ –∏ –º–æ–¥—É–ª–µ–π.
*   **–ú–æ—â–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã, –≤–∫–ª—é—á–∞—è "–º–∞–≥–∏—á–µ—Å–∫–∏–µ" F-–æ–±—ä–µ–∫—Ç—ã –¥–ª—è –ª–∞–∫–æ–Ω–∏—á–Ω—ã—Ö –∏ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫.
*   **–ú–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π (FSM)**: –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ FSM –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â (in-memory, Redis).
*   **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: Pydantic-–º–æ–¥–µ–ª–∏ –¥–ª—è –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ VK API, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –∏ –æ—Ç–ª–∏—á–Ω—ã–π –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç –≤ IDE.
*   **–£–¥–æ–±–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã**: `KeyboardBuilder` –∏ `Paginator` –¥–ª—è –ª–µ–≥–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è inline –∏ reply-–∫–ª–∞–≤–∏–∞—Ç—É—Ä –ª—é–±–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.
*   **–§–∞–±—Ä–∏–∫–∞ Callback-–¥–∞–Ω–Ω—ã—Ö**: –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –±–µ–∑ –≥–æ–ª–æ–≤–Ω–æ–π –±–æ–ª–∏ —Å –ø–∞—Ä—Å–∏–Ω–≥–æ–º —Å—Ç—Ä–æ–∫.

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
pip install aionvk
```

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è FSM —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º Redis:
```bash
pip install aionvk[redis]
```

##  quickstart.py: –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –±–∞–∑–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏: –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞, –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–æ–º–∞–Ω–¥—ã `/start` –∏ –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ inline-–∫–Ω–æ–ø–∫—É.

```python
import asyncio
import os

from aionvk import Bot, Button, Dispatcher, F, KeyboardBuilder, Router
from aionvk.bot import CommandFilter
from aionvk.types import Callback, Message

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ç–æ–∫–µ–Ω–∞
API_TOKEN = os.getenv("VK_BOT_TOKEN", "your_vk_token_here")

# --- –û—Å–Ω–æ–≤–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã ---
bot = Bot(token=API_TOKEN)
dp = Dispatcher()
router = Router()
dp.include_router(router)


# --- –•–µ–Ω–¥–ª–µ—Ä—ã ---
@router.message(CommandFilter("start"))
async def command_start_handler(event: Message):
    """
    –≠—Ç–æ—Ç —Ö–µ–Ω–¥–ª–µ—Ä –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –Ω–∞ –∫–æ–º–∞–Ω–¥—É /start
    """
    kb = KeyboardBuilder(inline=True)
    kb.add(Button.callback("–ù–∞–∂–º–∏ –º–µ–Ω—è!", payload={"command": "button_press"}))
    
    await event.answer(
        "–ü—Ä–∏–≤–µ—Ç! –Ø –ø—Ä–æ—Å—Ç–æ–π –±–æ—Ç –Ω–∞ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–µ aionvk.",
        keyboard=kb.build()
    )


@router.callback(F.payload["command"] == "button_press")
async def button_press_handler(event: Callback):
    """
    –≠—Ç–æ—Ç —Ö–µ–Ω–¥–ª–µ—Ä –ª–æ–≤–∏—Ç –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ inline-–∫–Ω–æ–ø–∫—É
    """
    # –û—Ç–≤–µ—á–∞–µ–º –Ω–∞ –∫–æ–ª–±—ç–∫, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å "—á–∞—Å–∏–∫–∏" —É –∫–Ω–æ–ø–∫–∏
    await event.answer()
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    await bot.send_message(
        peer_id=event.peer_id,
        text="–¢—ã –Ω–∞–∂–∞–ª –Ω–∞ –∫–Ω–æ–ø–∫—É!"
    )


async def main():
    """–§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ long polling."""
    # –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞—à –∫–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ aiohttp webhook
    # –∏–ª–∏ —á–µ—Ä–µ–∑ —Ü–∏–∫–ª long polling. –î–ª—è –ø—Ä–∏–º–µ—Ä–∞, –º—ã –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–µ–¥–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ.
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω... (—ç—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç long polling)")
    # –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ long polling —Ü–∏–∫–ª.


if __name__ == "__main__":
    try:
        asyncio.run(main())
    except (KeyboardInterrupt, SystemExit):
        print("–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.")
```

## üß† –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ø—Ä–∏–º–µ—Ä—ã

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ (FSM)

`aionvk` –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –º–∞—à–∏–Ω—É —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è –≤–µ–¥–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤.

```python
from aionvk.bot import FSMContext, State, StatesGroup
from aionvk.bot.fsm import RedisStorage  # –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
import redis.asyncio as redis

# 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è
class Form(StatesGroup):
    waiting_for_name = State()
    waiting_for_age = State()

# 2. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–≤ main-—Ñ–∞–π–ª–µ)
# storage = RedisStorage(redis.Redis(host='localhost', port=6379))
# dp.setup_fsm(storage)

# 3. –ü–∏—à–µ–º —Ö–µ–Ω–¥–ª–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
@router.message(CommandFilter("form"))
async def start_form(event: Message, state: FSMContext):
    await state.set_state(Form.waiting_for_name)
    await event.answer("–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?")

@router.message(F.text, state=Form.waiting_for_name)
async def process_name(event: Message, state: FSMContext):
    await state.update_data(name=event.text)
    await state.set_state(Form.waiting_for_age)
    await event.answer("–°–∫–æ–ª—å–∫–æ —Ç–µ–±–µ –ª–µ—Ç?")

@router.message(F.text.isdigit(), state=Form.waiting_for_age)
async def process_age(event: Message, state: FSMContext):
    user_data = await state.get_data()
    name = user_data.get("name")
    age = event.text
    
    await event.answer(f"–ü—Ä–∏—è—Ç–Ω–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è, {name}! –¢–µ–±–µ {age} –ª–µ—Ç.")
    
    # –ó–∞–≤–µ—Ä—à–∞–µ–º –¥–∏–∞–ª–æ–≥
    await state.clear()
```

### Inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å `CallbackData`

–ó–∞–±—É–¥—å—Ç–µ –æ —Ä—É—á–Ω–æ–º –ø–∞—Ä—Å–∏–Ω–≥–µ JSON –≤ `payload`. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `CallbackData` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

```python
from aionvk.bot.callback_data import CallbackData

# 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º "—Å—Ö–µ–º—É" –¥–∞–Ω–Ω—ã—Ö
class ItemCallback(CallbackData, prefix="item"):
    action: str  # 'view' –∏–ª–∏ 'delete'
    item_id: int

# 2. –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
def get_item_keyboard(item_id: int) -> str:
    builder = KeyboardBuilder(inline=True)
    builder.add(
        Button.callback("–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å", payload=ItemCallback(action="view", item_id=item_id).pack()),
        Button.callback("–£–¥–∞–ª–∏—Ç—å", payload=ItemCallback(action="delete", item_id=item_id).pack())
    )
    return builder.build()

# 3. –°–æ–∑–¥–∞–µ–º —Ö–µ–Ω–¥–ª–µ—Ä—ã —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
@router.callback(ItemCallback.filter(F.payload.action == "view"))
async def view_item_handler(event: Callback, callback_data: ItemCallback):
    # callback_data - —ç—Ç–æ —É–∂–µ –æ–±—ä–µ–∫—Ç ItemCallback, –∞ –Ω–µ —Å–ª–æ–≤–∞—Ä—å!
    await event.answer(show_snackbar=f"–ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–∞ #{callback_data.item_id}")

@router.callback(ItemCallback.filter(F.payload.action == "delete"))
async def delete_item_handler(event: Callback, callback_data: ItemCallback):
    await event.answer(show_snackbar=f"–£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ #{callback_data.item_id}")
    await event.edit_text("–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω.")
```

### –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã

–ü–∏—à–∏—Ç–µ —Å–ª–æ–∂–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –ª–∞–∫–æ–Ω–∏—á–Ω–æ –∏ —á–∏—Ç–∞–µ–º–æ —Å –ø–æ–º–æ—â—å—é `F`-–æ–±—ä–µ–∫—Ç–æ–≤.

```python
from aionvk import F

# –°—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ, –≥–¥–µ –µ—Å—Ç—å –≤–ª–æ–∂–µ–Ω–∏–µ —Ç–∏–ø–∞ "—Ñ–æ—Ç–æ"
@router.message(F.attachments[0].type == "photo")
async def photo_handler(event: Message):
    await event.answer("–Ø –≤–∏–∂—É —Ñ–æ—Ç–æ!")

# –°—Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç "–ø—Ä–∏–≤–µ—Ç" –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑ –†–æ—Å—Å–∏–∏
@router.message(
    (F.text.lower() == "–ø—Ä–∏–≤–µ—Ç") &
    (F.client_info.lang_id.is_in([0, 100]))  # 0 - RU, 100 - RU (–Ω–æ–≤—ã–µ –∫–ª–∏–µ–Ω—Ç—ã)
)
async def russian_hello_handler(event: Message):
    await event.answer("–ü—Ä–∏–≤–µ—Ç, —Å–æ–æ—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫!")
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT.