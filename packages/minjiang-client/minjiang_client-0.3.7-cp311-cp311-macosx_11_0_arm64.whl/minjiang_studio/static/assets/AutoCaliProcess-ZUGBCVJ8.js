import{C as Y}from"./CommingSoon-DCVPuohD.js";import{d as $,e as _,f as r,h as x,a2 as H,b as Q,C as W,r as p,J as X,a4 as Z,a8 as j,aY as M,ak as ee,ab as P,ac as te,z as R,a6 as q,l as e,i as g,t as y,w as I,s as B,af as h,ae as se,j as ae,N as oe,E as L,a7 as re}from"./index-CGjyaFmR.js";import{b as ne,c as le}from"./autoCali-C0_V8sAA.js";import{u as F}from"./useInterval-D6Sc1Alh.js";import{D as ie,_ as ce}from"./DotLoader-DHYQtk7K.js";import"./dayjs.min-DyrhdSLk.js";const de={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ue=$({name:"ChevronDown",render:function(T,f){return r(),_("svg",de,f[0]||(f[0]=[x("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 184l144 144l144-144"},null,-1)]))}}),_e={class:"flex p-5"},fe={class:"pr-10"},me=["onClick"],ve={class:"flex-1 break-all"},pe={key:0,class:"flex items-center justify-between pt-2"},ge={class:"flex flex-1 items-center flex-col"},he={key:0,class:"flex gap-2 items-center mb-5 text-lg"},Re=$({__name:"AutoCaliProcess",setup(J){const T=H(),{t:f}=Q(),S=W(),k=p(),l=p(),n=X(()=>{var a;return(a=k.value)==null?void 0:a.find(o=>o.node_id===l.value)}),m=p(!0),i=p(),w=p(!1),v=p(0),b=async()=>{var d,u,N,c,s,C,U,V;m.value=!0;const a={node_id:l.value,session_id:+S.query.session_id,last_record_id:v.value},[o,t]=await ne(a);w.value=!1,!o&&(t==null?void 0:t.status)===0&&(((u=(d=t.data)==null?void 0:d.logs)==null?void 0:u.find(z=>{if(typeof z.msg=="string")return z.msg.includes("COMPLETE")}))?(G(),m.value=!1,v.value!==t.data.last_record_id&&t.data.last_record_id&&(i.value=[...(N=t.data)==null?void 0:N.logs.reverse(),...i.value||[]]),t.data.last_record_id&&(v.value=t.data.last_record_id),((c=n.value)==null?void 0:c.status)==="RUNNING"&&A()):(v.value!==t.data.last_record_id&&t.data.last_record_id&&(i.value=[...(s=t.data)==null?void 0:s.logs.reverse(),...i.value||[]]),t.data.last_record_id&&(v.value=t.data.last_record_id),!D.value&&((C=n.value)==null?void 0:C.status)==="RUNNING"&&(E(),m.value=!0),((U=n.value)==null?void 0:U.status)!=="RUNNING"&&D.value&&(G(),b()),((V=n.value)==null?void 0:V.status)!=="RUNNING"&&(m.value=!1)))},A=async()=>{var t,d,u;const[a,o]=await le({session_id:+S.query.session_id});!a&&(o==null?void 0:o.status)===0&&(k.value=o.data,(t=o.data)!=null&&t.find(c=>c.node_id===l.value)||(l.value=(d=o.data[0])==null?void 0:d.node_id,M(()=>{b()})),(u=o.data)!=null&&u.find(c=>c.status=="RUNNING")||K())},{start:E,stop:G,runing:D}=F(b,{isManual:!0,duration:3e3}),{stop:K}=F(A,{duration:10*1e3});Z(n,a=>{j(a)||M(()=>{a.status===ee.RUNNING&&!D.value&&(E(),m.value=!0)})});const O=a=>{w.value||(w.value=!0,i.value=void 0,l.value=a,v.value=0,b())};return(a,o)=>{const t=se,d=ae,u=oe,N=Y,c=re;return r(),_("div",_e,[x("div",fe,[(r(!0),_(P,null,te(e(k),(s,C)=>(r(),_("div",{key:s.node_id,class:"cursor-pointer"},[x("div",{class:"px-2 pb-2 pt-2.5 w-full max-w-96 border text-center min-w-72 flex items-center",style:q({borderTopLeftRadius:"40px",borderBottomLeftRadius:"40px",borderTopRightRadius:"100px",borderBottomRightRadius:"100px",backgroundColor:e(l)===s.node_id?"rgba(0, 180, 42, 0.15)":"inherit",borderColor:e(l)===s.node_id?"rgb(0, 180, 42)":"#999A9B",color:e(l)===s.node_id?e(T).primaryColor:"inherit"}),onClick:()=>O(s.node_id)},[x("span",ve,y(s.node_name),1),g(t,{size:"tiny",round:"",class:"!h-[22.4px] !rounded-full !w-20 !flex !items-center !justify-center",color:{color:e(h)[s.status].color}},{default:I(()=>[B(y(e(f)(e(h)[s.status].text)),1)]),_:2},1032,["color"])],12,me),C<e(k).length-1?(r(),_("div",pe,[x("div",ge,[g(d,{class:"!h-10 !bg-[#999A9B]",vertical:""}),g(u,{class:"-mt-2",color:"#999A9B",component:e(ue)},null,8,["component"])]),g(t,{size:"tiny",round:"",class:"!h-[22.4px] !rounded-full invisible !w-20",color:{color:e(h)[s.status].color}},{default:I(()=>[B(y(e(f)(e(h)[s.status].text)),1)]),_:2},1032,["color"])])):R("",!0)]))),128))]),x("div",{class:"border-l pl-10 flex-1",style:q({borderColor:e(T).dividerColor})},[g(c,{style:{height:"calc(100vh - 335px)"}},{default:I(()=>{var s;return[e(j)(e(n))?R("",!0):(r(),_("div",he,[B(y((s=e(n))==null?void 0:s.node_name)+" ",1),g(t,{size:"tiny",color:{color:e(h)[e(n).status].color}},{default:I(()=>[B(y(e(f)(e(h)[e(n).status].text)),1)]),_:1},8,["color"]),e(m)?(r(),L(ie,{key:0})):R("",!0)])),Array.isArray(e(i))&&e(i).length===0?(r(),L(N,{key:1,class:"h-full"})):(r(),_(P,{key:2},[e(w)?R("",!0):(r(),L(ce,{key:0,logs:e(i)},null,8,["logs"]))],64))]}),_:1})],4)])}}});export{Re as default};
