import"../chunks/DsnmJJEf.js";import{o as Ye}from"../chunks/B98B7x2v.js";import{p as qe,s as c,b as ne,u as B,g as e,l as _,d as q,t as Ne,j as a,o as Ge,e as x,h as N,f as k,a as g,i as Je,n as se,m as Qe,r as Xe,c as G}from"../chunks/BZ0BXH4m.js";import{i as T,b as Pe}from"../chunks/CUAkeMiK.js";import{T as et}from"../chunks/BNVSwCFn.js";import{d as tt,F as rt,n as at,e as ge,r as lt,b as _e,S as ot,c as ie,t as fe}from"../chunks/B_jXps8r.js";import{A as $e}from"../chunks/adaaFKwn.js";import{B as je}from"../chunks/CquIFjLW.js";import{D as me}from"../chunks/Bxbeg6fW.js";import{u as nt,g as ve}from"../chunks/B9BLuPDP.js";var st=x("<!> <!> <!>",1),it=x("<!> <!> <!>",1),ut=x("<!> <!>",1),dt=x("<!> <!>",1),ct=x('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),gt=x('<div class="text-center">No technologies with this selection.</div>'),_t=x('<div class="text-center">No carriers with this selection.</div>'),ft=x('<div class="text-center">No solution selected.</div>'),mt=x('<div class="text-center">No locations with this selection.</div>'),vt=x('<div class="text-center">No data available for this selection.</div>'),pt=x("<!> <!>",1),ht=x('<h1 class="mt-2 mb-4">The Energy Balance &ndash; Storage</h1> <!> <div class="mt-4 plot"><!></div>',1);function Pt(Ae,De){qe(De,!0);let y=null,J=null,Q=null,X=null,ee=null,te=c(0),pe=c(ne({})),I=c(ne([]));const Te=["Hourly","Daily","Weekly","Monthly"];let s=c(null),v=c(null),S=c(""),L=c("Hourly"),R=c(!0),P=c(ne([])),$=c(ne([])),E=c(!1),j=c(!1),V=c(void 0),Z=c(void 0),he=_(()=>e(O).length>0?e(pe)[e(O)[0]]:""),be=_(()=>{if(!e(s)||!e(s).solution_name)return"";let r=e(s).solution_name.split(".");return[r[r.length-1],e(s).scenario_name,"storage_level",e(v)].join("_")}),Ie=_(()=>e(be)+"_flows"),Le=_(()=>we("Storage Level",r=>e(Z)?.zoom_rect(r.chart.scales.x.min,r.chart.scales.x.max))),Re=_(()=>we("Storage Flow",r=>e(V)?.zoom_rect(r.chart.scales.x.min,r.chart.scales.x.max)));function we(r,t){return{animation:!1,normalized:!0,parsing:!1,elements:{point:{radius:0},line:{borderWidth:1}},responsive:!0,scales:{x:{type:"linear",stacked:!0,title:{display:!0,text:"Time"},ticks:{maxRotation:0,autoSkip:!0,callback:n=>Number(n).toFixed(0)},min:0,max:e(s)?.detail?.system.unaggregated_time_steps_per_year},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:`${r} [${e(he)}]`}}},plugins:{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x",onPanComplete:t},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x",onZoomComplete:t},limits:{x:{minRange:10,min:"original",max:"original"}}},tooltip:{callbacks:{label:n=>`${n.dataset.label}: ${n.formattedValue} ${e(he)}`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}}let K=_(()=>(e(te),y?ge(y.map(r=>r.index.node)).sort():[])),M=_(()=>{if(e(te),!y||!e(s))return[];let r=Array.from(y.map(t=>t.index.technology));return ge(y.filter(t=>r.includes(t.index.technology)).map(t=>e(s).detail.reference_carrier[t.index.technology]))}),O=_(()=>(e(te),!y||!e(s)||e(M).length===0?[]:ge(y.map(t=>t.index.technology)).filter(t=>e(s).detail.reference_carrier[t]==e(v))));B(()=>{e(O),q(()=>{a(P,e(O),!0)})}),B(()=>{e(K),q(()=>{a($,e(K),!0)})}),B(()=>{e(M),q(()=>{e(M).length>0&&(!e(v)||!e(M).includes(e(v)))&&(a(v,e(M)[0],!0),ae())})}),B(()=>{e(I),q(()=>{e(I).length>0&&(!e(S)||!e(I).includes(Number(e(S))))&&(a(S,e(I)[0].toString(),!0),ae())})}),B(()=>{e(v),e(R),e(P),e($),q(ae)}),Ye(()=>{a(v,ve("car")||e(v),!0),a(S,ve("year")||e(S),!0),a(L,ve("window")||e(L),!0)}),B(()=>{e(S),e(v),e(L),Ne().then(()=>{nt({year:e(S),car:e(v),window:e(L)})})}),B(()=>{Ee()});async function Ee(){if(e(s)===null||!e(S))return;a(j,!0);let r={Daily:24,Weekly:168,Monthly:720}[e(L)]||1;const t=await tt(e(s).solution_name,["storage_level","flow_storage_charge","flow_storage_discharge","flow_storage_spillage","flow_storage_inflow"],e(s).scenario_name,"storage_level",Number(e(S)),r);y=t.components.storage_level||null,J=t.components.flow_storage_charge||null,Q=t.components.flow_storage_discharge||null,X=t.components.flow_storage_spillage||null,ee=t.components.flow_storage_inflow||null,Ge(te),t.unit?.data&&a(pe,Object.fromEntries(t.unit.data.map(n=>[n.technology,n[0]||n.units])),!0),a(j,!1),ae()}let xe=_(()=>Array.from({length:e(ye)},(r,t)=>t.toString())),re=[],ue=[],de=c(0),Me=c(0),ye=c(0);function We(){return e($).length==0||e(P).length==0||!y||!J||!Q||!ee||!X?[]:Se(y,{technology:e(P),node:e($)},e(R)?["technology"]:[],e(R)?void 0:()=>({label:"Storage Level",borderColor:"rgb(0, 0, 0)",backgroundColor:"rgba(0, 0, 0, 0.2)"}))}function Be(){return e(s)===null||e(j)||e($).length==0||e(P).length==0||!y||!J||!Q||!ee||!X?[]:[{data:J,label_suffix:"_charge",label_aggregated:"Flow Storage Charge",negate:!1,color:"rgb(54, 162, 235)"},{data:Q,label_suffix:"_discharge",label_aggregated:"Flow Storage Discharge",negate:!0,color:"rgb(255, 99, 132)"},{data:ee,label_suffix:"_inflow",label_aggregated:"Flow Storage Inflow",negate:!1,color:"rgb(75, 192, 192)"},{data:X,label_suffix:"_spillage",label_aggregated:"Flow Storage Spillage",negate:!0,color:"rgb(255, 99, 132)"}].flatMap(({data:r,label_suffix:t,label_aggregated:n,negate:A,color:D})=>Se(r,{technology:e(P),node:e($)},e(R)?["technology"]:[],e(R)?o=>({label:o.index.column+t}):()=>({label:n,borderColor:D,backgroundColor:D}),o=>A?-o:o))}async function ae(){lt(),re=We(),ue=Be(),a(de,re.length,!0),a(Me,ue.length,!0),a(ye,e(de)>0?re[0].data.length:0,!0),await Ne(),e(V)&&e(V).updateChart(re),e(Z)&&e(Z).updateChart(ue)}function Se(r,t,n,A=()=>({}),D=o=>o){let o=r.filter(l=>Object.entries(t).every(([i,u])=>u.includes(l.index[i]))).map(l=>({index:l.index,data:l.data.map(D)}));if(o.length===0)return[];if(n){const l=Array.isArray(n)?n:[0],i={};o.forEach(u=>{const d=l.map(f=>u.index[f]).join("_");i[d]||(i[d]=new Array(u.data.length).fill(0)),u.data.forEach((f,p)=>{i[d][p]+=f})}),o=Object.entries(i).map(([u,d])=>({index:{column:u},data:d}))}return o.map(l=>{const i=A(l),u=i.borderColor||at();return{...i,data:l.data.map((d,f)=>({x:f,y:d})),label:i.label||l.index.column,type:"line",fill:"origin",stepped:!0,borderColor:u,backgroundColor:i.backgroundColor||u}})}var ke=ht(),Ce=N(k(ke),2);rt(Ce,{children:(r,t)=>{var n=dt(),A=k(n);_e(A,{title:"Solution Selection",children:(l,i)=>{{let u=_(()=>e(j)||e(E));ot(l,{get disabled(){return e(u)},get selected_solution(){return e(s)},set selected_solution(d){a(s,d,!0)},get loading(){return e(E)},set loading(d){a(E,d,!0)},get years(){return e(I)},set years(d){a(I,d,!0)}})}}});var D=N(A,2);{var o=l=>{var i=ut(),u=k(i);_e(u,{title:"Variable Selection",children:(p,le)=>{var Y=st(),W=k(Y);ie(W,{label:"Year",content:(b,F=se)=>{{let m=_(()=>fe(e(I).map(z=>z.toString()))),w=_(()=>e(j)||e(E));me(b,{get formId(){return F()},get options(){return e(m)},get disabled(){return e(w)},get value(){return e(S)},set value(z){a(S,z,!0)}})}}});var h=N(W,2);ie(h,{label:"Carrier",content:(b,F=se)=>{{let m=_(()=>fe(e(M))),w=_(()=>e(j)||e(E));me(b,{get formId(){return F()},get options(){return e(m)},get disabled(){return e(w)},get value(){return e(v)},set value(z){a(v,z,!0)}})}}});var C=N(h,2);ie(C,{label:"Smoothing Window Size",content:(b,F=se)=>{{let m=_(()=>fe(Te)),w=_(()=>e(j)||e(E));me(b,{get formId(){return F()},get options(){return e(m)},get disabled(){return e(w)},get value(){return e(L)},set value(z){a(L,z,!0)}})}}}),g(p,Y)}});var d=N(u,2);{var f=p=>{_e(p,{title:"Data Selection",children:(le,Y)=>{var W=it(),h=k(W);ie(h,{label:"Technology Subdivision",content:(F,m=se)=>{et(F,{get formId(){return m()},get value(){return e(R)},set value(w){a(R,w,!0)}})}});var C=N(h,2);$e(C,{label:"Technologies",get elements(){return e(O)},get value(){return e(P)},set value(b){a(P,b,!0)}});var H=N(C,2);$e(H,{label:"Nodes",get elements(){return e(K)},get value(){return e($)},set value(b){a($,b,!0)}}),g(le,W)}})};T(d,p=>{e(v)&&e(K).length>0&&p(f)})}g(l,i)};T(D,l=>{e(s)&&l(o)})}g(r,n)}});var Fe=N(Ce,2),Oe=Qe(Fe);{var He=r=>{var t=ct();g(r,t)},Ue=r=>{var t=G(),n=k(t);{var A=o=>{var l=gt();g(o,l)},D=o=>{var l=G(),i=k(l);{var u=f=>{var p=_t();g(f,p)},d=f=>{var p=G(),le=k(p);{var Y=h=>{var C=ft();g(h,C)},W=h=>{var C=G(),H=k(C);{var b=m=>{var w=mt();g(m,w)},F=m=>{var w=G(),z=k(w);{var Ve=U=>{var oe=vt();g(U,oe)},Ze=U=>{var oe=pt(),ze=k(oe);Pe(je(ze,{id:"level_chart",type:"line",get labels(){return e(xe)},datasets:[],get options(){return e(Le)},get plot_name(){return e(be)},zoom:!0}),ce=>a(V,ce,!0),()=>e(V));var Ke=N(ze,2);Pe(je(Ke,{id:"flow_chart",type:"line",get labels(){return e(xe)},datasets:[],get options(){return e(Re)},get plot_name(){return e(Ie)},zoom:!0}),ce=>a(Z,ce,!0),()=>e(Z)),g(U,oe)};T(z,U=>{e(de)==0?U(Ve):U(Ze,!1)},!0)}g(m,w)};T(H,m=>{e(K).length==0?m(b):m(F,!1)},!0)}g(h,C)};T(le,h=>{e(s)==null?h(Y):h(W,!1)},!0)}g(f,p)};T(i,f=>{e(M).length==0?f(u):f(d,!1)},!0)}g(o,l)};T(n,o=>{e(O).length==0?o(A):o(D,!1)},!0)}g(r,t)};T(Oe,r=>{e(E)||e(j)?r(He):r(Ue,!1)})}Xe(Fe),g(Ae,ke),Je()}export{Pt as component};
