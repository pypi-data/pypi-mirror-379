import"../chunks/DsnmJJEf.js";import{o as he}from"../chunks/B98B7x2v.js";import{p as ye,s as g,b as Q,u as M,g as e,d as B,t as ne,e as N,h as P,f as L,a as R,i as we,j as a,k as xe,l as m,n as H,m as ke,r as $e,c as Se}from"../chunks/BZ0BXH4m.js";import{i as X,b as je}from"../chunks/CUAkeMiK.js";import{F as ze,g as Ce,a as De,r as Oe,b as le,S as Pe,c as T,t as U,n as Re}from"../chunks/B_jXps8r.js";import{D as K}from"../chunks/Bxbeg6fW.js";import{B as Fe}from"../chunks/CquIFjLW.js";import{g as h}from"../chunks/CqS7hfz2.js";import{u as Ie,g as V}from"../chunks/B9BLuPDP.js";var Me=N("<!> <!> <!> <!>",1),Ne=N("<!> <!>",1),Ee=N('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),We=N('<div class="text-center">No data with this selection.</div>'),Ae=N('<h1 class="mt-2 mb-4">The Energy Balance &ndash; Nodal</h1> <!> <div class="mt-4"><!></div>',1);function qe(oe,se){ye(se,!0);let Y=null,F=g(null),p=g(!1),f=g(!1),E=g(void 0),y=g(Q([])),w=g(Q([])),x=g(Q([]));const ie=U(["Hourly","Daily","Weekly","Monthly"]);let o=g(null),i=g(null),u=g(null),c=g(null),b=g("Hourly"),ue=m(()=>{if(!e(o)||!e(o).solution_name)return"";let t=e(o).solution_name.split(".");return[t[t.length-1],e(o).scenario_name,"balance",e(u),e(i),e(c)].join("_")}),ee=m(()=>{if(e(F)===null)return"";let t=e(F).data.find(l=>l.carrier===e(u));return t?t[0]||t.units||"":e(F).data[0][0]||e(F).data[0].units||""});const de=m(()=>({animation:!1,normalized:!0,parsing:!1,responsive:!0,borderWidth:1,elements:{point:{radius:0}},scales:{x:{type:"linear",stacked:!0,title:{display:!0,text:"Time"},ticks:{maxRotation:0,autoSkip:!0,callback:t=>Number(t).toFixed(0)},min:0,max:e(o)?.detail?.system.unaggregated_time_steps_per_year},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:`Energy [${e(ee)}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"},plugins:{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x"},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x"},limits:{x:{minRange:10,min:"original",max:"original"}}},tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue} ${e(ee)}`}}}}));M(()=>{e(x),B(()=>{e(x).length>0&&(e(c)==null||!e(x).includes(Number(e(c))))&&a(c,e(x)[0].toString(),!0)})}),M(()=>{e(y),B(()=>{e(y).length>0&&(e(i)==null||!e(y).includes(e(i)))&&a(i,e(y)[0],!0)})}),M(()=>{e(w),B(()=>{e(w).length>0&&(e(u)==null||!e(w).includes(e(u)))&&a(u,e(w)[0],!0)})}),M(()=>{e(o),e(c),e(i),e(u),e(b),B(ge)}),he(()=>{a(c,V("year")||e(c),!0),a(i,V("node")||e(i),!0),a(u,V("car")||e(u),!0),a(b,V("window")||e(b),!0)}),M(()=>{e(c),e(i),e(u),e(b),ne().then(()=>{Ie({year:e(c),node:e(i),car:e(u),window:e(b)})})});let ce=m(()=>({Daily:24,Weekly:168,Monthly:720})[e(b)]||1);async function ge(){e(i)==null||e(u)==null||e(c)==null||e(o)==null||(a(f,!0),await(async t=>{var l=xe(t,2);Y=l[0],a(F,l[1],!0)})(await Promise.all([Ce(e(o).solution_name,e(i),e(u),e(o).scenario_name,Number(e(c)),e(ce)),De(e(o).solution_name,h("flow_export",e(o).version),e(o).scenario_name)])),a(f,!1),pe())}let me=m(()=>Array.from({length:e(q)},(t,l)=>l.toString())),W=[],Z=g(0),q=g(0);function _e(){return!e(o)||!e(i)||!e(u)||!e(c)||!Y?[]:Object.entries(Y).flatMap(([t,l])=>{if(!l||l.length===0)return[];let k={node:[e(i)]};"technology"in l[0].index&&(k={technology:l.map(r=>r.index.technology)});const D=l.filter(r=>Object.entries(k).every(([n,s])=>s.includes(r.index[n]))),v={};return D.forEach(r=>{const n=r.index.technology||r.index.node||r.index.label||"";v[n]||(v[n]=new Array(r.data.length).fill(0)),r.data.forEach((s,O)=>{v[n][O]+=s})}),Object.entries(v).map(([r,n])=>{if(Object.keys(n).length==0)return null;const s=e(o).version,O={[h("flow_storage_discharge",s)]:_=>_+" (discharge)",[h("flow_transport_in",s)]:_=>_+" (transport in)",[h("flow_import",s)]:()=>"Import",[h("shed_demand",s)]:()=>"Shed Demand",[h("flow_storage_charge",s)]:_=>_+" (charge)",[h("flow_transport_out",s)]:_=>_+" (transport out)",[h("flow_export",s)]:()=>"Export"};let d=Re(),A=d,I=Object.values(n).map((_,G)=>({x:G,y:_}));return t=="demand"?{data:I,label:"Demand",type:"line",stack:"ownCustomStack",fill:!1,borderColor:"black",backgroundColor:"white",borderWidth:2,stepped:!0,pointRadius:Object.keys(n).length==1?2:0}:{data:I,label:O[t]?.(r)||r,fill:"origin",borderColor:d,backgroundColor:A,stepped:!0,cubicInterpolationMode:"monotone",pointRadius:Object.keys(n).length==1?2:0}}).filter(r=>r!==null)})}async function pe(){Oe(),W=_e(),a(Z,W.length,!0),a(q,e(Z)>0?W[0].data.length:0,!0),await ne(),e(E)&&e(E).updateChart(W)}var te=Ae(),re=P(L(te),2);ze(re,{children:(t,l)=>{var k=Ne(),D=L(k);le(D,{title:"Solution Selection",children:(n,s)=>{{let O=m(()=>e(f)||e(p));Pe(n,{get disabled(){return e(O)},get selected_solution(){return e(o)},set selected_solution(d){a(o,d,!0)},get carriers(){return e(w)},set carriers(d){a(w,d,!0)},get nodes(){return e(y)},set nodes(d){a(y,d,!0)},get years(){return e(x)},set years(d){a(x,d,!0)},get loading(){return e(p)},set loading(d){a(p,d,!0)}})}}});var v=P(D,2);{var r=n=>{le(n,{title:"Data Selection",children:(s,O)=>{var d=Me(),A=L(d);T(A,{label:"Year",content:($,S=H)=>{{let j=m(()=>U(e(x).map(C=>C.toString()))),z=m(()=>e(f)||e(p));K($,{get formId(){return S()},get options(){return e(j)},get disabled(){return e(z)},get value(){return e(c)},set value(C){a(c,C,!0)}})}}});var I=P(A,2);T(I,{label:"Node",content:($,S=H)=>{{let j=m(()=>U(e(y))),z=m(()=>e(f)||e(p));K($,{get formId(){return S()},get options(){return e(j)},get disabled(){return e(z)},get value(){return e(i)},set value(C){a(i,C,!0)}})}}});var _=P(I,2);T(_,{label:"Carrier",content:($,S=H)=>{{let j=m(()=>U(e(w))),z=m(()=>e(f)||e(p));K($,{get formId(){return S()},get options(){return e(j)},get disabled(){return e(z)},get value(){return e(u)},set value(C){a(u,C,!0)}})}}});var G=P(_,2);T(G,{label:"Smoothing Window Size",content:($,S=H)=>{{let j=m(()=>e(f)||e(p));K($,{get formId(){return S()},get options(){return ie},get disabled(){return e(j)},get value(){return e(b)},set value(z){a(b,z,!0)}})}}}),R(s,d)}})};X(v,n=>{!e(p)&&e(o)&&n(r)})}R(t,k)}});var ae=P(re,2),fe=ke(ae);{var be=t=>{var l=Ee();R(t,l)},ve=t=>{var l=Se(),k=L(l);{var D=r=>{var n=We();R(r,n)},v=r=>{{let n=m(()=>e(q)==1?"bar":"line");je(Fe(r,{get type(){return e(n)},get options(){return e(de)},get labels(){return e(me)},datasets:[],get plot_name(){return e(ue)},zoom:!0}),s=>a(E,s,!0),()=>e(E))}};X(k,r=>{e(Z)==0?r(D):r(v,!1)},!0)}R(t,l)};X(fe,t=>{e(f)?t(be):t(ve,!1)})}$e(ae),R(oe,te),we()}export{qe as component};
