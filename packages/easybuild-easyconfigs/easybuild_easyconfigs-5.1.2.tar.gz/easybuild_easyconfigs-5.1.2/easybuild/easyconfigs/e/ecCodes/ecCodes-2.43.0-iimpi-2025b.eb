easyblock = 'CMakeMake'

name = 'ecCodes'
version = '2.43.0'

homepage = 'https://software.ecmwf.int/wiki/display/ECC/ecCodes+Home'
description = """ecCodes is a package developed by ECMWF which provides an application programming interface and
 a set of tools for decoding and encoding messages in the following formats: WMO FM-92 GRIB edition 1 and edition 2,
 WMO FM-94 BUFR edition 3 and edition 4, WMO GTS abbreviated header (only decoding)."""

toolchain = {'name': 'iimpi', 'version': '2025b'}
toolchainopts = {'usempi': False}

source_urls = ['https://github.com/ecmwf/eccodes/archive/refs/tags/']
sources = [{'download_filename': '%(version)s.tar.gz', 'filename': '%(namelower)s-%(version)s.tar.gz'}]
patches = ['ecCodes-2.43.0_fix-conflicting-types-sigsetjmp.patch']
checksums = [
    {'eccodes-2.43.0.tar.gz': '0bb61719b233ef75c69acc1302454727281cd949ff226d44c533204dbfbf2dda'},
    {'ecCodes-2.43.0_fix-conflicting-types-sigsetjmp.patch':
     '993edc8c2143741a633ba5fbe7cfa8348c28222b98a59fb37ff8c34eb80c0967'},
]

builddependencies = [
    ('CMake', '4.0.3'),
    ('ecBuild', '3.11.0'),
]
dependencies = [
    ('netCDF', '4.9.3'),
    ('JasPer', '4.2.8'),
    ('libjpeg-turbo', '3.1.1'),
    ('libpng', '1.6.50'),
    ('zlib', '1.3.1'),
    ('libaec', '1.1.4'),
]

configopts = "-DENABLE_NETCDF=ON -DENABLE_PNG=ON -DENABLE_JPG=ON "
configopts += "-DENABLE_JPG_LIBJASPER=ON -DENABLE_ECCODES_THREADS=ON"


sanity_check_paths = {
    'files': ['bin/bufr_compare', 'bin/bufr_copy', 'bin/bufr_dump', 'bin/bufr_filter', 'bin/bufr_get', 'bin/bufr_ls',
              'bin/grib_compare', 'bin/grib_copy', 'bin/grib_dump', 'bin/grib_filter', 'bin/grib_get', 'bin/grib_ls',
              'bin/gts_compare', 'bin/gts_copy', 'bin/gts_dump', 'bin/gts_filter', 'bin/gts_get', 'bin/gts_ls',
              'bin/metar_compare', 'bin/metar_copy', 'bin/metar_dump', 'bin/metar_filter', 'bin/metar_get',
              'bin/metar_ls', 'bin/codes_count', 'bin/codes_info', 'bin/codes_split_file',
              'lib/libeccodes_f90.%s' % SHLIB_EXT, 'lib/libeccodes.%s' % SHLIB_EXT],
    'dirs': ['include'],
}

moduleclass = 'tools'
