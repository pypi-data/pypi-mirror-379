easyblock = 'ConfigureMake'

name = 'GAlib'
version = '2.4.7'
local_short_version = version.replace('.', '')

homepage = 'https://web.mit.edu/galib'
description = """GAlib is a set of C++ genetic algorithm objects.
The library includes tools for using genetic algorithms to do optimization in any C++ program.
"""

toolchain = {'name': 'GCC', 'version': '14.3.0'}
toolchainopts = {'pic': True, 'extra_cxxflags': '-fpermissive', 'cstd': 'c++98'}

source_urls = ['http://lancet.mit.edu/ga/dist/']
sources = [f'%(namelower)s{local_short_version}.tgz']
checksums = ['ea76b66ce4db4db2ed86e20d6d3ff144abaf73e33620104246639d9b2a465329']

skipsteps = ['configure']

prebuildopts = "sed -i -e 's|-g -Wall|-Wall|g' "
prebuildopts += "-e 's|DESTDIR=.*|DESTDIR=%(installdir)s|g' makevars && "
build_cmd_targets = 'lib'
buildopts = 'CXXFLAGS="$CXXFLAGS"'

test_cmd = 'make test CXX="$CXX -std=gnu++98 -fpermissive"'

preinstallopts = "mkdir -p %(installdir)s/lib %(installdir)s/include && "
install_cmd = (
    'make -C ga install HDR_DEST_DIR=%(installdir)s/include LIB_DEST_DIR=%(installdir)s/lib CXXFLAGS="$CXXFLAGS"'
)
sanity_check_paths = {
    'files': ['lib/libga.a'],
    'dirs': ['include/ga'],
}

moduleclass = 'tools'
