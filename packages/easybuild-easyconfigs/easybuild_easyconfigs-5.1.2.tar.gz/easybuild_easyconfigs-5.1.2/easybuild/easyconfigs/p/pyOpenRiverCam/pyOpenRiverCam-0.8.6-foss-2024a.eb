easyblock = 'PythonBundle'

name = 'pyOpenRiverCam'
version = '0.8.6'

homepage = 'https://github.com/localdevices/pyorc'
description = """
Surface velocity, object tracking, and river flow measurements in an open-source API
"""

toolchain = {'name': 'foss', 'version': '2024a'}

builddependencies = [
    ('poetry', '1.8.3'),
    ('Cython', '3.0.10'),  # for rastrerio
]

dependencies = [
    ('Python', '3.12.3'),
    ('SciPy-bundle', '2024.05'),
    ('Python-bundle-PyPI', '2024.06'),
    ('scikit-build', '0.17.6'),
    ('GDAL', '3.10.0'),
    ('matplotlib', '3.9.2'),  # plot extra
    ('boto3', '1.35.36'),  # s3 extra
    ('dask', '2024.9.1'),
    ('geopandas', '1.0.1'),  # maplotlib
    ('netcdf4-python', '1.7.1.post2'),
    ('numba', '0.60.0'),
    ('pyproj', '3.7.0'),
    ('PyYAML', '6.0.2'),
    ('scikit-image', '0.25.0'),
    ('tqdm', '4.66.5'),
    ('xarray', '2024.11.0'),
    ('OpenCV', '4.11.0', '-contrib'),
]

exts_list = [
    ('descartes', '1.1.0', {
        'checksums': ['135a502146af5ed6ff359975e2ebc5fa4b71b5432c355c2cafdc6dea1337035b'],
    }),
    ('ffpiv', '0.1.3', {
        'checksums': ['551626db1b1ff3a40f3ecc2d25875d9bc70ec1d91a127925c7e48b2b4af2e832'],
    }),
    ('geojson', '3.2.0', {
        'checksums': ['b860baba1e8c6f71f8f5f6e3949a694daccf40820fa8f138b3f712bd85804903'],
    }),
    ('numpy-groupies', '0.11.3', {
        'source_tmpl': 'numpy_groupies-%(version)s.tar.gz',
        'checksums': ['aed4afdad55e856b9e737fe4b4673c77e47c2f887c3663a18baaa200407c23e0'],
    }),
    ('flox', '0.10.4', {
        'checksums': ['2ccb6b497607857cfa68917584c5850005b27bf4748abdc24c106b10d5ce9056'],
    }),
    # OpenPIV needs importlib_resources==5.12.0
    ('importlib-resources', '5.12.0', {
        'sources': ['importlib_resources-%(version)s.tar.gz'],
        'checksums': ['4be82589bf5c1d7999aedf2a45159d10cb3ca4f19b2271f8792bc8e6da7b22f6'],
    }),
    ('natsort', '8.4.0', {
        'checksums': ['45312c4a0e5507593da193dedd04abb1469253b601ecaf63445ad80f0a1ea581'],
    }),
    ('typeguard', '4.4.2', {
        'checksums': ['a6f1065813e32ef365bc3b3f503af8a96f9dd4e0033a02c28c4a4983de8c6c49'],
    }),
    ('rocket-fft', '0.2.5', {
        'source_urls': ['https://github.com/styfenschaer/rocket-fft/archive/'],
        'sources': ['v%(version)s.tar.gz'],
        'checksums': ['02d209364d80810e9412cb90a7d83755cc336caa29617d0073108ec580b15dee'],
    }),
    ('OpenPIV', '0.25.3', {
        'modulename': 'openpiv',
        'source_tmpl': '%(namelower)s-%(version)s.tar.gz',
        'checksums': ['94e7588e897c6a5d64831aa9b906d4a9ed2d37a3ec71d668ba917783ddf1947d'],
    }),
    ('affine', '2.4.0', {
        'checksums': ['a24d818d6a836c131976d22f8c27b8d3ca32d0af64c1d8d29deb7bafa4da1eea'],
    }),
    ('click-plugins', '1.1.1', {
        'checksums': ['46ab999744a9d831159c3411bb0c79346d94a444df9a3a3742e9ed63645f264b'],
    }),
    ('cligj', '0.7.2', {
        'checksums': ['a4bc13d623356b373c2c27c53dbd9c68cae5d526270bfa71f6c6fa69669c6b27'],
    }),
    ('snuggs', '1.4.7', {
        'checksums': ['501cf113fe3892e14e2fee76da5cd0606b7e149c411c271898e6259ebde2617b'],
    }),
    # Needs rasterio<1.4.0, see https://github.com/localdevices/pyorc/issues/180
    ('rasterio', '1.3.11', {
        'use_pip_extras': 'plot,s3',
        'checksums': ['47aa70b4718ebc80d825bb7db3127577d74e31c53048ce215145c0baf530ece9'],
    }),
    (name, version, {
        'modulename': 'pyorc',
        # opencv-python is installed via OpenCV, python module name is 'cv2'
        'preinstallopts': "sed -i '/opencv-python/d' pyproject.toml && ",
        'source_tmpl': '%(namelower)s-%(version)s.tar.gz',
        'checksums': ['b93b588b4104a22ca15c0f6e73964ed339e4a77a150f58552c72e48225cc4630'],
    }),
]

moduleclass = 'geo'
