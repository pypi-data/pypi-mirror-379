easyblock = 'CMakeMake'

name = 'RapidJSON'
# no new release since Aug'16 so using latest commit;
# see also https://github.com/Tencent/rapidjson/issues/2202
version = '1.1.0-20250205'
local_commit = '24b5e7a'

homepage = 'https://rapidjson.org'
description = "A fast JSON parser/generator for C++ with both SAX/DOM style API"

toolchain = {'name': 'GCCcore', 'version': '14.3.0'}

source_urls = ['https://github.com/Tencent/%(namelower)s/archive/']
sources = [{'download_filename': '%s.tar.gz' % local_commit, 'filename': 'v%(version)s.tar.gz'}]
checksums = ['2d2601a82d2d3b7e143a3c8d43ef616671391034bc46891a9816b79cf2d3e7a8']

builddependencies = [
    ('binutils', '2.44'),
    ('CMake', '4.0.3'),
]

# strip out hardcoded use of -march=native, EasyBuild should be in control of this
preconfigopts = "sed -i 's/-march=native//g' ../rapidjson-*/CMakeLists.txt && "

configopts = "-DCMAKE_POLICY_VERSION_MINIMUM=3.5 "

sanity_check_paths = {
    'files': ['lib/pkgconfig/%(name)s.pc'],
    'dirs': ['include/%(namelower)s', 'lib/cmake', 'share'],
}

moduleclass = 'lib'
