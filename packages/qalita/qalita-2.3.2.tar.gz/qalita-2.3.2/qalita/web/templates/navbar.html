<div class="topbar">
    <div class="brand">
        <div class="left">
            <a href="/" style="display:flex;align-items:center;gap:8px;text-decoration:none;color:inherit;">
                <img src="/static/logo-no-slogan.png" alt="QALITA" />
                <span>CLI</span>
            </a>
        </div>
        <div class="right" style="display:flex;align-items:center;gap:8px;">
            <p style="margin: 0px; ">Context</p>
            <select id="ctx_select" class="ctx-select" style="margin-top: 0px; cursor:pointer;"></select>
        </div>
    </div>
</div>
<script>
    (function () {
        function loadContexts() {
            fetch('/contexts').then(r => r.json()).then(j => {
                var sel = document.getElementById('ctx_select'); if (!sel) return;
                sel.innerHTML = '';
                var opt = document.createElement('option');
                opt.value = ''; opt.textContent = 'Default context'; sel.appendChild(opt);
                (j.items || []).forEach(function (it) {
                    var o = document.createElement('option');
                    o.value = it.path; o.textContent = it.name; sel.appendChild(o);
                });
                if (j.selected) { sel.value = j.selected; }
            }).catch(() => { });
        }
        function onSelect() {
            var sel = document.getElementById('ctx_select'); if (!sel) return;
            fetch('/context/select', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ path: sel.value }) })
                .then(() => { window.location.reload(); })
                .catch(() => { window.location.reload(); });
        }
        document.addEventListener('DOMContentLoaded', function () {
            loadContexts(); var sel = document.getElementById('ctx_select'); if (sel) sel.addEventListener('change', onSelect);
        });
    })();
</script>