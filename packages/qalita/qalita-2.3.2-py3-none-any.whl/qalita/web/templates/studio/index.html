<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QALITA Studio</title>
  <link rel="icon" href="/static/studio.png" />
  <link rel="stylesheet" href="/static/styles.css" />
  <link rel="stylesheet" href="/static/studio.css" />
</head>

<body class="studio" style="background-repeat: no-repeat;">
  {% include 'studio/navbar.html' %}
  <div class="studio-panels" id="studio_panels">
    <section class="panel" id="panel_context" style="flex: 0 0 18%; margin-top: 40px;">
      {% include 'studio/context-panel.html' %}
    </section>
    <div class="resizer" data-resizer="left-center"></div>
    <section class="panel" id="panel_view" style="flex: 0 0 49%;">
      {% include 'studio/view-panel.html' %}
    </section>
    <div class="resizer" data-resizer="center-right"></div>
    <section class="panel" id="panel_agent" style="display:flex; padding-right:20px; flex-direction:column; overflow:hidden; flex: 0 0 33%;">
      {% include 'studio/agent-panel.html' %}
    </section>
  </div>

  <script>
    (function () {
      const container = document.getElementById('studio_panels');
      if (!container) return;
      const panels = container.querySelectorAll('.panel');
      const resizers = container.querySelectorAll('.resizer');

      let active = null;
      let startX = 0;
      let startWidths = [];

      function onMouseDown(e) {
        active = e.target;
        startX = e.clientX;
        startWidths = Array.from(panels).map(p => p.getBoundingClientRect().width);
        container.classList.add('dragging');
        window.addEventListener('mousemove', onMouseMove);
        window.addEventListener('mouseup', onMouseUp);
        e.preventDefault();
      }

      function onMouseMove(e) {
        if (!active) return;
        const dx = e.clientX - startX;
        const min = 263;
        if (active.dataset.resizer === 'left-center') {
          let w0 = Math.max(min, startWidths[0] + dx);
          let w1 = Math.max(min, startWidths[1] - dx);
          panels[0].style.flex = '0 0 ' + w0 + 'px';
          panels[1].style.flex = '0 0 ' + w1 + 'px';
        } else if (active.dataset.resizer === 'center-right') {
          let w1 = Math.max(min, startWidths[1] + dx);
          let w2 = Math.max(min, startWidths[2] - dx);
          panels[1].style.flex = '0 0 ' + w1 + 'px';
          panels[2].style.flex = '0 0 ' + w2 + 'px';
        }
      }

      function onMouseUp() {
        container.classList.remove('dragging');
        window.removeEventListener('mousemove', onMouseMove);
        window.removeEventListener('mouseup', onMouseUp);
        active = null;
      }

      resizers.forEach(r => r.addEventListener('mousedown', onMouseDown));
    })();
  </script>
</body>

</html>