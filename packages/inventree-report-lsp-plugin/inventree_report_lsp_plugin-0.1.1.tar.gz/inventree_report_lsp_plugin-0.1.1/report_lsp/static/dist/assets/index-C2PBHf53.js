import{a3 as G,cd as Q,bN as H,ce as L,a9 as z,i as ee,j as te,Z as ie,cf as oe,cg as re,ch as ne,a7 as se,bm as ae,W as le,bl as ce,ci as de,cj as ue,l as fe,bo as pe,ck as ge,cl as Pe,cm as P,cn as V,co as O,cp as w,cq as we,cr as f,cs as M,aw as A,U as ve,ct as K,cu as x,cv as E,cw as ye,cx as Re,cy as me,H as Se}from"./main-BY5dYOjU.js";import{cF as Ne,cG as Ue,cz as Fe,cD as Ye,cJ as Xe,cH as $e,cB as je,cA as qe,cE as Je,cI as Ze,cC as Qe}from"./main-BY5dYOjU.js";import{g as Te,a as he,E as Ae,S as Ce,P as be,A as Ee}from"./views-CaYyEkrT.js";import{b as et}from"./views-CaYyEkrT.js";import{M as Ie,a as Be}from"./editor-BUXrGX5P.js";import"./files.contribution._fileEditorFactory-Bj2Ckw7Y.js";function Ve(t,n,l){const v=document.createElement(n==="status"?"footer":"div");return v.classList.add("part","monaco-workbench-part",...l),v.id=t,v.setAttribute("role",n),n==="status"&&v.setAttribute("aria-live","off"),v}function Oe(t){var l;const n=(l=t.getContainer())==null?void 0:l.parentNode;n!=null&&t.layout(Math.max(t.minimumWidth,Math.min(t.maximumWidth,n.offsetWidth)),Math.max(t.minimumHeight,Math.min(t.maximumHeight,n.offsetHeight)),n.offsetTop,n.offsetLeft)}function xe(t,n){t.oncontextmenu=()=>!1;function l(){Oe(n)}n.onDidVisibilityChange(v=>{v&&l()}),l()}function De(t){return t.isConnected?t.checkVisibility!=null?t.checkVisibility({checkOpacity:!0,checkVisibilityCSS:!0}):t.offsetHeight>0&&t.offsetWidth>0:!1}function I(){const t=z.get(L).mainPart.getContainer();return t!=null&&De(t)}let D=class extends Be{constructor(n){super(n.createInstance(Ae),!1,n),this.restoreGroup=(...l)=>this.delegate.restoreGroup(...l)}getId(){return"standalone"}updateStyles(){}registerPart(n){return this.delegate.registerPart(n)}bind(n,l){return this.delegate.bind(n,l)}get activePart(){return this.delegate.activePart}};D=ee([te(0,ie)],D);let N=t=>t;oe(async t=>{const n=t.get(re),l=t.get(ne),v=t.get(se),S=t.get(ae),T=t.get(L),U=t.get(H),h=t.get(le),F=t.get(ce),C=t.get(de),k=t.get(ue),W=t.get(fe),Y=t.get(pe),X=t.get(ge),p=t.get(Pe);function $(){var i,c,u,d;const e=(i=C.options)==null?void 0:i.defaultLayout;if(((e==null?void 0:e.editors)!=null&&e.editors.length>0||((c=e==null?void 0:e.layout)==null?void 0:c.editors)!=null)&&((e.force??!1)||S.isNew(A.WORKSPACE)))return{layout:(u=e.layout)==null?void 0:u.editors,filesToOpenOrCreate:(d=e.editors)==null?void 0:d.map(g=>({viewColumn:g.viewColumn,fileUri:ve.revive(g.uri),openOnlyIfExists:g.openOnlyIfExists,options:g.options}))};const{filesToOpenOrCreate:o,filesToDiff:s,filesToMerge:r}=C;if(o!=null||s!=null||r!=null)return{filesToOpenOrCreate:o,filesToDiff:s,filesToMerge:r}}function j(e,o){var i;const s=(i=e.options)==null?void 0:i.defaultLayout;if(s==null||!(s.force??!1)&&!o.isNew(A.WORKSPACE))return;const{views:r}=s;if(r!=null&&r.length>0)return r.map(c=>c.id)}function q(e,o){return Re(e.getWorkspace())?!1:!!(W.getValue("window.restoreWindows")==="preserve")||o===void 0}async function J(e,o){var s;if(o!=null){const r=K(await x(o.filesToMerge,e,h));if(r.length===4&&E(r[0])&&E(r[1])&&E(r[2])&&E(r[3]))return[{editor:{input1:{resource:r[0].resource},input2:{resource:r[1].resource},base:{resource:r[2].resource},result:{resource:r[3].resource},options:{pinned:!0}}}];const i=K(await x(o.filesToDiff,e,h));if(i.length===2)return[{editor:{original:{resource:i[0].resource},modified:{resource:i[1].resource},options:{pinned:!0}}}];const c=[],u=await x(o.filesToOpenOrCreate,e,h);for(let d=0;d<u.length;d++){const g=u[d];g!=null&&c.push({editor:g,viewColumn:(s=o.filesToOpenOrCreate)==null?void 0:s[d].viewColumn})}return c}else if(k.getWorkbenchState()===ye.EMPTY&&W.getValue("workbench.startupEditor")==="newUntitledFile")return T.mainPart.hasRestorableState?[]:await X.hasBackups()?[]:[{editor:{resource:void 0}}];return[]}const y=$();y!=null&&h.info("Initial editor state",y);let a={layout:{editors:y==null?void 0:y.layout},editor:{restoreEditors:q(k,y),editorsToOpen:J(Y,y)},views:{defaults:j(C,S),containerToRestore:{}}};function R(e){return l.getDefaultViewContainer(e)??l.getViewContainersByLocation(e)[0]}function Z(){var e,o,s,r;if(p.isVisible(P.SIDEBAR_PART)){let i;!C.isBuilt||v.startupKind===me.ReloadedWindow||Se?i=S.get(Ce.activeViewletSettingsKey,A.WORKSPACE,(e=R(f.Sidebar))==null?void 0:e.id):i=(o=R(f.Sidebar))==null?void 0:o.id,a.views.containerToRestore.sideBar=i}if(p.isVisible(P.PANEL_PART)){const i=S.get(be.activePanelSettingsKey,A.WORKSPACE,(s=R(f.Panel))==null?void 0:s.id);a.views.containerToRestore.panel=i}if(p.isVisible(P.AUXILIARYBAR_PART)){const i=S.get(Ee.activeViewSettingsKey,A.WORKSPACE,(r=R(f.AuxiliaryBar))==null?void 0:r.id);a.views.containerToRestore.auxiliaryBar=i}}Z(),a=N(a),a.views.containerToRestore.sideBar==null&&p.setPartHidden(!0,P.SIDEBAR_PART),a.views.containerToRestore.panel==null&&p.setPartHidden(!0,P.PANEL_PART),a.views.containerToRestore.auxiliaryBar==null&&p.setPartHidden(!0,P.AUXILIARYBAR_PART);const B=document.createElement("div");B.style.display="none",document.body.append(B);for(const{id:e,role:o,classes:s,options:r,getPosition:i,onDidChangePosition:c}of[{id:P.TITLEBAR_PART,role:"none",classes:["titlebar"]},{id:P.BANNER_PART,role:"banner",classes:["banner"]},{id:P.ACTIVITYBAR_PART,role:"none",classes:["activitybar"],getPosition:()=>p.getSideBarPosition(),onDidChangePosition:p.onDidChangeSideBarPosition},{id:P.SIDEBAR_PART,role:"none",classes:["sidebar"],getPosition:()=>p.getSideBarPosition(),onDidChangePosition:p.onDidChangeSideBarPosition},{id:P.EDITOR_PART,role:"main",classes:["editor"],options:{restorePreviousState:a.editor.restoreEditors}},{id:P.PANEL_PART,role:"none",classes:["panel","basepanel"],getPosition:()=>p.getPanelPosition(),onDidChangePosition:p.onDidChangePanelPosition},{id:P.AUXILIARYBAR_PART,role:"none",classes:["auxiliarybar","basepanel"],getPosition:()=>p.getSideBarPosition()===V.LEFT?V.RIGHT:V.LEFT,onDidChangePosition:p.onDidChangeSideBarPosition},{id:P.STATUSBAR_PART,role:"status",classes:["statusbar"]}]){const u=p.getPart(e);if(u!=null){const d=Ve(e,o,s);if(u.create(d,r),xe(d,u),u.layout(9999,9999,0,0),B.append(d),i!=null){let g=i();u.element.classList.add(O(g)),c==null||c(()=>{u.element.classList.remove(O(g)),g=i(),u.element.classList.add(O(g))})}}}const m=[],_=[];m.push((async()=>{var s;w("code/willRestoreEditors"),await T.mainPart.whenReady,w("code/restoreEditors/editorGroupsReady"),((s=a.layout)==null?void 0:s.editors)!=null&&T.applyLayout(a.layout.editors);const e=await a.editor.editorsToOpen;w("code/restoreEditors/editorsToOpenResolved");let o;if(e.length>0){const r=T.getGroups(we.GRID_APPEARANCE),i=new Map;for(const c of e){const u=r[(c.viewColumn??1)-1];let d=i.get(u.id);d==null&&(d=new Set,i.set(u.id,d)),d.add(c.editor)}o=Promise.all(Array.from(i).map(async([c,u])=>{try{await U.openEditors(Array.from(u),c,{validateTrust:!0})}catch(d){h.error(d)}}))}_.push(Promise.all([o==null?void 0:o.finally(()=>w("code/restoreEditors/editorsOpened")),T.mainPart.whenRestored.finally(()=>w("code/restoreEditors/editorGroupsRestored"))]).finally(()=>{w("code/didRestoreEditors")}))})());const b=(async()=>{if(a.views.defaults!=null&&a.views.defaults.length>0){w("code/willOpenDefaultViews");const e=[],o=i=>{var u;const c=l.getViewLocationById(i.id);if(c!==null){const d=l.getViewContainerByViewId(i.id);if(d!=null){i.order>=(((u=e[c])==null?void 0:u.order)??0)&&(e[c]={id:d.id,order:i.order});const g=l.getViewContainerModel(d);return g.setCollapsed(i.id,!1),g.setVisible(i.id,!0),!0}}return!1},s=[...a.views.defaults].reverse().map((i,c)=>({id:i,order:c}));let r=s.length;for(;r>0;)r--,o(s[r])&&s.splice(r,1);if(s.length>0){await F.whenInstalledExtensionsRegistered();let i=s.length;for(;i>0;)i--,o(s[i])&&s.splice(i,1)}e[f.Sidebar]!=null&&(a.views.containerToRestore.sideBar=e[f.Sidebar].id),e[f.Panel]!=null&&(a.views.containerToRestore.panel=e[f.Panel].id),e[f.AuxiliaryBar]!=null&&(a.views.containerToRestore.auxiliaryBar=e[f.AuxiliaryBar].id),w("code/didOpenDefaultViews")}})();m.push(b),m.push((async()=>{var o;if(await b,a.views.containerToRestore.sideBar==null)return;w("code/willRestoreViewlet"),await n.openPaneComposite(a.views.containerToRestore.sideBar,f.Sidebar)==null&&await n.openPaneComposite((o=R(f.Sidebar))==null?void 0:o.id,f.Sidebar),w("code/didRestoreViewlet")})()),m.push((async()=>{var o;if(await b,a.views.containerToRestore.panel==null)return;w("code/willRestorePanel"),await n.openPaneComposite(a.views.containerToRestore.panel,f.Panel)==null&&await n.openPaneComposite((o=R(f.Panel))==null?void 0:o.id,f.Panel),w("code/didRestorePanel")})()),m.push((async()=>{var o;if(await b,a.views.containerToRestore.auxiliaryBar==null)return;w("code/willRestoreAuxiliaryBar"),await n.openPaneComposite(a.views.containerToRestore.auxiliaryBar,f.AuxiliaryBar)==null&&await n.openPaneComposite((o=R(f.AuxiliaryBar))==null?void 0:o.id,f.AuxiliaryBar),w("code/didRestoreAuxiliaryBar")})()),await M.settled(m),await M.settled(_)});function Me(t,n,l){return l!=null&&(N=typeof l=="boolean"?v=>({...v,editor:{...v.editor,restoreEditors:l}}):l),{...he(n),...Q({isKeybindingConfigurationVisible:I,shouldUseGlobalPicker:I}),...Te({shouldUseGlobalKeybindings:I}),[L.toString()]:new G(D,[],!1),[H.toString()]:new G(Ie,[t,I],!1)}}export{Ne as AbstractResourceEditorInput,Ue as AbstractTextResourceEditorInput,et as ActivityService,Fe as ActivitybarPart,Ye as ConfirmResult,Xe as DomScrollableElement,$e as EditorInput,je as EditorInputCapabilities,qe as GroupOrientation,be as PanelPart,P as Parts,V as Position,Je as RegisteredEditorPriority,Ce as SidebarPart,Ze as SplitView,f as ViewContainerLocation,Qe as ViewPaneContainer,Me as default,I as isEditorPartVisible,xe as renderPart};
