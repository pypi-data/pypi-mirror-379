import"./CWj6FrbW.js";import{p as tt,g as e,a7 as et,u as ht,c as Q,r as Z,J as O,t as at,d as z,a as nt,aw as dt,f as gt,s as B}from"./DcGCxgpH.js";import{n as rt,a as U,t as ft}from"./Crk-jcvV.js";import{i as W,s as mt,a as it}from"./DqUGznj_.js";import{p as T,b as ct,a as J}from"./D8GZDMNN.js";import{R as st,T as bt,U as yt,j as m,O as xt,y as wt,V as kt,W as K,X as vt}from"./BRnH9v23.js";import"./BBoGk9hq.js";import{o as zt}from"./2O287xak.js";import"./gLNdjSzu.js";import"./Cpy-nab_.js";import"./Df3aMO5B.js";import"./69_IOA4Y.js";import"./C0JiMuYn.js";import{s as St}from"./KpAtIldw.js";function Mt(o,t){const n={...o};return n.x=Math.round(Math.max(t.x,Math.min(n.x,t.x+t.width-n.width))),n.y=Math.round(Math.max(t.y,Math.min(n.y,t.y+t.height-n.height))),n.width=Math.round(Math.min(n.width,t.x+t.width-n.x)),n.height=Math.round(Math.min(n.height,t.y+t.height-n.y)),n}function L(o){return typeof o=="string"?new st([[document.querySelector(o)]],[document.documentElement]):new st([[o]],bt)}function _t(o){let t;for(;t=o.sourceEvent;)o=t;return o}function lt(o,t){if(o=_t(o),t===void 0&&(t=o.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=o.clientX,r.y=o.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var b=t.getBoundingClientRect();return[o.clientX-b.left-t.clientLeft,o.clientY-b.top-t.clientTop]}}return[o.pageX,o.pageY]}const Rt={passive:!1},Y={capture:!0,passive:!1};function N(o){o.stopImmediatePropagation()}function A(o){o.preventDefault(),o.stopImmediatePropagation()}function Tt(o){var t=o.document.documentElement,n=L(o).on("dragstart.drag",A,Y);"onselectstart"in t?n.on("selectstart.drag",A,Y):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Ct(o,t){var n=o.document.documentElement,r=L(o).on("dragstart.drag",null);t&&(r.on("click.drag",A,Y),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const G=o=>()=>o;function $(o,{sourceEvent:t,subject:n,target:r,identifier:b,active:k,x,y:w,dx:l,dy:i,dispatch:c}){Object.defineProperties(this,{type:{value:o,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:b,enumerable:!0,configurable:!0},active:{value:k,enumerable:!0,configurable:!0},x:{value:x,enumerable:!0,configurable:!0},y:{value:w,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:i,enumerable:!0,configurable:!0},_:{value:c}})}$.prototype.on=function(){var o=this._.on.apply(this._,arguments);return o===this._?this:o};function pt(o){return!o.ctrlKey&&!o.button}function Et(){return this.parentNode}function Pt(o,t){return t??{x:o.x,y:o.y}}function Dt(){return navigator.maxTouchPoints||"ontouchstart"in this}function ut(){var o=pt,t=Et,n=Pt,r=Dt,b={},k=yt("start","drag","end"),x=0,w,l,i,c,d=0;function s(a){a.on("mousedown.drag",v).filter(r).on("touchstart.drag",p).on("touchmove.drag",S,Rt).on("touchend.drag touchcancel.drag",E).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function v(a,y){if(!(c||!o.call(this,a,y))){var g=h(this,t.call(this,a,y),a,y,"mouse");g&&(L(a.view).on("mousemove.drag",C,Y).on("mouseup.drag",_,Y),Tt(a.view),N(a),i=!1,w=a.clientX,l=a.clientY,g("start",a))}}function C(a){if(A(a),!i){var y=a.clientX-w,g=a.clientY-l;i=y*y+g*g>d}b.mouse("drag",a)}function _(a){L(a.view).on("mousemove.drag mouseup.drag",null),Ct(a.view,i),A(a),b.mouse("end",a)}function p(a,y){if(o.call(this,a,y)){var g=a.changedTouches,u=t.call(this,a,y),M=g.length,P,D;for(P=0;P<M;++P)(D=h(this,u,a,y,g[P].identifier,g[P]))&&(N(a),D("start",a,g[P]))}}function S(a){var y=a.changedTouches,g=y.length,u,M;for(u=0;u<g;++u)(M=b[y[u].identifier])&&(A(a),M("drag",a,y[u]))}function E(a){var y=a.changedTouches,g=y.length,u,M;for(c&&clearTimeout(c),c=setTimeout(function(){c=null},500),u=0;u<g;++u)(M=b[y[u].identifier])&&(N(a),M("end",a,y[u]))}function h(a,y,g,u,M,P){var D=k.copy(),R=lt(P||g,y),H,I,F;if((F=n.call(a,new $("beforestart",{sourceEvent:g,target:s,identifier:M,active:x,x:R[0],y:R[1],dx:0,dy:0,dispatch:D}),u))!=null)return H=F.x-R[0]||0,I=F.y-R[1]||0,function q(X,f,j){var ot=R,V;switch(X){case"start":b[M]=q,V=x++;break;case"end":delete b[M],--x;case"drag":R=lt(j||f,y),V=x;break}D.call(X,a,new $(X,{sourceEvent:f,subject:F,target:s,identifier:M,active:V,x:R[0]+H,y:R[1]+I,dx:R[0]-ot[0],dy:R[1]-ot[1],dispatch:D}),u)}}return s.filter=function(a){return arguments.length?(o=typeof a=="function"?a:G(!!a),s):o},s.container=function(a){return arguments.length?(t=typeof a=="function"?a:G(a),s):t},s.subject=function(a){return arguments.length?(n=typeof a=="function"?a:G(a),s):n},s.touchable=function(a){return arguments.length?(r=typeof a=="function"?a:G(!!a),s):r},s.on=function(){var a=k.on.apply(k,arguments);return a===k?s:a},s.clickDistance=function(a){return arguments.length?(d=(a=+a)*a,s):Math.sqrt(d)},s}function jt({handle:o,getCurrentBbox:t,onResize:n}){let r;return ut().on("start",()=>{r=t()}).on("drag",b=>{let k=r.x,x=r.y,w=r.width,l=r.height;const i=b.x-b.subject.x,c=b.y-b.subject.y;switch(o){case"nw":k=r.x+i,x=r.y+c,w=r.width-i,l=r.height-c;break;case"ne":x=r.y+c,w=r.width+i,l=r.height-c;break;case"sw":k=r.x+i,w=r.width-i,l=r.height+c;break;case"se":w=r.width+i,l=r.height+c;break;case"n":x=r.y+c,l=r.height-c;break;case"s":l=r.height+c;break;case"w":k=r.x+i,w=r.width-i;break;case"e":w=r.width+i;break}const d=1;w<d&&(w=d,o.includes("w")&&(k=r.x+r.width-d)),l<d&&(l=d,o.includes("n")&&(x=r.y+r.height-d));const s=Math.round(k),v=Math.round(x),C=Math.round(w),_=Math.round(l);n&&n({x:s,y:v,width:C,height:_})})}function Lt({getCurrentBbox:o,onMove:t}){let n;return ut().on("start",()=>{n=o()}).on("drag",r=>{const b=r.x-r.subject.x,k=r.y-r.subject.y,x=Math.round(n.x+b),w=Math.round(n.y+k);t&&t({x,y:w,width:n.width,height:n.height})})}var Ft=rt('<g><rect stroke-width="2" pointer-events="all" vector-effect="non-scaling-stroke" class="movable-rectangle" style="cursor: move;"></rect></g>');function Xt(o,t){tt(t,!0);const n=T(t,"bbox",15),r=T(t,"colorStroke",3,"#007bff"),b=T(t,"colorFill",3,"transparent"),k=T(t,"opacity",3,.3),x=T(t,"handleSize",3,12),w=T(t,"scale",3,1),l=z(()=>n().x),i=z(()=>n().y),c=z(()=>n().width),d=z(()=>n().height);let s=et(void 0);function v(){if(!e(s))return;const E=x()/w(),h=Math.min(E,e(c)*.1,e(d)*.1),a=[{id:"nw",x:e(l)-h/2,y:e(i)-h/2,cursor:"nwse-resize",label:"Resize northwest corner"},{id:"ne",x:e(l)+e(c)-h/2,y:e(i)-h/2,cursor:"nesw-resize",label:"Resize northeast corner"},{id:"sw",x:e(l)-h/2,y:e(i)+e(d)-h/2,cursor:"nesw-resize",label:"Resize southwest corner"},{id:"se",x:e(l)+e(c)-h/2,y:e(i)+e(d)-h/2,cursor:"nwse-resize",label:"Resize southeast corner"},{id:"n",x:e(l)+e(c)/2-h/2,y:e(i)-h/2,cursor:"ns-resize",label:"Resize top edge"},{id:"s",x:e(l)+e(c)/2-h/2,y:e(i)+e(d)-h/2,cursor:"ns-resize",label:"Resize bottom edge"},{id:"w",x:e(l)-h/2,y:e(i)+e(d)/2-h/2,cursor:"ew-resize",label:"Resize left edge"},{id:"e",x:e(l)+e(c)-h/2,y:e(i)+e(d)/2-h/2,cursor:"ew-resize",label:"Resize right edge"}],g=L(e(s)).selectAll(".resize-handle").data(a,u=>u.id);g.enter().append("rect").attr("class","resize-handle").attr("width",h).attr("height",h).attr("fill",r()).attr("stroke",r()).attr("stroke-width","1").attr("vector-effect","non-scaling-stroke").attr("role","button").attr("style",u=>`cursor: ${u.cursor};`).attr("data-testid",u=>`resize-handle-${u.id}`).attr("aria-label",u=>u.label).merge(g).attr("x",u=>u.x).attr("y",u=>u.y).attr("width",h).attr("height",h).attr("fill",r()).attr("stroke",r()),g.exit().remove()}function C(){if(!e(s))return;["nw","ne","sw","se","n","s","w","e"].forEach(a=>{if(!e(s))return;const y=e(s).querySelector(`[data-testid="resize-handle-${a}"]`);y&&L(y).call(jt({handle:a,getCurrentBbox:()=>({x:e(l),y:e(i),width:e(c),height:e(d)}),onResize:g=>{n(n().x=g.x,!0),n(n().y=g.y,!0),n(n().width=g.width,!0),n(n().height=g.height,!0),t.onResize&&t.onResize(g),v()}}))});const h=e(s).querySelector(".movable-rectangle");h&&L(h).call(Lt({getCurrentBbox:()=>({x:e(l),y:e(i),width:e(c),height:e(d)}),onMove:a=>{n(n().x=a.x,!0),n(n().y=a.y,!0),n(n().width=a.width,!0),n(n().height=a.height,!0),t.onResize&&t.onResize(a),v()}}))}zt(()=>{e(s)&&(v(),C())});const _=async()=>{e(s)&&(await dt(),v(),C())};ht(()=>{v(),_()});var p=Ft(),S=Q(p);Z(p),ct(p,E=>O(s,E),()=>e(s)),at(()=>{m(S,"x",e(l)),m(S,"y",e(i)),m(S,"width",e(c)),m(S,"height",e(d)),m(S,"stroke",r()),m(S,"fill",b()),m(S,"fill-opacity",k())}),U(o,p),nt()}var At=ft("<!> <!> <!>",1);function ae(o,t){var q,X;tt(t,!0);const[n,r]=mt(),b=()=>it(i,"$taskMap",n),k=()=>it(c,"$customLabelColorsStore",n),x=T(t,"showLabel",3,!1),w=T(t,"isResizable",3,!1),l=T(t,"scale",3,1),{taskMap:i}=xt(),{customLabelColorsStore:c}=vt(),{annotation_task_id:d}=t.annotation,s=z(()=>t.annotation.annotation_label.annotation_label_name),v=(X=(q=t.annotation)==null?void 0:q.instance_segmentation_details)==null?void 0:X.segmentation_mask,C=z(()=>d&&b().has(d)?b().get(d).is_prediction:!1),_=z(()=>t.annotation.annotation_id),p=z(()=>K(e(s),1)),S=z(()=>{var f;return((f=k()[e(s)])==null?void 0:f.color)??K(e(s),1).color}),E=z(()=>{var f;return((f=k()[e(s)])==null?void 0:f.color)??K(e(s),.4).color}),h=z(()=>{var f;return((f=k()[e(s)])==null?void 0:f.alpha)*.4});let a=et(J(wt(t.annotation)));const y=f=>{var j;O(a,J(t.constraintBox?Mt(f,t.constraintBox):f)),(j=t.onBoundingBoxChange)==null||j.call(t,e(a))},g=z(()=>[e(a).x,e(a).y,e(a).width,e(a).height]);var u=At(),M=gt(u);{var P=f=>{const j=z(()=>[e(a).x,e(a).y]);qt(f,{get coordinates(){return e(j)},get colorText(){return e(p)},get label(){return e(s)},get isPrediction(){return e(C)}})};W(M,f=>{x()&&f(P)})}var D=B(M,2);{var R=f=>{kt(f,{segmentation:v,get width(){return t.imageWidth},get colorFill(){return e(E)},get opacity(){return e(h)}})};W(D,f=>{v&&f(R)})}var H=B(D,2);{var I=f=>{Xt(f,{get colorStroke(){return e(S)},get colorFill(){return e(E)},get opacity(){return e(h)},get scale(){return l()},onResize:y,get bbox(){return e(a)},set bbox(j){O(a,J(j))}})},F=f=>{Ht(f,{get bbox(){return e(g)},get annotationId(){return e(_)},get label(){return e(s)},get colorStroke(){return e(S)},get colorFill(){return e(E)},get opacity(){return e(h)},get isPrediction(){return e(C)}})};W(H,f=>{w()&&t.constraintBox?f(I):f(F,!1)})}U(o,u),nt(),r()}var Yt=rt('<rect vector-effect="non-scaling-stroke" stroke-width="2" pointer-events="all" data-testid="annotation_box"></rect>');function Ht(o,t){const n=T(t,"isPrediction",3,!1),[r,b,k,x]=t.bbox,w=n()?"5,5":"none",l=n()?.8:1;var i=Yt();m(i,"x",r),m(i,"y",b),m(i,"width",k),m(i,"height",x),m(i,"stroke-opacity",l),m(i,"stroke-dasharray",w),at(()=>{m(i,"stroke",t.colorStroke),m(i,"fill",t.colorFill),m(i,"fill-opacity",t.opacity),m(i,"aria-label",t.label),m(i,"data-annotation-id",t.annotationId)}),U(o,i)}var It=rt('<g class="unscaled"><rect></rect><text class="annotation-label-text" data-testid="svg-annotation-text"> </text></g>');function qt(o,t){tt(t,!0);const n=T(t,"fontSize",3,14),r=T(t,"isPrediction",3,!1),b=z(()=>t.coordinates[0]),k=z(()=>t.coordinates[1]);let x=et(null);const w=z(()=>e(x)?(e(x).textContent=r()?`${t.label} (pred)`:t.label,e(x).getBBox()):{width:0,height:0}),l=5,i=r()?.8:1,c=r()?"italic":"normal";var d=It(),s=Q(d);m(s,"opacity",i);var v=B(s);m(v,"x",l),m(v,"y",-5),m(v,"font-style",c);var C=Q(v,!0);Z(v),ct(v,_=>O(x,_),()=>e(x)),Z(d),at(()=>{var _,p,S;m(d,"transform",`translate(${e(b)}, ${e(k)})`),m(s,"y",-((_=e(w))==null?void 0:_.height)),m(s,"width",((p=e(w))==null?void 0:p.width)+l*2),m(s,"height",(S=e(w))==null?void 0:S.height),m(s,"fill",t.colorText.color),m(v,"fill",t.colorText.contrastColor),m(v,"font-size",n()),St(C,r()?`${t.label} (pred)`:t.label)}),U(o,d),nt()}export{ae as S,Tt as d,lt as p,L as s,Ct as y};
