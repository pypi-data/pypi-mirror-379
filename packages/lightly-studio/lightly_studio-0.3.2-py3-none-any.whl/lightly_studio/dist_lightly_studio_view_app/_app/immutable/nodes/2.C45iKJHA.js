var Mt=l=>{throw TypeError(l)};var Ot=(l,t,a)=>t.has(l)||Mt("Cannot "+a);var Ae=(l,t,a)=>(Ot(l,t,"read from private field"),a?a.call(l):t.get(l)),rt=(l,t,a)=>t.has(l)?Mt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(l):t.set(l,a);var Nt=(l,t,a)=>(Ot(l,t,"access private method"),a);import{u as it,a as ea}from"../chunks/BBoGk9hq.js";import{a as ta}from"../chunks/Cpy-nab_.js";import{r as Ve,i as aa,a as sa,b as ra}from"../chunks/H7C68rOM.js";import{r as Dt}from"../chunks/B90CZVMX.js";import{ab as xt,g as e,J as M,p as Oe,f as C,n as lt,a as Ne,s as n,c as i,ax as Y,d as p,r as o,t as de,a7 as Be,aB as na,ak as oa,au as Vt,l as Ze,u as Lt,w as ia}from"../chunks/DcGCxgpH.js";import"../chunks/CWj6FrbW.js";import{c as U,a as s,t as $,d as fe}from"../chunks/Crk-jcvV.js";import{a as L,i as se,s as Je}from"../chunks/DqUGznj_.js";import{s as Xe,c as dt,u as Et}from"../chunks/C0JiMuYn.js";import{s as ct,r as at,c as ve,a as je,p as et,b as zt}from"../chunks/D8GZDMNN.js";import{p as Ge}from"../chunks/Df3aMO5B.js";import{a2 as bt,I as ut,a1 as Re,e as ot,B as ht,a3 as _t,h as Ke,i as nt,O as la,a4 as yt,a5 as wt,a6 as Ct,a7 as St,a8 as Pt,a9 as kt,aa as da,ab as jt,s as Rt,ac as ca,ad as Bt,ae as Ht,q as ua,af as At,_ as va,ag as fa,ah as Gt,ai as ma,W as mt,t as _a,j as ga,X as pa,aj as ha,ak as $a,al as xa,am as ba,an as ya,ao as Jt,ap as wa,aq as Ca,ar as Sa,r as Pa,as as ka,n as Ta,f as Ia,F as Ea,at as Aa,Q as Fa,au as Ma}from"../chunks/BRnH9v23.js";import{g as Ue,o as Wt,d as Kt}from"../chunks/2O287xak.js";import{S as vt,f as Qe,b as Oa}from"../chunks/M1Q1F7bw.js";import{C as Na}from"../chunks/OH7-C_mc.js";import{s as J}from"../chunks/KpAtIldw.js";import{u as Qt}from"../chunks/gLNdjSzu.js";import{u as Da}from"../chunks/Cur71c3O.js";import"../chunks/69_IOA4Y.js";import{u as La,a as za}from"../chunks/DkR_EZ_B.js";import{i as Ut}from"../chunks/7YNGEs1C.js";import{u as ja,c as Ra,a as Ba}from"../chunks/i0ZZ4z06.js";import{T as qa}from"../chunks/CG0dMCJi.js";import{p as Tt}from"../chunks/Ccq4ZD0B.js";var Va=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],Ha=["difference","intersection","symmetricDifference","union"],qt=!1,tt,qe,We,gt,Xt;const pt=class pt extends Set{constructor(a){super();rt(this,gt);rt(this,tt,new Map);rt(this,qe,xt(0));rt(this,We,xt(0));if(a){for(var d of a)super.add(d);Ae(this,We).v=super.size}qt||Nt(this,gt,Xt).call(this)}has(a){var d=super.has(a),r=Ae(this,tt),u=r.get(a);if(u===void 0){if(!d)return e(Ae(this,qe)),!1;u=xt(!0),r.set(a,u)}return e(u),d}add(a){return super.has(a)||(super.add(a),M(Ae(this,We),super.size),bt(Ae(this,qe))),this}delete(a){var d=super.delete(a),r=Ae(this,tt),u=r.get(a);return u!==void 0&&(r.delete(a),M(u,!1)),d&&(M(Ae(this,We),super.size),bt(Ae(this,qe))),d}clear(){if(super.size!==0){super.clear();var a=Ae(this,tt);for(var d of a.values())M(d,!1);a.clear(),M(Ae(this,We),0),bt(Ae(this,qe))}}keys(){return this.values()}values(){return e(Ae(this,qe)),super.values()}entries(){return e(Ae(this,qe)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return e(Ae(this,We))}};tt=new WeakMap,qe=new WeakMap,We=new WeakMap,gt=new WeakSet,Xt=function(){qt=!0;var a=pt.prototype,d=Set.prototype;for(const r of Va)a[r]=function(...u){return e(Ae(this,qe)),d[r].apply(this,u)};for(const r of Ha)a[r]=function(...u){e(Ae(this,qe));var v=d[r].apply(this,u);return new pt(v)}};let It=pt;function Yt(l,t){Oe(t,!0);let a=at(t,["$$slots","$$events","$$legacy"]);ut(l,ct({name:"image"},()=>a,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(r,u)=>{var v=U(),y=C(v);Xe(y,()=>t.children??lt),s(r,v)},$$slots:{default:!0}})),Ne()}var Ga=$("<!> Samples",1),Ja=$("<!> Annotations",1),Wa=$('<div class="mb-5 mt-2 text-lg font-semibold">Collections</div> <!> <div class="flex space-x-2"><!> <!></div>',1);function Ka(l,t){Oe(t,!0);const a="is-active inline-flex rounded-md bg-muted",d=()=>{Ue(Ve.toSamples(t.datasetId))},r=()=>{Ue(Ve.toAnnotations(t.datasetId))};var u=Wa(),v=n(C(u),2);vt(v,{class:"mb-4 bg-border-hard"});var y=n(v,2),W=i(y);const E=p(()=>ot("flex-1","px-2",t.gridType=="samples"&&a));Re(W,{variant:"ghost",get class(){return e(E)},onclick:d,"data-testid":"collections-nav-samples-button","data-sveltekit-noscroll":!0,children:(F,S)=>{var k=Ga(),b=C(k);Yt(b,{class:"size-4"}),Y(),s(F,k)},$$slots:{default:!0}});var A=n(W,2);const P=p(()=>ot("flex-1","px-2",t.gridType=="annotations"&&a));Re(A,{get class(){return e(P)},variant:"ghost",onclick:r,"data-testid":"collections-nav-annotations-button","data-sveltekit-noscroll":!0,children:(F,S)=>{var k=Ja(),b=C(k);Na(b,{class:"size-4"}),Y(),s(F,k)},$$slots:{default:!0}}),o(y),s(l,u),Ne()}var Qa=$('<div class="space-y-1"><h2 class="text-md capitalize"> </h2> <div class="flex justify-between text-sm text-diffuse-foreground"><span> </span> <span> </span></div> <div class="relative p-2"><!></div></div>'),Ua=$('<div class="space-y-4"><div class="space-y-1"><h2 class="text-md">Width</h2> <div class="flex justify-between text-sm text-diffuse-foreground"><span> </span> <span> </span></div> <div class="relative p-2"><!></div></div> <div class="space-y-1"><h2 class="text-md">Height</h2> <div class="flex justify-between text-sm text-diffuse-foreground"><span> </span> <span> </span></div> <div class="relative p-2"><!></div></div> <!></div>');function Xa(l,t){Oe(t,!0);const[a,d]=Je(),r=()=>L(A,"$values",a),u=()=>L(b,"$metadataValues",a),v=()=>L(k,"$metadataBounds",a),y=()=>L(E,"$bounds",a),W=Ge.params.dataset_id,{dimensionsBounds:E,dimensionsValues:A,updateDimensionsValues:P}=Qt(),F=g=>{P({min_width:g[0],max_width:g[1],min_height:r().min_height,max_height:r().max_height})},S=g=>{P({min_width:r().min_width,max_width:r().max_width,min_height:g[0],max_height:g[1]})},{metadataBounds:k,metadataValues:b,updateMetadataValues:f}=Da(W),x=g=>N=>{const q={...u()};q[g]={min:N[0],max:N[1]},f(q)},R=p(()=>Object.keys(v()).filter(g=>{const N=v()[g];return N&&typeof N.min=="number"&&typeof N.max=="number"})),X=(g,N)=>{const q=v()[N];return q&&Number.isInteger(q.min)&&Number.isInteger(q.max)?Qe(g):Oa(g)};ht(l,{title:"Metadata FIlters",children:(g,N)=>{var q=Ua(),pe=i(q),we=n(i(pe),2),T=i(we),Ce=i(T);o(T);var Pe=n(T,2),De=i(Pe);o(Pe),o(we);var me=n(we,2),te=i(me);const Se=p(()=>[r().min_width,r().max_width]);_t(te,{type:"multiple",class:"filter-width",get min(){return y().min_width},get max(){return y().max_width},get value(){return e(Se)},onValueCommit:F}),o(me),o(pe);var K=n(pe,2),re=n(i(K),2),he=i(re),ke=i(he);o(he);var $e=n(he,2),Te=i($e);o($e),o(re);var Fe=n(re,2),m=i(Fe);const c=p(()=>[r().min_height,r().max_height]);_t(m,{type:"multiple",class:"filter-height",get min(){return y().min_height},get max(){return y().max_height},get value(){return e(c)},onValueCommit:S}),o(Fe),o(K);var _=n(K,2);{var ce=I=>{var Q=U(),B=C(Q);Ke(B,17,()=>e(R),nt,(xe,ne)=>{var V=Qa();const z=p(()=>v()[e(ne)]),oe=p(()=>u()[e(ne)]),ie=p(()=>Number.isInteger(e(z).min)&&Number.isInteger(e(z).max));var Z=i(V),Me=i(Z,!0);o(Z);var h=n(Z,2),j=i(h),w=i(j,!0);o(j);var H=n(j,2),O=i(H,!0);o(H),o(h);var D=n(h,2),ue=i(D);const G=p(()=>e(ie)?1:.01),le=p(()=>[e(oe).min,e(oe).max]),Ie=p(()=>x(e(ne)));_t(ue,{type:"multiple",get class(){return`filter-${e(ne)??""}`},get min(){return e(z).min},get max(){return e(z).max},get step(){return e(G)},get value(){return e(le)},get onValueCommit(){return e(Ie)}}),o(D),o(V),de((_e,ge,be)=>{J(Me,_e),J(w,ge),J(O,be)},[()=>e(ne).replace(/_/g," "),()=>X(e(oe).min,e(ne)),()=>X(e(oe).max,e(ne))]),s(xe,V)}),s(I,Q)};se(_,I=>{e(R).length>0&&I(ce)})}o(q),de((I,Q,B,xe)=>{J(Ce,`${I??""}px`),J(De,`${Q??""}px`),J(ke,`${B??""}px`),J(Te,`${xe??""}px`)},[()=>Qe(r().min_width),()=>Qe(r().max_width),()=>Qe(r().min_height),()=>Qe(r().max_height)]),s(g,q)},$$slots:{default:!0}}),Ne(),d()}function Ya(l,t){Oe(t,!0);let a=at(t,["$$slots","$$events","$$legacy"]);ut(l,ct({name:"eraser"},()=>a,{iconNode:[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"}],["path",{d:"M22 21H7"}],["path",{d:"m5 11 9 9"}]],children:(r,u)=>{var v=U(),y=C(v);Xe(y,()=>t.children??lt),s(r,v)},$$slots:{default:!0}})),Ne()}function Za(l,t){Oe(t,!0);let a=at(t,["$$slots","$$events","$$legacy"]);ut(l,ct({name:"grid-3x3"},()=>a,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}],["path",{d:"M3 9h18"}],["path",{d:"M3 15h18"}],["path",{d:"M9 3v18"}],["path",{d:"M15 3v18"}]],children:(r,u)=>{var v=U(),y=C(v);Xe(y,()=>t.children??lt),s(r,v)},$$slots:{default:!0}})),Ne()}function es(l,t){Oe(t,!0);let a=at(t,["$$slots","$$events","$$legacy"]);ut(l,ct({name:"plus"},()=>a,{iconNode:[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]],children:(r,u)=>{var v=U(),y=C(v);Xe(y,()=>t.children??lt),s(r,v)},$$slots:{default:!0}})),Ne()}function ts(l,t){Oe(t,!0);let a=at(t,["$$slots","$$events","$$legacy"]);ut(l,ct({name:"sliders-horizontal"},()=>a,{iconNode:[["line",{x1:"21",x2:"14",y1:"4",y2:"4"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22"}]],children:(r,u)=>{var v=U(),y=C(v);Xe(y,()=>t.children??lt),s(r,v)},$$slots:{default:!0}})),Ne()}const as=async l=>{const t={data:{},error:void 0};try{const a=await dt.POST("/api/metrics/compute/detection/map",{body:l});if(a.error)throw new Error(JSON.stringify(a.error,null,2));if(!a.data)throw new Error("No data returned from metrics calculation");t.data=a.data}catch(a){t.error="Error computing metrics: "+String(a)}return t};var ss=$("<!> <!>",1),rs=$("<!> <!>",1),ns=$("<!> <!>",1),os=$("<!> <!>",1),is=$('<div class="rounded-md bg-destructive/15 p-3 text-sm text-destructive"> </div>'),ls=$('<span class="mr-2 animate-spin">⟳</span>'),ds=$("<!> Compute",1),cs=$('<div class="space-y-6"><!> <!> <!> <!> <div class="flex space-x-2"><!> <!></div></div>'),us=$('<div class="flex justify-between"><span class="truncate"> </span> <span class="font-medium"> </span></div>'),vs=$('<div class="rounded-lg bg-muted p-4"><h4 class="text-md mb-2 font-medium">mAP by Class</h4> <div class="max-h-60 space-y-1 overflow-y-auto text-sm"></div></div>'),fs=$('<div class="space-y-4"><div class="rounded-lg bg-muted p-4"><h4 class="text-md mb-2 font-medium">mAP Results</h4> <div class="space-y-2 text-sm"><div class="flex justify-between"><span>mAP:</span> <span class="font-medium"> </span></div> <div class="flex justify-between"><span>mAP@50:</span> <span class="font-medium"> </span></div> <div class="flex justify-between"><span>mAP@75:</span> <span class="font-medium"> </span></div></div></div> <!> <!></div>'),ms=$('<div class="flex w-80 flex-col rounded-[1vw] bg-card p-4"><div class="mb-5 mt-2 text-lg font-semibold">Metrics</div> <!> <div class="flex-1 space-y-6"><!></div></div>'),_s=$('<div class="hidden"></div>');function gs(l,t){Oe(t,!0);const[a,d]=Je(),r=()=>L(F,"$isMetricsPanelOpen",a),u=()=>L(P,"$hasEnoughTasksForMetrics",a),v=()=>L(A,"$annotationTasks",a),y=()=>L(E,"$tags",a);let W=Ge.params.dataset_id;const{tags:E}=Et({dataset_id:W}),{annotationTasks:A,hasEnoughTasksForMetrics:P}=la(),{isMetricsPanelOpen:F}=La();let S=Be(""),k=Be(""),b=Be(""),f=Be(null),x=Be(!1),R=Be("");async function X(){if(!e(S)||!e(k)){M(R,"Please select both ground truth and prediction tasks");return}M(x,!0),M(R,"");try{const T=await as({dataset_id:W,ground_truth_task_id:e(S),prediction_task_id:e(k),tag_id:e(b)||null});T.error?M(R,je(T.error)):M(f,je(T.data))}catch(T){M(R,je(String(T)))}finally{M(x,!1)}}function g(){M(S,""),M(k,""),M(b,""),M(f,null),M(R,"")}var N=U(),q=C(N);{var pe=T=>{var Ce=ms(),Pe=n(i(Ce),2);vt(Pe,{class:"mb-4 bg-border-hard"});var De=n(Pe,2),me=i(De);{var te=K=>{var re=cs(),he=i(re);yt(he,{label:"Ground Truth Task",children:(I,Q)=>{var B=U(),xe=C(B);ve(xe,()=>kt,(ne,V)=>{V(ne,{type:"single",name:"groundTruthTaskId",get value(){return e(S)},set value(z){M(S,je(z))},children:(z,oe)=>{var ie=ss(),Z=C(ie);ve(Z,()=>wt,(h,j)=>{j(h,{class:"w-full",children:(w,H)=>{Y();var O=fe();de(D=>J(O,D),[()=>{var D;return((D=v().find(ue=>ue.annotation_task_id===e(S)))==null?void 0:D.name)||"Select ground truth task"}]),s(w,O)},$$slots:{default:!0}})});var Me=n(Z,2);ve(Me,()=>Ct,(h,j)=>{j(h,{children:(w,H)=>{var O=U(),D=C(O);ve(D,()=>St,(ue,G)=>{G(ue,{children:(le,Ie)=>{var _e=U(),ge=C(_e);Ke(ge,1,()=>v().filter(be=>!be.is_prediction),nt,(be,ee)=>{var ae=U(),ye=C(ae);{var ze=Ee=>{var Le=U(),He=C(Le);ve(He,()=>Pt,(ft,Ye)=>{Ye(ft,{get value(){return e(ee).annotation_task_id},get label(){return e(ee).name},children:($t,Zt)=>{Y();var st=fe();de(()=>J(st,e(ee).name)),s($t,st)},$$slots:{default:!0}})}),s(Ee,Le)};se(ye,Ee=>{e(ee).annotation_task_id&&Ee(ze)})}s(be,ae)}),s(le,_e)},$$slots:{default:!0}})}),s(w,O)},$$slots:{default:!0}})}),s(z,ie)},$$slots:{default:!0}})}),s(I,B)}});var ke=n(he,2);yt(ke,{label:"Prediction Task",children:(I,Q)=>{var B=U(),xe=C(B);ve(xe,()=>kt,(ne,V)=>{V(ne,{type:"single",name:"predictionTaskId",get value(){return e(k)},set value(z){M(k,je(z))},children:(z,oe)=>{var ie=rs(),Z=C(ie);ve(Z,()=>wt,(h,j)=>{j(h,{class:"w-full",children:(w,H)=>{Y();var O=fe();de(D=>J(O,D),[()=>{var D;return((D=v().find(ue=>ue.annotation_task_id===e(k)))==null?void 0:D.name)||"Select prediction task"}]),s(w,O)},$$slots:{default:!0}})});var Me=n(Z,2);ve(Me,()=>Ct,(h,j)=>{j(h,{children:(w,H)=>{var O=U(),D=C(O);ve(D,()=>St,(ue,G)=>{G(ue,{children:(le,Ie)=>{var _e=U(),ge=C(_e);Ke(ge,1,()=>v().filter(be=>be.is_prediction),nt,(be,ee)=>{var ae=U(),ye=C(ae);{var ze=Ee=>{var Le=U(),He=C(Le);ve(He,()=>Pt,(ft,Ye)=>{Ye(ft,{get value(){return e(ee).annotation_task_id},get label(){return e(ee).name},children:($t,Zt)=>{Y();var st=fe();de(()=>J(st,e(ee).name)),s($t,st)},$$slots:{default:!0}})}),s(Ee,Le)};se(ye,Ee=>{e(ee).annotation_task_id&&Ee(ze)})}s(be,ae)}),s(le,_e)},$$slots:{default:!0}})}),s(w,O)},$$slots:{default:!0}})}),s(z,ie)},$$slots:{default:!0}})}),s(I,B)}});var $e=n(ke,2);yt($e,{label:"Tag (Optional)",children:(I,Q)=>{var B=U(),xe=C(B);ve(xe,()=>kt,(ne,V)=>{V(ne,{type:"single",name:"tagId",get value(){return e(b)},set value(z){M(b,je(z))},children:(z,oe)=>{var ie=os(),Z=C(ie);ve(Z,()=>wt,(h,j)=>{j(h,{class:"w-full",children:(w,H)=>{Y();var O=fe();de(D=>J(O,D),[()=>{var D;return((D=y().find(ue=>ue.tag_id===e(b)))==null?void 0:D.name)||"Select tag (optional)"}]),s(w,O)},$$slots:{default:!0}})});var Me=n(Z,2);ve(Me,()=>Ct,(h,j)=>{j(h,{children:(w,H)=>{var O=U(),D=C(O);ve(D,()=>St,(ue,G)=>{G(ue,{children:(le,Ie)=>{var _e=ns(),ge=C(_e);ve(ge,()=>da,(ee,ae)=>{ae(ee,{children:(ye,ze)=>{Y();var Ee=fe("Sample tags");s(ye,Ee)},$$slots:{default:!0}})});var be=n(ge,2);Ke(be,1,()=>y().filter(ee=>ee.kind==="sample"),nt,(ee,ae)=>{var ye=U(),ze=C(ye);ve(ze,()=>Pt,(Ee,Le)=>{Le(Ee,{get value(){return e(ae).tag_id},get label(){return e(ae).name},children:(He,ft)=>{Y();var Ye=fe();de(()=>J(Ye,e(ae).name)),s(He,Ye)},$$slots:{default:!0}})}),s(ee,ye)}),s(le,_e)},$$slots:{default:!0}})}),s(w,O)},$$slots:{default:!0}})}),s(z,ie)},$$slots:{default:!0}})}),s(I,B)}});var Te=n($e,2);{var Fe=I=>{var Q=is(),B=i(Q,!0);o(Q),de(()=>J(B,e(R))),s(I,Q)};se(Te,I=>{e(R)&&I(Fe)})}var m=n(Te,2),c=i(m);Re(c,{variant:"outline",class:"flex-1",onclick:g,get disabled(){return e(x)},children:(I,Q)=>{Y();var B=fe("Reset");s(I,B)},$$slots:{default:!0}});var _=n(c,2);const ce=p(()=>!e(S)||!e(k)||e(x));Re(_,{variant:"default",class:"flex-1",onclick:X,get disabled(){return e(ce)},children:(I,Q)=>{var B=ds(),xe=C(B);{var ne=V=>{var z=ls();s(V,z)};se(xe,V=>{e(x)&&V(ne)})}Y(),s(I,B)},$$slots:{default:!0}}),o(m),o(re),s(K,re)},Se=K=>{var re=fs(),he=i(re),ke=n(i(he),2),$e=i(ke),Te=n(i($e),2),Fe=i(Te);o(Te),o($e);var m=n($e,2),c=n(i(m),2),_=i(c);o(c),o(m);var ce=n(m,2),I=n(i(ce),2),Q=i(I);o(I),o(ce),o(ke),o(he);var B=n(he,2);{var xe=V=>{var z=vs(),oe=n(i(z),2);Ke(oe,21,()=>Object.entries(e(f).map_per_class).sort(([ie],[Z])=>ie<Z?-1:ie>Z?1:0),nt,(ie,Z)=>{let Me=()=>e(Z)[0],h=()=>e(Z)[1];var j=us(),w=i(j),H=i(w);o(w);var O=n(w,2),D=i(O);o(O),o(j),de(ue=>{J(H,`${Me()??""}:`),J(D,`${ue??""}%`)},[()=>(h()*100).toFixed(2)]),s(ie,j)}),o(oe),o(z),s(V,z)};se(B,V=>{e(f).map_per_class&&V(xe)})}var ne=n(B,2);Re(ne,{variant:"outline",class:"mt-4 w-full",onclick:()=>M(f,null),children:(V,z)=>{Y();var oe=fe("Back to Form");s(V,oe)},$$slots:{default:!0}}),o(re),de((V,z,oe)=>{J(Fe,`${V??""}%`),J(_,`${z??""}%`),J(Q,`${oe??""}%`)},[()=>(e(f).map*100).toFixed(2),()=>(e(f).map_50*100).toFixed(2),()=>(e(f).map_75*100).toFixed(2)]),s(K,re)};se(me,K=>{e(f)?K(Se,!1):K(te)})}o(De),o(Ce),s(T,Ce)},we=T=>{var Ce=_s();s(T,Ce)};se(q,T=>{r()&&u()?T(pe):T(we,!1)})}s(l,N),Ne(),d()}var ps=$("<input>"),hs=$("<input>");function Ft(l,t){Oe(t,!0);let a=et(t,"ref",15,null),d=et(t,"value",15),r=et(t,"files",15),u=at(t,["$$slots","$$events","$$legacy","ref","value","type","files","class"]);var v=U(),y=C(v);{var W=A=>{var P=ps();jt(P);let F;zt(P,S=>a(S),()=>a()),de(S=>F=Rt(P,F,{class:S,type:"file",...u}),[()=>ot("border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-10 w-full rounded-md border px-3 py-2 text-base file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t.class)]),ca(P,r),Bt(P,d),s(A,P)},E=A=>{var P=hs();jt(P);let F;zt(P,S=>a(S),()=>a()),de(S=>F=Rt(P,F,{class:S,type:t.type,...u}),[()=>ot("border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-10 w-full rounded-md border px-3 py-2 text-base file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t.class)]),Bt(P,d),s(A,P)};se(y,A=>{t.type==="file"?A(W):A(E,!1)})}s(l,v),Ne()}var $s=$('<div class="flex w-80 flex-col rounded-[1vw] bg-card p-4"><div class="mb-5 mt-2 flex items-center justify-between"><div class="text-lg font-semibold">Create Classifier</div> <!></div> <!> <div class="flex-1 space-y-6"><!> <div class="space-y-2"><label for="classifier-name" class="text-sm font-medium">Classifier Name</label> <!></div> <!></div></div>'),xs=$('<div class="hidden"></div>');function bs(l,t){Oe(t,!1);const[a,d]=Je(),r=()=>L(v,"$isCreateClassifiersPanelOpen",a),u=()=>L(W,"$error",a),{isCreateClassifiersPanelOpen:v,closeCreateClassifiersPanel:y}=ua(),{error:W,createClassifier:E}=Ht(),{clearClassifierSamples:A}=it();let P=na(""),F=Ge.params.dataset_id;function S(){A(),M(P,""),y(),Ue(Ve.toSamples(F))}Ut();var k=U(),b=C(k);{var f=R=>{var X=$s(),g=i(X),N=n(i(g),2);Re(N,{variant:"ghost",size:"icon",onclick:S,class:"h-8 w-8",children:(te,Se)=>{Y();var K=fe("✕");s(te,K)},$$slots:{default:!0}}),o(g);var q=n(g,2);vt(q,{class:"mb-4 bg-border-hard"});var pe=n(q,2),we=i(pe);{var T=te=>{At(te,{title:"Error occured",children:(Se,K)=>{Y();var re=fe();de(()=>J(re,u())),s(Se,re)}})};se(we,te=>{u()&&te(T)})}var Ce=n(we,2),Pe=n(i(Ce),2);Ft(Pe,{id:"classifier-name",type:"text",placeholder:"Enter classifier name",get value(){return e(P)},set value(te){M(P,te)},$$legacy:!0}),o(Ce);var De=n(Ce,2);const me=oa(()=>!e(P).trim());Re(De,{variant:"default",class:"w-full",onclick:()=>E({name:e(P),class_list:["positive","negative"],dataset_id:F}),get disabled(){return e(me)},children:(te,Se)=>{Y();var K=fe("Create Classifier");s(te,K)},$$slots:{default:!0}}),o(pe),o(X),s(R,X)},x=R=>{var X=xs();s(R,X)};se(b,R=>{r()?R(f):R(x,!1)})}s(l,k),Ne(),d()}var ys=$('<div class="w-300 flex space-x-4 text-diffuse-foreground"><!> <!> <!></div>');function ws(l,t){Oe(t,!0);const[a,d]=Je(),r=()=>L(y,"$sampleSize",a),u=et(t,"min",3,100),v=et(t,"max",3,1500),{sampleSize:y,updateSampleSize:W}=it(),E=p(()=>r().width),A=va.throttle(f=>{W(f[0])},100);var P=ys(),F=i(P);Za(F,{class:"h-6 w-6"});var S=n(F,2);const k=p(()=>[e(E)]);_t(S,{class:"w-full flex-1",get value(){return e(k)},get min(){return u()},get max(){return v()},step:1,onValueChange:A});var b=n(S,2);Yt(b,{class:"h-6 w-6"}),o(P),s(l,P),Ne(),d()}var Cs=$('<div class="h-3 w-3 cursor-pointer rounded-sm border"></div>'),Ss=$('<div class="color-picker-container"><!></div> <p class="flex-1 truncate text-base font-normal" data-testid="label-menu-label-name"> </p> <span class="text-sm text-diffuse-foreground" data-testid="label-menu-label-count"> </span>',1),Ps=$('<div class="width-full flex items-center space-x-2"><!> <!></div>'),ks=$('<div class="width-full space-y-2 overflow-hidden"></div>');function Ts(l,t){Oe(t,!0);const[a,d]=Je(),r=()=>L(A,"$customLabelColorsStore",a),u=()=>L(v(),"$annotationFilters",a);let v=et(t,"annotationFilters",19,()=>[]);const{setCustomColor:y,getCustomColor:W,hasCustomColor:E,customLabelColorsStore:A}=pa();function P(b,f,x){y(b,f,x)}function F(b){if(E(b)){const x=W(b);return(x==null?void 0:x.color)||"#ff0000"}const f=mt(b,1).color;try{const x=f.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(x){const R=parseInt(x[1]),X=parseInt(x[2]),g=parseInt(x[3]);return`#${((1<<24)+(R<<16)+(X<<8)+g).toString(16).slice(1)}`}}catch(x){console.error("Error converting rgba to hex",x)}return"#ff0000"}function S(b){if(E(b)){const f=W(b);return(f==null?void 0:f.alpha)||1}return .4}const k=p(()=>{const b=r(),f={};for(const x of Object.keys(b)){const R=b[x];f[x]={borderColor:R.color,backgroundColor:mt(x,.4).color}}return f});ht(l,{title:"Labels",children:(b,f)=>{var x=ks();Ke(x,5,u,({label_name:R,current_count:X,total_count:g,selected:N})=>R,(R,X)=>{let g=()=>e(X).label_name,N=()=>e(X).current_count,q=()=>e(X).total_count,pe=()=>e(X).selected;var we=Ps(),T=i(we);const Ce=p(()=>`${g()}-label`);fa(T,{get id(){return g()},get checked(){return pe()},get"aria-labelledby"(){return e(Ce)},onCheckedChange:()=>t.onToggleAnnotationFilter(g())});var Pe=n(T,2);const De=p(()=>`${g()}-label`);Gt(Pe,{get id(){return e(De)},get for(){return g()},"data-testid":"labels-menu-item",class:"flex min-w-0 flex-1 cursor-pointer items-center space-x-2 text-nowrap peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:(me,te)=>{var Se=Ss(),K=C(Se),re=i(K);const he=p(()=>F(g())),ke=p(()=>S(g()));ma(re,{get initialColor(){return e(he)},get initialAlpha(){return e(ke)},onChange:(c,_)=>P(g(),c,_),children:(c,_)=>{var ce=Cs();de(I=>_a(ce,I),[()=>{var I,Q;return`
                                    border-color: ${((I=e(k)[g()])==null?void 0:I.borderColor)??mt(g()).color};
                                    background-color: ${((Q=e(k)[g()])==null?void 0:Q.backgroundColor)??mt(g(),pe()?1:.4).color};
                                `}]),s(c,ce)},$$slots:{default:!0}}),o(K);var $e=n(K,2),Te=i($e,!0);o($e);var Fe=n($e,2),m=i(Fe);o(Fe),de((c,_)=>{J(Te,g()),J(m,`${c??""} of ${_??""}`)},[()=>Qe(N()),()=>Qe(q())]),s(me,Se)},$$slots:{default:!0}}),o(we),de(()=>ga(we,"title",g())),s(R,we)}),o(x),s(b,x)},$$slots:{default:!0}}),Ne(),d()}const Is=async({dataset_id:l,tag_id:t,annotationIdsBody:a})=>{const d={data:void 0,error:void 0};try{const r=await dt.POST("/api/datasets/{dataset_id}/tags/{tag_id}/add/annotations",{params:{path:{dataset_id:l,tag_id:t}},body:a});if(r.error)throw new Error(JSON.stringify(r.error,null,2));if(!r.data)throw new Error("No data");d.data=r.data}catch(r){d.error="Error assigning annotationIds to a tag: "+String(r)}return d},Es=l=>["/api/datasets/{dataset_id}/tags",l],As=async({dataset_id:l,tag_id:t,sampleIdsBody:a})=>{const d={data:void 0,error:void 0};try{const r=await dt.POST("/api/datasets/{dataset_id}/tags/{tag_id}/add/samples",{params:{path:{dataset_id:l,tag_id:t}},body:a});if(r.error)throw new Error(JSON.stringify(r.error,null,2));if(!r.data)throw new Error("No data");d.data=r.data}catch(r){d.error="Error assigning sampleIds to tag: "+String(r)}return d},Fs=async({dataset_id:l,tagInputBody:t})=>{const a={data:void 0,error:void 0};try{const d=await dt.POST("/api/datasets/{dataset_id}/tags",{params:{path:{dataset_id:l}},body:t});if(d.error)throw new Error(JSON.stringify(d.error,null,2));if(!d.data)throw new Error("No data");a.data=d.data}catch(d){a.error="Error creating tag: "+String(d)}return a};var Ms=$("<!> Create new Tags",1),Os=$("<!> <!>",1),Ns=$('<div class="flex space-x-2 py-1"><!></div>'),Ds=$('<!> <!> <div class="grid gap-4"><!></div> <div><!> <!></div> <!>',1),Ls=$('<div class="flex space-x-1"><!> <!></div> <!>',1);function zs(l,t){Oe(t,!0);const[a,d]=Je(),r=()=>L(S,"$selectedSampleIds",a),u=()=>L(k,"$selectedSampleAnnotationCropIds",a),v=()=>L(e(P),"$tags",a),y=()=>L(e(R),"$itemsSelected",a),W=()=>L(te,"$submitTagAndMutate",a);let E=p(()=>t.gridType==="samples"?"sample":"annotation");const A=p(()=>Et({dataset_id:t.datasetId,kind:[e(E)]})),P=p(()=>e(A).tags),F=p(()=>e(A).loadTags),{selectedSampleIds:S,selectedSampleAnnotationCropIds:k,clearSelectedSampleAnnotationCrops:b,clearSelectedSamples:f}=it(),x=p(()=>t.gridType==="samples"?f:b),R=p(()=>t.gridType==="samples"?S:k);let X=Be(!1);const g=p(()=>r().size>0&&t.gridType==="samples"||u().size>0&&t.gridType==="annotations");let N=Be(""),q=Be(je([])),pe=()=>{e(q).push(e(N)),T.add(e(N)),M(N,"")};const we=p(()=>[...e(q).map(c=>({tag_id:c,name:c,kind:e(E)})),...v()].filter(c=>c.name.includes(e(N))));let T=je(new It);const Ce=c=>{T.has(c)?(T.delete(c),e(q).splice(e(q).indexOf(c),1)):T.add(c)};let Pe=Be(null);const De=async()=>{await Promise.all([...e(q)].map(async c=>{var ce;const _=await Fs({dataset_id:t.datasetId,tagInputBody:{name:c,description:`${c} description`,kind:e(E)}});if(_.error)throw _.error;return(ce=_.data)!=null&&ce.tag_id&&(T.delete(c),T.add(_.data.tag_id)),_})),await Promise.all([...T].map(async c=>{const _=e(E)==="sample"?await As({dataset_id:t.datasetId,tag_id:c,sampleIdsBody:{sample_ids:[...y()]}}):await Is({dataset_id:t.datasetId,tag_id:c,annotationIdsBody:{annotation_ids:[...y()]}});if(_.error)throw _.error;return _}))},me=ja(),te=ha({mutationFn:async()=>{await De()},onError:c=>{M(Pe,je(c))},onSuccess:()=>{me.invalidateQueries({queryKey:Es({dataset_id:t.datasetId})}),e(F)(),e(x)(),Se(!1)}}),Se=c=>{M(X,je(c)),M(Pe,null),M(N,""),M(q,je([])),T.clear()},K=p(()=>T.size>0||e(q).length>0);var re=Ls(),he=C(re),ke=i(he);const $e=p(()=>!e(g));Re(ke,{variant:"outline",get disabled(){return e($e)},class:"flex-1",onclick:()=>M(X,!0),"data-testid":"tag-create-dialog-button",children:(c,_)=>{var ce=Ms(),I=C(ce);es(I,{}),Y(),s(c,ce)},$$slots:{default:!0}});var Te=n(ke,2);const Fe=p(()=>!e(g));Re(Te,{variant:"outline",get disabled(){return e(Fe)},size:"icon",title:"Clear selection",get onclick(){return e(x)},children:(c,_)=>{Ya(c,{})},$$slots:{default:!0}}),o(he);var m=n(he,2);ve(m,()=>Ca,(c,_)=>{_(c,{onOpenChange:Se,get open(){return e(X)},children:(ce,I)=>{var Q=U(),B=C(Q);ve(B,()=>$a,(xe,ne)=>{ne(xe,{class:"sm:max-w-[425px]",children:(V,z)=>{var oe=Ds(),ie=C(oe);ve(ie,()=>xa,(G,le)=>{le(G,{children:(Ie,_e)=>{var ge=Os(),be=C(ge);ve(be,()=>ba,(ae,ye)=>{ye(ae,{children:(ze,Ee)=>{Y();var Le=fe();de(()=>J(Le,`Add the selected ${e(E)??""} to a tag`)),s(ze,Le)},$$slots:{default:!0}})});var ee=n(be,2);ve(ee,()=>ya,(ae,ye)=>{ye(ae,{children:(ze,Ee)=>{Y();var Le=fe();de(()=>J(Le,`Add the selected ${y().size??""}
                ${e(E)??""} to an new or existing tag. Tags can later be exported.`)),s(ze,Le)},$$slots:{default:!0}})}),s(Ie,ge)},$$slots:{default:!0}})});var Z=n(ie,2);{var Me=G=>{At(G,{title:"Error occured",children:(le,Ie)=>{Y();var _e=fe();de(()=>J(_e,e(Pe))),s(le,_e)}})};se(Z,G=>{e(Pe)&&G(Me)})}var h=n(Z,2),j=i(h);Ft(j,{type:"text",placeholder:"Create or search tags",autofocus:!0,"data-testid":"tag-create-dialog-input",get value(){return e(N)},set value(G){M(N,je(G))}}),o(h);var w=n(h,2),H=i(w);Ke(H,17,()=>e(we),G=>G.tag_id,(G,le)=>{var Ie=Ns(),_e=i(Ie);const ge=p(()=>`tagCreateDialog-tag-${e(le).tag_id}`),be=p(()=>T.has(e(le).tag_id));Jt(_e,{get name(){return e(ge)},get isChecked(){return e(be)},get label(){return e(le).name},onCheckedChange:()=>Ce(e(le).tag_id)}),o(Ie),s(G,Ie)});var O=n(H,2);{var D=G=>{const le=p(()=>ot("",...Sa({variant:"outline"})));Re(G,{type:"button",variant:"outline",get class(){return e(le)},onclick:pe,"data-testid":"tag-create-dialog-create",children:(Ie,_e)=>{Y();var ge=fe();de(()=>J(ge,`Create tag "${e(N)??""}"`)),s(Ie,ge)},$$slots:{default:!0}})};se(O,G=>{e(N)&&G(D)})}o(w);var ue=n(w,2);ve(ue,()=>wa,(G,le)=>{le(G,{children:(Ie,_e)=>{var ge=U(),be=C(ge);{var ee=ae=>{Re(ae,{type:"submit",onclick:()=>W().mutate(),"data-testid":"tag-create-dialog-save",children:(ye,ze)=>{Y();var Ee=fe("Save changes");s(ye,Ee)},$$slots:{default:!0}})};se(be,ae=>{e(K)&&ae(ee)})}s(Ie,ge)},$$slots:{default:!0}})}),s(V,oe)},$$slots:{default:!0}})}),s(ce,Q)},$$slots:{default:!0}})}),s(l,re),Ne(),d()}var js=$('<div class="flex items-center space-x-2 py-1" data-testid="tag-menu-item"><!></div>'),Rs=$("<p>No tag, create a tag</p>"),Bs=$('<div class="mb-3 w-full space-y-2"></div>');function qs(l,t){Oe(t,!0);const[a,d]=Je(),r=()=>L(e(y),"$tags",a),u=()=>L(e(W),"$tagsSelected",a),v=p(()=>Et({dataset_id:t.dataset_id,kind:[t.gridType==="annotations"?"annotation":"sample"]})),y=p(()=>e(v).tags),W=p(()=>e(v).tagsSelected),E=p(()=>e(v).tagSelectionToggle);ht(l,{title:"Tags",icon:qa,children:(A,P)=>{var F=Bs();Ke(F,5,r,S=>S.tag_id,(S,k)=>{var b=js(),f=i(b);const x=p(()=>u().has(e(k).tag_id));Jt(f,{get name(){return e(k).tag_id},get isChecked(){return e(x)},get label(){return e(k).name},onCheckedChange:()=>e(E)(e(k).tag_id)}),o(b),s(S,b)},S=>{var k=Rs();s(S,k)}),o(F),s(A,F)}}),Ne(),d()}var Vs=$(`<li>Once satisfied with the results, click "Commit Temporary Classifier"
                                to save permanently</li>`),Hs=$('<div class="flex w-80 flex-col rounded-[1vw] bg-card p-4"><div class="mb-5 mt-2 flex items-center justify-between"><div class="text-lg font-semibold"> </div> <!></div> <!> <div class="flex-1 space-y-6"><div class="space-y-4"><div><h3 class="mb-2 text-lg font-semibold">Refinement Instructions</h3> <p class="mb-4 text-sm text-muted-foreground">You are refining classifier: <span class="font-medium"> </span></p> <ol class="list-inside list-decimal space-y-2 text-sm text-muted-foreground"><li>Select positive examples from the samples</li> <li>Click "Refine Classifier" to retrain with your selections</li> <!></ol></div></div> <div class="space-y-4"><!> <!> <div class="flex items-center justify-between gap-4"><!> <!></div> <!></div></div></div>'),Gs=$('<div class="hidden"></div>');function Js(l,t){Oe(t,!1);const[a,d]=Je(),r=()=>L(S,"$isRefineClassifiersPanelOpen",a),u=()=>L(b,"$currentMode",a),v=()=>L(x,"$currentClassifierName",a),y=()=>L(X,"$error",a),W=()=>L(f,"$currentClassifierId",a),E=()=>L(R,"$currentClassifierClasses",a),A=()=>L(F,"$showTrainingSamplesToggle",a),{clearSelectedSamples:P}=it(),F=ea("refine_classifier_show_training_samples",!1),{isRefineClassifiersPanelOpen:S,closeRefineClassifiersPanel:k,currentMode:b,currentClassifierId:f,currentClassifierName:x,currentClassifierClasses:R}=Pa(),{error:X,commitTempClassifier:g,refineClassifier:N,showClassifierTrainingSamples:q}=Ht();let pe=Ge.params.dataset_id;function we(){P(),F.set(!1),k(),Ue(Ve.toSamples(pe))}Ut();var T=U(),Ce=C(T);{var Pe=me=>{var te=Hs(),Se=i(te),K=i(Se),re=i(K,!0);o(K);var he=n(K,2);Re(he,{variant:"ghost",size:"icon",onclick:we,class:"h-8 w-8",children:(h,j)=>{Y();var w=fe("✕");s(h,w)},$$slots:{default:!0}}),o(Se);var ke=n(Se,2);vt(ke,{class:"mb-4 bg-border-hard"});var $e=n(ke,2),Te=i($e),Fe=i(Te),m=n(i(Fe),2),c=n(i(m)),_=i(c,!0);o(c),o(m);var ce=n(m,2),I=n(i(ce),4);{var Q=h=>{var j=Vs();s(h,j)};se(I,h=>{u()==="temp"&&h(Q)})}o(ce),o(Fe),o(Te);var B=n(Te,2),xe=i(B);{var ne=h=>{At(h,{title:"Error occured",children:(j,w)=>{Y();var H=fe();de(()=>J(H,y())),s(j,H)}})};se(xe,h=>{y()&&h(ne)})}var V=n(xe,2);Re(V,{variant:"default",class:"w-full",onclick:()=>{F.set(!1),N(W()||"",pe,E()||[])},children:(h,j)=>{Y();var w=fe("Refine Classifier");s(h,w)},$$slots:{default:!0}});var z=n(V,2),oe=i(z);Gt(oe,{class:"text-foreground",children:(h,j)=>{Y();var w=fe("Show All Training Samples");s(h,w)},$$slots:{default:!0}});var ie=n(oe,2);ka(ie,{class:"",get checked(){return A()},onCheckedChange:h=>{F.set(h),q(W()||"",pe,E()||[],h)}}),o(z);var Z=n(z,2);{var Me=h=>{Re(h,{variant:"outline",class:"w-full",onclick:()=>{F.set(!1),g(W()||"",pe)},children:(j,w)=>{Y();var H=fe("Commit Temporary Classifier");s(j,H)},$$slots:{default:!0}})};se(Z,h=>{u()==="temp"&&h(Me)})}o(B),o($e),o(te),de(()=>{J(re,u()==="temp"?"Refine Temporary Classifier":"Refine Classifier"),J(_,v())}),s(me,te)},De=me=>{var te=Gs();s(me,te)};se(Ce,me=>{r()?me(Pe):me(De,!1)})}s(l,T),Ne(),d()}const Ws=async({params:{dataset_id:l}})=>{let t;try{const{data:r}=await ta({path:{dataset_id:l}});t=r}catch{throw Dt(307,Ve.toHome())}if(!t)throw Dt(307,Ve.toHome());const a=it(),d=Vt(a.selectedAnnotationFilterIds,r=>Array.from(r));return{datasetId:l,dataset:t,globalStorage:a,selectedAnnotationFilterIds:d,sampleSize:a.sampleSize}},Ir=Object.freeze(Object.defineProperty({__proto__:null,load:Ws},Symbol.toStringTag,{value:"Module"})),Ks=l=>{const{settingsStore:t}=Ta(),a=new Set,d=u=>{if(u.target instanceof HTMLInputElement||u.target instanceof HTMLTextAreaElement||u.target instanceof HTMLSelectElement)return;a.add(u.key);const v=Ze(Tt).url.pathname,y={hideAnnotations:Ze(t).key_hide_annotations||"v",goBack:Ze(t).key_go_back||"Escape"};Object.entries(l).forEach(([W,E])=>{const A=y[W]||E.key;if(u.key===A){if(E.requiredPath){if(typeof E.requiredPath=="function"){if(!E.requiredPath(v))return}else if(!E.requiredPath.test(v))return}E.action(u)}})},r=u=>{a.delete(u.key)};return Wt(()=>{window.addEventListener("keydown",d),window.addEventListener("keyup",r)}),Kt(()=>{window.removeEventListener("keydown",d),window.removeEventListener("keyup",r)}),{isKeyPressed:u=>a.has(u)}},Qs={goBack:{key:"Escape",description:"Go back from detail view to grid view",isConfigurable:!0,requiredPath:l=>/\/datasets\/[^/]+\/(samples|annotations)\/[^/]+/.test(l)||/\/samples\/[^/]+/.test(l),action:()=>{const l=Ze(Tt).url.pathname,t=Ze(Tt).params.dataset_id;if(/\/samples\/[^/]+/.test(l)&&!t){Ue("/");return}t&&(l.includes("/samples/")?Ue(Ve.toSamples(t)):l.includes("/annotations/")&&Ue(Ve.toAnnotations(t)))}}},Us=async({query_text:l="",model_id:t=""})=>{const a={data:[],error:void 0};try{const d=await dt.GET("/api/text_embedding/embed_text",{params:{query:{query_text:l,model_id:t}}});if(d.error)throw new Error(JSON.stringify(d.error,null,2));if(!d.data)throw new Error("No data");a.data=d.data}catch(d){a.error="Error creating text embedding: "+String(d)}return a},Xs=({datasetId:l,options:t})=>{var a,d,r,u;return Ra(Ba({path:{dataset_id:l},query:{...(t==null?void 0:t.filtered_labels)&&{filtered_labels:t.filtered_labels},...((a=t==null?void 0:t.dimensions)==null?void 0:a.min_width)&&{min_width:t.dimensions.min_width},...((d=t==null?void 0:t.dimensions)==null?void 0:d.max_width)&&{max_width:t.dimensions.max_width},...((r=t==null?void 0:t.dimensions)==null?void 0:r.min_height)&&{min_height:t.dimensions.min_height},...((u=t==null?void 0:t.dimensions)==null?void 0:u.max_height)&&{max_height:t.dimensions.max_height}}}))};var Ys=$("<div><!></div>"),Zs=$('<div class="space-y-2"><!> <!></div>'),er=$('<div class="flex w-80 flex-col space-y-6 rounded-[1vw] bg-card py-4"><div class="px-4"><!></div> <div class="min-h-0 flex-1 space-y-2 overflow-y-auto px-4 dark:[color-scheme:dark]"><div><!> <!></div> <!> <!></div></div>'),tr=$('<div class="relative"><!> <!></div>'),ar=$("<!> <!>",1),sr=$('<div class="flex h-full w-full space-x-4 px-4 pb-4"><!> <div class="flex1 flex flex-grow flex-col space-y-4 rounded-[1vw] bg-card p-4"><div class="my-2 flex items-center space-x-4"><div class="flex-1"><!></div> <div class="w-4/12"><!></div></div> <!> <div class="flex min-h-0 flex-1"><!></div></div> <!> <!></div>');function Er(l,t){Oe(t,!0);const[a,d]=Je(),r=()=>L(F,"$textEmbedding",a),u=()=>L(g,"$featureFlags",a),v=()=>L(De,"$annotationFilterLabels",a),y=()=>L(k,"$selectedAnnotationFilterIds",a),W=()=>L(Ce,"$dimensionsValues",a),E=()=>L(e(Se),"$annotationCounts",a),{datasetId:A,globalStorage:{setTextEmbedding:P,textEmbedding:F,setLastGridType:S,selectedAnnotationFilterIds:k}}=t.data,{handleKeyEvent:b}=Ia();Wt(()=>{window.addEventListener("keydown",b),window.addEventListener("keyup",b)}),Kt(()=>{window.removeEventListener("keydown",b),window.removeEventListener("keyup",b)}),Ks({goBack:Qs.goBack});let f=Be("samples");Lt(()=>{Ge.url.pathname===Ve.toAnnotations(A)?M(f,"annotations"):Ge.url.pathname===Ve.toClassifiers(A)?M(f,"classifiers"):M(f,"samples"),S(e(f))});let x=Be(je(r()?r().queryText:""));async function R(){if(e(x).trim()!=="")try{return(await Us({query_text:e(x),model_id:void 0})).data}catch(m){he(m.message),console.error("Error during API call:",m)}}async function X(m){if(m.key==="Enter"){const c=await R();P({queryText:e(x),embedding:c||[]})}}const{featureFlags:g}=za(),N=p(()=>u().some(m=>m==="embeddingSearchEnabled")),q=p(()=>u().some(m=>m==="fewShotClassifierEnabled")),pe=p(()=>aa(Ge.route.id)),we=p(()=>sa(Ge.route.id)),T=p(()=>ra(Ge.route.id)),{dimensionsValues:Ce}=Qt(A),Pe=Ea(),De=Vt(Pe,m=>m.data?m.data.reduce((c,_)=>({...c,[_.annotation_label_name]:_.annotation_label_id}),{}):{}),me=p(()=>{const m=v(),c=Array.from(y());return Object.entries(m).filter(([,_])=>c.includes(_)).map(([_])=>_)}),te=(m,c)=>m.map(_=>({..._,selected:c.includes(_.label_name)})),Se=p(()=>Xs({datasetId:A,options:{filtered_labels:e(me).length>0?e(me):void 0,dimensions:W()}})),K=ia([]);Lt(()=>{const m=E().data;if(m){const c=te(m,e(me));K.set(c)}});const re=m=>{const c=Ze(De)[m];c&&k.update(_=>(_.has(c)?_.delete(c):_.add(c),_))},he=m=>{Fa.error("Error",{description:m})};var ke=U(),$e=C(ke);{var Te=m=>{var c=U(),_=C(c);Xe(_,()=>t.children),s(m,c)},Fe=m=>{var c=sr(),_=i(c);{var ce=w=>{var H=er(),O=i(H),D=i(O);Ka(D,{datasetId:A,get gridType(){return e(f)}}),o(O);var ue=n(O,2),G=i(ue),le=i(G);qs(le,{dataset_id:A,get gridType(){return e(f)}});var Ie=n(le,2);zs(Ie,{datasetId:A,get gridType(){return e(f)}}),o(G);var _e=n(G,2);{var ge=ee=>{var ae=Ys(),ye=i(ae);Ma(ye,{}),o(ae),s(ee,ae)};se(_e,ee=>{e(f)==="samples"&&e(N)&&e(q)&&ee(ge)})}var be=n(_e,2);ht(be,{title:"Filters",icon:ts,children:(ee,ae)=>{var ye=Zs(),ze=i(ye);Ts(ze,{annotationFilters:K,onToggleAnnotationFilter:re});var Ee=n(ze,2);{var Le=He=>{Xa(He,{})};se(Ee,He=>{e(f)==="samples"&&He(Le)})}o(ye),s(ee,ye)}}),o(ue),o(H),s(w,H)};se(_,w=>{(e(f)==="samples"||e(f)==="annotations")&&w(ce)})}var I=n(_,2),Q=i(I),B=i(Q),xe=i(B);{var ne=w=>{var H=tr(),O=i(H);Aa(O,{class:"absolute left-2 top-[50%] h-4 w-4 translate-y-[-50%] text-muted-foreground"});var D=n(O,2);Ft(D,{placeholder:"Search",class:"pl-8",onkeydown:X,"data-testid":"text-embedding-search-input",get value(){return e(x)},set value(ue){M(x,je(ue))}}),o(H),s(w,H)};se(xe,w=>{e(f)==="samples"&&e(N)&&w(ne)})}o(B);var V=n(B,2),z=i(V);ws(z,{}),o(V),o(Q);var oe=n(Q,2);vt(oe,{class:"mb-4 bg-border-hard"});var ie=n(oe,2),Z=i(ie);Xe(Z,()=>t.children),o(ie),o(I);var Me=n(I,2);{var h=w=>{var H=ar(),O=C(H);bs(O,{});var D=n(O,2);Js(D,{}),s(w,H)};se(Me,w=>{e(f)==="classifiers"&&e(N)&&e(q)&&w(h)})}var j=n(Me,2);gs(j,{}),o(c),s(m,c)};se($e,m=>{e(pe)||e(we)||e(T)?m(Te):m(Fe,!1)})}s(l,ke),Ne(),d()}export{Er as component,Ir as universal};
