(self.webpackChunk_naavre_containerizer_jupyterlab=self.webpackChunk_naavre_containerizer_jupyterlab||[]).push([[960],{2960:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>fe});var a=n(201),r=n(9980),o=n(5010),l=n(3760),i=n(3345),s=n.n(i),c=n(9743);const u=(0,c.createTheme)({palette:{secondary:{main:"#ea5b2d",dark:"#b12800",light:"#ff8c5a"},primary:{main:"#0f4e8a",dark:"#00275c",light:"#4e79ba"}}});var p=n(5429),d=n(8397),m=n(3566);async function h(e,t,n={},a={}){const r={method:"POST",body:JSON.stringify({query:{method:e,url:t,headers:n,data:a}})},o=await async function(e="",t={}){const n=m.ServerConnection.makeSettings(),a=d.URLExt.join(n.baseUrl,e);let r;try{r=await m.ServerConnection.makeRequest(a,t,n)}catch(e){throw new m.ServerConnection.NetworkError(e)}let o=await r.text();if(o.length>0)try{o=JSON.parse(o)}catch(e){console.log("Not a JSON response body.",r)}if(!r.ok)throw new m.ServerConnection.ResponseError(r,o.message||o);return o}("naavre-communicator/external-service",r);console.debug("resp",o);try{console.debug("resp.content",JSON.parse(o.content))}catch(e){}return o}var g=n(5916),v=n(8856),f=n(1918),y=n(4943),b=n.n(y),E=n(7908),w=n(3539),x=n.n(w),C=n(7043),S=n.n(C);const k=S().div`
  position: absolute;
  background: white;
  width: 250px;
  height: 150px;
  border-radius: 5px;
  border: 1px solid lightgray;
`,z=S().div`
  position: absolute;
  background: white;
  width: 200px;
  height: 100px;
  border-radius: 5px;
  border: 1px solid lightgray;
`,_=S().div``,T=S().div`
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
  padding: 5px;
  background-color: aliceblue;
  text-align: center;
`,j=S().div`
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
  padding: 5px;
  background-color: lavender;
  text-align: center;
`,N=S().span`
  font-size: small;
  display: inline-block;
  max-width: 200px;
  white-space: nowrap;
  overflow: hidden !important;
  text-overflow: ellipsis;
`,I=i.forwardRef((({node:e,children:t,...n},a)=>(({node:e,children:t,...n},a)=>"splitter"===e.type||"merger"===e.type||"visualizer"===e.type?i.createElement(z,{ref:a,...n},i.createElement(j,null,i.createElement(N,null,e.properties.title)),i.createElement(_,null,t)):i.createElement(k,{ref:a,...n},i.createElement(c.Tooltip,{title:e.properties.title},i.createElement(T,null,i.createElement(N,null,e.properties.title))),i.createElement(_,null,t)))({node:e,children:t,...n},a)));var $=n(709),O=n(4848);const P=(0,$.A)((0,O.jsx)("path",{d:"m14 4 2.29 2.29-2.88 2.88 1.42 1.42 2.88-2.88L20 10V4zm-4 0H4v6l2.29-2.29 4.71 4.7V20h2v-8.41l-5.29-5.3z"}),"CallSplit"),R=(0,$.A)((0,O.jsx)("path",{d:"M17 20.41 18.41 19 15 15.59 13.59 17zM7.5 8H11v5.59L5.59 19 7 20.41l6-6V8h3.5L12 3.5z"}),"CallMerge"),L=(0,$.A)((0,O.jsx)("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"}),"Image"),A=S().div`
  min-height: 100px;
`,M=S().div`
  padding: 5px;
  display: flex;
  justify-content: center;
`,D=({node:e,config:t})=>{return i.createElement(A,null,"splitter"===e.type||"merger"===e.type||"visualizer"===e.type?i.createElement(M,null,"splitter"===(n=e.type)?i.createElement(P,{sx:{fontSize:"50px",transform:"rotate(90deg)"}}):"merger"===n?i.createElement(R,{sx:{fontSize:"50px",transform:"rotate(90deg)"}}):"visualizer"===n?i.createElement(L,{sx:{fontSize:"50px"}}):void 0):i.createElement("div",null));var n},V=S().div`
  display: flex;
  justify-content: flex-start;
`,B=S().div`
  display: flex;
  justify-content: flex-end;
`,W=S().div`
  width: 20px;
  height: 20px;
  background: ${e=>e.color};
  border-radius: 50%;
  cursor: pointer;
`,J=S().div`
  margin-top: 20px;
  width: 25px;
  height: 25px;
  background: cadetblue;
  border-radius: 5px;
  cursor: pointer;
`,U=S().div`
  margin-left: 5px;
`,F=S().div`
  margin-right: 5px;
`,H=S().span`
  display: inline-block;
  max-width: 100px;
  white-space: nowrap;
  overflow: hidden !important;
  text-overflow: ellipsis;
`,q=e=>e.port.properties.special_node?i.createElement(J,null):"left"===e.port.type?i.createElement(c.Tooltip,{title:e.port.id,placement:"right"},i.createElement(V,null,i.createElement(W,{color:e.port.properties.color}),i.createElement(U,null,i.createElement(H,null,e.port.id)))):"right"===e.port.type?i.createElement(c.Tooltip,{title:e.port.id,placement:"left"},i.createElement(B,null,i.createElement(F,null,i.createElement(H,null,e.port.id)),i.createElement(W,{color:e.port.properties.color}))):i.createElement(i.Fragment,null),G={offset:{x:0,y:0},scale:1,nodes:{},links:{},selected:{},hovered:{}};function K(e){const t={title:e.title,params:e.params.map((e=>e.name)),secrets:e.secrets.map((e=>e.name)),inputs:e.inputs.map((e=>e.name)),outputs:e.outputs.map((e=>e.name))};return(0,E.sha1)(JSON.stringify(x()(t)))}function Q(e){return{offset:{x:0,y:0},scale:1,nodes:Object.fromEntries(e.map((e=>{const t=function(e){const t=new(b());return{id:K(e).substring(0,7),type:"input-output",position:{x:35,y:15},properties:{title:e.title,params:e.params.map((e=>e.name)),secrets:e.secrets.map((e=>e.name)),inputs:e.inputs.map((e=>e.name)),outputs:e.outputs.map((e=>e.name)),vars:[...e.inputs.map((e=>({name:e.name,direction:"input",type:"datatype",color:t.hex(e.name)}))),...e.outputs.map((e=>({name:e.name,direction:"output",type:"datatype",color:t.hex(e.name)})))]},ports:Object.fromEntries([...e.inputs.map((e=>[e.name,{id:e.name,type:"left",properties:{color:t.hex(e.name)}}])),...e.outputs.map((e=>[e.name,{id:e.name,type:"right",properties:{color:t.hex(e.name)}}]))])}}(e);return[t.id,t]}))),links:{},selected:{},hovered:{}}}class X extends i.Component{constructor(){super(...arguments),this.state=(0,g.cloneDeep)(G),this.updateChart=e=>{this.setState(e)}}render(){const e=this.state,t=(0,g.mapValues)(v,(e=>(...t)=>this.setState(e(...t))));return i.createElement("div",null,i.createElement("div",{style:{margin:"10px",width:"350px",height:"200px",overflow:"hidden",borderRadius:"5px"}},i.createElement(f.FlowChart,{chart:e,callbacks:t,Components:{Node:I,NodeInner:D,Port:q}})))}}var Y=n(648),Z=n(5157),ee=n(3182);const te={offset:{x:0,y:0},scale:1,nodes:{},links:{},selected:{},hovered:{}};var ne=n(3546);const ae=({title:e,ioItems:t,updateType:n,removeEntry:a})=>s().createElement("div",null,s().createElement("p",{className:"naavre-containerizer-preview"},e),s().createElement(c.TableContainer,{component:c.Paper,className:"naavre-containerizer-table"},s().createElement(c.Table,{"aria-label":"simple table"},s().createElement(c.TableBody,null,t.map((e=>s().createElement(c.TableRow,{key:e.name},s().createElement(c.TableCell,{component:"th",scope:"row",style:{width:"70%",maxWidth:"150px",overflow:"hidden"}},s().createElement("p",{style:{fontSize:"1em"}},e.name)),s().createElement(c.TableCell,{component:"th",scope:"row",style:{width:"15%"}},s().createElement(c.FormControl,{fullWidth:!0},s().createElement(c.Select,{labelId:"io-types-select-label",id:e.name+"-select",label:"Type",value:e.type||"",error:null===e.type,onChange:t=>{n(t,e)}},s().createElement(c.MenuItem,{value:"int"},"Integer"),s().createElement(c.MenuItem,{value:"float"},"Float"),s().createElement(c.MenuItem,{value:"str"},"String"),s().createElement(c.MenuItem,{value:"list"},"List")))),s().createElement(c.TableCell,{component:"th",scope:"row",style:{width:"15%",paddingLeft:"0",paddingRight:"0"}},s().createElement(c.IconButton,{"aria-label":"delete",onClick:()=>a(e)},s().createElement(ne.A,null)))))))))),re=({items:e})=>s().createElement("div",null,s().createElement("p",{className:"naavre-containerizer-preview"},"Dependencies"),s().createElement(c.TableContainer,{component:c.Paper,className:"naavre-containerizer-table"},s().createElement(c.Table,{"aria-label":"simple table"},s().createElement(c.TableBody,null,e.map((e=>s().createElement(c.TableRow,{key:`${e.module}-${e.name}`},s().createElement(c.TableCell,{component:"th",scope:"row"},""!==e.module?e.module+" â€¢ "+e.name:e.name))))))));var oe=n(1436),le=n(854),ie=n.n(le);async function se(e,t){const n=await h("GET",`${t.containerizerServiceUrl}/status/${t.virtualLab}/${e}/`,{},{});if(200===n.status_code)return JSON.parse(n.content);if(404===n.status_code)return null;throw`${n.status_code} ${n.reason}`}async function ce(e,t,n){const a=await async function({cell:e,settings:t}){if(e.virtual_lab=t.virtualLab||void 0,null===t.virtualLab)throw"Virtual lab is null, check @naavre/containerizer-jupyterlab settings";const n=await async function({searchParams:e,settings:t}){const n=await h("GET",`${t.catalogueServiceUrl}/workflow-cells/?${e}`);if(200!==n.status_code)throw`${n.status_code} ${n.reason}`;return JSON.parse(n.content)}({searchParams:new URLSearchParams({title:e.title,virtual_lab:t.virtualLab}),settings:t});return 0===n.count?null:n.results.reduce(((e,t)=>t.version>e.version?t:e))}({cell:e,settings:n});e.version=null!==a?a.version+1:1;const r=await async function({cell:e,containerizeResponse:t,settings:n}){e.container_image=(null==t?void 0:t.container_image)||"",e.source_url=(null==t?void 0:t.source_url)||"",e.description=e.title,e.virtual_lab=n.virtualLab||void 0;const a=await h("POST",`${n.catalogueServiceUrl}/workflow-cells/`,{},e);if(201!==a.status_code)throw`${a.status_code} ${a.reason}`;return JSON.parse(a.content)}({cell:e,containerizeResponse:t,settings:n});return null!==a?(await async function({cellUrl:e,payload:t}){const n=await h("PATCH",e,{},t);if(200!==n.status_code)throw`${n.status_code} ${n.reason}`;return JSON.parse(n.content)}({cellUrl:a.url,payload:{next_version:r.url}}),"updated"):"added"}const ue={baseImageSelected:!1,baseImages:[],cellAnalyzed:!1,currentCell:{title:"",description:"",version:1,next_version:null,container_image:"",inputs:[],outputs:[],params:[],secrets:[],confs:[],dependencies:[]},extractorError:"",isDialogOpen:!1,loading:!1,typeSelections:{},forceContainerize:!1};class pe extends i.Component{constructor(e){super(e),this.state=ue,this.loadBaseImages=async()=>{h("GET",`${this.props.settings.containerizerServiceUrl}/base-image-tags?virtual_lab=${this.props.settings.virtualLab}`).then((e=>{if(200!==e.status_code)throw`${e.status_code} ${e.reason}`;return JSON.parse(e.content)})).then((e=>{const t=Object.entries(e).map((([e,t])=>({name:e,image:t})));console.log("updatedBaseImages"),console.log(t),this.setState({baseImages:t})})).catch((e=>{console.log(`Could not retrieve base image tags: ${e}`),console.log(e)}))},this.resetState=()=>{const e=ue;e.baseImages=this.state.baseImages,this.setState(e),null!==this.cellPreviewRef.current&&this.cellPreviewRef.current.updateChart(te)},this.connectAndInitWhenReady=e=>{e.context.ready.then((()=>{null!==this.props.notebook&&(this.props.notebook.content.activeCellChanged.connect(this.resetState),this.props.notebook.content.modelContentChanged.connect(this.resetState))}))},this.componentDidMount=async()=>{this.setState({currentCell:{...this.state.currentCell,virtual_lab:this.props.settings.virtualLab||void 0}}),await this.loadBaseImages(),this.props.notebook&&this.connectAndInitWhenReady(this.props.notebook)},this.componentDidUpdate=async(e,t)=>{(e.notebook?e.notebook.id:"")!==(this.props.notebook?this.props.notebook.id:"")&&(e.notebook&&(e.notebook.content.activeCellChanged.disconnect(this.resetState),e.notebook.content.modelContentChanged.disconnect(this.resetState)),this.props.notebook&&this.connectAndInitWhenReady(this.props.notebook))},this.getKernel=async()=>{var e;const t=this.props.notebook.context.sessionContext,n=null===(e=null==t?void 0:t.session)||void 0===e?void 0:e.kernel;return(await n.info).implementation},this.getTypeSelections=e=>{const t={};return[e.inputs,e.outputs,e.params,e.secrets].forEach((e=>{e.forEach((e=>t[e.name]=null!==e.type))})),t},this.extractCell=async(e,t,n=!1)=>{if(null===e)return null;const a=await this.getKernel();this.setState({loading:!0,extractorError:""}),h("POST",`${this.props.settings.containerizerServiceUrl}/extract_cell`,{},{virtual_lab:this.props.settings.virtualLab||void 0,data:{save:n,kernel:a,cell_index:t,notebook:e.toJSON()}}).then((e=>{if(200!==e.status_code)throw`${e.status_code} ${e.reason}`;return JSON.parse(e.content)})).then((e=>{const t=e,n=(e,t)=>e.name>t.name?1:e.name<t.name?-1:0;t.inputs.sort(n),t.outputs.sort(n),t.params.sort(n),t.secrets.sort(n);const a=this.getTypeSelections(t);this.setState({loading:!1,cellAnalyzed:!0,extractorError:"",currentCell:t,typeSelections:a}),null!==this.cellPreviewRef.current&&this.cellPreviewRef.current.updateChart(Q([t]))})).catch((e=>{console.log(e),this.setState({loading:!1,extractorError:String(e)})}))},this.onAnalyzeCell=()=>{this.extractCell(this.props.notebook.model,this.props.notebook.content.activeCellIndex).then((()=>{})).catch((e=>{console.log("Error extracting cell",e)}))},this.onDetectType=async()=>{this.setState({loading:!0}),(async({notebook:e,currentCell:t})=>{var n;const a=e.content.activeCell;if(!a)throw"No cell selected";if("code"!==a.model.type)throw"Selected cell is not a code cell";const r=e.content.activeCell;r.model.outputs.clear();const o=null===(n=e.sessionContext.session)||void 0===n?void 0:n.kernel;if(!o)throw"No kernel found";const l=t,i=l.inputs,s=l.outputs,c=l.params,u={};i.forEach((e=>u[e.name]=e.type)),s.forEach((e=>u[e.name]=e.type)),c.forEach((e=>u[e.name]=e.type));const p=async(e,t)=>{const n=o.requestExecute({code:e}),a={};return new Promise(((e,o)=>{n.onIOPub=e=>{if("execute_result"===e.header.msg_type){const t=e;console.log("Execution Result:",t.content)}else if("display_data"===e.header.msg_type){const n=e;console.log("Display Data:",n.content);let o=n.content.data["text/html"];o=o.replace(/['"]/g,"");const l=t[0];let i;i="integer"===o?"int":"character"===o?"str":"double"===o?"float":"list"===o?"list":u[l],null!==i&&(a[l]=i);const s={output_type:"display_data",data:{"text/plain":t[0]+": "+n.content.data["text/html"]},metadata:{}};r.model.outputs.add(s),t.shift()}else if("stream"===e.header.msg_type){const t=e;console.log("Stream:",t)}else if("error"===e.header.msg_type){const t=e,n={output_type:"display_data",data:{"text/plain":"evalue"in t.content?t.content.evalue:"No data found"},metadata:{}};r.model.outputs.add(n),console.error("Error:",t.content)}},n.onReply=t=>{"ok"===t.content.status?e(a):"error"===t.content.status&&o(t.content)}}))};let d="";i.forEach((e=>{d+=`\ntypeof(${e.name})`})),c.forEach((e=>{d+=`\ntypeof(${e.name})`}));const m=await p(d,[...i.map((e=>e.name)),...c.map((e=>e.name))]);console.log("Detected Input and Param Types:",m),await o.requestExecute({code:"xyz"}).done;let h="";s.forEach((e=>{h+=`\ntypeof(${e.name})`}));const g=await p(h,[...s.map((e=>e.name))]);console.log("Detected Output Types:",g);const v={...u,...m,...g},f={...t},y={};return f.inputs.forEach((e=>{e.name==e.name&&(e.type=v[e.name]),y[e.name]=null!==v[e.name]})),f.outputs.forEach((e=>{e.name==e.name&&(e.type=v[e.name]),y[e.name]=null!==v[e.name]})),f.params.forEach((e=>{e.name==e.name&&(e.type=v[e.name]),y[e.name]=null!==v[e.name]})),{updatedCell:f,updatedTypeSelections:y}})({notebook:this.props.notebook,currentCell:this.state.currentCell}).then((e=>{this.setState({currentCell:e.updatedCell,typeSelections:e.updatedTypeSelections}),console.log(this.state)})).catch((e=>{console.log(e)})).finally((()=>{this.setState({loading:!1})}))},this.removeVariable=async(e,t)=>{const n=this.state.currentCell;n[t]=n[t].filter((t=>t.name!==e.name));const a=this.state.typeSelections;delete a[e.name],this.setState({currentCell:n,typeSelections:a}),null!==this.cellPreviewRef.current&&this.cellPreviewRef.current.updateChart(Q([n]))},this.updateVariableType=async(e,t,n)=>{const a=this.state.currentCell;a[n].forEach((n=>{n.name===t.name&&(n.type=String(e.target.value)||null)}));const r=this.state.typeSelections;r[t.name]=!0,this.setState({currentCell:a,typeSelections:r})},this.updateBaseImage=async e=>{const t=this.state.currentCell;console.log("updateBaseImage",e),t.base_container_image=e,this.setState({baseImageSelected:!0,currentCell:t})},this.allTypesSelected=()=>Object.values(this.state.typeSelections).length>0&&Object.values(this.state.typeSelections).reduce(((e,t)=>e&&t)),this.onContainerize=async()=>{await async function(e,t,n){const a=oe.Notification.emit(`Containerizing ${e.title}: submitting cell`,"in-progress",{autoClose:!1});let r,o;try{r=await async function(e,t,n){const a=await h("POST",`${n.containerizerServiceUrl}/containerize`,{},{virtual_lab:n.virtualLab||void 0,cell:e,force_containerize:t});if(200!==a.status_code)throw`${a.status_code} ${a.reason}`;return JSON.parse(a.content)}(e,n,t),console.debug("containerizeResponse",r)}catch(t){return void oe.Notification.update({id:a,type:"error",message:`Failed to containerize ${e.title}: cannot submit cell`,autoClose:5e3})}if(r.dispatched_github_workflow){await new Promise((e=>setTimeout(e,5e3))),oe.Notification.update({id:a,message:`Containerizing ${e.title}: starting build job`});try{o=await ie()((async()=>{const e=await se(r.workflow_id,t);if(console.debug(e),null===e)throw Error("job not found");return e}),{retries:5,factor:2,minTimeout:3e3}),console.debug("statusResponse",o)}catch(t){return void oe.Notification.update({id:a,type:"error",message:`Failed to containerize ${e.title}: could not start build job`,autoClose:5e3})}oe.Notification.update({id:a,message:`Containerizing ${e.title}: building image (this can take up to several minutes)`,actions:[{label:"See progress on GitHub",callback:e=>{e.preventDefault(),window.open(null==o?void 0:o.job.html_url)}}]});try{o=await ie()((async()=>{const e=await se(r.workflow_id,t);if(null===e)throw Error("job not found");if(console.debug(e.job),"completed"!==e.job.status)throw Error("job not complete");if(null===e.job.conclusion||["action_required","cancelled","failure","stale","timed_out"].includes(e.job.conclusion))throw new le.AbortError("job was not successful");return e}),{retries:180,factor:1,minTimeout:2e4}),console.debug("statusResponse",o)}catch(t){return void oe.Notification.update({id:a,type:"error",message:`Failed to containerize ${e.title}: could not run build job`,actions:[{label:"See status on GitHub",callback:e=>{e.preventDefault(),window.open(null==o?void 0:o.job.html_url)}}],autoClose:5e3})}oe.Notification.update({id:a,message:`Containerizing ${e.title}: saving to the catalogue`,actions:[]});try{const n=await ce(e,r,t);console.debug("catalogueResponse",n)}catch(t){return void oe.Notification.update({id:a,type:"error",message:`Failed to containerize ${e.title}: save to the catalogue`,autoClose:5e3})}oe.Notification.update({id:a,type:"success",message:`Containerized ${e.title}`,autoClose:5e3})}else oe.Notification.update({id:a,type:"warning",message:`Cell ${e.title} is already containerized`,autoClose:5e3})}(this.state.currentCell,this.props.settings,this.state.forceContainerize)},this.cellPreviewRef=i.createRef()}render(){var e;return i.createElement(c.ThemeProvider,{theme:u},i.createElement("div",null,i.createElement(X,{ref:this.cellPreviewRef}),i.createElement(c.Button,{variant:"contained",className:"naavre-containerizer-button",onClick:this.onAnalyzeCell,color:"primary",disabled:!this.state.currentCell||this.state.loading},this.state.loading?i.createElement(ee.A,{size:24,color:"inherit"}):"Analyze cell"),"irkernel"===(null===(e=this.state.currentCell.kernel)||void 0===e?void 0:e.toLowerCase())&&i.createElement(c.Button,{variant:"contained",className:"naavre-containerizer-button",onClick:this.onDetectType,color:"primary",disabled:!this.state.currentCell||this.state.loading||this.allTypesSelected()},"Detect types"),this.state.extractorError&&i.createElement("div",null,i.createElement(Z.Alert,{severity:"error"},i.createElement("p",null,"Notebook cannot be analyzed: ",this.state.extractorError))),this.state.loading?i.createElement("div",null,this.state.loading?i.createElement("div",null,i.createElement("p",{className:"naavre-containerizer-preview"},i.createElement("span",null,"Analyzing notebook"),i.createElement("br",null),i.createElement("span",{style:{color:"#aaaaaa"}},"This can take up to a minute")),i.createElement(Z.Box,{className:"naavre-containerizer-table",sx:{width:"100%"}},i.createElement(Z.LinearProgress,null))):i.createElement(Y.A,null)):i.createElement("div",null,this.state.currentCell.inputs.length>0&&i.createElement(ae,{title:"Inputs",ioItems:this.state.currentCell.inputs,updateType:(e,t)=>this.updateVariableType(e,t,"inputs"),removeEntry:e=>this.removeVariable(e,"inputs")}),this.state.currentCell.outputs.length>0&&i.createElement(ae,{title:"Outputs",ioItems:this.state.currentCell.outputs,updateType:(e,t)=>this.updateVariableType(e,t,"outputs"),removeEntry:e=>this.removeVariable(e,"outputs")}),this.state.currentCell.params.length>0&&i.createElement(ae,{title:"Parameters",ioItems:this.state.currentCell.params,updateType:(e,t)=>this.updateVariableType(e,t,"params"),removeEntry:e=>this.removeVariable(e,"params")}),this.state.currentCell.secrets.length>0&&i.createElement(ae,{title:"Secrets",ioItems:this.state.currentCell.secrets,updateType:(e,t)=>this.updateVariableType(e,t,"secrets"),removeEntry:e=>this.removeVariable(e,"secrets")}),this.state.currentCell.dependencies.length>0&&i.createElement(re,{items:this.state.currentCell.dependencies}),this.state.cellAnalyzed&&i.createElement("div",null,i.createElement("p",{className:"naavre-containerizer-preview"},"Base Image"),i.createElement(Z.Autocomplete,{getOptionLabel:e=>e.name,options:this.state.baseImages,disablePortal:!0,onChange:(e,t)=>{this.updateBaseImage(t.image)},id:"combo-box-demo",sx:{width:330,margin:"20px"},renderInput:e=>i.createElement(c.TextField,{...e})}),i.createElement(c.Tooltip,{title:"Build the container image, even if the cell hasn't changed and the image already exists"},i.createElement(c.FormControlLabel,{label:"Force recontainerization",control:i.createElement(Z.Checkbox,{checked:this.state.forceContainerize,onChange:e=>{this.setState({forceContainerize:e.target.checked})}}),style:{margin:"0.5rem"}})),i.createElement(c.Button,{variant:"contained",className:"naavre-containerizer-button",onClick:this.onContainerize,color:"primary",disabled:!this.allTypesSelected()||!this.state.baseImageSelected||this.state.loading,style:{float:"right"}},"Containerize")))))}}const de={virtualLab:null,containerizerServiceUrl:null,catalogueServiceUrl:null},me=({tracker:e,settings:t})=>{const[n,a]=(0,i.useState)("");(0,i.useEffect)((()=>{e.currentChanged.connect(o,void 0),e.currentWidget instanceof r.NotebookPanel&&a(e.currentWidget.context.path)}),[e]);const o=(e,t)=>{t&&a(t.context.path)};return s().createElement(p.A,{theme:u},s().createElement("div",{style:{flexDirection:"column",minWidth:"var(--jp-sidebar-min-width)",color:"var(--jp-ui-font-color1)",background:"var(--jp-layout-color1)",fontSize:"var(--jp-ui-font-size1)",overflow:"auto",height:"100%",display:"flex"}},s().createElement("div",{style:{minWidth:"var(--jp-sidebar-min-width)",overflow:"auto"}},s().createElement("div",null,s().createElement("p",{style:{fontSize:"var(--jp-ui-font-size3)",padding:"10px",fontWeight:"800",letterSpacing:"0.5px"}},"Component containerizer"),s().createElement(c.Divider,null),s().createElement("div",null,s().createElement("p",{style:{fontSize:"var(--jp-ui-font-size2)",padding:"10px",color:"cornflowerblue",fontWeight:"700"}},n)),s().createElement(c.Divider,null)),s().createElement("div",{style:{marginTop:5}},s().createElement(pe,{notebook:e.currentWidget,settings:t})))))};class he extends l.ReactWidget{constructor(e){super(),this.settings=de,this.tracker=e}updateSettings(e){this.settings={...this.settings,...e},this.update()}render(){return s().createElement(me,{tracker:this.tracker,settings:this.settings})}}const ge=new l.LabIcon({name:"extension-icon",svgstr:'<?xml version="1.0" encoding="UTF-8"?>\n\x3c!-- Created with Inkscape (http://www.inkscape.org/) --\x3e\n<svg width="642.52" height="642.52" version="1.1" viewBox="0 0 170 170" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"><g transform="matrix(.3323 0 0 .3323 -.13759 -.19103)" fill="#3c8f49" stroke-width=".79622">\n\t<g fill="#3c8f49" stroke-width=".79622">\n\t\t<path d="m470.57 369.84c-1.951-5.285-7.815-7.988-13.1-6.038l-106.07 39.139c-5.285 1.95-7.988 7.815-6.038 13.1 1.521 4.12 5.42 6.671 9.57 6.671 1.172 0 2.365-0.204 3.53-0.633l106.07-39.139c5.285-1.95 7.988-7.815 6.038-13.1z"/>\n\t\t<path d="m335.34 419.74c-1.949-5.286-7.815-7.989-13.1-6.039l-4.492 1.657c-5.284 1.95-7.988 7.815-6.038 13.099 1.52 4.12 5.42 6.672 9.57 6.672 1.172 0 2.365-0.204 3.53-0.633l4.492-1.657c5.284-1.95 7.988-7.814 6.038-13.099z"/>\n\t\t<path d="m470.57 328.28c-1.951-5.285-7.815-7.986-13.1-6.038l-83.825 30.93c-5.285 1.95-7.988 7.815-6.038 13.1 1.521 4.12 5.42 6.671 9.57 6.671 1.172 0 2.365-0.204 3.53-0.633l83.825-30.93c5.285-1.95 7.988-7.815 6.038-13.1z"/>\n\t\t<path d="m470.57 287.15c-1.951-5.285-7.815-7.986-13.1-6.038l-83.825 30.93c-5.285 1.95-7.988 7.815-6.038 13.1 1.521 4.12 5.42 6.671 9.57 6.671 1.172 0 2.365-0.204 3.53-0.633l83.825-30.93c5.285-1.95 7.988-7.815 6.038-13.1z"/>\n\t</g>\n</g><g transform="matrix(.33203 0 0 .33203 0 -.18856)" fill="#3c8f49" stroke-width=".79686">\n\t<g fill="#3c8f49" stroke-width=".79686">\n\t\t<path d="m505.33 100.53-245.8-90.696c-2.279-0.84-4.783-0.84-7.061 0l-245.8 90.696-2e-3 8e-3c-0.805 0.298-1.579 0.692-2.299 1.193-2.737 1.908-4.368 5.033-4.368 8.368v291.81c0 4.271 2.661 8.09 6.668 9.569l245.8 90.696c1.146 0.423 2.341 0.63 3.53 0.63 1.201 0 2.396-0.218 3.528-0.636l4e-3 6e-3 245.8-90.696c4.007-1.479 6.668-5.297 6.668-9.569v-291.81c0-4.272-2.661-8.09-6.668-9.569zm-259.53 377.44-225.4-83.17v-270.06l45.896 16.936v123.58c0 4.271 2.661 8.09 6.668 9.569l110.15 40.645c1.146 0.423 2.341 0.63 3.53 0.63 2.058 0 4.098-0.623 5.833-1.832 2.736-1.907 4.367-5.032 4.367-8.367v-116.05l48.956 18.064v270.06zm-69.355-295.65v108.94l-89.753-33.118v-108.94zm-70.489-47.834 80.688-29.773 80.688 29.773-80.688 29.773zm150.04 55.445-40.001-14.76 84.329-31.117c4.007-1.479 6.668-5.297 6.668-9.569s-2.661-8.09-6.668-9.569l-110.15-40.644c-2.279-0.84-4.782-0.84-7.062 0l-106.73 39.384-36.72-13.55 216.34-79.824 216.34 79.825zm235.6 204.87-225.4 83.169v-270.06l225.4-83.17z" fill="#3c8f49" stroke-width=".79686"/>\n\t</g>\n</g></svg>\n'}),ve={id:"@naavre/containerizer-jupyterlab:plugin",description:"NaaVRE cells containerizer frontend on Jupyter Lab",autoStart:!0,requires:[a.ILayoutRestorer,r.INotebookTracker],optional:[o.ISettingRegistry],activate:(e,t,n,a)=>{let r;if(console.log("JupyterLab extension @naavre/containerizer-jupyterlab is activated!"),a){const t=a.load(ve.id);Promise.all([t,e.restored]).then((([e])=>{function t(e){r.updateSettings(e.composite)}e.changed.connect(t),t(e)})).catch((e=>{console.error("Failed to load settings for @naavre/containerizer-jupyterlab.",e)}))}e.started.then((()=>{r=new he(n),r.id="NaaVRE-containerizer-jupyterlab",r.title.icon=ge,r.title.caption="NaaVRE containerizer",t.add(r,r.id)})),e.restored.then((()=>{r.isAttached||e.shell.add(r,"left")}))}},fe=ve},5709:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},8784:(e,t,n)=>{var a=n(5735).default;function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}e.exports=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var o={__proto__:null},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=l?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(o,i,s):o[i]=e[i]}return o.default=e,n&&n.set(e,o),o},e.exports.__esModule=!0,e.exports.default=e.exports},5735:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},3546:(e,t,n)=>{"use strict";var a=n(5709),r=n(8784);t.A=void 0;var o=r(n(3345)),l=(0,a(n(6447)).default)(o.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");t.A=l},6447:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a.createSvgIcon}});var a=n(9010)}}]);